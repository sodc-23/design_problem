var fabric=fabric||{version:"2.3.3"};function resizeCanvasIfNeeded(t){var e=t.targetCanvas,i=e.width,n=e.height,r=t.destinationWidth,o=t.destinationHeight;i===r&&n===o||(e.width=r,e.height=o)}function copyGLTo2DDrawImage(t,e){var i=t.canvas,n=e.targetCanvas,r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1);var o=i.height-n.height;r.drawImage(i,0,o,n.width,n.height,0,0,n.width,n.height)}function copyGLTo2DPutImageData(t,e){var i=e.targetCanvas.getContext("2d"),n=e.destinationWidth,r=e.destinationHeight,o=n*r*4,s=new Uint8Array(this.imageBuffer,0,o),a=new Uint8ClampedArray(this.imageBuffer,0,o);t.readPixels(0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,s);var c=new ImageData(a,n,r);i.putImageData(c,0,0)}"undefined"!=typeof exports?exports.fabric=fabric:"function"==typeof define&&define.amd&&define([],function(){return fabric}),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=fabric.document.defaultView,DOMParser=require("xmldom").DOMParser),fabric.isTouchSupported="ontouchstart"in fabric.window,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","instantiated_by_use"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.canvasModule="canvas",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=fabric),function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:fabric.util.array.fill(i,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof e)for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=!1,n=0,r=arguments.length;n<r;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return-1<this.getObjects().indexOf(t)},complexity:function(){return this.getObjects().reduce(function(t,e){return t+(e.complexity?e.complexity():0)},0)}},fabric.CommonMethods={_setOptions:function(t){for(var e in t)this.set(e,t[e])},_initGradient:function(t,e){!t||!t.colorStops||t instanceof fabric.Gradient||this.set(e,new fabric.Gradient(t))},_initPattern:function(t,e,i){!t||!t.source||t instanceof fabric.Pattern?i&&i():this.set(e,new fabric.Pattern(t,i))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var e=fabric.util.getFunctionBody(t.clipTo);void 0!==e&&(this.clipTo=new Function("ctx",e))}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,e){this[t]=e},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},get:function(t){return this[t]}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.pow,r=Math.abs,o=Math.PI/180,s=Math.PI/2;fabric.util={cos:function(t){if(0===t)return 1;switch(t<0&&(t=-t),t/s){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},sin:function(t){if(0===t)return 0;var e=1;switch(t<0&&(e=-1),t/s){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(t)},removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*o},radiansToDegrees:function(t){return t/o},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=fabric.util.rotateVector(t,i);return new fabric.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=fabric.util.sin(e),n=fabric.util.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),n=fabric.util.array.max(e)-i,r=[t[0].y,t[1].y,t[2].y,t[3].y],o=fabric.util.array.min(r);return{left:i,top:o,width:n,height:fabric.util.array.max(r)-o}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},resolveNamespace:function(e){if(!e)return fabric;var i,n=e.split("."),r=n.length,o=t||fabric.window;for(i=0;i<r;++i)o=o[n[i]];return o},loadImage:function(t,e,i,n){if(t){var r=fabric.util.createImage(),o=function(){e&&e.call(i,r),r=r.onload=r.onerror=null};r.onload=o,r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),"data:image/svg"===t.substring(0,14)&&(r.onload=null,fabric.util.loadImageInDom(r,o)),r.src=t}else e&&e.call(i,t)},loadImageInDom:function(t,e){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(t),fabric.document.querySelector("body").appendChild(i),t.onload=function(){e(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(t,e,i,n){function r(){++s===a&&e&&e(o)}var o=[],s=0,a=(t=t||[]).length;a?t.forEach(function(t,e){t&&t.type?fabric.util.getKlass(t.type,i).fromObject(t,function(i,s){s||(o[e]=i),n&&n(t,i,s),r()}):r()}):e&&e(o)},enlivenPatterns:function(t,e){function i(){++r===o&&e&&e(n)}var n=[],r=0,o=(t=t||[]).length;o?t.forEach(function(t,e){t&&t.source?new fabric.Pattern(t,function(t){n[e]=t,i()}):(n[e]=t,i())}):e&&e(n)},groupSVGElements:function(t,e,i){var n;return 1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),n=new fabric.Group(t,e),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;n<r;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,o,s,a){var c=o-n,l=s-r,u=e(c*c+l*l),h=i(l,c),f=a.length,p=0,d=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(h),n=0;n<u;)u<(n+=a[p++%f])&&(n=u),t[d?"lineTo":"moveTo"](n,0),d=!d;t.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},createImage:function(){return fabric.document.createElement("img")},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var r=i(t[1],t[0]),s=n(t[0],2)+n(t[1],2),a=e(s),c=(t[0]*t[3]-t[2]*t[1])/a,l=i(t[0]*t[2]+t[1]*t[3],s);return{angle:r/o,scaleX:a,scaleY:c,skewX:l/o,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var n=[1,0,r(Math.tan(i*o)),1],s=[r(t),0,0,r(e)];return fabric.util.multiplyTransformMatrices(s,n,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){0<n&&(n<e?e-=n:e=0,n<i?i-=n:i=0);var r,o=!0,s=t.getImageData(e,i,2*n||1,2*n||1),a=s.data.length;for(r=3;r<a&&!1!=(o=s.data[r]<=0);r+=4);return s=null,o},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n=t.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(e=i,i="meet"):n.length&&(e=n.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){(t=(t||"").toLowerCase())?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}},limitDimsByArea:function(t,e){var i=Math.sqrt(e*t),n=Math.floor(e/i);return{x:Math.floor(i),y:n}},capValue:function(t,e,i){return Math.max(t,Math.min(e,i))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)}}}("undefined"!=typeof exports?exports:this),function(){var t={},e={},i={},n=Array.prototype.join;function r(e,i,r,a,c,l,u){var h=n.call(arguments);if(t[h])return t[h];var f=Math.PI,p=u*f/180,d=fabric.util.sin(p),g=fabric.util.cos(p),m=0,v=0,_=-g*e*.5-d*i*.5,b=-g*i*.5+d*e*.5,y=(r=Math.abs(r))*r,w=(a=Math.abs(a))*a,x=b*b,C=_*_,S=y*w-y*x-w*C,T=0;if(S<0){var O=Math.sqrt(1-S/(y*w));r*=O,a*=O}else T=(c===l?-1:1)*Math.sqrt(S/(y*x+w*C));var k=T*r*b/a,$=-T*a*_/r,A=g*k-d*$+.5*e,E=d*k+g*$+.5*i,j=s(1,0,(_-k)/r,(b-$)/a),I=s((_-k)/r,(b-$)/a,(-_-k)/r,(-b-$)/a);0===l&&0<I?I-=2*f:1===l&&I<0&&(I+=2*f);for(var M=Math.ceil(Math.abs(I/f*2)),P=[],D=I/M,F=8/3*Math.sin(D/4)*Math.sin(D/4)/Math.sin(D/2),L=j+D,R=0;R<M;R++)P[R]=o(j,L,g,d,r,a,A,E,F,m,v),m=P[R][4],v=P[R][5],j=L,L+=D;return t[h]=P}function o(t,i,r,o,s,a,c,l,u,h,f){var p=n.call(arguments);if(e[p])return e[p];var d=fabric.util.cos(t),g=fabric.util.sin(t),m=fabric.util.cos(i),v=fabric.util.sin(i),_=r*s*m-o*a*v+c,b=o*s*m+r*a*v+l,y=h+u*(-r*s*g-o*a*d),w=f+u*(-o*s*g+r*a*d),x=_+u*(r*s*v+o*a*m),C=b+u*(o*s*v-r*a*m);return e[p]=[y,w,x,C,_,b],e[p]}function s(t,e,i,n){var r=Math.atan2(e,t),o=Math.atan2(n,i);return r<=o?o-r:2*Math.PI-(r-o)}function a(t,e,r,o,s,a,c,l){var u=n.call(arguments);if(i[u])return i[u];var h,f,p,d,g,m,v,_,b=Math.sqrt,y=Math.min,w=Math.max,x=Math.abs,C=[],S=[[],[]];f=6*t-12*r+6*s,h=-3*t+9*r-9*s+3*c,p=3*r-3*t;for(var T=0;T<2;++T)if(0<T&&(f=6*e-12*o+6*a,h=-3*e+9*o-9*a+3*l,p=3*o-3*e),x(h)<1e-12){if(x(f)<1e-12)continue;0<(d=-p/f)&&d<1&&C.push(d)}else(v=f*f-4*p*h)<0||(0<(g=(-f+(_=b(v)))/(2*h))&&g<1&&C.push(g),0<(m=(-f-_)/(2*h))&&m<1&&C.push(m));for(var O,k,$,A=C.length,E=A;A--;)O=($=1-(d=C[A]))*$*$*t+3*$*$*d*r+3*$*d*d*s+d*d*d*c,S[0][A]=O,k=$*$*$*e+3*$*$*d*o+3*$*d*d*a+d*d*d*l,S[1][A]=k;S[0][E]=t,S[1][E]=e,S[0][E+1]=c,S[1][E+1]=l;var j=[{x:y.apply(null,S[0]),y:y.apply(null,S[1])},{x:w.apply(null,S[0]),y:w.apply(null,S[1])}];return i[u]=j}fabric.util.drawArc=function(t,e,i,n){for(var o=n[0],s=n[1],a=n[2],c=n[3],l=n[4],u=[[],[],[],[]],h=r(n[5]-e,n[6]-i,o,s,c,l,a),f=0,p=h.length;f<p;f++)u[f][0]=h[f][0]+e,u[f][1]=h[f][1]+i,u[f][2]=h[f][2]+e,u[f][3]=h[f][3]+i,u[f][4]=h[f][4]+e,u[f][5]=h[f][5]+i,t.bezierCurveTo.apply(t,u[f])},fabric.util.getBoundsOfArc=function(t,e,i,n,o,s,c,l,u){for(var h,f=0,p=0,d=[],g=r(l-t,u-e,i,n,s,c,o),m=0,v=g.length;m<v;m++)h=a(f,p,g[m][0],g[m][1],g[m][2],g[m][3],g[m][4],g[m][5]),d.push({x:h[0].x+t,y:h[0].y+e}),d.push({x:h[1].x+t,y:h[1].y+e}),f=g[m][4],p=g[m][5];return d},fabric.util.getBoundsOfCurve=a}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var n=t.call(arguments,2),r=[],o=0,s=e.length;o<s;o++)r[o]=n.length?e[o][i].apply(e[o],n):e[o][i].call(e[o]);return r},min:function(t,i){return e(t,i,function(t,e){return t<e})},max:function(t,i){return e(t,i,function(t,e){return e<=t})}}}(),function(){function t(e,i,n){if(n)if(!fabric.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var r=0,o=i.length;r<o;r++)e[r]=t({},i[r],n)}else if(i&&"object"==typeof i)for(var s in i)i.hasOwnProperty(s)&&(e[s]=t({},i[s],n));else e=i;else for(var s in i)e[s]=i[s];return e}fabric.util.object={extend:t,clone:function(e,i){return t({},e,i)}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function t(t,e){var i=t.charCodeAt(e);if(isNaN(i))return"";if(i<55296||57343<i)return t.charAt(e);if(55296<=i&&i<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";var n=t.charCodeAt(e+1);if(n<56320||57343<n)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var r=t.charCodeAt(e-1);if(r<55296||56319<r)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(e){var i,n=0,r=[];for(n=0;n<e.length;n++)!1!==(i=t(e,n))&&r.push(i);return r}}}(),function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),n=function(t,e,n){for(var r in e)r in t.prototype&&"function"==typeof t.prototype[r]&&-1<(e[r]+"").indexOf("callSuper")?t.prototype[r]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return r}}(r):t.prototype[r]=e[r],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function r(){}function o(e){for(var i=null,n=this;n.constructor.superclass;){var r=n.constructor.superclass.prototype[e];if(n[e]!==r){i=r;break}n=n.constructor.superclass.prototype}return i?1<arguments.length?i.apply(this,t.call(arguments,1)):i.call(this):console.log("tried to callSuper "+e+", method not found in prototype chain",this)}fabric.util.createClass=function(){var i=null,s=t.call(arguments,0);function a(){this.initialize.apply(this,arguments)}"function"==typeof s[0]&&(i=s.shift()),a.superclass=i,a.subclasses=[],i&&(r.prototype=i.prototype,a.prototype=new r,i.subclasses.push(a));for(var c=0,l=s.length;c<l;c++)n(a,s[c],i);return a.prototype.initialize||(a.prototype.initialize=e),(a.prototype.constructor=a).prototype.callSuper=o,a}}(),function(){function t(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;i<r;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}var e,i,n,r,o=(n=0,function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)});r={},e=function(t){return r[t]},i=function(t,e){r[t]=e};var s,a,c=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),l=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),u={},h={};c?(s=function(t,e,i,n){t&&t.addEventListener(e,i,!l&&n)},a=function(t,e,i,n){t&&t.removeEventListener(e,i,!l&&n)}):l?(s=function(t,n,r){if(t){var s=o(t);i(s,t),u[s]||(u[s]={}),u[s][n]||(u[s][n]=[]);var a={handler:c=r,wrappedHandler:(l=s,h=c,function(t){h.call(e(l),t||fabric.window.event)})};u[s][n].push(a),t.attachEvent("on"+n,a.wrappedHandler)}var c,l,h},a=function(t,e,i){if(t){var n,r=o(t);if(u[r]&&u[r][e])for(var s=0,a=u[r][e].length;s<a;s++)(n=u[r][e][s])&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),u[r][e][s]=null)}}):(s=function(t,e,i){if(t){var n,r,s=o(t);if(h[s]||(h[s]={}),!h[s][e]){h[s][e]=[];var a=t["on"+e];a&&h[s][e].push(a),t["on"+e]=(n=s,r=e,function(t){if(h[n]&&h[n][r])for(var e=h[n][r],i=0,o=e.length;i<o;i++)e[i].call(this,t||fabric.window.event)})}h[s][e].push(i)}},a=function(t,e,i){if(t){var n=o(t);if(h[n]&&h[n][e])for(var r=h[n][e],s=0,a=r.length;s<a;s++)r[s]===i&&r.splice(s,1)}}),fabric.util.addListener=s,fabric.util.removeListener=a;var f=function(t){return t.clientX},p=function(t){return t.clientY};function d(t,e,i){var n,r=t["touchend"===t.type?"changedTouches":"touches"];return r&&r[0]&&(n=r[0][i]),void 0===n&&(n=t[i]),n}fabric.isTouchSupported&&(f=function(t){return d(t,0,"clientX")},p=function(t){return d(t,0,"clientY")}),fabric.util.getPointer=function(t){t||(t=fabric.window.event);var e=t.target||("unknown"!=typeof t.srcElement?t.srcElement:null),i=fabric.util.getScrollLeftTop(e);return{x:f(t)+i.left,y:p(t)+i.top}}}(),function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(t){return t};e?r=function(t,e){return t.style.opacity=e,t}:i&&(r=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),n.test(i.filter)?(e=.9999<=e?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(n,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,-1<e.indexOf("opacity")?r(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"===n?r(t,e[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n];return t}}(),function(){var t,e,i,n,r=Array.prototype.slice,o=function(t){return r.call(t,0)};try{t=o(fabric.document.childNodes)instanceof Array}catch(t){}function s(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function a(t){for(var e=0,i=0,n=fabric.document.documentElement,r=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:i}}t||(o=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),e=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},i=fabric.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"",fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),n?t.style[n]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),n?t.style[n]="":"string"==typeof t.unselectable&&(t.unselectable=""),t},fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)},fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=o,fabric.util.makeElement=s,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=s(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},fabric.util.getScrollLeftTop=a,fabric.util.getElementOffset=function(t){var i,n,r=t&&t.ownerDocument,o={left:0,top:0},s={left:0,top:0},c={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return s;for(var l in c)s[c[l]]+=parseInt(e(t,l),10)||0;return i=r.documentElement,void 0!==t.getBoundingClientRect&&(o=t.getBoundingClientRect()),n=a(t),{left:o.left+n.left-(i.clientLeft||0)+s.left,top:o.top+n.top-(i.clientTop||0)+s.top}},fabric.util.getElementStyle=e,fabric.util.getNodeCanvas=function(t){var e=fabric.jsdomImplForWrapper(t);return e._canvas||e._image}}(),function(){var t=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();function e(){}fabric.util.request=function(i,n){n||(n={});var r,o,s=n.method?n.method.toUpperCase():"GET",a=n.onComplete||function(){},c=t(),l=n.body||n.parameters;return c.onreadystatechange=function(){4===c.readyState&&(a(c),c.onreadystatechange=e)},"GET"===s&&(l=null,"string"==typeof n.parameters&&(r=i,o=n.parameters,i=r+(/\?/.test(r)?"&":"?")+o)),c.open(s,i,!0),"POST"!==s&&"PUT"!==s||c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(l),c}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){function t(){return!1}var e=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){return fabric.window.setTimeout(t,1e3/60)},i=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function n(){return e.apply(fabric.window,arguments)}fabric.util.animate=function(e){n(function(i){e||(e={});var r,o=i||+new Date,s=e.duration||500,a=o+s,c=e.onChange||t,l=e.abort||t,u=e.onComplete||t,h=e.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},f="startValue"in e?e.startValue:0,p="endValue"in e?e.endValue:100,d=e.byValue||p-f;e.onStart&&e.onStart(),function t(i){if(l())u(p,1,1);else{r=i||+new Date;var g=a<r?s:r-o,m=g/s,v=h(g,f,d,s),_=Math.abs((v-f)/d);c(v,_,m),a<r?e.onComplete&&e.onComplete():n(t)}}(o)})},fabric.util.requestAnimFrame=n,fabric.util.cancelAnimFrame=function(){return i.apply(fabric.window,arguments)}}(),fabric.util.animateColor=function(t,e,i,n){var r=new fabric.Color(t).getSource(),o=new fabric.Color(e).getSource();n=n||{},fabric.util.animate(fabric.util.object.extend(n,{duration:i||500,startValue:r,endValue:o,byValue:o,easing:function(t,e,i,r){var o,s,a,c;return o=e,s=i,a=n.colorEasing?n.colorEasing(t,r):1-Math.cos(t/r*(Math.PI/2)),c="rgba("+parseInt(o[0]+a*(s[0]-o[0]),10)+","+parseInt(o[1]+a*(s[1]-o[1]),10)+","+parseInt(o[2]+a*(s[2]-o[2]),10),(c+=","+(o&&s?parseFloat(o[3]+a*(s[3]-o[3])):1))+")"}}))},function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function i(t,e,i,r){return i-n(r-t,0,i,r)+e}function n(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,n,r,o){var s=0;return 0===i?n:1==(i/=o)?n+r:(s||(s=.3*o),-e(t(r,r,s,1.70158),i,o)+n)},easeOutElastic:function(e,i,n,r){var o=0;if(0===e)return i;if(1==(e/=r))return i+n;o||(o=.3*r);var s=t(n,n,o,1.70158);return s.a*Math.pow(2,-10*e)*Math.sin((e*r-s.s)*(2*Math.PI)/s.p)+s.c+i},easeInOutElastic:function(i,n,r,o){var s=0;if(0===i)return n;if(2==(i/=o/2))return n+r;s||(s=o*(.3*1.5));var a=t(r,r,s,1.70158);return i<1?-.5*e(a,i,o)+n:a.a*Math.pow(2,-10*(i-=1))*Math.sin((i*o-a.s)*(2*Math.PI)/a.p)*.5+a.c+n},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(t,e,r,o){return t<o/2?.5*i(2*t,0,r,o)+e:.5*n(2*t-o,0,r,o)+.5*r+e}}}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,o=e.util.parseUnit,s=e.util.multiplyTransformMatrices,a={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity"},c={stroke:"strokeOpacity",fill:"fillOpacity"};function l(t,i,n,r){var a,c="[object Array]"===Object.prototype.toString.call(i);if("fill"!==t&&"stroke"!==t||"none"!==i)if("strokeDashArray"===t)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)});else if("transformMatrix"===t)i=n&&n.transformMatrix?s(n.transformMatrix,e.parseTransformAttribute(i)):e.parseTransformAttribute(i);else if("visible"===t)i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1);else if("opacity"===t)i=parseFloat(i),n&&void 0!==n.opacity&&(i*=n.opacity);else if("textAnchor"===t)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===t)a=o(i,r)/r*1e3;else if("paintFirst"===t){var l=i.indexOf("fill"),u=i.indexOf("stroke");i="fill",-1<l&&-1<u&&u<l?i="stroke":-1===l&&-1<u&&(i="stroke")}else a=c?i.map(o):o(i,r);else i="";return!c&&isNaN(a)?i:a}function u(t){return new RegExp("^("+t.join("|")+")\\b","i")}function h(t,e){var i,n,r,o,s=[];for(r=0,o=e.length;r<o;r++)i=e[r],n=t.getElementsByTagName(i),s=s.concat(Array.prototype.slice.call(n));return s}function f(t,e){var i,n,r=t.nodeName,o=t.getAttribute("class"),s=t.getAttribute("id");if(i=new RegExp("^"+r,"i"),e=e.replace(i,""),s&&e.length&&(i=new RegExp("#"+s+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),o&&e.length)for(n=(o=o.split(" ")).length;n--;)i=new RegExp("\\."+o[n]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function p(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,r,o,s=t.getElementsByTagName("*");for(r=0,o=s.length;r<o;r++)if(e===(n=s[r]).getAttribute("id"))return n}e.svgValidTagNamesRegEx=u(["path","circle","polygon","polyline","ellipse","rect","line","image","text","linearGradient","radialGradient","stop"]),e.svgViewBoxElementsRegEx=u(["symbol","image","marker","pattern","view","svg"]),e.svgInvalidAncestorsRegEx=u(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),e.svgValidParentsRegEx=u(["symbol","g","a","svg"]),e.cssRules={},e.gradientDefs={},e.parseTransformAttribute=function(){function t(t,i,n){t[n]=Math.tan(e.util.degreesToRadians(i[0]))}var i=[1,0,0,1,0,0],n=e.reNum,r="(?:\\s+,?\\s*|,\\s*)",o="(?:(?:(matrix)\\s*\\(\\s*("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+")"+r+"("+n+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\)))",s=new RegExp("^\\s*(?:(?:"+o+"(?:"+r+"*"+o+")*)?)\\s*$"),a=new RegExp(o,"g");return function(n){var r=i.concat(),c=[];if(!n||n&&!s.test(n))return r;n.replace(a,function(n){var s,a,l,u,h,f,p,d,g,m,v,_,b=new RegExp(o).exec(n).filter(function(t){return!!t}),y=b[1],w=b.slice(2).map(parseFloat);switch(y){case"translate":_=w,(v=r)[4]=_[0],2===_.length&&(v[5]=_[1]);break;case"rotate":w[0]=e.util.degreesToRadians(w[0]),h=r,f=w,p=e.util.cos(f[0]),d=e.util.sin(f[0]),m=g=0,3===f.length&&(g=f[1],m=f[2]),h[0]=p,h[1]=d,h[2]=-d,h[3]=p,h[4]=g-(p*g-d*m),h[5]=m-(d*g+p*m);break;case"scale":s=r,l=(a=w)[0],u=2===a.length?a[1]:a[0],s[0]=l,s[3]=u;break;case"skewX":t(r,w,2);break;case"skewY":t(r,w,1);break;case"matrix":r=w}c.push(r.concat()),r=i.concat()});for(var l=c[0];1<c.length;)c.shift(),l=e.util.multiplyTransformMatrices(l,c[0]);return l}}();var d=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function g(t){var i,n,r,s,a,c,l=t.getAttribute("viewBox"),u=1,h=1,f=t.getAttribute("width"),p=t.getAttribute("height"),g=t.getAttribute("x")||0,m=t.getAttribute("y")||0,v=t.getAttribute("preserveAspectRatio")||"",_=!l||!e.svgViewBoxElementsRegEx.test(t.nodeName)||!(l=l.match(d)),b=!f||!p||"100%"===f||"100%"===p,y=_&&b,w={},x="",C=0,S=0;if(w.width=0,w.height=0,w.toBeParsed=y)return w;if(_)return w.width=o(f),w.height=o(p),w;if(i=-parseFloat(l[1]),n=-parseFloat(l[2]),r=parseFloat(l[3]),s=parseFloat(l[4]),b?(w.width=r,w.height=s):(w.width=o(f),w.height=o(p),u=w.width/r,h=w.height/s),"none"!==(v=e.util.parsePreserveAspectRatioAttribute(v)).alignX&&("meet"===v.meetOrSlice&&(h=u=h<u?h:u),"slice"===v.meetOrSlice&&(h=u=h<u?u:h),C=w.width-r*u,S=w.height-s*u,"Mid"===v.alignX&&(C/=2),"Mid"===v.alignY&&(S/=2),"Min"===v.alignX&&(C=0),"Min"===v.alignY&&(S=0)),1===u&&1===h&&0===i&&0===n&&0===g&&0===m)return w;if((g||m)&&(x=" translate("+o(g)+" "+o(m)+") "),a=x+" matrix("+u+" 0 0 "+h+" "+(i*u+C)+" "+(n*h+S)+") ","svg"===t.nodeName){for(c=t.ownerDocument.createElement("g");t.firstChild;)c.appendChild(t.firstChild);t.appendChild(c)}else a=(c=t).getAttribute("transform")+a;return c.setAttribute("transform",a),w}e.parseSVGDocument=function(t,i,r,o){if(t){!function(t){for(var e=h(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var n,r,o,s,a=e[i],c=a.getAttribute("xlink:href").substr(1),l=a.getAttribute("x")||0,u=a.getAttribute("y")||0,f=p(t,c).cloneNode(!0),d=(f.getAttribute("transform")||"")+" translate("+l+", "+u+")",m=e.length;if(g(f),/^svg$/i.test(f.nodeName)){var v=f.ownerDocument.createElement("g");for(r=0,s=(o=f.attributes).length;r<s;r++)n=o.item(r),v.setAttribute(n.nodeName,n.nodeValue);for(;f.firstChild;)v.appendChild(f.firstChild);f=v}for(r=0,s=(o=a.attributes).length;r<s;r++)"x"!==(n=o.item(r)).nodeName&&"y"!==n.nodeName&&"xlink:href"!==n.nodeName&&("transform"===n.nodeName?d=n.nodeValue+" "+d:f.setAttribute(n.nodeName,n.nodeValue));f.setAttribute("transform",d),f.setAttribute("instantiated_by_use","1"),f.removeAttribute("id"),a.parentNode.replaceChild(f,a),e.length===m&&i++}}(t);var s,a,c=e.Object.__uid++,l=g(t),u=e.util.toArray(t.getElementsByTagName("*"));if(l.crossOrigin=o&&o.crossOrigin,l.svgUid=c,0===u.length&&e.isLikelyNode){var f=[];for(s=0,a=(u=t.selectNodes('//*[name(.)!="svg"]')).length;s<a;s++)f[s]=u[s];u=f}var d=u.filter(function(t){return g(t),e.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,e.svgInvalidAncestorsRegEx)});!d||d&&!d.length?i&&i([],{}):(e.gradientDefs[c]=e.getGradientDefs(t),e.cssRules[c]=e.getCSSRules(t),e.parseElements(d,function(t,e){i&&i(t,l,e,u)},n(l),r,o))}};var m=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");i(e,{parseFontDeclaration:function(t,e){var i=t.match(m);if(i){var n=i[1],r=i[3],s=i[4],a=i[5],c=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),s&&(e.fontSize=o(s)),c&&(e.fontFamily=c),a&&(e.lineHeight="normal"===a?1:a)}},getGradientDefs:function(t){var e,i,n,r=h(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),o=0,s={},a={};for(o=r.length;o--;)n=(e=r[o]).getAttribute("xlink:href"),i=e.getAttribute("id"),n&&(a[i]=n.substr(1)),s[i]=e;for(i in a){var c=s[a[i]].cloneNode(!0);for(e=s[i];c.firstChild;)e.appendChild(c.firstChild)}return s},parseAttributes:function(t,n,o){if(t){var s,u,h={};void 0===o&&(o=t.getAttribute("svgUid")),t.parentNode&&e.svgValidParentsRegEx.test(t.parentNode.nodeName)&&(h=e.parseAttributes(t.parentNode,n,o)),u=h&&h.fontSize||t.getAttribute("font-size")||e.Text.DEFAULT_SVG_FONT_SIZE;var p=n.reduce(function(e,i){return(s=t.getAttribute(i))&&(e[i]=s),e},{});p=i(p,i(function(t,i){var n,r,o,s,a={};for(var c in e.cssRules[i])if(n=t,r=c.split(" "),o=void 0,s=void 0,s=!0,(o=f(n,r.pop()))&&r.length&&(s=function(t,e){for(var i,n=!0;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=f(t,i);return 0===e.length}(n,r)),o&&s&&0===r.length)for(var l in e.cssRules[i][c])a[l]=e.cssRules[i][c][l];return a}(t,o),e.parseStyleAttribute(t)));var d,g,m,v={};for(var _ in p)g=l(d=(m=_)in a?a[m]:m,p[_],h,u),v[d]=g;v&&v.font&&e.parseFontDeclaration(v.font,v);var b=i(h,v);return e.svgValidParentsRegEx.test(t.nodeName)?b:function(t){for(var i in c)if(void 0!==t[c[i]]&&""!==t[i]){if(void 0===t[i]){if(!e.Object.prototype[i])continue;t[i]=e.Object.prototype[i]}if(0!==t[i].indexOf("url(")){var n=new e.Color(t[i]);t[i]=n.setAlpha(r(n.getAlpha()*t[c[i]],2)).toRgba()}}return t}(b)}},parseElements:function(t,i,n,r,o){new e.ElementsParser(t,i,n,r,o).parse()},parseStyleAttribute:function(t){var e,i,n,r={},o=t.getAttribute("style");return o&&("string"==typeof o?(e=r,o.replace(/;\s*$/,"").split(";").forEach(function(t){var r=t.split(":");i=r[0].trim().toLowerCase(),n=r[1].trim(),e[i]=n})):function(t,e){var i,n;for(var r in t)void 0!==t[r]&&(i=r.toLowerCase(),n=t[r],e[i]=n)}(o,r)),r},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){var i,n,r=t.getElementsByTagName("style"),o={};for(i=0,n=r.length;i<n;i++){var s=r[i].textContent||r[i].text;""!==(s=s.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&s.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){var r=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),s={},a=r[2].trim().replace(/;$/,"").split(/\s*;\s*/);for(i=0,n=a.length;i<n;i++){var c=a[i].split(/\s*:\s*/),l=c[0],u=c[1];s[l]=u}(t=r[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(o[t]?e.util.object.extend(o[t],s):o[t]=e.util.object.clone(s))})})}return o},loadSVGFromURL:function(t,i,n,r){t=t.replace(/^\n\s*/,"").trim(),new e.util.request(t,{method:"get",onComplete:function(t){var o=t.responseXML;o&&!o.documentElement&&e.window.ActiveXObject&&t.responseText&&((o=new ActiveXObject("Microsoft.XMLDOM")).async="false",o.loadXML(t.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),o&&o.documentElement||i&&i(null),e.parseSVGDocument(o.documentElement,function(t,e,n,r){i&&i(t,e,n,r)},n,r)}})},loadSVGFromString:function(t,i,n,r){var o;if(t=t.trim(),"undefined"!=typeof DOMParser){var s=new DOMParser;s&&s.parseFromString&&(o=s.parseFromString(t,"text/xml"))}else e.window.ActiveXObject&&((o=new ActiveXObject("Microsoft.XMLDOM")).async="false",o.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(o.documentElement,function(t,e,n,r){i(t,e,n,r)},n,r)}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,n,r){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;t<e;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){t.fromElement(e,this.createCallback(i,e),this.options)},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(n){var r;i.resolveGradient(n,"fill"),i.resolveGradient(n,"stroke"),n instanceof fabric.Image&&(r=n.parsePreserveAspectRatioAttribute(e)),n._removeTransformMatrix(r),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t[e];if(/^url\(/.test(i)){var n=this.regexUrl.exec(i)[1];this.regexUrl.lastIndex=0,fabric.gradientDefs[this.svgUid][n]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances,this.elements))},function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i).prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,n,r,o){var s,a=(o.x-r.x)*(t.y-r.y)-(o.y-r.y)*(t.x-r.x),c=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),l=(o.y-r.y)*(n.x-t.x)-(o.x-r.x)*(n.y-t.y);if(0!==l){var u=a/l,h=c/l;0<=u&&u<=1&&0<=h&&h<=1?(s=new i("Intersection")).appendPoint(new e.Point(t.x+u*(n.x-t.x),t.y+u*(n.y-t.y))):s=new i}else s=new i(0===a||0===c?"Coincident":"Parallel");return s},e.Intersection.intersectLinePolygon=function(t,e,n){var r,o,s,a,c=new i,l=n.length;for(a=0;a<l;a++)r=n[a],o=n[(a+1)%l],s=i.intersectLineLine(t,e,r,o),c.appendPoints(s.points);return 0<c.points.length&&(c.status="Intersection"),c},e.Intersection.intersectPolygonPolygon=function(t,e){var n,r=new i,o=t.length;for(n=0;n<o;n++){var s=t[n],a=t[(n+1)%o],c=i.intersectLinePolygon(s,a,e);r.appendPoints(c.points)}return 0<r.points.length&&(r.status="Intersection"),r},e.Intersection.intersectPolygonRectangle=function(t,n,r){var o=n.min(r),s=n.max(r),a=new e.Point(s.x,o.y),c=new e.Point(o.x,s.y),l=i.intersectLinePolygon(o,a,t),u=i.intersectLinePolygon(a,s,t),h=i.intersectLinePolygon(s,c,t),f=i.intersectLinePolygon(c,o,t),p=new i;return p.appendPoints(l.points),p.appendPoints(u.points),p.appendPoints(h.points),p.appendPoints(f.points),0<p.points.length&&(p.status="Intersection"),p})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function n(t,e,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color?e.warn("fabric.Color is already defined."):(e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,n){t/=255,i/=255,n/=255;var r,o,s,a=e.util.array.max([t,i,n]),c=e.util.array.min([t,i,n]);if(s=(a+c)/2,a===c)r=o=0;else{var l=a-c;switch(o=.5<s?l/(2-a-c):l/(a+c),a){case t:r=(i-n)/l+(i<n?6:0);break;case i:r=(n-t)/l+2;break;case n:r=(t-i)/l+4}r/=6}return[Math.round(360*r),Math.round(100*o),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=1===(t=n[0].toString(16)).length?"0"+t:t,e=1===(e=n[1].toString(16)).length?"0"+e:e,i=1===(i=n[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},toHexa:function(){var t,e=this.getSource();return t=1===(t=(t=Math.round(255*e[3])).toString(16)).length?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof i||(t=new i(t));var e,n=[],r=this.getAlpha(),o=this.getSource(),s=t.getSource();for(e=0;e<3;e++)n.push(Math.round(.5*o[e]+.5*s[e]));return n[3]=r,this.setSource(n),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),r=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),o=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(o,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var r,o,s,a=(parseFloat(e[1])%360+360)%360/360,c=parseFloat(e[2])/(/%$/.test(e[2])?100:1),l=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===c)r=o=s=l;else{var u=l<=.5?l*(c+1):l+c-l*c,h=2*l-u;r=n(h,u,a+1/3),o=n(h,u,a),s=n(h,u,a-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*s),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=3===e.length||4===e.length,r=8===e.length||4===e.length,o=n?e.charAt(0)+e.charAt(0):e.substring(0,2),s=n?e.charAt(1)+e.charAt(1):e.substring(2,4),a=n?e.charAt(2)+e.charAt(2):e.substring(4,6),c=r?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(o,16),parseInt(s,16),parseInt(a,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e})}("undefined"!=typeof exports?exports:this),function(){function t(t){var e,i,n,r,o=t.getAttribute("style"),s=t.getAttribute("offset")||0;if(s=(s=parseFloat(s)/(/%$/.test(s)?100:1))<0?0:1<s?1:s,o){var a=o.split(/\s*;\s*/);for(""===a[a.length-1]&&a.pop(),r=a.length;r--;){var c=a[r].split(/\s*:\s*/),l=c[0].trim(),u=c[1].trim();"stop-color"===l?e=u:"stop-opacity"===l&&(n=u)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),n||(n=t.getAttribute("stop-opacity")),i=(e=new fabric.Color(e)).getAlpha(),n=isNaN(parseFloat(n))?1:parseFloat(n),n*=i,{offset:s,color:e.toRgb(),opacity:n}}var e=fabric.util.object.clone;function i(t,e,i){var n,r=0,o=1,s="";for(var a in e)"Infinity"===e[a]?e[a]=1:"-Infinity"===e[a]&&(e[a]=0),n=parseFloat(e[a],10),o="string"==typeof e[a]&&/^(\d+\.\d+)%|(\d+)%$/.test(e[a])?.01:1,"x1"===a||"x2"===a||"r2"===a?(o*="objectBoundingBox"===i?t.width:1,r="objectBoundingBox"===i&&t.left||0):"y1"!==a&&"y2"!==a||(o*="objectBoundingBox"===i?t.height:1,r="objectBoundingBox"===i&&t.top||0),e[a]=n*o+r;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var c=t.ry/t.rx;s=" scale(1, "+c+")",e.y1&&(e.y1/=c),e.y2&&(e.y2/=c)}return s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:parseFloat(e),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(t){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,e,t),e},toSVG:function(t){var i,n,r,o,s=e(this.coords,!0),a=e(this.colorStops,!0),c=s.r1>s.r2,l=t.width/2,u=t.height/2;for(var h in a.sort(function(t,e){return t.offset-e.offset}),"path"===t.type&&(l-=t.pathOffset.x,u-=t.pathOffset.y),s)"x1"===h||"x2"===h?s[h]+=this.offsetX-l:"y1"!==h&&"y2"!==h||(s[h]+=this.offsetY-u);if(o='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(o+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?r=["<linearGradient ",o,' x1="',s.x1,'" y1="',s.y1,'" x2="',s.x2,'" y2="',s.y2,'">\n']:"radial"===this.type&&(r=["<radialGradient ",o,' cx="',c?s.x1:s.x2,'" cy="',c?s.y1:s.y2,'" r="',c?s.r1:s.r2,'" fx="',c?s.x2:s.x1,'" fy="',c?s.y2:s.y1,'">\n']),"radial"===this.type){if(c)for((a=a.concat()).reverse(),i=0,n=a.length;i<n;i++)a[i].offset=1-a[i].offset;var f=Math.min(s.r1,s.r2);if(0<f){var p=f/Math.max(s.r1,s.r2);for(i=0,n=a.length;i<n;i++)a[i].offset+=p*(1-a[i].offset)}}for(i=0,n=a.length;i<n;i++){var d=a[i];r.push("<stop ",'offset="',100*d.offset+"%",'" style="stop-color:',d.color,void 0!==d.opacity?";stop-opacity: "+d.opacity:";",'"/>\n')}return r.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),r.join("")},toLive:function(t){var e,i,n,r=fabric.util.object.clone(this.coords);if(this.type){for("linear"===this.type?e=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(e=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2)),i=0,n=this.colorStops.length;i<n;i++){var o=this.colorStops[i].color,s=this.colorStops[i].opacity,a=this.colorStops[i].offset;void 0!==s&&(o=new fabric.Color(o).setAlpha(s).toRgba()),e.addColorStop(a,o)}return e}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(e,n){var r,o,s,a,c,l,u=e.getElementsByTagName("stop"),h=e.getAttribute("gradientUnits")||"objectBoundingBox",f=e.getAttribute("gradientTransform"),p=[];for("linear"==(r="linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?"linear":"radial")?o={x1:(l=e).getAttribute("x1")||0,y1:l.getAttribute("y1")||0,x2:l.getAttribute("x2")||"100%",y2:l.getAttribute("y2")||0}:"radial"===r&&(o={x1:(c=e).getAttribute("fx")||c.getAttribute("cx")||"50%",y1:c.getAttribute("fy")||c.getAttribute("cy")||"50%",r1:0,x2:c.getAttribute("cx")||"50%",y2:c.getAttribute("cy")||"50%",r2:c.getAttribute("r")||"50%"}),a=u.length;a--;)p.push(t(u[a]));s=i(n,o,h);var d=new fabric.Gradient({type:r,coords:o,colorStops:p,offsetX:-n.left,offsetY:-n.top});return(f||""!==s)&&(d.gradientTransform=fabric.parseTransformAttribute((f||"")+s)),d},forObject:function(t,e){return e||(e={}),i(t,e.coords,"userSpaceOnUse"),new fabric.Gradient(e)}})}(),function(){"use strict";var t=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,e){if(t||(t={}),this.id=fabric.Object.__uid++,this.setOptions(t),!t.source||t.source&&"string"!=typeof t.source)e&&e(this);else if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source)),e&&e(this);else{var i=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){i.source=t,e&&e(i)},null,this.crossOrigin)}},toObject:function(e){var i,n,r=fabric.Object.NUM_FRACTION_DIGITS;return"function"==typeof this.source?i=String(this.source):"string"==typeof this.source.src?i=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(i=this.source.toDataURL()),n={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:t(this.offsetX,r),offsetY:t(this.offsetY,r),patternTransform:this.patternTransform?this.patternTransform.concat():null},fabric.util.populateWithProperties(this,n,e),n},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.width,n=e.height/t.height,r=this.offsetX/t.width,o=this.offsetY/t.height,s="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1),e.src?s=e.src:e.toDataURL&&(s=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+s+'"></image>\n</pattern>\n'},setOptions:function(t){for(var e in t)this[e]=t[e]},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var i in"string"==typeof t&&(t=this._parseShadow(t)),t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var n=40,r=40,o=e.Object.NUM_FRACTION_DIGITS,s=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-t.angle)),a=new e.Color(this.color);return t.width&&t.height&&(n=100*i((Math.abs(s.x)+this.blur)/t.width,o)+20,r=100*i((Math.abs(s.y)+this.blur)/t.height,o)+20),t.flipX&&(s.x*=-1),t.flipY&&(s.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,o)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(s.x,o)+'" dy="'+i(s.y,o)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+a.toRgb()+'" flood-opacity="'+a.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var t={},i=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(e){this[e]!==i[e]&&(t[e]=this[e])},this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=fabric.util.toFixed,r=fabric.util.transformPoint,o=fabric.util.invertTransform,s=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,_initStatic:function(t,e){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){e&&(this[t]=new fabric.Image(e,n)),i&&i(e)},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,i&&i(e)),this},__setBgOverlayColor:function(t,e,i){return this[t]=e,this._initGradient(e,t),this._initPattern(e,t,i),this},_createCanvasElement:function(){var t=fabric.util.createCanvasElement();if(!t)throw s;if(t.style||(t.style={}),void 0===t.getContext)throw s;return t},_initOptions:function(t){this._setOptions(t),this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){t&&t.getContext?this.lowerCanvasEl=t:this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var n in e=e||{},t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px",this.hasLostContext=!0),e.backstoreOnly||this._setCssDimension(n,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i,n,r=this._activeObject;for(this.viewportTransform=t,i=0,n=this._objects.length;i<n;i++)(e=this._objects[i]).group||e.setCoords(!1,!0);return r&&"activeSelection"===r.type&&r.setCoords(!1,!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(t,e){var i=t,n=this.viewportTransform.slice(0);t=r(t,o(this.viewportTransform)),n[0]=e,n[3]=e;var s=r(t,n);return n[4]+=i.x-s.x,n[5]+=i.y-s.y,this.setViewportTransform(n)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var t={},e=this.width,i=this.height,n=o(this.viewportTransform);return t.tl=r({x:0,y:0},n),t.br=r({x:e,y:i},n),t.tr=new fabric.Point(t.br.x,t.tl.y),t.bl=new fabric.Point(t.tl.x,t.br.y),this.vptCoords=t},renderCanvas:function(t,e){var i=this.viewportTransform;this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.calcViewportBoundaries(),this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){var i,n;for(i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i,n=this[e+"Color"];n&&(t.fillStyle=n.toLive?n.toLive(t,this):n,t.fillRect(n.offsetX||0,n.offsetY||0,this.width,this.height)),(n=this[e+"Image"])&&(this[e+"Vpt"]&&(i=this.viewportTransform,t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5])),n.render(t),this[e+"Vpt"]&&t.restore())},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=o(this.viewportTransform);return r({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n={version:fabric.version,objects:this._toObjects(e,i)};return t(n,this.__serializeBgOverlay(e,i)),fabric.util.populateWithProperties(this,n,i),n},_toObjects:function(t,e){return this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(t,e){var i={},n=this.backgroundImage,r=this.overlayImage;return this.backgroundColor&&(i.background=this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor),this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,t,e)),r&&!r.excludeFromExport&&(i.overlayImage=this._toObject(r,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,r=e.width||this.width,o=e.height||this.height,s='viewBox="0 0 '+this.width+" "+this.height+'" ',a=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?s='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,s='viewBox="'+n(-i[4]/i[0],a)+" "+n(-i[5]/i[3],a)+" "+n(this.width/i[0],a)+" "+n(this.height/i[3],a)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',o,'" ',s,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),"</defs>\n")},createSVGRefElementsMarkup:function(){var t=this;return["backgroundColor","overlayColor"].map(function(e){var i=t[e];if(i&&i.toLive)return i.toSVG(t,!1)}).join("")},createSVGFontFacesMarkup:function(){var t,e,i,n,r,o,s,a,c="",l={},u=fabric.fontPaths,h=this.getObjects();for(s=0,a=h.length;s<a;s++)if(e=(t=h[s]).fontFamily,-1!==t.type.indexOf("text")&&!l[e]&&u[e]&&(l[e]=!0,t.styles))for(r in i=t.styles)for(o in n=i[r])!l[e=n[o].fontFamily]&&u[e]&&(l[e]=!0);for(var f in l)c+=["\t\t@font-face {\n","\t\t\tfont-family: '",f,"';\n","\t\t\tsrc: url('",u[f],"');\n","\t\t}\n"].join("");return c&&(c=['\t<style type="text/css">',"<![CDATA[\n",c,"]]>","</style>\n"].join("")),c},_setSVGObjects:function(t,e){var i,n,r,o=this.getObjects();for(n=0,r=o.length;n<r;n++)(i=o[n]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){var i=this[e],n=this.viewportTransform,r=this.width/n[0],o=this.height/n[3];if(i)if(i.toLive){var s=i.repeat;t.push('<rect transform="translate(',r/2,",",o/2,')"',' x="',i.offsetX-r/2,'" y="',i.offsetY-o/2,'" ','width="',"repeat-y"===s||"no-repeat"===s?i.source.width:r,'" height="',"repeat-x"===s||"no-repeat"===s?i.source.height:o,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',this[e],'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,n,r,o=this._activeObject;if(t===o&&"activeSelection"===t.type)for(e=(r=o._objects).length;e--;)n=r[e],i(this._objects,n),this._objects.unshift(n);else i(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(t){if(!t)return this;var e,n,r,o=this._activeObject;if(t===o&&"activeSelection"===t.type)for(r=o._objects,e=0;e<r.length;e++)n=r[e],i(this._objects,n),this._objects.push(n);else i(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(t,e){if(!t)return this;var n,r,o,s,a,c=this._activeObject,l=0;if(t===c&&"activeSelection"===t.type)for(a=c._objects,n=0;n<a.length;n++)r=a[n],0+l<(o=this._objects.indexOf(r))&&(s=o-1,i(this._objects,r),this._objects.splice(s,0,r)),l++;else 0!==(o=this._objects.indexOf(t))&&(s=this._findNewLowerIndex(t,o,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(t,e,i){var n,r;if(i){for(r=(n=e)-1;0<=r;--r)if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var n,r,o,s,a,c=this._activeObject,l=0;if(t===c&&"activeSelection"===t.type)for(n=(a=c._objects).length;n--;)r=a[n],(o=this._objects.indexOf(r))<this._objects.length-1-l&&(s=o+1,i(this._objects,r),this._objects.splice(s,0,r)),l++;else(o=this._objects.indexOf(t))!==this._objects.length-1&&(s=this._findNewUpperIndex(t,o,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(t,e,i){var n,r,o;if(i){for(r=(n=e)+1,o=this._objects.length;r<o;++r)if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage=null,this.overlayImage=null,this._iTextInstances=null,this.lowerCanvasEl=null,this.contextContainer=null,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var t=fabric.util.getNodeCanvas(this.lowerCanvasEl);return t&&t.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){var e=fabric.util.getNodeCanvas(this.lowerCanvasEl);return e&&e.createJPEGStream(t)})}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(t){var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop,e=this.canvas.getZoom();t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*e,t.shadowOffsetX=this.shadow.offsetX*e,t.shadowOffsetY=this.shadow.offsetY*e}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},_drawSegment:function(t,e,i){var n=e.midPointFrom(i);return t.quadraticCurveTo(e.x,e.y,n.x,n.y),n},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){if(this._captureDrawingPath(t)&&1<this._points.length)if(this.needsFullRender)this.canvas.clearContext(this.canvas.contextTop),this._render();else{var e=this._points,i=e.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,e[i-2],e[i-1],!0),n.stroke(),n.restore()}},onMouseUp:function(){this.oldEnd=void 0,this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){return!(1<this._points.length&&t.eq(this._points[this._points.length-1])||(this._points.push(t),0))},_reset:function(){this._points.length=0,this._setBrushStyles();var t=new fabric.Color(this.color);this.needsFullRender=t.getAlpha()<1,this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);return this._addPoint(e)},_render:function(){var t,e,i=this.canvas.contextTop,n=this._points[0],r=this._points[1];if(this._saveAndTransform(i),i.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y){var o=this.width/1e3;n=new fabric.Point(n.x,n.y),r=new fabric.Point(r.x,r.y),n.x-=o,r.x+=o}for(i.moveTo(n.x,n.y),t=1,e=this._points.length;t<e;t++)this._drawSegment(i,n,r),n=this._points[t],r=this._points[t+1];i.lineTo(n.x,n.y),i.stroke(),i.restore()},convertPointsToSVGPath:function(t){var e,i=[],n=this.width/1e3,r=new fabric.Point(t[0].x,t[0].y),o=new fabric.Point(t[1].x,t[1].y),s=t.length,a=1,c=1,l=2<s;for(l&&(a=t[2].x<o.x?-1:t[2].x===o.x?0:1,c=t[2].y<o.y?-1:t[2].y===o.y?0:1),i.push("M ",r.x-a*n," ",r.y-c*n," "),e=1;e<s;e++){if(!r.eq(o)){var u=r.midPointFrom(o);i.push("Q ",r.x," ",r.y," ",u.x," ",u.y," ")}r=t[e],e+1<t.length&&(o=t[e+1])}return l&&(a=r.x>t[e-2].x?1:r.x===t[e-2].x?0:-1,c=r.y>t[e-2].y?1:r.y===t[e-2].y?0:-1),i.push("L ",r.x+a*n," ",r.y+c*n),i},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray}),i=new fabric.Point(e.left+e.width/2,e.top+e.height/2);return i=e.translateToGivenOrigin(i,"center","center",e.originX,e.originY),e.top=i.y,e.left=i.x,this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(e),this.canvas.renderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e})}else this.canvas.requestRenderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;this._saveAndTransform(i),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},_render:function(){var t,e,i,n=this.canvas.contextTop,r=this.points;for(this._saveAndTransform(n),t=0,e=r.length;t<e;t++)i=r[t],n.fillStyle=i.fill,n.beginPath(),n.arc(i.x,i.y,i.radius,0,2*Math.PI,!1),n.closePath(),n.fill();n.restore()},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(t=0,e=this.points.length;t<e;t++){var r=this.points[t],o=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&o.setShadow(this.shadow),n.push(o)}var s=new fabric.Group(n,{originX:"center",originY:"center"});s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseMove:function(t){this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],o=0,s=r.length;o<s;o++){var a=new fabric.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e,{originX:"center",originY:"center"});this.shadow&&c.setShadow(this.shadow),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var e,i,n,r={};for(i=0,n=t.length;i<n;i++)r[e=t[i].left+""+t[i].top]||(r[e]=t[i]);var o=[];for(e in r)o.push(r[e]);return o},render:function(t){var e,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),e=0,i=t.length;e<i;e++){var r=t[e];void 0!==r.opacity&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var t,e,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),t=0,e=this.sprayChunks.length;t<e;t++)this.render(this.sprayChunks[t]);i.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var e,i,n,r,o=this.width/2;for(r=0;r<this.density;r++){e=fabric.util.getRandomInt(t.x-o,t.x+o),i=fabric.util.getRandomInt(t.y-o,t.y+o),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(e,i);s.width=n,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs,o=fabric.StaticCanvas.supports("setLineDash");for(var s in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e,i,n=this.getActiveObjects();if(0<n.length&&!this.preserveObjectStacking){e=[],i=[];for(var r=0,o=this._objects.length;r<o;r++)t=this._objects[r],-1===n.indexOf(t)?e.push(t):i.push(t);1<n.length&&(this._activeObject._objects=i),e.push.apply(e,i)}else e=this._objects;return e},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTopLayer:function(t){this.isDrawingMode&&this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.selection&&this._groupSelector&&this._drawSelection(t)},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.renderTopLayer(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var n,r=i||this.getPointer(t,!0);return n=e.group&&e.group===this._activeObject&&"activeSelection"===e.group.type?this._normalizePointer(e.group,r):{x:r.x,y:r.y},e.containsPoint(n)||e._findTargetCorner(r)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=fabric.util.invertTransform(i),r=this.restorePointerVpt(e);return fabric.util.transformPoint(r,n)},isTargetTransparent:function(t,e,i){if(t.shouldCache()&&t._cacheCanvas){var n=this._normalizePointer(t,{x:e,y:i}),r=t.cacheTranslationX+n.x*t.zoomX,o=t.cacheTranslationY+n.y*t.zoomY;return fabric.util.isTransparent(t._cacheContext,r,o,this.targetFindTolerance)}var s=this.contextCache,a=t.selectionBackgroundColor,c=this.viewportTransform;return t.selectionBackgroundColor="",this.clearContext(s),s.save(),s.transform(c[0],c[1],c[2],c[3],c[4],c[5]),t.render(s),s.restore(),t===this._activeObject&&t._renderControls(s,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),t.selectionBackgroundColor=a,fabric.util.isTransparent(s,e,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(t){return"[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(e){return!0===t[e]}):t[this.selectionKey]},_shouldClearSelection:function(t,e){var i=this.getActiveObjects(),n=this._activeObject;return!e||e&&n&&1<i.length&&-1===i.indexOf(e)&&n!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(this.getPointer(t,!0)),o=this._getActionFromCorner(i,r,t),s=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:o,corner:r,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:s.x,originY:s.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,originX:s.x,originY:s.y},this._resetCurrentTransform(),this._beforeTransform(t)}},_translateObject:function(t,e){var i=this._currentTransform,n=i.target,r=t-i.offsetX,o=e-i.offsetY,s=!n.get("lockMovementX")&&n.left!==r,a=!n.get("lockMovementY")&&n.top!==o;return s&&n.set("left",r),a&&n.set("top",o),s||a},_changeSkewTransformOrigin:function(t,e,i){var n="originX",r={0:"center"},o=e.target.skewX,s="left",a="right",c="mt"===e.corner||"ml"===e.corner?1:-1,l=1;t=0<t?1:-1,"y"===i&&(o=e.target.skewY,s="top",a="bottom",n="originY"),r[-1]=s,r[1]=a,e.target.flipX&&(l*=-1),e.target.flipY&&(l*=-1),0===o?(e.skewSign=-c*t*l,e[n]=r[-t]):(o=0<o?1:-1,e.skewSign=o,e[n]=r[o*c*l])},_skewObject:function(t,e,i){var n,r=this._currentTransform,o=r.target,s=o.get("lockSkewingX"),a=o.get("lockSkewingY");if(s&&"x"===i||a&&"y"===i)return!1;var c,l,u=o.getCenterPoint(),h=o.toLocalPoint(new fabric.Point(t,e),"center","center")[i],f=o.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[i],p=o._getTransformedDimensions();return this._changeSkewTransformOrigin(h-f,r,i),c=o.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY)[i],l=o.translateToOriginPoint(u,r.originX,r.originY),n=this._setObjectSkew(c,r,i,p),r.lastX=t,r.lastY=e,o.setPositionByOrigin(l,r.originX,r.originY),n},_setObjectSkew:function(t,e,i,n){var r,o,s,a,c,l,u,h,f,p,d=e.target,g=e.skewSign;return"x"===i?(c="y",l="Y",u="X",f=0,p=d.skewY):(c="x",l="X",u="Y",f=d.skewX,p=0),a=d._getTransformedDimensions(f,p),(h=2*Math.abs(t)-a[i])<=2?r=0:(r=g*Math.atan(h/d["scale"+u]/(a[c]/d["scale"+l])),r=fabric.util.radiansToDegrees(r)),o=d["skew"+u]!==r,d.set("skew"+u,r),0!==d["skew"+l]&&(s=d._getTransformedDimensions(),r=n[c]/s[c]*d["scale"+l],d.set("scale"+l,r)),o},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,o=r.lockScalingX,s=r.lockScalingY,a=r.lockScalingFlip;if(o&&s)return!1;var c,l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),u=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY),h=r._getTransformedDimensions();return this._setLocalMouse(u,n),c=this._setObjectScale(u,n,o,s,i,a,h),r.setPositionByOrigin(l,n.originX,n.originY),c},_setObjectScale:function(t,e,i,n,r,o,s){var a,c,l,u,h=e.target,f=!1,p=!1,d=!1;return l=t.x*h.scaleX/s.x,u=t.y*h.scaleY/s.y,a=h.scaleX!==l,c=h.scaleY!==u,o&&l<=0&&l<h.scaleX&&(f=!0,t.x=0),o&&u<=0&&u<h.scaleY&&(p=!0,t.y=0),"equally"!==r||i||n?r?"x"!==r||h.get("lockUniScaling")?"y"!==r||h.get("lockUniScaling")||p||n||h.set("scaleY",u)&&(d=d||c):f||i||h.set("scaleX",l)&&(d=d||a):(f||i||h.set("scaleX",l)&&(d=d||a),p||n||h.set("scaleY",u)&&(d=d||c)):d=this._scaleObjectEqually(t,h,e,s),e.newScaleX=l,e.newScaleY=u,f||p||this._flipObject(e,r),d},_scaleObjectEqually:function(t,e,i,n){var r,o=t.y+t.x,s=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,a=t.x<0?-1:1,c=t.y<0?-1:1;return i.newScaleX=a*Math.abs(i.original.scaleX*o/s),i.newScaleY=c*Math.abs(i.original.scaleY*o/s),r=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),r},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target,n=this.getZoom(),o=i.padding/n;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>o?t.x<0?t.x+=o:t.x-=o:t.x=0,r(t.y)>o?t.y<0?t.y+=o:t.y-=o:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform,o=r.target,s=o.translateToOriginPoint(o.getCenterPoint(),r.originX,r.originY);if(o.lockRotation)return!1;var a=n(r.ey-s.y,r.ex-s.x),c=n(e-s.y,t-s.x),l=i(c-a+r.theta),u=!0;if(0<o.snapAngle){var h=o.snapAngle,f=o.snapThreshold||h,p=Math.ceil(l/h)*h,d=Math.floor(l/h)*h;Math.abs(l-d)<f?l=d:Math.abs(l-p)<f&&(l=p)}return l<0&&(l=360+l),l%=360,o.angle===l?u=!1:(o.angle=l,o.setPositionByOrigin(s,r.originX,r.originY)),u},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.rotate(0)},_drawSelection:function(t){var e=this._groupSelector,i=e.left,n=e.top,s=r(i),a=r(n);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(0<i?0:-i),e.ey-(0<n?0:-n),s,a)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!o){var c=e.ex+.5-(0<i?0:s),l=e.ey+.5-(0<n?0:a);t.beginPath(),fabric.util.drawDashedLine(t,c,l,c+s,l,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l+a-1,c+s,l+a-1,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l,c,l+a,this.selectionDashArray),fabric.util.drawDashedLine(t,c+s-1,l,c+s-1,l+a,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(0<i?0:s),e.ey+.5-(0<n?0:a),s,a)},findTarget:function(t,e){if(!this.skipTargetFind){var i,n,r=this.getPointer(t,!0),o=this._activeObject,s=this.getActiveObjects();if(this.targets=[],1<s.length&&!e&&o===this._searchPossibleTargets([o],r))return o;if(1===s.length&&o._findTargetCorner(r))return o;if(1===s.length&&o===this._searchPossibleTargets([o],r)){if(!this.preserveObjectStacking)return o;i=o,n=this.targets,this.targets=[]}var a=this._searchPossibleTargets(this._objects,r);return t[this.altSelectionKey]&&a&&i&&a!==i&&(a=i,this.targets=n),a}},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,t.x,t.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,r,o=t.length;o--;)if(this._checkTarget(e,t[o])){(i=t[o]).subTargetCheck&&i instanceof fabric.Group&&(n=this._normalizePointer(i,e),(r=this._searchPossibleTargets(i._objects,n))&&this.targets.push(r));break}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(e,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var n,r=t(e),o=this.upperCanvasEl,s=o.getBoundingClientRect(),a=s.width||0,c=s.height||0;return a&&c||("top"in s&&"bottom"in s&&(c=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(a=Math.abs(s.right-s.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,i||(r=this.restorePointerVpt(r)),n=0===a||0===c?{width:1,height:1}:{width:o.width/a,height:o.height/c},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.width||t.width,i=this.height||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var t=this._activeObject;return t?"activeSelection"===t.type&&t._objects?t._objects.slice(0):[t]:[]},_onObjectRemoved:function(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this._hoveredTarget===t&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",t)},_fireSelectionEvents:function(t,e){var i=!1,n=this.getActiveObjects(),r=[],o=[],s={e:e};t.forEach(function(t){-1===n.indexOf(t)&&(i=!0,t.fire("deselected",s),o.push(t))}),n.forEach(function(e){-1===t.indexOf(e)&&(i=!0,e.fire("selected",s),r.push(e))}),0<t.length&&0<n.length?(s.selected=r,s.deselected=o,s.updated=r[0]||o[0],s.target=this._activeObject,i&&this.fire("selection:updated",s)):0<n.length?(1===n.length&&(s.target=r[0],this.fire("object:selected",s)),s.selected=r,s.target=this._activeObject,this.fire("selection:created",s)):0<t.length&&(s.deselected=o,this.fire("selection:cleared",s))},setActiveObject:function(t,e){var i=this.getActiveObjects();return this._setActiveObject(t,e),this._fireSelectionEvents(i,e),this},_setActiveObject:function(t,e){return this._activeObject!==t&&!!this._discardActiveObject(e,t)&&!t.onSelect({e:e})&&(this._activeObject=t,!0)},_discardActiveObject:function(t,e){var i=this._activeObject;if(i){if(i.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var e=this.getActiveObjects();return e.length&&this.fire("before:selection:cleared",{target:e[0],e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this},dispose:function(){var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),this.upperCanvasEl=null,this.cacheCanvasEl=null,this.contextCache=null,this.contextTop=null,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this._activeObject;e&&e._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),r=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),r},_realizeGroupTransformOnObject:function(t){if(t.group&&"activeSelection"===t.group.type&&this._activeObject===t.group){var e={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(i){e[i]=t[i]}),this._activeObject.realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(e);this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)},setViewportTransform:function(t){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),fabric.StaticCanvas.prototype.setViewportTransform.call(this,t)}}),fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener,n={passive:!1};function r(t,e){return"which"in t?t.which===e:t.button===e-1}fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},addOrRemove:function(t,e){t(fabric.window,"resize",this._onResize),t(this.upperCanvasEl,"mousedown",this._onMouseDown),t(this.upperCanvasEl,"mousemove",this._onMouseMove,n),t(this.upperCanvasEl,"mouseout",this._onMouseOut),t(this.upperCanvasEl,"mouseenter",this._onMouseEnter),t(this.upperCanvasEl,"wheel",this._onMouseWheel),t(this.upperCanvasEl,"contextmenu",this._onContextMenu),t(this.upperCanvasEl,"dblclick",this._onDoubleClick),t(this.upperCanvasEl,"touchstart",this._onMouseDown,n),t(this.upperCanvasEl,"touchmove",this._onMouseMove,n),t(this.upperCanvasEl,"dragover",this._onDragOver),t(this.upperCanvasEl,"dragenter",this._onDragEnter),t(this.upperCanvasEl,"dragleave",this._onDragLeave),t(this.upperCanvasEl,"drop",this._onDrop),"undefined"!=typeof eventjs&&e in eventjs&&(eventjs[e](this.upperCanvasEl,"gesture",this._onGesture),eventjs[e](this.upperCanvasEl,"drag",this._onDrag),eventjs[e](this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs[e](this.upperCanvasEl,"shake",this._onShake),eventjs[e](this.upperCanvasEl,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(i,"remove"),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp,n),i(fabric.document,"mousemove",this._onMouseMove,n),i(fabric.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t}),this._iTextInstances&&this._iTextInstances.forEach(function(t){t.isEditing&&t.hiddenTextarea.focus()})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onDragOver:function(t){t.preventDefault();var e=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(e,t)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},_onMouseDown:function(t){this.__onMouseDown(t),this._resetTransformEventData(),e(fabric.document,"touchend",this._onMouseUp,n),e(fabric.document,"touchmove",this._onMouseMove,n),i(this.upperCanvasEl,"mousemove",this._onMouseMove,n),i(this.upperCanvasEl,"touchmove",this._onMouseMove,n),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove,n))},_onMouseUp:function(t){if(this.__onMouseUp(t),this._resetTransformEventData(),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp,n),i(fabric.document,"mousemove",this._onMouseMove,n),i(fabric.document,"touchmove",this._onMouseMove,n),e(this.upperCanvasEl,"mousemove",this._onMouseMove,n),e(this.upperCanvasEl,"touchmove",this._onMouseMove,n),"touchend"===t.type){var r=this;setTimeout(function(){e(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this._activeObject;return!(i&&i.isEditing&&t===i||!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y)))},__onMouseUp:function(t){var e,i=this._currentTransform,n=this._groupSelector,o=!n||0===n.left&&0===n.top;if(this._cacheTransformEventData(t),e=this._target,this._handleEvent(t,"up:before"),r(t,3))this.fireRightClick&&this._handleEvent(t,"up",3,o);else{if(r(t,2))return this.fireMiddleClick&&this._handleEvent(t,"up",2,o),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else{i&&this._finalizeCurrentTransform(t);var s=this._shouldRender(e,this._absolutePointer);!e&&o||this._maybeGroupObjects(t),e&&(e.isMoving=!1),this._setCursorFromEvent(t,e),this._handleEvent(t,"up",1,o),this._groupSelector=null,this._currentTransform=null,e&&(e.__corner=0),s&&this.requestRenderAll()}}},_simpleEventHandler:function(t,e){var i=this.findTarget(e),n=this.targets,r={e:e,target:i,subTargets:n};if(this.fire(t,r),i&&i.fire(t,r),!n)return i;for(var o=0;o<n.length;o++)n[o].fire(t,r);return i},_handleEvent:function(t,e,i,n){var r=this._target,o=this.targets||[],s={e:t,target:r,subTargets:o,button:i||1,isClick:n||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+e,s),r&&r.fire("mouse"+e,s);for(var a=0;a<o.length;a++)o[a].fire("mouse"+e,s)},_finalizeCurrentTransform:function(t){var e,i=this._currentTransform,n=i.target,r={e:t,target:n,transform:i};n._scaling&&(n._scaling=!1),n.setCoords(),(i.actionPerformed||this.stateful&&n.hasStateChanged())&&(i.actionPerformed&&(e=this._addEventOptions(r,i),this._fire(e,r)),this._fire("modified",r))},_addEventOptions:function(t,e){var i,n;switch(e.action){case"scaleX":i="scaled",n="x";break;case"scaleY":i="scaled",n="y";break;case"skewX":i="skewed",n="x";break;case"skewY":i="skewed",n="y";break;case"scale":i="scaled",n="equally";break;case"rotate":i="rotated";break;case"drag":i="moved"}return t.by=n,i},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e)}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var e=this._target;if(r(t,3))this.fireRightClick&&this._handleEvent(t,"down",3);else if(r(t,2))this.fireMiddleClick&&this._handleEvent(t,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(!this._currentTransform){var i=this._pointer;this._previousPointer=i;var n=this._shouldRender(e,i),o=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this.discardActiveObject(t):o&&(this._handleGrouping(t,e),e=this._activeObject),!this.selection||e&&(e.selectable||e.isEditing||e===this._activeObject)||(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0}),e&&(e.selectable&&this.setActiveObject(e,t),e!==this._activeObject||!e.__corner&&o||this._setupCurrentTransform(t,e)),this._handleEvent(t,"down"),n&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform:function(t){var e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:t,transform:e}),e.corner&&this.onBeforeScaleRotate(e.target)},__onMouseMove:function(t){var e,i;if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(!(void 0!==t.touches&&1<t.touches.length)){var n=this._groupSelector;n?(i=this._pointer,n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t)||null,this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(t,e){this.fireSynteticInOutEvents(t,e,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(t,e){this.fireSynteticInOutEvents(t,e,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSynteticInOutEvents:function(t,e,i){var n,r,o,s=this[i.targetName],a=s!==t,c=i.canvasEvtIn,l=i.canvasEvtOut;a&&(n={e:e,target:t,previousTarget:s},r={e:e,target:s,nextTarget:t},this[i.targetName]=t),o=t&&a,s&&a&&(l&&this.fire(l,r),s.fire(i.evtOut,r)),o&&(c&&this.fire(c,n),t.fire(i.evtIn,n))},__onMouseWheel:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,i.shiftKey=t.shiftKey,i.altKey=t[this.centeredKey],this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,o=e.action,s=!1,a={target:e.target,e:t,transform:e,pointer:i};"rotate"===o?(s=this._rotateObject(n,r))&&this._fire("rotating",a):"scale"===o?(s=this._onScale(t,e,n,r))&&this._fire("scaling",a):"scaleX"===o?(s=this._scaleObject(n,r,"x"))&&this._fire("scaling",a):"scaleY"===o?(s=this._scaleObject(n,r,"y"))&&this._fire("scaling",a):"skewX"===o?(s=this._skewObject(n,r,"x"))&&this._fire("skewing",a):"skewY"===o?(s=this._skewObject(n,r,"y"))&&this._fire("skewing",a):(s=this._translateObject(n,r))&&(this._fire("moving",a),this.setCursor(a.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||s},_fire:function(t,e){this.fire("object:"+t,e),e.target.fire(t,e)},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,n){return this._isUniscalePossible(t,e.target)?(e.currentAction="scale",this._scaleObject(i,n)):(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally"))},_isUniscalePossible:function(t,e){return(t[this.uniScaleKey]||this.uniScaleTransform)&&!e.get("lockUniScaling")},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));r?this.setCursor(this.getCornerCursor(r,e,t)):this.setCursor(i)},getCornerCursor:function(e,i,n){return this.actionIsDisabled(e,i,n)?this.notAllowedCursor:e in t?this._getRotatedCornerCursor(e,i,n):"mtr"===e&&i.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(t,e,i){return"mt"===t||"mb"===t?i[this.altActionKey]?e.lockSkewingX:e.lockScalingY:"ml"===t||"mr"===t?i[this.altActionKey]?e.lockSkewingY:e.lockScalingX:"mtr"===t?e.lockRotation:this._isUniscalePossible(i,e)?e.lockScalingX&&e.lockScalingY:e.lockScalingX||e.lockScalingY},_getRotatedCornerCursor:function(e,i,n){var r=Math.round(i.angle%360/45);return r<0&&(r+=8),r+=t[e],n[this.altActionKey]&&t[e]%2==0&&(r+=2),r%=8,this.cursorMap[r]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this._activeObject;return i&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(i!==e||"activeSelection"===i.type)},_handleGrouping:function(t,e){var i=this._activeObject;i.__corner||(e!==i||(e=this.findTarget(t,!0)))&&(i&&"activeSelection"===i.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))},_updateActiveSelection:function(t,e){var i=this._activeObject,n=i._objects.slice(0);i.contains(t)?(i.removeWithUpdate(t),this._hoveredTarget=t,1===i.size()&&this._setActiveObject(i.item(0),e)):(i.addWithUpdate(t),this._hoveredTarget=i),this._fireSelectionEvents(n,e)},_createActiveSelection:function(t,e){var i=this.getActiveObjects(),n=this._createGroup(t);this._hoveredTarget=n,this._setActiveObject(n,e),this._fireSelectionEvents(i,e)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(t){var e,i=this._collectObjects();1===i.length?this.setActiveObject(i[0],t):1<i.length&&(e=new fabric.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(e,t))},_collectObjects:function(){for(var i,n=[],r=this._groupSelector.ex,o=this._groupSelector.ey,s=r+this._groupSelector.left,a=o+this._groupSelector.top,c=new fabric.Point(t(r,s),t(o,a)),l=new fabric.Point(e(r,s),e(o,a)),u=!this.selectionFullyContained,h=r===s&&o===a,f=this._objects.length;f--&&!((i=this._objects[f])&&i.selectable&&i.visible&&(u&&i.intersectsWithRect(c,l)||i.isContainedWithinRect(c,l)||u&&i.containsPoint(c)||u&&i.containsPoint(l))&&(n.push(i),h)););return n},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){var t=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=(t.multiplier||1)*(t.enableRetinaScaling?1:1/this.getRetinaScaling()),r={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,r,n)},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.width,o=this.height,s=(i.width||this.width)*n,a=(i.height||this.height)*n,c=this.getZoom()*n,l=this.viewportTransform,u=[c,0,0,c,(l[4]-i.left)*n,(l[5]-i.top)*n],h=this.interactive,f=this.skipOffscreen,p=r!==s||o!==a;this.viewportTransform=u,this.skipOffscreen=!1,this.interactive=!1,p&&this.setDimensions({width:s,height:a},{backstoreOnly:!0}),this.renderAll();var d=this.__toDataURL(t,e,i);return this.interactive=h,this.skipOffscreen=f,this.viewportTransform=l,p&&this.setDimensions({width:r,height:o},{backstoreOnly:!0}),this.renderAll(),d},__toDataURL:function(e,i){var n=this.contextContainer.canvas;return"jpg"===e&&(e="jpeg"),t?n.toDataURL("image/"+e,i):n.toDataURL("image/"+e)}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t),r=this,o=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(n.objects,function(t){r.clear(),r._setBgOverlay(n,function(){t.forEach(function(t,e){r.insertAt(t,e)}),r.renderOnAddRemove=o,delete n.objects,delete n.backgroundImage,delete n.overlayImage,delete n.background,delete n.overlay,r._setOptions(n),r.renderAll(),e&&e()})},i),this}},_setBgOverlay:function(t,e){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",t.backgroundImage,i,n),this.__setBgOverlay("overlayImage",t.overlayImage,i,n),this.__setBgOverlay("backgroundColor",t.background,i,n),this.__setBgOverlay("overlayColor",t.overlay,i,n)}else e&&e()},__setBgOverlay:function(t,e,i,n){var r=this;if(!e)return i[t]=!0,void(n&&n());"backgroundImage"===t||"overlayImage"===t?fabric.util.enlivenObjects([e],function(e){r[t]=e[0],i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()})},_enlivenObjects:function(t,e,i){t&&0!==t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},null,i):e&&e([])},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.width,e.height=this.height;var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,o=e.util.string.capitalize,s=e.util.degreesToRadians,a=e.StaticCanvas.supports("setLineDash"),c=!e.isLikelyNode;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:c,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),initialize:function(t){t&&this.setOptions(t)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(t){var i=e.perfLimitSizeTotal,n=t.width,r=t.height,o=e.maxCacheSideLimit,s=e.minCacheSideLimit;if(n<=o&&r<=o&&n*r<=i)return n<s&&(t.width=s),r<s&&(t.height=s),t;var a=n/r,c=e.util.limitDimsByArea(a,i),l=e.util.capValue,u=l(s,c.x,o),h=l(s,c.y,o);return u<n&&(t.zoomX/=n/u,t.width=u,t.capped=!0),h<r&&(t.zoomY/=r/h,t.height=h,t.capped=!0),t},_getCacheCanvasDimensions:function(){var t=this.canvas&&this.canvas.getZoom()||1,i=this.getObjectScaling(),n=this.canvas&&this.canvas._isRetinaScaling()?e.devicePixelRatio:1,r=this._getNonTransformedDimensions(),o=i.scaleX*t*n,s=i.scaleY*t*n;return{width:r.x*o+2,height:r.y*s+2,zoomX:o,zoomY:s,x:r.x,y:r.y}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var t=this.canvas._currentTransform.target,i=this.canvas._currentTransform.action;if(this===t&&i.slice&&"scale"===i.slice(0,5))return!1}var n,r,o=this._cacheCanvas,s=this._limitCacheSize(this._getCacheCanvasDimensions()),a=e.minCacheSideLimit,c=s.width,l=s.height,u=s.zoomX,h=s.zoomY,f=c!==this.cacheWidth||l!==this.cacheHeight,p=this.zoomX!==u||this.zoomY!==h,d=f||p,g=0,m=0,v=!1;if(f){var _=this._cacheCanvas.width,b=this._cacheCanvas.height,y=_<c||b<l;v=y||(c<.9*_||l<.9*b)&&a<_&&a<b,y&&!s.capped&&(a<c||a<l)&&(g=.1*c,m=.1*l)}return!!d&&(v?(o.width=Math.ceil(c+g),o.height=Math.ceil(l+m)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,o.width,o.height)),n=s.x*u/2,r=s.y*h/2,this.cacheTranslationX=Math.round(o.width/2-n)+n,this.cacheTranslationY=Math.round(o.height/2-r)+r,this.cacheWidth=c,this.cacheHeight=l,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(u,h),this.zoomX=u,this.zoomY=h,!0)},setOptions:function(t){this._setOptions(t),this._initGradient(t.fill,"fill"),this._initGradient(t.stroke,"stroke"),this._initClipping(t),this._initPattern(t.fill,"fill"),this._initPattern(t.stroke,"stroke")},transform:function(t){var e;e=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:r(this.left,i),top:r(this.top,i),width:r(this.width,i),height:r(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,i),scaleX:r(this.scaleX,i),scaleY:r(this.scaleY,i),angle:r(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:r(this.skewX,i),skewY:r(this.skewY,i)};return e.util.populateWithProperties(this,n,t),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e],"[object Array]"===Object.prototype.toString.call(t[e])&&"[object Array]"===Object.prototype.toString.call(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e]}),t},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){var t=this.scaleX,e=this.scaleY;if(this.group){var i=this.group.getObjectScaling();t*=i.scaleX,e*=i.scaleY}return{scaleX:t,scaleY:e}},getObjectOpacity:function(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t},_set:function(t,i){var n="scaleX"===t||"scaleY"===t,r=this[t]!==i,o=!1;return n&&(i=this._constrainScale(i)),"scaleX"===t&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow?"dirty"===t&&this.group&&this.group.set("dirty",i):i=new e.Shadow(i),this[t]=i,r&&(o=this.group&&this.group.isOnACache(),-1<this.cacheProperties.indexOf(t)?(this.dirty=!0,o&&this.group.set("dirty",!0)):o&&-1<this.stateProperties.indexOf(t)&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t,this),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this.shouldCache()?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext),this.dirty=!1),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&t.restore(),t.restore())},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"==typeof this.shadow},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawObject:function(t){this._renderBackground(t),this._setStrokeStyles(t,this),this._setFillStyles(t,this),this._render(t)},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(t){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!t){var e=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-i/2,e,i)}return!0}return!1},_renderBackground:function(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}},_setOpacity:function(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity},_setStrokeStyles:function(t,e){e.stroke&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,t.strokeStyle=e.stroke.toLive?e.stroke.toLive(t,this):e.stroke)},_setFillStyles:function(t,e){e.fill&&(t.fillStyle=e.fill.toLive?e.fill.toLive(t,this):e.fill)},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),a?t.setLineDash(e):i&&i(t))},_renderControls:function(t,i){var n,r,o,a=this.getViewportTransform(),c=this.calcTransformMatrix();r=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,o=void 0!==i.hasControls?i.hasControls:this.hasControls,c=e.util.multiplyTransformMatrices(a,c),n=e.util.qrDecompose(c),t.save(),t.translate(n.translateX,n.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),i.forActiveSelection?(t.rotate(s(n.angle)),r&&this.drawBordersInGroup(t,n,i)):(t.rotate(s(this.angle)),r&&this.drawBorders(t,i)),o&&this.drawControls(t,i),t.restore()},_setShadow:function(t){if(this.shadow){var i=this.canvas&&this.canvas.viewportTransform[0]||1,n=this.canvas&&this.canvas.viewportTransform[3]||1,r=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(i*=e.devicePixelRatio,n*=e.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*e.browserShadowBlurConstant*(i+n)*(r.scaleX+r.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*i*r.scaleX,t.shadowOffsetY=this.shadow.offsetY*n*r.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_applyPatternGradientTransform:function(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var i=e.gradientTransform||e.patternTransform,n=-this.width/2+e.offsetX||0,r=-this.height/2+e.offsetY||0;return t.translate(n,r),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:n,offsetY:r}},_renderPaintInOrder:function(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))},_renderFill:function(t){this.fill&&(t.save(),this._applyPatternGradientTransform(t,this.fill),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())},_renderStroke:function(t){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(t,this.stroke),t.stroke(),t.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var t=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}},_removeTransformMatrix:function(t){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=e.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,t&&(this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this.cropX=t.cropX,this.cropY=t.cropY,i.x+=t.offsetLeft,i.y+=t.offsetTop,this.width=t.width,this.height=t.height),this.setPositionByOrigin(i,"center","center")},clone:function(t,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,t):e.Object._fromObject("Object",n,t)},cloneAsImage:function(t,i){var n=this.toDataURL(i);return e.util.loadImage(n,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),n=this.getBoundingRect();i.width=n.width,i.height=n.height,e.util.wrapElement(i,"div");var r=new e.StaticCanvas(i,{enableRetinaScaling:t.enableRetinaScaling,renderOnAddRemove:!1,skipOffscreen:!1});"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(r.backgroundColor="#fff");var o={left:this.left,top:this.top};this.setPositionByOrigin(new e.Point(r.width/2,r.height/2),"center","center");var s=this.canvas;r.add(this);var a=r.toDataURL(t);return this.set(o).setCoords(),this.canvas=s,r._objects=[],r.dispose(),r=null,a},isType:function(t){return this.type===t},complexity:function(){return 1},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};return n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2),n.gradientTransform=i.gradientTransform,e.Gradient.prototype.addColorStop.call(n,i.colorStops),this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},rotate:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var n=new e.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=e.util.rotatePoint(n,r,s(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object._fromObject=function(t,i,r,o){var s=e[t];i=n(i,!0),e.util.enlivenPatterns([i.fill,i.stroke],function(t){void 0!==t[0]&&(i.fill=t[0]),void 0!==t[1]&&(i.stroke=t[1]);var e=o?new s(i[o],i):new s(i);r&&r(e)})},e.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,n,r,o,s){var a,c,l,u=t.x,h=t.y;return"string"==typeof n?n=e[n]:n-=.5,"string"==typeof o?o=e[o]:o-=.5,"string"==typeof r?r=i[r]:r-=.5,"string"==typeof s?s=i[s]:s-=.5,c=s-r,((a=o-n)||c)&&(l=this._getTransformedDimensions(),u=t.x+a*l.x,h=t.y+c*l.y),new fabric.Point(u,h)},translateToCenterPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,i,n,"center","center");return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},translateToOriginPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,"center","center",i,n);return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,o,s=this.getCenterPoint();return r=void 0!==i&&void 0!==n?this.translateToGivenOrigin(s,"center","center",i,n):new fabric.Point(this.left,this.top),o=new fabric.Point(e.x,e.y),this.angle&&(o=fabric.util.rotatePoint(o,s,-t(this.angle))),o.subtractEquals(r)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(i){var n,r,o=t(this.angle),s=this.getScaledWidth(),a=fabric.util.cos(o)*s,c=fabric.util.sin(o)*s;n="string"==typeof this.originX?e[this.originX]:this.originX-.5,r="string"==typeof i?e[i]:i-.5,this.left+=a*(r-n),this.top+=c*(r-n),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){var t=fabric.util.degreesToRadians,e=fabric.util.multiplyTransformMatrices,i=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,e){this.oCoords||this.setCoords();var i,n=t?this.aCoords:this.oCoords;return i=e?this.calcCoords(t):n,[new fabric.Point(i.tl.x,i.tl.y),new fabric.Point(i.tr.x,i.tr.y),new fabric.Point(i.br.x,i.br.y),new fabric.Point(i.bl.x,i.bl.y)]},intersectsWithRect:function(t,e,i,n){var r=this.getCoords(i,n);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(r,t,e).status},intersectsWithObject:function(t,e,i){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(e,i),t.getCoords(e,i)).status||t.isContainedWithinObject(this,e,i)||this.isContainedWithinObject(t,e,i)},isContainedWithinObject:function(t,e,i){for(var n=this.getCoords(e,i),r=0,o=t._getImageLines(i?t.calcCoords(e):e?t.aCoords:t.oCoords);r<4;r++)if(!t.containsPoint(n[r],o))return!1;return!0},isContainedWithinRect:function(t,e,i,n){var r=this.getBoundingRect(i,n);return r.left>=t.x&&r.left+r.width<=e.x&&r.top>=t.y&&r.top+r.height<=e.y},containsPoint:function(t,e,i,n){e=e||this._getImageLines(n?this.calcCoords(i):i?this.aCoords:this.oCoords);var r=this._findCrossPoints(t,e);return 0!==r&&r%2==1},isOnScreen:function(t){if(!this.canvas)return!1;for(var e,i=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,r=this.getCoords(!0,t),o=0;o<4;o++)if((e=r[o]).x<=n.x&&e.x>=i.x&&e.y<=n.y&&e.y>=i.y)return!0;return!!this.intersectsWithRect(i,n,!0,t)||this._containsCenterOfCanvas(i,n,t)},_containsCenterOfCanvas:function(t,e,i){var n={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return!!this.containsPoint(n,null,!0,i)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(e,i,!0,t)||this._containsCenterOfCanvas(e,i,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,o=0;for(var s in e)if(!((r=e[s]).o.y<t.y&&r.d.y<t.y||r.o.y>=t.y&&r.d.y>=t.y||(r.o.x===r.d.x&&r.o.x>=t.x?n=r.o.x:(i=(r.d.y-r.o.y)/(r.d.x-r.o.x),n=-(t.y-0*t.x-(r.o.y-i*r.o.x))/(0-i)),n>=t.x&&(o+=1),2!==o)))break;return o},getBoundingRect:function(t,e){var i=this.getCoords(t,e);return fabric.util.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,e){var i=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/i)},scaleToHeight:function(t,e){var i=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/i)},calcCoords:function(n){var r=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),s=e(o,r),a=this.getViewportTransform(),c=n?s:e(a,s),l=this._getTransformedDimensions(),u=l.x/2,h=l.y/2,f=i({x:-u,y:-h},c),p=i({x:u,y:-h},c),d=i({x:-u,y:h},c),g=i({x:u,y:h},c);if(!n){var m=this.padding,v=t(this.angle),_=fabric.util.cos(v),b=fabric.util.sin(v),y=_*m,w=b*m,x=y+w,C=y-w;m&&(f.x-=C,f.y-=x,p.x+=x,p.y-=C,d.x-=x,d.y+=C,g.x+=C,g.y+=x);var S=new fabric.Point((f.x+d.x)/2,(f.y+d.y)/2),T=new fabric.Point((p.x+f.x)/2,(p.y+f.y)/2),O=new fabric.Point((g.x+p.x)/2,(g.y+p.y)/2),k=new fabric.Point((g.x+d.x)/2,(g.y+d.y)/2),$=new fabric.Point(T.x+b*this.rotatingPointOffset,T.y-_*this.rotatingPointOffset)}var A={tl:f,tr:p,br:g,bl:d};return n||(A.ml=S,A.mt=T,A.mr=O,A.mb=k,A.mtr=$),A},setCoords:function(t,e){return this.oCoords=this.calcCoords(t),e||(this.aCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var e=t(this.angle),i=fabric.util.cos(e),n=fabric.util.sin(e);return[i,n,-n,i,0,0]}return fabric.iMatrix.concat()},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var e="_",i="";return!t&&this.group&&(i=this.group.transformMatrixKey(t)+e),i+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){if(t)return this.calcOwnMatrix();var i=this.transformMatrixKey(),n=this.matrixCache||(this.matrixCache={});if(n.key===i)return n.value;var r=this.calcOwnMatrix();return this.group&&(r=e(this.group.calcTransformMatrix(),r)),n.key=i,n.value=r},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===t)return i.value;var n,r=this._calcTranslateMatrix(),o=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return this.angle&&(n=this._calcRotateMatrix(),r=e(r,n)),r=e(r,o),i.key=t,i.value=r},_calcDimensionsTransformMatrix:function(i,n,r){var o,s=[this.scaleX*(r&&this.flipX?-1:1),0,0,this.scaleY*(r&&this.flipY?-1:1),0,0];return i&&(o=[1,0,Math.tan(t(i)),1],s=e(s,o,!0)),n&&(o=[1,Math.tan(t(n)),0,1],s=e(s,o,!0)),s},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i=this._getNonTransformedDimensions();if(0===t&&0===e)return{x:i.x*this.scaleX,y:i.y*this.scaleY};var n,r,o=i.x/2,s=i.y/2,a=[{x:-o,y:-s},{x:o,y:-s},{x:-o,y:s},{x:o,y:s}],c=this._calcDimensionsTransformMatrix(t,e,!1);for(n=0;n<a.length;n++)a[n]=fabric.util.transformPoint(a[n],c);return{x:(r=fabric.util.makeBoundingBoxFromPoints(a)).width,y:r.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return fabric.util.transformPoint(e,t,!0).scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new fabric.Color(e),n=t+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=t+"-opacity: "+r.toString()+"; "),n}return t+": none; "}var e=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(e){var i=this.fillRule,n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",o=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=void 0!==this.opacity?this.opacity:"1",l=this.visible?"":" visibility: hidden;",u=e?"":this.getSvgFilter(),h=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",o,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",a,"; ",h,"fill-rule: ",i,"; ","opacity: ",c,";",u,l].join("")},getSvgSpanStyles:function(e,i){var n="; ",r=e.fontFamily?"font-family: "+(-1===e.fontFamily.indexOf("'")&&-1===e.fontFamily.indexOf('"')?"'"+e.fontFamily+"'":e.fontFamily)+n:"",o=e.strokeWidth?"stroke-width: "+e.strokeWidth+n:"",s=(r=r,e.fontSize?"font-size: "+e.fontSize+"px"+n:""),a=e.fontStyle?"font-style: "+e.fontStyle+n:"",c=e.fontWeight?"font-weight: "+e.fontWeight+n:"",l=e.fill?t("fill",e.fill):"",u=e.stroke?t("stroke",e.stroke):"",h=this.getSvgTextDecoration(e);return h&&(h="text-decoration: "+h+n),[u,o,r,s,a,c,h,l,e.deltaY?"baseline-shift: "+-e.deltaY+"; ":"",i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(t){return"overline"in t||"underline"in t||"linethrough"in t?(t.overline?"overline ":"")+(t.underline?"underline ":"")+(t.linethrough?"line-through ":""):""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){var t=this.angle,i=this.skewX%360,n=this.skewY%360,r=this.getCenterPoint(),o=fabric.Object.NUM_FRACTION_DIGITS,s="translate("+e(r.x,o)+" "+e(r.y,o)+")",a=0!==t?" rotate("+e(t,o)+")":"",c=1===this.scaleX&&1===this.scaleY?"":" scale("+e(this.scaleX,o)+" "+e(this.scaleY,o)+")",l=0!==i?" skewX("+e(i,o)+")":"",u=0!==n?" skewY("+e(n,o)+")":"";return[s,a,c,this.flipX?" matrix(-1 0 0 1 0 0) ":"",this.flipY?" matrix(1 0 0 -1 0 0)":"",l,u].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_setSVGBg:function(t){if(this.backgroundColor){var i=fabric.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,i),'" y="',e(-this.height/2,i),'" width="',e(this.width,i),'" height="',e(this.height,i),'"></rect>\n')}},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var t=fabric.util.object.extend,e="stateProperties";function i(e,i,n){var r={};n.forEach(function(t){r[t]=e[t]}),t(e[i],r,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(t){var i="_"+(t=t||e);return Object.keys(this[i]).length<this[t].length||!function t(e,i,n){if(e===i)return!0;if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var r=0,o=e.length;r<o;r++)if(!t(e[r],i[r]))return!1;return!0}if(e&&"object"==typeof e){var s,a=Object.keys(e);if(!i||"object"!=typeof i||!n&&a.length!==Object.keys(i).length)return!1;for(r=0,o=a.length;r<o;r++)if(!t(e[s=a[r]],i[s]))return!1;return!0}}(this[i],this,!0)},saveState:function(t){var n=t&&t.propertySet||e,r="_"+n;return this[r]?(i(this,r,this[n]),t&&t.stateProperties&&i(this,r,t.stateProperties),this):this.setupState(t)},setupState:function(t){var i=(t=t||{}).propertySet||e;return this["_"+(t.propertySet=i)]={},this.saveState(t),this}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var e,i,n=t.x,r=t.y;for(var o in this.__corner=0,this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=o;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),o=.707106*this.cornerSize,s=o*fabric.util.cos(r),a=o*fabric.util.sin(r);for(var c in n)e=n[c].x,i=n[c].y,n[c].corner={tl:{x:e-a,y:i-s},tr:{x:e+s,y:i-a},bl:{x:e-s,y:i+a},br:{x:e+a,y:i+s}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/r[0],1/r[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=1/this.borderScaleFactor,r=i.x+n,o=i.y+n,s=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,a=void 0!==e.hasControls?e.hasControls:this.hasControls,c=void 0!==e.rotatingPointOffset?e.rotatingPointOffset:this.rotatingPointOffset;if(t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray,null),t.strokeRect(-r/2,-o/2,r,o),s&&this.isControlVisible("mtr")&&a){var l=-o/2;t.beginPath(),t.moveTo(0,l),t.lineTo(0,l-c),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e,i){i=i||{};var n=this._getNonTransformedDimensions(),r=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),o=fabric.util.transformPoint(n,r),s=1/this.borderScaleFactor,a=o.x+s,c=o.y+s;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-a/2,-c/2,a,c),t.restore(),this},drawControls:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=i.x,r=i.y,o=e.cornerSize||this.cornerSize,s=-(n+o)/2,a=-(r+o)/2,c=void 0!==e.transparentCorners?e.transparentCorners:this.transparentCorners,l=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,u=c?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",t,u,s,a,e),this._drawControl("tr",t,u,s+n,a,e),this._drawControl("bl",t,u,s,a+r,e),this._drawControl("br",t,u,s+n,a+r,e),this.get("lockUniScaling")||(this._drawControl("mt",t,u,s+n/2,a,e),this._drawControl("mb",t,u,s+n/2,a+r,e),this._drawControl("mr",t,u,s+n,a+r/2,e),this._drawControl("ml",t,u,s,a+r/2,e)),l&&this._drawControl("mtr",t,u,s+n/2,a-this.rotatingPointOffset,e),t.restore(),this},_drawControl:function(t,e,i,n,r,o){if(o=o||{},this.isControlVisible(t)){var s=this.cornerSize,a=!this.transparentCorners&&this.cornerStrokeColor;switch(o.cornerStyle||this.cornerStyle){case"circle":e.beginPath(),e.arc(n+s/2,r+s/2,s/2,0,2*Math.PI,!1),e[i](),a&&e.stroke();break;default:this.transparentCorners||e.clearRect(n,r,s,s),e[i+"Rect"](n,r,s,s),a&&e.strokeRect(n,r,s,s)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),o.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),o.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,o=this;return fabric.util.animate({startValue:t.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){t.set("opacity",e),o.requestRenderAll(),r()},onComplete:function(){o.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;n<r;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,o=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var s=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=s),e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(o)},onChange:function(e,s,a){r?o[r[0]][r[1]]=e:o.set(t,e),n||i.onChange&&i.onChange(e,s,a)},onComplete:function(t,e,r){n||(o.setCoords(),i.onComplete&&i.onComplete(t,e,r))}})}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r={x1:1,x2:1,y1:1,y2:1},o=e.StaticCanvas.supports("setLineDash");function s(t,e){var i=t.origin,n=t.axis1,r=t.axis2,o=t.dimension,s=e.nearest,a=e.center,c=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(o);case c:return Math.max(this.get(n),this.get(r))}}}e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(t,e){t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==r[t]&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t){if(t.beginPath(),!this.strokeDashArray||this.strokeDashArray&&o){var e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)}t.lineWidth=this.strokeWidth;var i=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=i},_renderDashedStroke:function(t){var i=this.calcLinePoints();t.beginPath(),e.util.drawDashedLine(t,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray),t.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(t){return i(this.callSuper("toObject",t),this.calcLinePoints())},_getNonTransformedDimensions:function(){var t=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.calcLinePoints();return e.push("<line ",this.getSvgId(),'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(t,n,r){r=r||{};var o=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),s=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];n(new e.Line(s,i(o,r)))},e.Line.fromObject=function(t,i){var r=n(t,!0);r.points=[t.x1,t.y1,t.x2,t.y2],e.Object._fromObject("Line",r,function(t){delete t.points,i&&i(t)},"points")})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.PI;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},toSVG:function(t){var n=this._createBaseSVGMarkup(),r=(this.endAngle-this.startAngle)%(2*i);if(0===(r=this.endAngle-this.startAngle>2*i?0:r))n.push("<circle ",this.getSvgId(),'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/>\n");else{var o=e.util.cos(this.startAngle)*this.radius,s=e.util.sin(this.startAngle)*this.radius,a=e.util.cos(this.endAngle)*this.radius,c=e.util.sin(this.endAngle)*this.radius,l=i<r?"1":"0";n.push('<path d="M '+o+" "+s," A "+this.radius+" "+this.radius," 0 ",+l+" 1"," "+a+" "+c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/>\n")}return t?t(n.join("")):n.join("")},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,i){var n,r=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=r)&&0<=n.radius))throw new Error("value of `r` attribute is required and can not be negative");r.left=(r.left||0)-r.radius,r.top=(r.top||0)-r.radius,i(new e.Circle(r))},e.Circle.fromObject=function(t,i){return e.Object._fromObject("Circle",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,n=this.height/2,r=[-i+" "+n,"0 "+-n,i+" "+n].join(",");return e.push("<polygon ",this.getSvgId(),'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"',this.addPaintOrder(),"/>"),t?t(e.join("")):e.join("")}}),e.Triangle.fromObject=function(t,i){return e.Object._fromObject("Triangle",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this.set("rx",t&&t.rx||0),this.set("ry",t&&t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup();return e.push("<ellipse ",this.getSvgId(),'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/>\n"),t?t(e.join("")):e.join("")},_render:function(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,i,!1),t.restore(),this._renderPaintInOrder(t)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){var n=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new e.Ellipse(n))},e.Ellipse.fromObject=function(t,i){return e.Object._fromObject("Ellipse",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Rect?e.warn("fabric.Rect is already defined"):(e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){if(1!==this.width||1!==this.height){var e=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,o=-this.width/2,s=-this.height/2,a=0!==e||0!==i,c=.4477152502;t.beginPath(),t.moveTo(o+e,s),t.lineTo(o+n-e,s),a&&t.bezierCurveTo(o+n-c*e,s,o+n,s+c*i,o+n,s+i),t.lineTo(o+n,s+r-i),a&&t.bezierCurveTo(o+n,s+r-c*i,o+n-c*e,s+r,o+n-e,s+r),t.lineTo(o+e,s+r),a&&t.bezierCurveTo(o+c*e,s+r,o,s+r-c*i,o,s+r-i),t.lineTo(o,s+i),a&&t.bezierCurveTo(o,s+c*i,o+c*e,s,o+e,s),t.closePath(),this._renderPaintInOrder(t)}else t.fillRect(-.5,-.5,1,1)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,o=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+o,i,n+o,this.strokeDashArray),e.util.drawDashedLine(t,i,n+o,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=-this.width/2,n=-this.height/2;return e.push("<rect ",this.getSvgId(),'x="',i,'" y="',n,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/>\n"),t?t(e.join("")):e.join("")}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n,r){if(!t)return n(null);r=r||{};var o=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);o.left=o.left||0,o.top=o.top||0;var s=new e.Rect(i(r?e.util.object.clone(r):{},o));s.visible=s.visible&&0<s.width&&0<s.height,n(s)},e.Rect.fromObject=function(t,i){return e.Object._fromObject("Rect",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,o=e.util.toFixed;e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e);var i=this._calcDimensions();void 0===e.left&&(this.left=i.left),void 0===e.top&&(this.top=i.top),this.width=i.width,this.height=i.height,this.pathOffset={x:i.left+this.width/2,y:i.top+this.height/2}},_calcDimensions:function(){var t=this.points,e=n(t,"x")||0,i=n(t,"y")||0;return{left:e,top:i,width:(r(t,"x")||0)-e,height:(r(t,"y")||0)-i}},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var i=[],n=this.pathOffset.x,r=this.pathOffset.y,s=this._createBaseSVGMarkup(),a=e.Object.NUM_FRACTION_DIGITS,c=0,l=this.points.length;c<l;c++)i.push(o(this.points[c].x-n,a),",",o(this.points[c].y-r,a)," ");return s.push("<",this.type," ",this.getSvgId(),'points="',i.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"',this.addPaintOrder(),"/>\n"),t?t(s.join("")):s.join("")},commonRender:function(t){var e,i=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-r);for(var o=0;o<i;o++)e=this.points[o],t.lineTo(e.x-n,e.y-r);return!0},_render:function(t){this.commonRender(t)&&this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,o=this.points.length;r<o;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i,n){if(!t)return i(null);n||(n={});var r=e.parsePointsAttribute(t.getAttribute("points")),o=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);i(new e.Polyline(r,e.util.object.extend(o,n)))},e.Polyline.fromObject=function(t,i){return e.Object._fromObject("Polyline",t,i,"points")})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_render:function(t){this.commonRender(t)&&(t.closePath(),this._renderPaintInOrder(t))},_renderDashedStroke:function(t){this.callSuper("_renderDashedStroke",t),t.closePath()}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,n,r){if(!t)return n(null);r||(r={});var o=e.parsePointsAttribute(t.getAttribute("points")),s=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);n(new e.Polygon(o,i(s,r)))},e.Polygon.fromObject=function(t,i){return e.Object._fromObject("Polygon",t,i,"points")})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,o=Object.prototype.toString,s=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(t,e){e=e||{},this.callSuper("initialize",e),t||(t=[]);var i="[object Array]"===o.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left),void 0===t.top&&(this.top=e.top),this.pathOffset=this.pathOffset||{x:e.left+this.width/2,y:e.top+this.height/2}},_renderPathCommands:function(t){var e,i,n,r=null,o=0,a=0,c=0,l=0,u=0,h=0,f=-this.pathOffset.x,p=-this.pathOffset.y;t.beginPath();for(var d=0,g=this.path.length;d<g;++d){switch((e=this.path[d])[0]){case"l":c+=e[1],l+=e[2],t.lineTo(c+f,l+p);break;case"L":c=e[1],l=e[2],t.lineTo(c+f,l+p);break;case"h":c+=e[1],t.lineTo(c+f,l+p);break;case"H":c=e[1],t.lineTo(c+f,l+p);break;case"v":l+=e[1],t.lineTo(c+f,l+p);break;case"V":l=e[1],t.lineTo(c+f,l+p);break;case"m":o=c+=e[1],a=l+=e[2],t.moveTo(c+f,l+p);break;case"M":o=c=e[1],a=l=e[2],t.moveTo(c+f,l+p);break;case"c":i=c+e[5],n=l+e[6],u=c+e[3],h=l+e[4],t.bezierCurveTo(c+e[1]+f,l+e[2]+p,u+f,h+p,i+f,n+p),c=i,l=n;break;case"C":c=e[5],l=e[6],u=e[3],h=e[4],t.bezierCurveTo(e[1]+f,e[2]+p,u+f,h+p,c+f,l+p);break;case"s":i=c+e[3],n=l+e[4],null===r[0].match(/[CcSs]/)?(u=c,h=l):(u=2*c-u,h=2*l-h),t.bezierCurveTo(u+f,h+p,c+e[1]+f,l+e[2]+p,i+f,n+p),u=c+e[1],h=l+e[2],c=i,l=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(u=c,h=l):(u=2*c-u,h=2*l-h),t.bezierCurveTo(u+f,h+p,e[1]+f,e[2]+p,i+f,n+p),c=i,l=n,u=e[1],h=e[2];break;case"q":i=c+e[3],n=l+e[4],u=c+e[1],h=l+e[2],t.quadraticCurveTo(u+f,h+p,i+f,n+p),c=i,l=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+p,i+f,n+p),c=i,l=n,u=e[1],h=e[2];break;case"t":i=c+e[1],n=l+e[2],null===r[0].match(/[QqTt]/)?(u=c,h=l):(u=2*c-u,h=2*l-h),t.quadraticCurveTo(u+f,h+p,i+f,n+p),c=i,l=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(u=c,h=l):(u=2*c-u,h=2*l-h),t.quadraticCurveTo(u+f,h+p,i+f,n+p),c=i,l=n;break;case"a":s(t,c+f,l+p,[e[1],e[2],e[3],e[4],e[5],e[6]+c+f,e[7]+l+p]),c+=e[6],l+=e[7];break;case"A":s(t,c+f,l+p,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+p]),c=e[6],l=e[7];break;case"z":case"Z":c=o,l=a,t.closePath()}r=e}},_render:function(t){this._renderPathCommands(t),this._renderPaintInOrder(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return r(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),top:this.top,left:this.left})},toDatalessObject:function(t){var e=this.toObject(["sourcePath"].concat(t));return e.sourcePath&&delete e.path,e},toSVG:function(t){for(var e,i=[],n=this._createBaseSVGMarkup(),r=0,o=this.path.length;r<o;r++)i.push(this.path[r].join(" "));var s=i.join(" ");return e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ",n.push("<path ",this.getSvgId(),'d="',s,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',this.addPaintOrder(),"/>\n"),t?t(n.join("")):n.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,o=[],s=[],l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,u=0,h=this.path.length;u<h;u++){for(n=(t=this.path[u]).slice(1).trim(),s.length=0;i=l.exec(n);)s.push(i[0]);r=[t.charAt(0)];for(var f=0,p=s.length;f<p;f++)e=parseFloat(s[f]),isNaN(e)||r.push(e);var d=r[0],g=a[d.toLowerCase()],m=c[d]||d;if(r.length-1>g)for(var v=1,_=r.length;v<_;v+=g)o.push([d].concat(r.slice(v,v+g))),d=m;else o.push(r)}return o},_parseDimensions:function(){for(var t,r,o,s,a=[],c=[],l=null,u=0,h=0,f=0,p=0,d=0,g=0,m=0,v=this.path.length;m<v;++m){switch((t=this.path[m])[0]){case"l":f+=t[1],p+=t[2],s=[];break;case"L":f=t[1],p=t[2],s=[];break;case"h":f+=t[1],s=[];break;case"H":f=t[1],s=[];break;case"v":p+=t[1],s=[];break;case"V":p=t[1],s=[];break;case"m":u=f+=t[1],h=p+=t[2],s=[];break;case"M":u=f=t[1],h=p=t[2],s=[];break;case"c":r=f+t[5],o=p+t[6],d=f+t[3],g=p+t[4],s=e.util.getBoundsOfCurve(f,p,f+t[1],p+t[2],d,g,r,o),f=r,p=o;break;case"C":d=t[3],g=t[4],s=e.util.getBoundsOfCurve(f,p,t[1],t[2],d,g,t[5],t[6]),f=t[5],p=t[6];break;case"s":r=f+t[3],o=p+t[4],null===l[0].match(/[CcSs]/)?(d=f,g=p):(d=2*f-d,g=2*p-g),s=e.util.getBoundsOfCurve(f,p,d,g,f+t[1],p+t[2],r,o),d=f+t[1],g=p+t[2],f=r,p=o;break;case"S":r=t[3],o=t[4],null===l[0].match(/[CcSs]/)?(d=f,g=p):(d=2*f-d,g=2*p-g),s=e.util.getBoundsOfCurve(f,p,d,g,t[1],t[2],r,o),f=r,p=o,d=t[1],g=t[2];break;case"q":r=f+t[3],o=p+t[4],d=f+t[1],g=p+t[2],s=e.util.getBoundsOfCurve(f,p,d,g,d,g,r,o),f=r,p=o;break;case"Q":d=t[1],g=t[2],s=e.util.getBoundsOfCurve(f,p,d,g,d,g,t[3],t[4]),f=t[3],p=t[4];break;case"t":r=f+t[1],o=p+t[2],null===l[0].match(/[QqTt]/)?(d=f,g=p):(d=2*f-d,g=2*p-g),s=e.util.getBoundsOfCurve(f,p,d,g,d,g,r,o),f=r,p=o;break;case"T":r=t[1],o=t[2],null===l[0].match(/[QqTt]/)?(d=f,g=p):(d=2*f-d,g=2*p-g),s=e.util.getBoundsOfCurve(f,p,d,g,d,g,r,o),f=r,p=o;break;case"a":s=e.util.getBoundsOfArc(f,p,t[1],t[2],t[3],t[4],t[5],t[6]+f,t[7]+p),f+=t[6],p+=t[7];break;case"A":s=e.util.getBoundsOfArc(f,p,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),f=t[6],p=t[7];break;case"z":case"Z":f=u,p=h}l=t,s.forEach(function(t){a.push(t.x),c.push(t.y)}),a.push(f),c.push(p)}var _=i(a)||0,b=i(c)||0;return{left:_,top:b,width:(n(a)||0)-_,height:(n(c)||0)-b}}}),e.Path.fromObject=function(t,i){if("string"==typeof t.sourcePath){var n=t.sourcePath;e.loadSVGFromURL(n,function(e){var n=e[0];n.setOptions(t),i&&i(n)})}else e.Object._fromObject("Path",t,i,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var o=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);i(new e.Path(o.d,r(o,n)))})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),i)this._updateObjectsACoords();else{var r=e&&e.centerPoint;r||this._calcBounds(),this._updateObjectsCoords(r),delete e.centerPoint,this.callSuper("initialize",e)}this.setCoords()},_updateObjectsACoords:function(){for(var t=this._objects.length;t--;)this._objects[t].setCoords(!0,!0)},_updateObjectsCoords:function(t){t=t||this.getCenterPoint();for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){var i=t.left,n=t.top;t.set({left:i-e.x,top:n-e.y}),t.group=this,t.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,e){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(t,e);if("canvas"===t)for(i=this._objects.length;i--;)this._objects[i]._set(t,e);this.callSuper("_set",t,e)},toObject:function(t){var e=this.getObjects().map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var n=e.toObject(t);return e.includeDefaultValues=i,n});return i(this.callSuper("toObject",t),{objects:e})},toDatalessObject:function(t){var e;return e=this.sourcePath||this.getObjects().map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var n=e.toDatalessObject(t);return e.includeDefaultValues=i,n}),i(this.callSuper("toDatalessObject",t),{objects:e})},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=t)for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1;return t},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var t=0,e=this._objects.length;t<e;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var e=0,i=this._objects.length;e<i;e++)this._objects[e].render(t)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var t=0,e=this._objects.length;t<e;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var i=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-i/2,-n/2,i,n)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),n=e.util.qrDecompose(i),r=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(r,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var t=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new e.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),t.forEach(function(t){t.group=r,t.dirty=!0,i.add(t)}),r.canvas=i,r._objects=t,(i._activeObject=r).setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0,!0)}),this},_calcBounds:function(t){for(var e,i,n,r=[],o=[],s=["tr","br","bl","tl"],a=0,c=this._objects.length,l=s.length;a<c;++a)for((e=this._objects[a]).setCoords(!0),n=0;n<l;n++)i=s[n],r.push(e.oCoords[i].x),o.push(e.oCoords[i].y);this.set(this._getBounds(r,o,t))},_getBounds:function(t,i,o){var s=new e.Point(n(t),n(i)),a=new e.Point(r(t),r(i)),c={width:a.x-s.x||0,height:a.y-s.y||0};return o||(c.left=s.x||0,c.top=s.y||0,"center"===this.originX&&(c.left+=c.width/2),"right"===this.originX&&(c.left+=c.width),"center"===this.originY&&(c.top+=c.height/2),"bottom"===this.originY&&(c.top+=c.height)),c},toSVG:function(t){var e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){var r=e.util.object.clone(t,!0);delete r.objects,i&&i(new e.Group(n,r,!0))})})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(t,i){i=i||{},this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var t=this._objects;this._objects=[];var i=this.toObject(),n=new e.Group([]);if(delete i.objects,n.set(i),n.type="group",t.forEach(function(t){t.group=n,t.canvas.remove(t)}),n._objects=t,!this.canvas)return n;var r=this.canvas;return r.add(n),(r._activeObject=n).setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},_set:function(t,i){var n=this._objects.length;if("canvas"===t)for(;n--;)this._objects[n].set(t,i);if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,i);e.Object.prototype._set.call(this,t,i)},shouldCache:function(){return!1},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var t=0,e=this._objects.length;t<e;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return!1},_renderControls:function(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),void 0===i.hasRotatingPoint&&(i.hasRotatingPoint=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(t,i);t.restore()}}),e.ActiveSelection.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.ActiveSelection(n,t,!0))})})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=fabric.util.object.extend;t.fabric||(t.fabric={}),t.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),objectCaching:!1,cacheKey:"",cropX:0,cropY:0,initialize:function(t,e){e||(e={}),this.filters=[],this.cacheKey="texture"+fabric.Object.__uid++,this.callSuper("initialize",e),this._initElement(t,e)},getElement:function(){return this._element},setElement:function(t,e){var i=fabric.filterBackend;return i&&i.evictCachesForKey&&(i.evictCachesForKey(this.cacheKey),i.evictCachesForKey(this.cacheKey+"_filtered")),this._element=t,this._originalElement=t,this._initConfig(e),this.resizeFilter&&this.applyResizeFilters(),0!==this.filters.length&&this.applyFilters(),this},dispose:function(){var t=fabric.filterBackend;t&&t.evictCachesForKey&&(t.evictCachesForKey(this.cacheKey),t.evictCachesForKey(this.cacheKey+"_filtered")),this._originalElement=void 0,this._element=void 0,this._filteredEl=void 0},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t,this),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var i=[];this.filters.forEach(function(t){t&&i.push(t.toObject())});var n=e(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(t)),{src:this.getSrc(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=-this.width/2,n=-this.height/2,r="";if(this.hasCrop()){var o=fabric.Object.__uid++;e.push('<clipPath id="imageCrop_'+o+'">\n','\t<rect x="'+i+'" y="'+n+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),r=' clip-path="url(#imageCrop_'+o+')" '}e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n');var s=["\t<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',n-this.cropY,'" style="',this.getSvgStyles(),'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',r,"></image>\n"];if("fill"===this.paintFirst&&Array.prototype.push.apply(e,s),this.stroke||this.strokeDashArray){var a=this.fill;this.fill=null,e.push("\t<rect ",'x="',i,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=a}return"fill"!==this.paintFirst&&Array.prototype.push.apply(e,s),e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():e.src:this.src||""},setSrc:function(t,e,i){return fabric.util.loadImage(t,function(t){this.setElement(t,i),this._setWidthHeight(),e(this)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var t=this.resizeFilter,e=this.canvas?this.canvas.getRetinaScaling():1,i=this.minimumScaleTrigger,n=this.scaleX*e,r=this.scaleY*e,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i<n&&i<r)return this._element=o,this._filterScalingX=1,void(this._filterScalingY=1);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var s=fabric.util.createCanvasElement(),a=this._filteredEl?this.cacheKey:this.cacheKey+"_filtered",c=o.width,l=o.height;s.width=c,s.height=l,this._element=s,t.scaleX=n,t.scaleY=r,fabric.filterBackend.applyFilters([t],o,c,l,this._element,a),this._filterScalingX=s.width/this._originalElement.width,this._filterScalingY=s.height/this._originalElement.height},applyFilters:function(t){if(t=(t=t||this.filters||[]).filter(function(t){return t}),this.group&&this.set("dirty",!0),0===t.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var e=this._originalElement,i=e.naturalWidth||e.width,n=e.naturalHeight||e.height;if(this._element===this._originalElement){var r=fabric.util.createCanvasElement();r.width=i,r.height=n,this._element=r,this._filteredEl=r}else this._element.getContext("2d").clearRect(0,0,i,n);return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(t,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(t){!1===this.isMoving&&this.resizeFilter&&this._needsResize()&&(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,this.applyResizeFilters()),this._stroke(t),this._renderPaintInOrder(t)},_renderFill:function(t){var e=this.width,i=this.height,n=e*this._filterScalingX,r=i*this._filterScalingY,o=-e/2,s=-i/2,a=this._element;a&&t.drawImage(a,this.cropX*this._filterScalingX,this.cropY*this._filterScalingY,n,r,o,s,e,i)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t,e){this.setElement(fabric.util.getById(t),e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width=t&&"width"in t?t.width:this.getElement()&&this.getElement().width||0,this.height=t&&"height"in t?t.height:this.getElement()&&this.getElement().height||0},parsePreserveAspectRatioAttribute:function(){var t,e=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,r=1,o=1,s=0,a=0,c=0,l=0,u=this.width,h=this.height,f={width:u,height:h};return!e||"none"===e.alignX&&"none"===e.alignY?(r=u/i,o=h/n):("meet"===e.meetOrSlice&&(t=(u-i*(r=o=fabric.util.findScaleToFit(this._element,f)))/2,"Min"===e.alignX&&(s=-t),"Max"===e.alignX&&(s=t),t=(h-n*o)/2,"Min"===e.alignY&&(a=-t),"Max"===e.alignY&&(a=t)),"slice"===e.meetOrSlice&&(t=i-u/(r=o=fabric.util.findScaleToCover(this._element,f)),"Mid"===e.alignX&&(c=t/2),"Max"===e.alignX&&(c=t),t=n-h/o,"Mid"===e.alignY&&(l=t/2),"Max"===e.alignY&&(l=t),i=u/r,n=h/o)),{width:i,height:n,scaleX:r,scaleY:o,offsetLeft:s,offsetTop:a,cropX:c,cropY:l}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){var i=fabric.util.object.clone(t);fabric.util.loadImage(i.src,function(t,n){n?e&&e(null,n):fabric.Image.prototype._initFilters.call(i,i.filters,function(n){i.filters=n||[],fabric.Image.prototype._initFilters.call(i,[i.resizeFilter],function(n){i.resizeFilter=n[0];var r=new fabric.Image(t,i);e(r)})})},null,i.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),fabric.Image.fromElement=function(t,i,n){var r=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(r["xlink:href"],i,e(n?fabric.util.object.clone(n):{},r))})}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.angle%360;return 0<t?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.rotate(t),n()},onComplete:function(){r.setCoords(),i()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){"use strict";fabric.isWebglSupported=function(t){if(fabric.isLikelyNode)return!1;t=t||fabric.WebglFilterBackend.prototype.tileSize;var e,i,n,r=document.createElement("canvas"),o=r.getContext("webgl")||r.getContext("experimental-webgl"),s=!1;if(o){fabric.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),s=fabric.maxTextureSize>=t;for(var a=["highp","mediump","lowp"],c=0;c<3;c++)if(i="precision "+a[c]+" float;\nvoid main(){}",n=(e=o).createShader(e.FRAGMENT_SHADER),e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)){fabric.webGlPrecision=a[c];break}}return this.isSupported=s},(fabric.WebglFilterBackend=function(t){t&&t.tileSize&&(this.tileSize=t.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}).prototype={tileSize:2048,resources:{},setupGLContext:function(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(t,e)},chooseFastestCopyGLTo2DMethod:function(t,e){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(t){i=!1}var r="undefined"!=typeof ArrayBuffer,o="undefined"!=typeof Uint8ClampedArray;if(n&&i&&r&&o){var s,a,c=fabric.util.createCanvasElement(),l=new ArrayBuffer(t*e*4),u={imageBuffer:l,destinationWidth:t,destinationHeight:e,targetCanvas:c};c.width=t,c.height=e,s=window.performance.now(),copyGLTo2DDrawImage.call(u,this.gl,u),a=window.performance.now()-s,s=window.performance.now(),copyGLTo2DPutImageData.call(u,this.gl,u),window.performance.now()-s<a?(this.imageBuffer=l,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(t,e){var i=fabric.util.createCanvasElement();i.width=t,i.height=e;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},r=i.getContext("webgl",n);r||(r=i.getContext("experimental-webgl",n)),r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)},applyFilters:function(t,e,i,n,r,o){var s,a=this.gl;o&&(s=this.getCachedTexture(o,e));var c={originalWidth:e.width||e.originalWidth,originalHeight:e.height||e.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:a,sourceTexture:this.createTexture(a,i,n,!s&&e),targetTexture:this.createTexture(a,i,n),originalTexture:s||this.createTexture(a,i,n,!s&&e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:r},l=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,l),t.forEach(function(t){t&&t.applyTo(c)}),resizeCanvasIfNeeded(c),this.copyGLTo2D(a,c),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(c.sourceTexture),a.deleteTexture(c.targetTexture),a.deleteFramebuffer(l),r.getContext("2d").setTransform(1,0,0,1,0,0),c},applyFiltersDebug:function(t,e,i,n,r,o){var s=this.gl,a=this.applyFilters(t,e,i,n,r,o),c=s.getError();if(c!==s.NO_ERROR){var l=this.glErrorToString(s,c),u=new Error("WebGL Error "+l);throw u.glErrorCode=c,u}return a},glErrorToString:function(t,e){if(!t)return"Context undefined for error code: "+e;if("number"!=typeof e)return"Error code is not a number";switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"UNKNOWN_ERROR"}},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(t,e,i,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),r},getCachedTexture:function(t,e){if(this.textureCache[t])return this.textureCache[t];var i=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[t]=i},evictCachesForKey:function(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,e=t.getExtension("WEBGL_debug_renderer_info"),i={renderer:"",vendor:""};if(e){var n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),r=t.getParameter(e.UNMASKED_VENDOR_WEBGL);n&&(i.renderer=n.toLowerCase()),r&&(i.vendor=r.toLowerCase())}return this.gpuInfo=i}}}(),function(){"use strict";var t=function(){};(fabric.Canvas2dFilterBackend=function(){}).prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(t,e,i,n,r){var o=r.getContext("2d");o.drawImage(e,0,0,i,n);var s={sourceWidth:i,sourceHeight:n,imageData:o.getImageData(0,0,i,n),originalEl:e,originalImageData:o.getImageData(0,0,i,n),canvasEl:r,ctx:o,filterBackend:this};return t.forEach(function(t){t.applyTo(s)}),s.imageData.width===i&&s.imageData.height===n||(r.width=s.imageData.width,r.height=s.imageData.height),o.putImageData(s.imageData,0,0),s}}}(),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},createProgram:function(t,e,i){e=e||this.fragmentSource,i=i||this.vertexSource,"highp"!==fabric.webGlPrecision&&(e=e.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+t.getShaderInfoLog(n));var r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+t.getShaderInfoLog(r));var o=t.createProgram();if(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(o));var s=this.getAttributeLocations(t,o),a=this.getUniformLocations(t,o)||{};return a.uStepW=t.getUniformLocation(o,"uStepW"),a.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:s,uniformLocations:a}},getAttributeLocations:function(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(t,e,i){var n=e.aPosition,r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW)},_setupFrameBuffer:function(t){var e,i,n=t.context;1<t.passes?(e=t.destinationWidth,i=t.destinationHeight,t.sourceWidth===e&&t.sourceHeight===i||(n.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(n,e,i)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(t){t.passes--,t.pass++;var e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e},isNeutralState:function(){return!1},applyTo:function(t){if(t.webgl){if(1<t.passes&&this.isNeutralState(t))return;this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)}else this.isNeutralState()||this.applyTo2d(t)},retrieveShader:function(t){return t.programCache.hasOwnProperty(this.type)||(t.programCache[this.type]=this.createProgram(t.context)),t.programCache[this.type]},applyToWebGL:function(t){var e=t.context,i=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.aPosition),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)},unbindAdditionalTexture:function(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(t){this[this.mainParameter]=t},sendUniformData:function(){},createHelpLayer:function(t){if(!t.helpLayer){var e=document.createElement("canvas");e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}},toObject:function(){var t={type:this.type},e=this.mainParameter;return e&&(t[e]=this[e]),t},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(t,e){var i=new fabric.Image.filters[t.type](t);return e&&e(i),i},function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},isNeutralState:function(){for(var t=i.ColorMatrix,e=20;e--;)if(this.matrix[e]!==t.prototype.matrix[e])return!1;return!0},applyTo2d:function(t){var e,i,n,r,o,s=t.imageData.data,a=s.length,c=this.matrix,l=this.colorsOnly;for(o=0;o<a;o+=4)e=s[o],i=s[o+1],n=s[o+2],l?(s[o]=e*c[0]+i*c[1]+n*c[2]+255*c[4],s[o+1]=e*c[5]+i*c[6]+n*c[7]+255*c[9],s[o+2]=e*c[10]+i*c[11]+n*c[12]+255*c[14]):(r=s[o+3],s[o]=e*c[0]+i*c[1]+n*c[2]+r*c[3]+255*c[4],s[o+1]=e*c[5]+i*c[6]+n*c[7]+r*c[8]+255*c[9],s[o+2]=e*c[10]+i*c[11]+n*c[12]+r*c[13]+255*c[14],s[o+3]=e*c[15]+i*c[16]+n*c[17]+r*c[18]+255*c[19])},getUniformLocations:function(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}},sendUniformData:function(t,e){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],r=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,n),t.uniform4fv(e.uConstants,r)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(0!==this.brightness){var e,i=t.imageData.data,n=i.length,r=Math.round(255*this.brightness);for(e=0;e<n;e+=4)i[e]=i[e]+r,i[e+1]=i[e+1]+r,i[e+2]=i[e+2]+r}},getUniformLocations:function(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}},sendUniformData:function(t,e){t.uniform1f(e.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(t){var e=Math.sqrt(this.matrix.length),i=this.type+"_"+e+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return t.programCache.hasOwnProperty(i)||(t.programCache[i]=this.createProgram(t.context,n)),t.programCache[i]},applyTo2d:function(t){var e,i,n,r,o,s,a,c,l,u,h,f,p,d=t.imageData,g=d.data,m=this.matrix,v=Math.round(Math.sqrt(m.length)),_=Math.floor(v/2),b=d.width,y=d.height,w=t.ctx.createImageData(b,y),x=w.data,C=this.opaque?1:0;for(h=0;h<y;h++)for(u=0;u<b;u++){for(o=4*(h*b+u),p=r=n=i=e=0;p<v;p++)for(f=0;f<v;f++)s=u+f-_,(a=h+p-_)<0||y<a||s<0||b<s||(c=4*(a*b+s),l=m[p*v+f],e+=g[c]*l,i+=g[c+1]*l,n+=g[c+2]*l,C||(r+=g[c+3]*l));x[o]=e,x[o+1]=i,x[o+2]=n,x[o+3]=C?g[o+3]:r}t.imageData=w},getUniformLocations:function(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}},sendUniformData:function(t,e){t.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(t){var e,i,n=t.imageData.data,r=n.length,o=this.mode;for(e=0;e<r;e+=4)"average"===o?i=(n[e]+n[e+1]+n[e+2])/3:"lightness"===o?i=(Math.min(n[e],n[e+1],n[e+2])+Math.max(n[e],n[e+1],n[e+2]))/2:"luminosity"===o&&(i=.21*n[e]+.72*n[e+1]+.07*n[e+2]),n[e]=i,n[e+1]=i,n[e+2]=i},retrieveShader:function(t){var e=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(e)){var i=this.fragmentSource[this.mode];t.programCache[e]=this.createProgram(t.context,i)}return t.programCache[e]},getUniformLocations:function(t,e){return{uMode:t.getUniformLocation(e,"uMode")}},sendUniformData:function(t,e){t.uniform1i(e.uMode,1)}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(t){if(this.invert){var e,i=t.imageData.data,n=i.length;for(e=0;e<n;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2]}},getUniformLocations:function(t,e){return{uInvert:t.getUniformLocation(e,"uInvert")}},sendUniformData:function(t,e){t.uniform1i(e.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(t){if(0!==this.noise){var e,i,n=t.imageData.data,r=n.length,o=this.noise;for(e=0,r=n.length;e<r;e+=4)i=(.5-Math.random())*o,n[e]+=i,n[e+1]+=i,n[e+2]+=i}},getUniformLocations:function(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}},sendUniformData:function(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(t){if(1!==this.blocksize){var e,i,n,r,o,s,a,c,l,u,h,f=t.imageData,p=f.data,d=f.height,g=f.width;for(i=0;i<d;i+=this.blocksize)for(n=0;n<g;n+=this.blocksize)for(r=p[e=4*i*g+4*n],o=p[e+1],s=p[e+2],a=p[e+3],u=Math.min(i+this.blocksize,d),h=Math.min(n+this.blocksize,g),c=i;c<u;c++)for(l=n;l<h;l++)p[e=4*c*g+4*l]=r,p[e+1]=o,p[e+2]=s,p[e+3]=a}},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}},sendUniformData:function(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.RemoveColor=r(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(t){var i,n,r,o,s=t.imageData.data,a=255*this.distance,c=new e.Color(this.color).getSource(),l=[c[0]-a,c[1]-a,c[2]-a],u=[c[0]+a,c[1]+a,c[2]+a];for(i=0;i<s.length;i+=4)n=s[i],r=s[i+1],o=s[i+2],l[0]<n&&l[1]<r&&l[2]<o&&n<u[0]&&r<u[1]&&o<u[2]&&(s[i+3]=0)},getUniformLocations:function(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource(),r=parseFloat(this.distance),o=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],s=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];t.uniform4fv(i.uLow,o),t.uniform4fv(i.uHigh,s)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in r)i[o]=n(i.ColorMatrix,{type:o,matrix:r[o],mainParameter:!1,colorsOnly:!0}),e.Image.filters[o].fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.BlendColor=n(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(t){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[t]+"}\n}"},retrieveShader:function(t){var e,i=this.type+"_"+this.mode;return t.programCache.hasOwnProperty(i)||(e=this.buildSource(this.mode),t.programCache[i]=this.createProgram(t.context,e)),t.programCache[i]},applyTo2d:function(t){var i,n,r,o,s,a,c,l=t.imageData.data,u=l.length,h=1-this.alpha;i=(c=new e.Color(this.color).getSource())[0]*this.alpha,n=c[1]*this.alpha,r=c[2]*this.alpha;for(var f=0;f<u;f+=4)switch(o=l[f],s=l[f+1],a=l[f+2],this.mode){case"multiply":l[f]=o*i/255,l[f+1]=s*n/255,l[f+2]=a*r/255;break;case"screen":l[f]=255-(255-o)*(255-i)/255,l[f+1]=255-(255-s)*(255-n)/255,l[f+2]=255-(255-a)*(255-r)/255;break;case"add":l[f]=o+i,l[f+1]=s+n,l[f+2]=a+r;break;case"diff":case"difference":l[f]=Math.abs(o-i),l[f+1]=Math.abs(s-n),l[f+2]=Math.abs(a-r);break;case"subtract":l[f]=o-i,l[f+1]=s-n,l[f+2]=a-r;break;case"darken":l[f]=Math.min(o,i),l[f+1]=Math.min(s,n),l[f+2]=Math.min(a,r);break;case"lighten":l[f]=Math.max(o,i),l[f+1]=Math.max(s,n),l[f+2]=Math.max(a,r);break;case"overlay":l[f]=i<128?2*o*i/255:255-2*(255-o)*(255-i)/255,l[f+1]=n<128?2*s*n/255:255-2*(255-s)*(255-n)/255,l[f+2]=r<128?2*a*r/255:255-2*(255-a)*(255-r)/255;break;case"exclusion":l[f]=i+o-2*i*o/255,l[f+1]=n+s-2*n*s/255,l[f+2]=r+a-2*r*a/255;break;case"tint":l[f]=i+o*h,l[f+1]=n+s*h,l[f+2]=r+a*h}},getUniformLocations:function(t,e){return{uColor:t.getUniformLocation(e,"uColor")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(i.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.BlendImage=n(i.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(t){var e=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(e)||(t.programCache[e]=this.createProgram(t.context,i)),t.programCache[e]},applyToWebGL:function(t){var e=t.context,i=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,i,e.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(e,e.TEXTURE1)},createTexture:function(t,e){return t.getCachedTexture(e.cacheKey,e._element)},calculateMatrix:function(){var t=this.image,e=t._element.width,i=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/i,1]},applyTo2d:function(t){var e,i,n,r,o,s,a,c,l,u,h,f=t.imageData,p=t.filterBackend.resources,d=f.data,g=d.length,m=t.imageData.width,v=t.imageData.height,_=this.image;p.blendImage||(p.blendImage=document.createElement("canvas")),(l=p.blendImage).width===m&&l.height===v||(l.width=m,l.height=v),(u=l.getContext("2d")).setTransform(_.scaleX,0,0,_.scaleY,_.left,_.top),u.drawImage(_._element,0,0,m,v),h=u.getImageData(0,0,m,v).data;for(var b=0;b<g;b+=4)switch(o=d[b],s=d[b+1],a=d[b+2],c=d[b+3],e=h[b],i=h[b+1],n=h[b+2],r=h[b+3],this.mode){case"multiply":d[b]=o*e/255,d[b+1]=s*i/255,d[b+2]=a*n/255,d[b+3]=c*r/255;break;case"mask":d[b+3]=r}},getUniformLocations:function(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}},sendUniformData:function(t,e){var i=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(t,i){e.Image.fromObject(t.image,function(n){var r=e.util.object.clone(t);r.image=n,i(new e.Image.filters.BlendImage(r))})}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,o=Math.abs,s=Math.round,a=Math.sin,c=Math.ceil,l=e.Image.filters,u=e.util.createClass;l.Resize=u(l.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,getUniformLocations:function(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}},sendUniformData:function(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)},retrieveShader:function(t){var e=this.getFilterWindow(),i=this.type+"_"+e;if(!t.programCache.hasOwnProperty(i)){var n=this.generateShader(e);t.programCache[i]=this.createProgram(t.context,n)}return t.programCache[i]},getFilterWindow:function(){var t=this.tempScale;return Math.ceil(this.lanczosLobes/t)},getTaps:function(){for(var t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,i=this.getFilterWindow(),n=new Array(i),r=1;r<=i;r++)n[r-1]=t(r*e);return n},generateShader:function(t){for(var e=new Array(t),i=this.fragmentSourceTOP,n=1;n<=t;n++)e[n-1]=n+".0 * uDelta";return i+="uniform float uTaps["+t+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",e.forEach(function(t,e){i+="  color += texture2D(uTexture, vTexCoord + "+t+") * uTaps["+e+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+t+") * uTaps["+e+"];\n",i+="  sum += 2.0 * uTaps["+e+"];\n"}),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(t){if(t.webgl){if(1<t.passes&&this.isNeutralState(t))return;t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceHeight=t.destinationHeight}else this.isNeutralState(t)||this.applyTo2d(t)},isNeutralState:function(t){var e=t.scaleX||this.scaleX,i=t.scaleY||this.scaleY;return 1===e&&1===i},lanczosCreate:function(t){return function(e){if(t<=e||e<=-t)return 0;if(e<1.1920929e-7&&-1.1920929e-7<e)return 1;var i=(e*=Math.PI)/t;return a(e)/e*a(i)/i}},applyTo2d:function(t){var e=t.imageData,i=this.scaleX,n=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/n;var r,o=e.width,a=e.height,c=s(o*i),l=s(a*n);"sliceHack"===this.resizeType?r=this.sliceByTwo(t,o,a,c,l):"hermite"===this.resizeType?r=this.hermiteFastResize(t,o,a,c,l):"bilinear"===this.resizeType?r=this.bilinearFiltering(t,o,a,c,l):"lanczos"===this.resizeType&&(r=this.lanczosResize(t,o,a,c,l)),t.imageData=r},sliceByTwo:function(t,i,r,o,s){var a,c,l=t.imageData,u=!1,h=!1,f=.5*i,p=.5*r,d=e.filterBackend.resources,g=0,m=0,v=i,_=0;for(d.sliceByTwo||(d.sliceByTwo=document.createElement("canvas")),((a=d.sliceByTwo).width<1.5*i||a.height<r)&&(a.width=1.5*i,a.height=r),(c=a.getContext("2d")).clearRect(0,0,1.5*i,r),c.putImageData(l,0,0),o=n(o),s=n(s);!u||!h;)r=p,o<n(.5*(i=f))?f=n(.5*f):(f=o,u=!0),s<n(.5*p)?p=n(.5*p):(p=s,h=!0),c.drawImage(a,g,m,i,r,v,_,f,p),g=v,m=_,_+=p;return c.getImageData(g,m,o,s)},lanczosResize:function(t,e,s,a,l){var u=t.imageData.data,h=t.ctx.createImageData(a,l),f=h.data,p=this.lanczosCreate(this.lanczosLobes),d=this.rcpScaleX,g=this.rcpScaleY,m=2/this.rcpScaleX,v=2/this.rcpScaleY,_=c(d*this.lanczosLobes/2),b=c(g*this.lanczosLobes/2),y={},w={},x={};return function t(c){var C,S,T,O,k,$,A,E,j,I,M;for(w.x=(c+.5)*d,x.x=n(w.x),C=0;C<l;C++){for(w.y=(C+.5)*g,x.y=n(w.y),j=E=A=$=k=0,S=x.x-_;S<=x.x+_;S++)if(!(S<0||e<=S)){I=n(1e3*o(S-w.x)),y[I]||(y[I]={});for(var P=x.y-b;P<=x.y+b;P++)P<0||s<=P||(M=n(1e3*o(P-w.y)),y[I][M]||(y[I][M]=p(r(i(I*m,2)+i(M*v,2))/1e3)),0<(T=y[I][M])&&(k+=T,$+=T*u[O=4*(P*e+S)],A+=T*u[O+1],E+=T*u[O+2],j+=T*u[O+3]))}f[O=4*(C*a+c)]=$/k,f[O+1]=A/k,f[O+2]=E/k,f[O+3]=j/k}return++c<a?t(c):h}(0)},bilinearFiltering:function(t,e,i,r,o){var s,a,c,l,u,h,f,p,d,g=0,m=this.rcpScaleX,v=this.rcpScaleY,_=4*(e-1),b=t.imageData.data,y=t.ctx.createImageData(r,o),w=y.data;for(c=0;c<o;c++)for(l=0;l<r;l++)for(u=m*l-(s=n(m*l)),h=v*c-(a=n(v*c)),d=4*(a*e+s),f=0;f<4;f++)p=b[d+f]*(1-u)*(1-h)+b[d+4+f]*u*(1-h)+b[d+_+f]*h*(1-u)+b[d+_+4+f]*u*h,w[g++]=p;return y},hermiteFastResize:function(t,e,i,s,a){for(var l=this.rcpScaleX,u=this.rcpScaleY,h=c(l/2),f=c(u/2),p=t.imageData.data,d=t.ctx.createImageData(s,a),g=d.data,m=0;m<a;m++)for(var v=0;v<s;v++){for(var _=4*(v+m*s),b=0,y=0,w=0,x=0,C=0,S=0,T=0,O=(m+.5)*u,k=n(m*u);k<(m+1)*u;k++)for(var $=o(O-(k+.5))/f,A=(v+.5)*l,E=$*$,j=n(v*l);j<(v+1)*l;j++){var I=o(A-(j+.5))/h,M=r(E+I*I);1<M&&M<-1||0<(b=2*M*M*M-3*M*M+1)&&(T+=b*p[3+(I=4*(j+k*e))],w+=b,p[I+3]<255&&(b=b*p[I+3]/250),x+=b*p[I],C+=b*p[I+1],S+=b*p[I+2],y+=b)}g[_]=x/y,g[_+1]=C/y,g[_+2]=S/y,g[_+3]=T/w}return d},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(0!==this.contrast){var e,i=t.imageData.data,n=i.length,r=Math.floor(255*this.contrast),o=259*(r+255)/(255*(259-r));for(e=0;e<n;e+=4)i[e]=o*(i[e]-128)+128,i[e+1]=o*(i[e+1]-128)+128,i[e+2]=o*(i[e+2]-128)+128}},getUniformLocations:function(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}},sendUniformData:function(t,e){t.uniform1f(e.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(0!==this.saturation){var e,i,n=t.imageData.data,r=n.length,o=-this.saturation;for(e=0;e<r;e+=4)i=Math.max(n[e],n[e+1],n[e+2]),n[e]+=i!==n[e]?(i-n[e])*o:0,n[e+1]+=i!==n[e+1]?(i-n[e+1])*o:0,n[e+2]+=i!==n[e+2]?(i-n[e+2])*o:0}},getUniformLocations:function(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}},sendUniformData:function(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var i,n,r=t.filterBackend.resources,o=t.imageData.width,s=t.imageData.height;r.blurLayer1||(r.blurLayer1=e.util.createCanvasElement(),r.blurLayer2=e.util.createCanvasElement()),i=r.blurLayer1,n=r.blurLayer2,i.width===o&&i.height===s||(n.width=i.width=o,n.height=i.height=s);var a,c,l,u,h=i.getContext("2d"),f=n.getContext("2d"),p=.06*this.blur*.5;for(h.putImageData(t.imageData,0,0),f.clearRect(0,0,o,s),u=-15;u<=15;u++)l=p*(c=u/15)*o+(a=(Math.random()-.5)/4),f.globalAlpha=1-Math.abs(c),f.drawImage(i,l,a),h.drawImage(n,0,0),f.globalAlpha=1,f.clearRect(0,0,n.width,n.height);for(u=-15;u<=15;u++)l=p*(c=u/15)*s+(a=(Math.random()-.5)/4),f.globalAlpha=1-Math.abs(c),f.drawImage(i,a,l),h.drawImage(n,0,0),f.globalAlpha=1,f.clearRect(0,0,n.width,n.height);t.ctx.drawImage(i,0,0);var d=t.ctx.getImageData(0,0,i.width,i.height);return h.globalAlpha=1,h.clearRect(0,0,i.width,i.height),d},getUniformLocations:function(t,e){return{delta:t.getUniformLocation(e,"uDelta")}},sendUniformData:function(t,e){var i=this.chooseRightDelta();t.uniform2fv(e.delta,i)},chooseRightDelta:function(){var t,e=1,i=[0,0];return this.horizontal?1<this.aspectRatio&&(e=1/this.aspectRatio):this.aspectRatio<1&&(e=this.aspectRatio),t=e*this.blur*.12,this.horizontal?i[0]=t:i[1]=t,i}}),i.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",applyTo2d:function(t){var e,i=t.imageData.data,n=this.gamma,r=i.length,o=1/n[0],s=1/n[1],a=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),e=0,r=256;e<r;e++)this.rVals[e]=255*Math.pow(e/255,o),this.gVals[e]=255*Math.pow(e/255,s),this.bVals[e]=255*Math.pow(e/255,a);for(e=0,r=i.length;e<r;e+=4)i[e]=this.rVals[i[e]],i[e+1]=this.gVals[i[e+1]],i[e+2]=this.bVals[i[e+2]]},getUniformLocations:function(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}},sendUniformData:function(t,e){t.uniform3fv(e.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(e){e.applyTo(t)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})}}),e.Image.filters.Composed.fromObject=function(t,i){var n=(t.subFilters||[]).map(function(t){return new e.Image.filters[t.type](t)}),r=new e.Image.filters.Composed({subFilters:n});return i&&i(r),r}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,i=e.util.cos(t),n=e.util.sin(t),r=Math.sqrt(1/3)*n,o=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+o/3,this.matrix[1]=1/3*o-r,this.matrix[2]=1/3*o+r,this.matrix[5]=1/3*o+r,this.matrix[6]=i+1/3*o,this.matrix[7]=1/3*o-r,this.matrix[10]=1/3*o-r,this.matrix[11]=1/3*o+r,this.matrix[12]=i+1/3*o},applyTo:function(t){this.calculateMatrix(),e.Image.filters.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;e.Text?e.warn("fabric.Text is already defined"):(e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:e.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(t,e){this.styles=e&&e.styles||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var t,e,i,n,r,o,s,a=0,c=this._textLines.length;a<c;a++)if(("justify"===this.textAlign||a!==c-1&&!this.isEndOfWrapping(a))&&(n=0,r=this._textLines[a],(e=this.getLineWidth(a))<this.width&&(s=this.textLines[a].match(this._reSpacesAndTabs)))){i=s.length,t=(this.width-e)/i;for(var l=0,u=r.length;l<=u;l++)o=this.__charBounds[a][l],this._reSpaceAndTab.test(r[l])?(o.width+=t,o.kernedWidth+=t,o.left+=n,n+=t):o.left+=n}},isEndOfWrapping:function(t){return t===this._textLines.length-1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions"),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t},_render:function(t){this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")},_renderText:function(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))},_setTextStyles:function(t,e,i){t.textBaseline="alphabetic",t.font=this._getFontDeclaration(e,i)},calcTextWidth:function(){for(var t=this.getLineWidth(0),e=1,i=this._textLines.length;e<i;e++){var n=this.getLineWidth(e);t<n&&(t=n)}return t},_renderTextLine:function(t,e,i,n,r,o){this._renderChars(t,e,i,n,r,o)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e,i,n,r,o,s,a=0,c=t.fillStyle,l=this._getLeftOffset(),u=this._getTopOffset(),h=0,f=0,p=0,d=this._textLines.length;p<d;p++)if(e=this.getHeightOfLine(p),this.textBackgroundColor||this.styleHas("textBackgroundColor",p)){n=this._textLines[p],i=this._getLineLeftOffset(p),h=f=0,r=this.getValueOfPropertyAt(p,0,"textBackgroundColor");for(var g=0,m=n.length;g<m;g++)o=this.__charBounds[p][g],(s=this.getValueOfPropertyAt(p,g,"textBackgroundColor"))!==r?((t.fillStyle=r)&&t.fillRect(l+i+h,u+a,f,e/this.lineHeight),h=o.left,f=o.width,r=s):f+=o.kernedWidth;s&&(t.fillStyle=s,t.fillRect(l+i+h,u+a,f,e/this.lineHeight)),a+=e}else a+=e;t.fillStyle=c,this._removeShadow(t)}},getFontCache:function(t){var i=t.fontFamily.toLowerCase();e.charWidthsCache[i]||(e.charWidthsCache[i]={});var n=e.charWidthsCache[i],r=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return n[r]||(n[r]={}),n[r]},_applyCharStyles:function(t,e,i,n,r){this._setFillStyles(e,r),this._setStrokeStyles(e,r),e.font=this._getFontDeclaration(r)},_measureChar:function(t,e,i,n){var r,o,s,a,c=this.getFontCache(e),l=i+t,u=this._getFontDeclaration(e)===this._getFontDeclaration(n),h=e.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==c[i]&&(s=c[i]),void 0!==c[t]&&(a=r=c[t]),u&&void 0!==c[l]&&(a=(o=c[l])-s),void 0===r||void 0===s||void 0===o){var f=this.getMeasuringContext();this._setTextStyles(f,e,!0)}return void 0===r&&(a=r=f.measureText(t).width,c[t]=r),void 0===s&&u&&i&&(s=f.measureText(i).width,c[i]=s),u&&void 0===o&&(o=f.measureText(l).width,a=(c[l]=o)-s),{width:r*h,kernedWidth:a*h}},getHeightOfChar:function(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")},measureLine:function(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e},_measureLine:function(t){var e,i,n,r,o=0,s=this._textLines[t],a=new Array(s.length);for(this.__charBounds[t]=a,e=0;e<s.length;e++)i=s[e],r=this._getGraphemeBox(i,t,e,n),o+=(a[e]=r).kernedWidth,n=i;return a[e]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:o,numOfSpaces:0}},_getGraphemeBox:function(t,e,i,n,r){var o,s=this.getCompleteStyleDeclaration(e,i),a=n?this.getCompleteStyleDeclaration(e,i-1):{},c=this._measureChar(t,s,n,a),l=c.kernedWidth,u=c.width;0!==this.charSpacing&&(u+=o=this._getWidthOfCharSpacing(),l+=o);var h={width:u,left:0,height:s.fontSize,kernedWidth:l,deltaY:s.deltaY};if(0<i&&!r){var f=this.__charBounds[e][i-1];h.left=f.left+f.width+c.kernedWidth-c.width}return h},getHeightOfLine:function(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var e=this._textLines[t],i=this.getHeightOfChar(t,0),n=1,r=e.length;n<r;n++)i=Math.max(this.getHeightOfChar(t,n),i);return this.__lineHeights[t]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var t,e=0,i=0,n=this._textLines.length;i<n;i++)t=this.getHeightOfLine(i),e+=i===n-1?t/this.lineHeight:t;return e},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(t,e){t.save();for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),o=this._applyPatternGradientTransform(t,"fillText"===e?this.fill:this.stroke),s=0,a=this._textLines.length;s<a;s++){var c=this.getHeightOfLine(s),l=c/this.lineHeight,u=this._getLineLeftOffset(s);this._renderTextLine(e,t,this._textLines[s],n+u-o.offsetX,r+i+l-o.offsetY,s),i+=c}t.restore()},_renderTextFill:function(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_renderChars:function(t,e,i,n,r,o){var s,a,c,l,u=this.getHeightOfLine(o),h=-1!==this.textAlign.indexOf("justify"),f="",p=0,d=!h&&0===this.charSpacing&&this.isEmptyStyles(o);if(e.save(),r-=u*this._fontSizeFraction/this.lineHeight,d)return this._renderChar(t,e,o,0,this.textLines[o],n,r,u),void e.restore();for(var g=0,m=i.length-1;g<=m;g++)l=g===m||this.charSpacing,f+=i[g],c=this.__charBounds[o][g],0===p?(n+=c.kernedWidth-c.width,p+=c.width):p+=c.kernedWidth,h&&!l&&this._reSpaceAndTab.test(i[g])&&(l=!0),l||(s=s||this.getCompleteStyleDeclaration(o,g),a=this.getCompleteStyleDeclaration(o,g+1),l=this._hasStyleChanged(s,a)),l&&(this._renderChar(t,e,o,g,f,n,r,u),f="",s=a,n+=p,p=0);e.restore()},_renderChar:function(t,e,i,n,r,o,s){var a=this._getStyleDeclaration(i,n),c=this.getCompleteStyleDeclaration(i,n),l="fillText"===t&&c.fill,u="strokeText"===t&&c.stroke&&c.strokeWidth;(u||l)&&(a&&e.save(),this._applyCharStyles(t,e,i,n,c),a&&a.textBackgroundColor&&this._removeShadow(e),a&&a.deltaY&&(s+=a.deltaY),l&&e.fillText(r,o,s),u&&e.strokeText(r,o,s),a&&e.restore())},setSuperscript:function(t,e){return this._setScript(t,e,this.superscript)},setSubscript:function(t,e){return this._setScript(t,e,this.subscript)},_setScript:function(t,e,i){var n=this.get2DCursorLocation(t,!0),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),o=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),s={fontSize:r*i.size,deltaY:o+r*i.baseline};return this.setSelectionStyles(s,t,e),this},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.deltaY!==e.deltaY},_hasStyleChangedForSvg:function(t,e){return this._hasStyleChanged(t,e)||t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough},_getLineLeftOffset:function(t){var e=this.getLineWidth(t);return"center"===this.textAlign?(this.width-e)/2:"right"===this.textAlign?this.width-e:"justify-center"===this.textAlign&&this.isEndOfWrapping(t)?(this.width-e)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(t)?this.width-e:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t},getLineWidth:function(t){return this.__lineWidths[t]?this.__lineWidths[t]:(e=""===this._textLines[t]?0:this.measureLine(t).width,this.__lineWidths[t]=e);var e},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(t,e,i){var n=this._getStyleDeclaration(t,e);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(t,e){if(this[e]||this.styleHas(e)){for(var i,n,r,o,s,a,c,l,u,h,f,p,d,g,m,v,_=this._getLeftOffset(),b=this._getTopOffset(),y=this._getWidthOfCharSpacing(),w=0,x=this._textLines.length;w<x;w++)if(i=this.getHeightOfLine(w),this[e]||this.styleHas(e,w)){c=this._textLines[w],g=i/this.lineHeight,o=this._getLineLeftOffset(w),f=h=0,l=this.getValueOfPropertyAt(w,0,e),v=this.getValueOfPropertyAt(w,0,"fill"),u=b+g*(1-this._fontSizeFraction),n=this.getHeightOfChar(w,0),s=this.getValueOfPropertyAt(w,0,"deltaY");for(var C=0,S=c.length;C<S;C++)p=this.__charBounds[w][C],d=this.getValueOfPropertyAt(w,C,e),m=this.getValueOfPropertyAt(w,C,"fill"),r=this.getHeightOfChar(w,C),a=this.getValueOfPropertyAt(w,C,"deltaY"),(d!==l||m!==v||r!==n||a!==s)&&0<f?(t.fillStyle=v,l&&v&&t.fillRect(_+o+h,u+this.offsets[e]*n+s,f,this.fontSize/15),h=p.left,f=p.width,l=d,v=m,n=r,s=a):f+=p.kernedWidth;t.fillStyle=m,d&&m&&t.fillRect(_+o+h,u+this.offsets[e]*n+s,f-y,this.fontSize/15),b+=i}else b+=i;this._removeShadow(t)}},_getFontDeclaration:function(t,i){var n=t||this,r=this.fontFamily,o=-1<e.Text.genericFonts.indexOf(r.toLowerCase()),s=void 0===r||-1<r.indexOf("'")||-1<r.indexOf('"')||o?n.fontFamily:'"'+n.fontFamily+'"';return[e.isLikelyNode?n.fontWeight:n.fontStyle,e.isLikelyNode?n.fontStyle:n.fontWeight,i?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",s].join(" ")},render:function(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",t)))},_splitTextIntoLines:function(t){for(var i=t.split(this._reNewline),n=new Array(i.length),r=["\n"],o=[],s=0;s<i.length;s++)n[s]=e.util.string.graphemeSplit(i[s]),o=o.concat(n[s],r);return o.pop(),{_unwrappedLines:n,lines:i,graphemeText:o,graphemeLines:n}},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(t),n=this.callSuper("toObject",e);return n.styles=i(this.styles,!0),n},set:function(t,e){this.callSuper("set",t,e);var i=!1;if("object"==typeof t)for(var n in t)i=i||-1!==this._dimensionAffectingProps.indexOf(n);else i=-1!==this._dimensionAffectingProps.indexOf(t);return i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,n,r){if(!t)return n(null);var o=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES),s=o.textAnchor||"left";if((r=e.util.object.extend(r?i(r):{},o)).top=r.top||0,r.left=r.left||0,o.textDecoration){var a=o.textDecoration;-1!==a.indexOf("underline")&&(r.underline=!0),-1!==a.indexOf("overline")&&(r.overline=!0),-1!==a.indexOf("line-through")&&(r.linethrough=!0),delete r.textDecoration}"dx"in o&&(r.left+=o.dx),"dy"in o&&(r.top+=o.dy),"fontSize"in r||(r.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var c="";"textContent"in t?c=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(c=t.firstChild.data),c=c.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var l=r.strokeWidth;r.strokeWidth=0;var u=new e.Text(c,r),h=u.getScaledHeight()/u.height,f=((u.height+u.strokeWidth)*u.lineHeight-u.height)*h,p=u.getScaledHeight()+f,d=0;"center"===s&&(d=u.getScaledWidth()/2),"right"===s&&(d=u.getScaledWidth()),u.set({left:u.left-d,top:u.top-(p-u.fontSize*(.07+u._fontSizeFraction))/u.lineHeight,strokeWidth:void 0!==l?l:1}),n(u)},e.Text.fromObject=function(t,i){return e.Object._fromObject("Text",t,i,"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;var e=void 0===t?this.styles:{line:this.styles[t]};for(var i in e)for(var n in e[i])for(var r in e[i][n])return!1;return!0},styleHas:function(t,e){if(!this.styles||!t||""===t)return!1;if(void 0!==e&&!this.styles[e])return!1;var i=void 0===e?this.styles:{line:this.styles[e]};for(var n in i)for(var r in i[n])if(void 0!==i[n][r][t])return!0;return!1},cleanStyle:function(t){if(!this.styles||!t||""===t)return!1;var e,i,n=this.styles,r=0,o=!0,s=0;for(var a in n){for(var c in e=0,n[a]){var l;r++,(l=n[a][c]).hasOwnProperty(t)?(i?l[t]!==i&&(o=!1):i=l[t],l[t]===this[t]&&delete l[t]):o=!1,0!==Object.keys(l).length?e++:delete n[a][c]}0===e&&delete n[a]}for(var u=0;u<this._textLines.length;u++)s+=this._textLines[u].length;o&&r===s&&(this[t]=i,this.removeStyle(t))},removeStyle:function(t){if(this.styles&&t&&""!==t){var e,i,n,r=this.styles;for(i in r){for(n in e=r[i])delete e[n][t],0===Object.keys(e[n]).length&&delete e[n];0===Object.keys(e).length&&delete r[i]}}},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},get2DCursorLocation:function(t,e){void 0===t&&(t=this.selectionStart);for(var i=e?this._unwrappedTextLines:this._textLines,n=i.length,r=0;r<n;r++){if(t<=i[r].length)return{lineIndex:r,charIndex:t};t-=i[r].length+1}return{lineIndex:r-1,charIndex:i[r-1].length<t?i[r-1].length:t}},getSelectionStyles:function(t,e,i){void 0===t&&(t=this.selectionStart||0),void 0===e&&(e=this.selectionEnd||t);for(var n=[],r=t;r<e;r++)n.push(this.getStyleAtPosition(r,i));return n},getStyleAtPosition:function(t,e){var i=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(t,e,i){void 0===e&&(e=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||e);for(var n=e;n<i;n++)this._extendStyles(n,t);return this._forceClearCache=!0,this},_getStyleDeclaration:function(t,e){var i=this.styles&&this.styles[t];return i?i[e]:null},getCompleteStyleDeclaration:function(t,e){for(var i,n=this._getStyleDeclaration(t,e)||{},r={},o=0;o<this._styleProperties.length;o++)r[i=this._styleProperties[o]]=void 0===n[i]?this[i]:n[i];return r},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]}}),function(){function t(t){t.textDecoration&&(-1<t.textDecoration.indexOf("underline")&&(t.underline=!0),-1<t.textDecoration.indexOf("line-through")&&(t.linethrough=!0),-1<t.textDecoration.indexOf("overline")&&(t.overline=!0),delete t.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,e){this.callSuper("initialize",t,e),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this.canvas.contextTop,i=this.canvas.viewportTransform;e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e),t||e.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas){var t,e=this._getCursorBoundaries();this.canvas&&this.canvas.contextTop?(t=this.canvas.contextTop,this.clearContextTop(!0)):(t=this.canvas.contextContainer).save(),this.selectionStart===this.selectionEnd?this.renderCursor(e,t):this.renderSelection(e,t),t.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},_getCursorBoundaries:function(t){void 0===t&&(t=this.selectionStart);var e=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t);return{left:e,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var e,i,n,r,o=0,s=0,a=this.get2DCursorLocation(t);n=a.charIndex,i=a.lineIndex;for(var c=0;c<i;c++)o+=this.getHeightOfLine(c);e=this._getLineLeftOffset(i);var l=this.__charBounds[i][n];return l&&(s=l.left),0!==this.charSpacing&&n===this._textLines[i].length&&(s-=this._getWidthOfCharSpacing()),r={top:o,left:e+(0<s?s:0)},this.cursorOffsetCache=r,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=0<i.charIndex?i.charIndex-1:0,o=this.getValueOfPropertyAt(n,r,"fontSize"),s=this.scaleX*this.canvas.getZoom(),a=this.cursorWidth/s,c=t.topOffset,l=this.getValueOfPropertyAt(n,r,"deltaY");c+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-o*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,e),e.fillStyle=this.getValueOfPropertyAt(n,r,"fill"),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+t.leftOffset-a/2,c+t.top+l,a,o)},renderSelection:function(t,e){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=-1!==this.textAlign.indexOf("justify"),o=this.get2DCursorLocation(i),s=this.get2DCursorLocation(n),a=o.lineIndex,c=s.lineIndex,l=o.charIndex<0?0:o.charIndex,u=s.charIndex<0?0:s.charIndex,h=a;h<=c;h++){var f,p=this._getLineLeftOffset(h)||0,d=this.getHeightOfLine(h),g=0,m=0;if(h===a&&(g=this.__charBounds[a][l].left),a<=h&&h<c)m=r&&!this.isEndOfWrapping(h)?this.width:this.getLineWidth(h)||5;else if(h===c)if(0===u)m=this.__charBounds[c][u].left;else{var v=this._getWidthOfCharSpacing();m=this.__charBounds[c][u-1].left+this.__charBounds[c][u-1].width-v}f=d,(this.lineHeight<1||h===c&&1<this.lineHeight)&&(d/=this.lineHeight),this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",e.fillRect(t.left+p+g,t.top+t.topOffset+d,m-g,1)):(e.fillStyle=this.selectionColor,e.fillRect(t.left+p+g,t.top+t.topOffset,m-g,d)),t.topOffset+=f}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0),e=0<t.charIndex?t.charIndex-1:0;return{l:t.lineIndex,c:e}}}),fabric.IText.fromObject=function(e,i){if(t(e),e.styles)for(var n in e.styles)for(var r in e.styles[n])t(e.styles[n][r]);fabric.Object._fromObject("IText",e,i,"text")}}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",function(){var e=t.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,t._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var e=t.canvas;e&&(e._iTextInstances=e._iTextInstances||[],fabric.util.removeFromArray(e._iTextInstances,t),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,t._removeCanvasHandlers(e)))})},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,e=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&e&&e.clearContext(e.contextTop||e.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i--;for(;/\S/.test(this._text[i])&&-1<i;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i++;for(;/\S/.test(this._text[i])&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this._text[i])&&-1<i;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this._text[i])&&i<this.text.length;)e++,i++;return t+e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&0<i&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll()),this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;(e===this.__selectionStartOnMouseDown&&i!==n||i!==e&&n!==e)&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,e,i){var n=i.slice(0,t),r=fabric.util.string.graphemeSplit(n).length;if(t===e)return{selectionStart:r,selectionEnd:r};var o=i.slice(t,e);return{selectionStart:r,selectionEnd:r+fabric.util.string.graphemeSplit(o).length}},fromGraphemeToStringSelection:function(t,e,i){var n=i.slice(0,t).join("").length;return t===e?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+i.slice(t,e).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),n=i.lineIndex,r=i.charIndex,o=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,s=e.leftOffset,a=this.calcTransformMatrix(),c={x:e.left+s,y:e.top+e.topOffset+o},l=this.canvas.upperCanvasEl,u=l.width,h=l.height,f=u-o,p=h-o,d=l.clientWidth/u,g=l.clientHeight/h;return c=fabric.util.transformPoint(c,a),(c=fabric.util.transformPoint(c,this.canvas.viewportTransform)).x*=d,c.y*=g,c.x<0&&(c.x=0),c.x>f&&(c.x=f),c.y<0&&(c.y=0),c.y>p&&(c.y=p),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:o+"px",charHeight:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,e){var i,n,r=this.get2DCursorLocation(t,!0),o=this.get2DCursorLocation(e,!0),s=r.lineIndex,a=r.charIndex,c=o.lineIndex,l=o.charIndex;if(s!==c){if(this.styles[s])for(i=a;i<this._unwrappedTextLines[s].length;i++)delete this.styles[s][i];if(this.styles[c])for(i=l;i<this._unwrappedTextLines[c].length;i++)(n=this.styles[c][i])&&(this.styles[s]||(this.styles[s]={}),this.styles[s][a+i-l]=n);for(i=s+1;i<=c;i++)delete this.styles[i];this.shiftLineStyles(c,s-c)}else if(this.styles[s]){n=this.styles[s];var u,h,f=l-a;for(i=a;i<l;i++)delete n[i];for(h in this.styles[s])l<=(u=parseInt(h,10))&&(n[u-f]=n[h],delete n[h])}},shiftLineStyles:function(e,i){var n=t(this.styles);for(var r in this.styles){var o=parseInt(r,10);e<o&&(this.styles[o+i]=n[o],n[o-i]||delete this.styles[o])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(e,i,n,r){var o,s={},a=!1;for(var c in n||(n=1),this.shiftLineStyles(e,n),this.styles[e]&&(o=this.styles[e][0===i?i:i-1]),this.styles[e]){var l=parseInt(c,10);i<=l&&(a=!0,s[l-i]=this.styles[e][c],delete this.styles[e][c])}for(a?this.styles[e+n]=s:delete this.styles[e+n];1<n;)n--,r&&r[n]?this.styles[e+n]={0:t(r[n])}:o?this.styles[e+n]={0:t(o)}:delete this.styles[e+n];this._forceClearCache=!0},insertCharStyleObject:function(e,i,n,r){this.styles||(this.styles={});var o=this.styles[e],s=o?t(o):{};for(var a in n||(n=1),s){var c=parseInt(a,10);i<=c&&(o[c+n]=s[c],s[c-n]||delete o[c])}if(this._forceClearCache=!0,r)for(;n--;)Object.keys(r[n]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][i+n]=t(r[n]));else if(o)for(var l=o[i?i-1:1];l&&n--;)this.styles[e][i+n]=t(l)},insertNewStyleBlock:function(t,e,i){for(var n=this.get2DCursorLocation(e,!0),r=[0],o=0,s=0;s<t.length;s++)"\n"===t[s]?r[++o]=0:r[o]++;for(0<r[0]&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],i),i=i&&i.slice(r[0]+1)),o&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],o),s=1;s<o;s++)0<r[s]?this.insertCharStyleObject(n.lineIndex+s,0,r[s],i):i&&(this.styles[n.lineIndex+s][0]=i[0]),i=i&&i.slice(r[s]+1);0<r[s]&&this.insertCharStyleObject(n.lineIndex+s,0,r[s],i)},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):t<i&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(t){if(this.canvas){this.__newClickTime=+new Date;var e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("mousedblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},_mouseDownHandler:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||this===this.canvas._activeObject&&(this.selected=!0)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(t){this.__isMousedown=!1,!this.editable||t.transform&&t.transform.actionPerformed||t.e.button&&1!==t.e.button||(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,n,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(t){for(var e=this.getLocalPointer(t),i=0,n=0,r=0,o=0,s=0,a=0,c=this._textLines.length;a<c&&r<=e.y;a++)r+=this.getHeightOfLine(a)*this.scaleY,0<(s=a)&&(o+=this._textLines[a-1].length+1);n=this._getLineLeftOffset(s)*this.scaleX;for(var l=0,u=this._textLines[s].length;l<u&&(i=n,(n+=this.__charBounds[s][l].kernedWidth*this.scaleX)<=e.x);l++)o++;return this._getNewSelectionStartFromOffset(e,i,n,o,u)},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var o=t.x-e,s=i-t.x,a=n+(o<s||s<0?0:1);return this.flipX&&(a=r-a),a>this._text.length&&(a=this._text.length),a}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; line-height: 1px; paddingtop: "+t.fontSize+";",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing&&!this.inCompositionMode){if(t.keyCode in this.keysMap)this[this.keysMap[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),33<=t.keyCode&&t.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(t){var e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),this.isEditing){var i,n,r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,o=this._text.length,s=r.length,a=s-o;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var c=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),l=this.selectionStart>c.selectionStart;this.selectionStart!==this.selectionEnd?(i=this._text.slice(this.selectionStart,this.selectionEnd),a+=this.selectionEnd-this.selectionStart):s<o&&(i=l?this._text.slice(this.selectionEnd+a,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-a)),n=r.slice(c.selectionEnd-a,c.selectionEnd),i&&i.length&&(this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):l?this.removeStyleFromTo(this.selectionEnd-i.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+i.length)),n.length&&(e&&n.join("")===fabric.copiedText?this.insertNewStyleBlock(n,this.selectionStart,fabric.copiedTextStyle):this.insertNewStyleBlock(n,this.selectionStart)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){var i,n=this._getLineLeftOffset(t);return 0<e&&(n+=(i=this.__charBounds[t][e-1]).left+i.width),n},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r+1,s);return this._textLines[r].slice(o).length+a+2},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||t.metaKey||33===t.keyCode)return-i;var o=n.charIndex,s=this._getWidthBeforeCursor(r,o),a=this._getIndexOnLine(r-1,s),c=this._textLines[r].slice(0,o);return-this._textLines[r-1].length+a-c.length},_getIndexOnLine:function(t,e){for(var i,n,r=this._textLines[t],o=this._getLineLeftOffset(t),s=0,a=0,c=r.length;a<c;a++)if(e<(o+=i=this.__charBounds[t][a].width)){n=!0;var l=o-i,u=o,h=Math.abs(l-e);s=Math.abs(u-e)<h?a:a-1;break}return n||(s=r.length-1),s},moveCursorDown:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var n;if(t.altKey)n=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[e])}if(void 0!==typeof n&&this[e]!==n)return this[e]=n,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t,e){void 0===e&&(e=t+1),this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(t,e,i,n){void 0===n&&(n=i),i<n&&this.removeStyleFromTo(i,n);var r=fabric.util.string.graphemeSplit(t);this.insertNewStyleBlock(r,i,e),this._text=[].concat(this._text.slice(0,i),r,this._text.slice(n)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var t=fabric.util.toFixed,e=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this._getSVGLeftTopOffsets(),n=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(e,n),t?t(e.join("")):e.join("")},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(t,e){var i=this.getSvgFilter(),n=""===i?"":' style="'+i+'"',r=this.getSvgTextDecoration(this);t.push("\t<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',n,">\n",e.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",r?'text-decoration="'+r+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var i,n=[],r=[],o=t;this._setSVGBg(r);for(var s=0,a=this._textLines.length;s<a;s++)i=this._getLineLeftOffset(s),(this.textBackgroundColor||this.styleHas("textBackgroundColor",s))&&this._setSVGTextLineBg(r,s,e+i,o),this._setSVGTextLineText(n,s,e+i,o),o+=this.getHeightOfLine(s);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(i,n,r,o){var s=i!==i.trim()||i.match(e),a=this.getSvgSpanStyles(n,s),c=a?'style="'+a+'"':"",l=n.deltaY,u="",h=fabric.Object.NUM_FRACTION_DIGITS;return l&&(u=' dy="'+t(l,h)+'" '),['<tspan x="',t(r,h),'" y="',t(o,h),'" ',u,c,">",fabric.util.string.escapeXml(i),"</tspan>"].join("")},_setSVGTextLineText:function(t,e,i,n){var r,o,s,a,c,l=this.getHeightOfLine(e),u=-1!==this.textAlign.indexOf("justify"),h="",f=0,p=this._textLines[e];n+=l*(1-this._fontSizeFraction)/this.lineHeight;for(var d=0,g=p.length-1;d<=g;d++)c=d===g||this.charSpacing,h+=p[d],s=this.__charBounds[e][d],0===f?(i+=s.kernedWidth-s.width,f+=s.width):f+=s.kernedWidth,u&&!c&&this._reSpaceAndTab.test(p[d])&&(c=!0),c||(r=r||this.getCompleteStyleDeclaration(e,d),o=this.getCompleteStyleDeclaration(e,d+1),c=this._hasStyleChangedForSvg(r,o)),c&&(a=this._getStyleDeclaration(e,d)||{},t.push(this._createTextCharSpan(h,a,i,n)),h="",r=o,i+=f,f=0)},_pushTextBgRect:function(e,i,n,r,o,s){var a=fabric.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(i),' x="',t(n,a),'" y="',t(r,a),'" width="',t(o,a),'" height="',t(s,a),'"></rect>\n')},_setSVGTextLineBg:function(t,e,i,n){for(var r,o,s=this._textLines[e],a=this.getHeightOfLine(e)/this.lineHeight,c=0,l=0,u=this.getValueOfPropertyAt(e,0,"textBackgroundColor"),h=0,f=s.length;h<f;h++)r=this.__charBounds[e][h],(o=this.getValueOfPropertyAt(e,h,"textBackgroundColor"))!==u?(u&&this._pushTextBgRect(t,u,i+l,n,c,a),l=r.left,c=r.width,u=o):c+=r.kernedWidth;o&&this._pushTextBgRect(t,o,i+l,n,c,a)},_getFillAttributes:function(t){var e=t&&"string"==typeof t?new fabric.Color(t):"";return e&&e.getSource()&&1!==e.getAlpha()?'opacity="'+e.getAlpha()+'" fill="'+e.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_getSVGLineTopOffset:function(t){for(var e,i=0,n=0;n<t;n++)i+=this.getHeightOfLine(n);return e=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(t){return fabric.Object.prototype.getSvgStyles.call(this,t)+" white-space: pre;"}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(t){for(var e=0,i=0,n=0,r={},o=0;o<t.graphemeLines.length;o++)"\n"===t.graphemeText[n]&&0<o?(i=0,n++,e++):this._reSpaceAndTab.test(t.graphemeText[n])&&0<o&&(i++,n++),r[o]={line:e,offset:i},n+=t.graphemeLines[o].length,i+=t.graphemeLines[o].length;return r},styleHas:function(t,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return e.Text.prototype.styleHas.call(this,t,i)},isEmptyStyles:function(t){var e,i,n=0,r=!1,o=this._styleMap[t],s=this._styleMap[t+1];for(var a in o&&(t=o.line,n=o.offset),s&&(r=s.line===t,e=s.offset),i=void 0===t?this.styles:{line:this.styles[t]})for(var c in i[a])if(n<=c&&(!r||c<e))for(var l in i[a][c])return!1;return!0},_getStyleDeclaration:function(t,e){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[t];if(!i)return null;t=i.line,e=i.offset+e}return this.callSuper("_getStyleDeclaration",t,e)},_setStyleDeclaration:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return this.styles[e.line]},_setLineStyle:function(t,e){var i=this._styleMap[t];this.styles[i.line]=e},_deleteLineStyle:function(t){var e=this._styleMap[t];delete this.styles[e.line]},_wrapText:function(t,e){var i,n=[];for(this.isWrapping=!0,i=0;i<t.length;i++)n=n.concat(this._wrapLine(t[i],i,e));return this.isWrapping=!1,n},_measureWord:function(t,e,i){var n,r=0;i=i||0;for(var o=0,s=t.length;o<s;o++)r+=this._getGraphemeBox(t[o],e,o+i,n,!0).kernedWidth,n=t[o];return r},_wrapLine:function(t,i,n,r){var o=0,s=[],a=[],c=t.split(this._reSpaceAndTab),l="",u=0,h=0,f=0,p=0,d=!0,g=this._getWidthOfCharSpacing();n-=r=r||0;for(var m=0;m<c.length;m++)l=e.util.string.graphemeSplit(c[m]),h=this._measureWord(l,i,u),u+=l.length,n<=(o+=f+h-g)&&!d?(s.push(a),a=[],o=h,d=!0):o+=g,d||a.push(" "),a=a.concat(l),f=this._measureWord([" "],i,u),u++,d=!1,p<h&&(p=h);return m&&s.push(a),p+r>this.dynamicMinWidth&&(this.dynamicMinWidth=p-g+r),s},isEndOfWrapping:function(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line},_splitTextIntoLines:function(t){for(var i=e.Text.prototype._splitTextIntoLines.call(this,t),n=this._wrapText(i.lines,this.width),r=new Array(n.length),o=0;o<n.length;o++)r[o]=n[o].join("");return i.lines=r,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),e.Textbox.fromObject=function(t,i){return e.Object._fromObject("Textbox",t,i,"text")}}("undefined"!=typeof exports?exports:this),function(){var t=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(e,i,n,r,o,s,a){var c=i.target;if(!("x"===o&&c instanceof fabric.Textbox))return t.call(fabric.Canvas.prototype,e,i,n,r,o,s,a);var l=c._getTransformedDimensions().x,u=c.width*(e.x/l);return u>=c.getMinWidth()?(c.set("width",u),!0):void 0},fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]}})}(),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],function(t){return e(t)}):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(0,function(t){function e(t){this.$container,this.constraints=null,this.__$tooltip,this.__init(t)}function i(e,i){var n=!0;return t.each(e,function(t,r){return void 0===i[t]||e[t]!==i[t]?(n=!1,!1):void 0}),n}function n(e){var i=e.attr("id"),n=i?s.window.document.getElementById(i):null;return n?n===e[0]:t.contains(s.window.document.body,e[0])}var r={animation:"fade",animationDuration:350,content:null,contentAsHTML:!1,contentCloning:!1,debug:!0,delay:300,delayTouch:[300,500],functionInit:null,functionBefore:null,functionReady:null,functionAfter:null,functionFormat:null,IEmin:6,interactive:!1,multiple:!1,parent:"body",plugins:["sideTip"],repositionOnScroll:!1,restoration:"none",selfDestruction:!0,theme:[],timer:0,trackerInterval:500,trackOrigin:!1,trackTooltip:!1,trigger:"hover",triggerClose:{click:!1,mouseleave:!1,originClick:!1,scroll:!1,tap:!1,touchleave:!1},triggerOpen:{click:!1,mouseenter:!1,tap:!1,touchstart:!1},updateAnimation:"rotate",zIndex:9999999},o="undefined"!=typeof window?window:null,s={hasTouchCapability:!(!o||!("ontouchstart"in o||o.DocumentTouch&&o.document instanceof o.DocumentTouch||o.navigator.maxTouchPoints)),hasTransitions:function(){if(!o)return!1;var t=(o.document.body||o.document.documentElement).style,e="transition",i=["Moz","Webkit","Khtml","O","ms"];if("string"==typeof t[e])return!0;e=e.charAt(0).toUpperCase()+e.substr(1);for(var n=0;n<i.length;n++)if("string"==typeof t[i[n]+e])return!0;return!1}(),IE:!1,semVer:"4.1.6",window:o},a=function(){this.__$emitterPrivate=t({}),this.__$emitterPublic=t({}),this.__instancesLatestArr=[],this.__plugins={},this._env=s};a.prototype={__bridge:function(e,i,n){if(!i[n]){var o=function(){};o.prototype=e;var s=new o;s.__init&&s.__init(i),t.each(e,function(t,e){0!=t.indexOf("__")&&(i[t]?r.debug&&console.log("The "+t+" method of the "+n+" plugin conflicts with another plugin or native methods"):(i[t]=function(){return s[t].apply(s,Array.prototype.slice.apply(arguments))},i[t].bridged=s))}),i[n]=s}return this},__setWindow:function(t){return s.window=t,this},_getRuler:function(t){return new e(t)},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_plugin:function(e){if("string"==typeof e){var i=e,n=null;return i.indexOf(".")>0?n=this.__plugins[i]:t.each(this.__plugins,function(t,e){return e.name.substring(e.name.length-i.length-1)=="."+i?(n=e,!1):void 0}),n}if(e.name.indexOf(".")<0)throw new Error("Plugins must be namespaced");return this.__plugins[e.name]=e,e.core&&this.__bridge(e.core,this,e.name),this},_trigger:function(){var t=Array.prototype.slice.apply(arguments);return"string"==typeof t[0]&&(t[0]={type:t[0]}),this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,t),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,t),this},instances:function(e){var i=[];return t(e||".tooltipstered").each(function(){var e=t(this),n=e.data("tooltipster-ns");n&&t.each(n,function(t,n){i.push(e.data(n))})}),i},instancesLatest:function(){return this.__instancesLatestArr},off:function(){return this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},origins:function(e){return t((e?e+" ":"")+".tooltipstered").toArray()},setDefaults:function(e){return t.extend(r,e),this},triggerHandler:function(){return this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},t.tooltipster=new a,t.Tooltipster=function(e,i){this.__callbacks={close:[],open:[]},this.__closingTime,this.__Content,this.__contentBcr,this.__destroyed=!1,this.__destroying=!1,this.__$emitterPrivate=t({}),this.__$emitterPublic=t({}),this.__enabled=!0,this.__garbageCollector,this.__Geometry,this.__lastPosition,this.__namespace="tooltipster-"+Math.round(1e6*Math.random()),this.__options,this.__$originParents,this.__pointerIsOverOrigin=!1,this.__previousThemes=[],this.__state="closed",this.__timeouts={close:[],open:null},this.__touchEvents=[],this.__tracker=null,this._$origin,this._$tooltip,this.__init(e,i)},t.Tooltipster.prototype={__init:function(e,i){var n=this;if(n._$origin=t(e),n.__options=t.extend(!0,{},r,i),n.__optionsFormat(),!s.IE||s.IE>=n.__options.IEmin){var o=null;if(void 0===n._$origin.data("tooltipster-initialTitle")&&(void 0===(o=n._$origin.attr("title"))&&(o=null),n._$origin.data("tooltipster-initialTitle",o)),null!==n.__options.content)n.__contentSet(n.__options.content);else{var a,c=n._$origin.attr("data-tooltip-content");c&&(a=t(c)),a&&a[0]?n.__contentSet(a.first()):n.__contentSet(o)}n._$origin.removeAttr("title").addClass("tooltipstered"),n.__prepareOrigin(),n.__prepareGC(),t.each(n.__options.plugins,function(t,e){n._plug(e)}),s.hasTouchCapability&&t("body").on("touchmove."+n.__namespace+"-triggerOpen",function(t){n._touchRecordEvent(t)}),n._on("created",function(){n.__prepareTooltip()})._on("repositioned",function(t){n.__lastPosition=t.position})}else n.__options.disabled=!0},__contentInsert:function(){var t=this,e=t._$tooltip.find(".tooltipster-content"),i=t.__Content;return t._trigger({type:"format",content:t.__Content,format:function(t){i=t}}),t.__options.functionFormat&&(i=t.__options.functionFormat.call(t,t,{origin:t._$origin[0]},t.__Content)),"string"!=typeof i||t.__options.contentAsHTML?e.empty().append(i):e.text(i),t},__contentSet:function(e){return e instanceof t&&this.__options.contentCloning&&(e=e.clone(!0)),this.__Content=e,this._trigger({type:"updated",content:e}),this},__destroyError:function(){throw new Error("This tooltip has been destroyed and cannot execute your method call.")},__geometry:function(){var e=this._$origin,i=this._$origin.is("area");if(i){var n=this._$origin.parent().attr("name");e=t('img[usemap="#'+n+'"]')}var r=e[0].getBoundingClientRect(),o=t(s.window.document),a=t(s.window),c=e,l={available:{document:null,window:null},document:{size:{height:o.height(),width:o.width()}},window:{scroll:{left:s.window.scrollX||s.window.document.documentElement.scrollLeft,top:s.window.scrollY||s.window.document.documentElement.scrollTop},size:{height:a.height(),width:a.width()}},origin:{fixedLineage:!1,offset:{},size:{height:r.bottom-r.top,width:r.right-r.left},usemapImage:i?e[0]:null,windowOffset:{bottom:r.bottom,left:r.left,right:r.right,top:r.top}}};if(i){var u=this._$origin.attr("shape"),h=this._$origin.attr("coords");if(h&&(h=h.split(","),t.map(h,function(t,e){h[e]=parseInt(t)})),"default"!=u)switch(u){case"circle":var f=h[0],p=h[1],d=h[2],g=p-d,m=f-d;l.origin.size.height=2*d,l.origin.size.width=l.origin.size.height,l.origin.windowOffset.left+=m,l.origin.windowOffset.top+=g;break;case"rect":var v=h[0],_=h[1],b=h[2],y=h[3];l.origin.size.height=y-_,l.origin.size.width=b-v,l.origin.windowOffset.left+=v,l.origin.windowOffset.top+=_;break;case"poly":for(var w=0,x=0,C=0,S=0,T="even",O=0;O<h.length;O++){var k=h[O];"even"==T?(k>C&&(C=k,0===O&&(w=C)),w>k&&(w=k),T="odd"):(k>S&&(S=k,1==O&&(x=S)),x>k&&(x=k),T="even")}l.origin.size.height=S-x,l.origin.size.width=C-w,l.origin.windowOffset.left+=w,l.origin.windowOffset.top+=x}}for(this._trigger({type:"geometry",edit:function(t){l.origin.size.height=t.height,l.origin.windowOffset.left=t.left,l.origin.windowOffset.top=t.top,l.origin.size.width=t.width},geometry:{height:l.origin.size.height,left:l.origin.windowOffset.left,top:l.origin.windowOffset.top,width:l.origin.size.width}}),l.origin.windowOffset.right=l.origin.windowOffset.left+l.origin.size.width,l.origin.windowOffset.bottom=l.origin.windowOffset.top+l.origin.size.height,l.origin.offset.left=l.origin.windowOffset.left+l.window.scroll.left,l.origin.offset.top=l.origin.windowOffset.top+l.window.scroll.top,l.origin.offset.bottom=l.origin.offset.top+l.origin.size.height,l.origin.offset.right=l.origin.offset.left+l.origin.size.width,l.available.document={bottom:{height:l.document.size.height-l.origin.offset.bottom,width:l.document.size.width},left:{height:l.document.size.height,width:l.origin.offset.left},right:{height:l.document.size.height,width:l.document.size.width-l.origin.offset.right},top:{height:l.origin.offset.top,width:l.document.size.width}},l.available.window={bottom:{height:Math.max(l.window.size.height-Math.max(l.origin.windowOffset.bottom,0),0),width:l.window.size.width},left:{height:l.window.size.height,width:Math.max(l.origin.windowOffset.left,0)},right:{height:l.window.size.height,width:Math.max(l.window.size.width-Math.max(l.origin.windowOffset.right,0),0)},top:{height:Math.max(l.origin.windowOffset.top,0),width:l.window.size.width}};"html"!=c[0].tagName.toLowerCase();){if("fixed"==c.css("position")){l.origin.fixedLineage=!0;break}c=c.parent()}return l},__optionsFormat:function(){return"number"==typeof this.__options.animationDuration&&(this.__options.animationDuration=[this.__options.animationDuration,this.__options.animationDuration]),"number"==typeof this.__options.delay&&(this.__options.delay=[this.__options.delay,this.__options.delay]),"number"==typeof this.__options.delayTouch&&(this.__options.delayTouch=[this.__options.delayTouch,this.__options.delayTouch]),"string"==typeof this.__options.theme&&(this.__options.theme=[this.__options.theme]),"string"==typeof this.__options.parent&&(this.__options.parent=t(this.__options.parent)),"hover"==this.__options.trigger?(this.__options.triggerOpen={mouseenter:!0,touchstart:!0},this.__options.triggerClose={mouseleave:!0,originClick:!0,touchleave:!0}):"click"==this.__options.trigger&&(this.__options.triggerOpen={click:!0,tap:!0},this.__options.triggerClose={click:!0,tap:!0}),this._trigger("options"),this},__prepareGC:function(){var e=this;return e.__options.selfDestruction?e.__garbageCollector=setInterval(function(){var i=(new Date).getTime();e.__touchEvents=t.grep(e.__touchEvents,function(t,e){return i-t.time>6e4}),n(e._$origin)||e.destroy()},2e4):clearInterval(e.__garbageCollector),e},__prepareOrigin:function(){var t=this;if(t._$origin.off("."+t.__namespace+"-triggerOpen"),s.hasTouchCapability&&t._$origin.on("touchstart."+t.__namespace+"-triggerOpen touchend."+t.__namespace+"-triggerOpen touchcancel."+t.__namespace+"-triggerOpen",function(e){t._touchRecordEvent(e)}),t.__options.triggerOpen.click||t.__options.triggerOpen.tap&&s.hasTouchCapability){var e="";t.__options.triggerOpen.click&&(e+="click."+t.__namespace+"-triggerOpen "),t.__options.triggerOpen.tap&&s.hasTouchCapability&&(e+="touchend."+t.__namespace+"-triggerOpen"),t._$origin.on(e,function(e){t._touchIsMeaningfulEvent(e)&&t._open(e)})}if(t.__options.triggerOpen.mouseenter||t.__options.triggerOpen.touchstart&&s.hasTouchCapability){e="";t.__options.triggerOpen.mouseenter&&(e+="mouseenter."+t.__namespace+"-triggerOpen "),t.__options.triggerOpen.touchstart&&s.hasTouchCapability&&(e+="touchstart."+t.__namespace+"-triggerOpen"),t._$origin.on(e,function(e){!t._touchIsTouchEvent(e)&&t._touchIsEmulatedEvent(e)||(t.__pointerIsOverOrigin=!0,t._openShortly(e))})}if(t.__options.triggerClose.mouseleave||t.__options.triggerClose.touchleave&&s.hasTouchCapability){e="";t.__options.triggerClose.mouseleave&&(e+="mouseleave."+t.__namespace+"-triggerOpen "),t.__options.triggerClose.touchleave&&s.hasTouchCapability&&(e+="touchend."+t.__namespace+"-triggerOpen touchcancel."+t.__namespace+"-triggerOpen"),t._$origin.on(e,function(e){t._touchIsMeaningfulEvent(e)&&(t.__pointerIsOverOrigin=!1)})}return t},__prepareTooltip:function(){var e=this,i=e.__options.interactive?"auto":"";return e._$tooltip.attr("id",e.__namespace).css({"pointer-events":i,zIndex:e.__options.zIndex}),t.each(e.__previousThemes,function(t,i){e._$tooltip.removeClass(i)}),t.each(e.__options.theme,function(t,i){e._$tooltip.addClass(i)}),e.__previousThemes=t.merge([],e.__options.theme),e},__scrollHandler:function(e){var i=this;if(i.__options.triggerClose.scroll)i._close(e);else{if(e.target===s.window.document)i.__Geometry.origin.fixedLineage||i.__options.repositionOnScroll&&i.reposition(e);else{var n=i.__geometry(),r=!1;if("fixed"!=i._$origin.css("position")&&i.__$originParents.each(function(e,i){var o=t(i),s=o.css("overflow-x"),a=o.css("overflow-y");if("visible"!=s||"visible"!=a){var c=i.getBoundingClientRect();if("visible"!=s&&(n.origin.windowOffset.left<c.left||n.origin.windowOffset.right>c.right))return r=!0,!1;if("visible"!=a&&(n.origin.windowOffset.top<c.top||n.origin.windowOffset.bottom>c.bottom))return r=!0,!1}return"fixed"!=o.css("position")&&void 0}),r)i._$tooltip.css("visibility","hidden");else if(i._$tooltip.css("visibility","visible"),i.__options.repositionOnScroll)i.reposition(e);else{var o=n.origin.offset.left-i.__Geometry.origin.offset.left,a=n.origin.offset.top-i.__Geometry.origin.offset.top;i._$tooltip.css({left:i.__lastPosition.coord.left+o,top:i.__lastPosition.coord.top+a})}}i._trigger({type:"scroll",event:e})}return i},__stateSet:function(t){return this.__state=t,this._trigger({type:"state",state:t}),this},__timeoutsClear:function(){return clearTimeout(this.__timeouts.open),this.__timeouts.open=null,t.each(this.__timeouts.close,function(t,e){clearTimeout(e)}),this.__timeouts.close=[],this},__trackerStart:function(){var t=this,e=t._$tooltip.find(".tooltipster-content");return t.__options.trackTooltip&&(t.__contentBcr=e[0].getBoundingClientRect()),t.__tracker=setInterval(function(){if(n(t._$origin)&&n(t._$tooltip)){if(t.__options.trackOrigin){var r=t.__geometry(),o=!1;i(r.origin.size,t.__Geometry.origin.size)&&(t.__Geometry.origin.fixedLineage?i(r.origin.windowOffset,t.__Geometry.origin.windowOffset)&&(o=!0):i(r.origin.offset,t.__Geometry.origin.offset)&&(o=!0)),o||(t.__options.triggerClose.mouseleave?t._close():t.reposition())}if(t.__options.trackTooltip){var s=e[0].getBoundingClientRect();s.height===t.__contentBcr.height&&s.width===t.__contentBcr.width||(t.reposition(),t.__contentBcr=s)}}else t._close()},t.__options.trackerInterval),t},_close:function(e,i){var n=this,r=!0;if(n._trigger({type:"close",event:e,stop:function(){r=!1}}),r||n.__destroying){i&&n.__callbacks.close.push(i),n.__callbacks.open=[],n.__timeoutsClear();var o=function(){t.each(n.__callbacks.close,function(t,i){i.call(n,n,{event:e,origin:n._$origin[0]})}),n.__callbacks.close=[]};if("closed"!=n.__state){var a=!0,c=(new Date).getTime()+n.__options.animationDuration[1];if("disappearing"==n.__state&&c>n.__closingTime&&(a=!1),a){n.__closingTime=c,"disappearing"!=n.__state&&n.__stateSet("disappearing");var l=function(){clearInterval(n.__tracker),n._trigger({type:"closing",event:e}),n._$tooltip.off("."+n.__namespace+"-triggerClose").removeClass("tooltipster-dying"),t(s.window).off("."+n.__namespace+"-triggerClose"),n.__$originParents.each(function(e,i){t(i).off("scroll."+n.__namespace+"-triggerClose")}),n.__$originParents=null,t("body").off("."+n.__namespace+"-triggerClose"),n._$origin.off("."+n.__namespace+"-triggerClose"),n._off("dismissable"),n.__stateSet("closed"),n._trigger({type:"after",event:e}),n.__options.functionAfter&&n.__options.functionAfter.call(n,n,{event:e,origin:n._$origin[0]}),o()};s.hasTransitions?(n._$tooltip.css({"-moz-animation-duration":n.__options.animationDuration[1]+"ms","-ms-animation-duration":n.__options.animationDuration[1]+"ms","-o-animation-duration":n.__options.animationDuration[1]+"ms","-webkit-animation-duration":n.__options.animationDuration[1]+"ms","animation-duration":n.__options.animationDuration[1]+"ms","transition-duration":n.__options.animationDuration[1]+"ms"}),n._$tooltip.clearQueue().removeClass("tooltipster-show").addClass("tooltipster-dying"),n.__options.animationDuration[1]>0&&n._$tooltip.delay(n.__options.animationDuration[1]),n._$tooltip.queue(l)):n._$tooltip.stop().fadeOut(n.__options.animationDuration[1],l)}}else o()}return n},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_open:function(e,i){var r=this;if(!r.__destroying&&n(r._$origin)&&r.__enabled){var o=!0;if("closed"==r.__state&&(r._trigger({type:"before",event:e,stop:function(){o=!1}}),o&&r.__options.functionBefore&&(o=r.__options.functionBefore.call(r,r,{event:e,origin:r._$origin[0]}))),!1!==o&&null!==r.__Content){i&&r.__callbacks.open.push(i),r.__callbacks.close=[],r.__timeoutsClear();var a,c=function(){"stable"!=r.__state&&r.__stateSet("stable"),t.each(r.__callbacks.open,function(t,e){e.call(r,r,{origin:r._$origin[0],tooltip:r._$tooltip[0]})}),r.__callbacks.open=[]};if("closed"!==r.__state)a=0,"disappearing"===r.__state?(r.__stateSet("appearing"),s.hasTransitions?(r._$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-show"),r.__options.animationDuration[0]>0&&r._$tooltip.delay(r.__options.animationDuration[0]),r._$tooltip.queue(c)):r._$tooltip.stop().fadeIn(c)):"stable"==r.__state&&c();else{if(r.__stateSet("appearing"),a=r.__options.animationDuration[0],r.__contentInsert(),r.reposition(e,!0),s.hasTransitions?(r._$tooltip.addClass("tooltipster-"+r.__options.animation).addClass("tooltipster-initial").css({"-moz-animation-duration":r.__options.animationDuration[0]+"ms","-ms-animation-duration":r.__options.animationDuration[0]+"ms","-o-animation-duration":r.__options.animationDuration[0]+"ms","-webkit-animation-duration":r.__options.animationDuration[0]+"ms","animation-duration":r.__options.animationDuration[0]+"ms","transition-duration":r.__options.animationDuration[0]+"ms"}),setTimeout(function(){"closed"!=r.__state&&(r._$tooltip.addClass("tooltipster-show").removeClass("tooltipster-initial"),r.__options.animationDuration[0]>0&&r._$tooltip.delay(r.__options.animationDuration[0]),r._$tooltip.queue(c))},0)):r._$tooltip.css("display","none").fadeIn(r.__options.animationDuration[0],c),r.__trackerStart(),t(s.window).on("resize."+r.__namespace+"-triggerClose",function(e){var i=t(document.activeElement);(i.is("input")||i.is("textarea"))&&t.contains(r._$tooltip[0],i[0])||r.reposition(e)}).on("scroll."+r.__namespace+"-triggerClose",function(t){r.__scrollHandler(t)}),r.__$originParents=r._$origin.parents(),r.__$originParents.each(function(e,i){t(i).on("scroll."+r.__namespace+"-triggerClose",function(t){r.__scrollHandler(t)})}),r.__options.triggerClose.mouseleave||r.__options.triggerClose.touchleave&&s.hasTouchCapability){r._on("dismissable",function(t){t.dismissable?t.delay?(f=setTimeout(function(){r._close(t.event)},t.delay),r.__timeouts.close.push(f)):r._close(t):clearTimeout(f)});var l=r._$origin,u="",h="",f=null;r.__options.interactive&&(l=l.add(r._$tooltip)),r.__options.triggerClose.mouseleave&&(u+="mouseenter."+r.__namespace+"-triggerClose ",h+="mouseleave."+r.__namespace+"-triggerClose "),r.__options.triggerClose.touchleave&&s.hasTouchCapability&&(u+="touchstart."+r.__namespace+"-triggerClose",h+="touchend."+r.__namespace+"-triggerClose touchcancel."+r.__namespace+"-triggerClose"),l.on(h,function(t){if(r._touchIsTouchEvent(t)||!r._touchIsEmulatedEvent(t)){var e="mouseleave"==t.type?r.__options.delay:r.__options.delayTouch;r._trigger({delay:e[1],dismissable:!0,event:t,type:"dismissable"})}}).on(u,function(t){!r._touchIsTouchEvent(t)&&r._touchIsEmulatedEvent(t)||r._trigger({dismissable:!1,event:t,type:"dismissable"})})}r.__options.triggerClose.originClick&&r._$origin.on("click."+r.__namespace+"-triggerClose",function(t){r._touchIsTouchEvent(t)||r._touchIsEmulatedEvent(t)||r._close(t)}),(r.__options.triggerClose.click||r.__options.triggerClose.tap&&s.hasTouchCapability)&&setTimeout(function(){if("closed"!=r.__state){var e="";r.__options.triggerClose.click&&(e+="click."+r.__namespace+"-triggerClose "),r.__options.triggerClose.tap&&s.hasTouchCapability&&(e+="touchend."+r.__namespace+"-triggerClose"),t("body").on(e,function(e){r._touchIsMeaningfulEvent(e)&&(r._touchRecordEvent(e),r.__options.interactive&&t.contains(r._$tooltip[0],e.target)||r._close(e))}),r.__options.triggerClose.tap&&s.hasTouchCapability&&t("body").on("touchstart."+r.__namespace+"-triggerClose",function(t){r._touchRecordEvent(t)})}},0),r._trigger("ready"),r.__options.functionReady&&r.__options.functionReady.call(r,r,{origin:r._$origin[0],tooltip:r._$tooltip[0]})}if(r.__options.timer>0){f=setTimeout(function(){r._close()},r.__options.timer+a);r.__timeouts.close.push(f)}}}return r},_openShortly:function(t){var e=this,i=!0;if("stable"!=e.__state&&"appearing"!=e.__state&&!e.__timeouts.open&&(e._trigger({type:"start",event:t,stop:function(){i=!1}}),i)){var n=0==t.type.indexOf("touch")?e.__options.delayTouch:e.__options.delay;n[0]?e.__timeouts.open=setTimeout(function(){e.__timeouts.open=null,e.__pointerIsOverOrigin&&e._touchIsMeaningfulEvent(t)?(e._trigger("startend"),e._open(t)):e._trigger("startcancel")},n[0]):(e._trigger("startend"),e._open(t))}return e},_optionsExtract:function(e,i){var n=this,r=t.extend(!0,{},i),o=n.__options[e];return o||(o={},t.each(i,function(t,e){var i=n.__options[t];void 0!==i&&(o[t]=i)})),t.each(r,function(e,i){void 0!==o[e]&&("object"!=typeof i||i instanceof Array||null==i||"object"!=typeof o[e]||o[e]instanceof Array||null==o[e]?r[e]=o[e]:t.extend(r[e],o[e]))}),r},_plug:function(e){var i=t.tooltipster._plugin(e);if(!i)throw new Error('The "'+e+'" plugin is not defined');return i.instance&&t.tooltipster.__bridge(i.instance,this,i.name),this},_touchIsEmulatedEvent:function(t){for(var e=!1,i=(new Date).getTime(),n=this.__touchEvents.length-1;n>=0;n--){var r=this.__touchEvents[n];if(!(i-r.time<500))break;r.target===t.target&&(e=!0)}return e},_touchIsMeaningfulEvent:function(t){return this._touchIsTouchEvent(t)&&!this._touchSwiped(t.target)||!this._touchIsTouchEvent(t)&&!this._touchIsEmulatedEvent(t)},_touchIsTouchEvent:function(t){return 0==t.type.indexOf("touch")},_touchRecordEvent:function(t){return this._touchIsTouchEvent(t)&&(t.time=(new Date).getTime(),this.__touchEvents.push(t)),this},_touchSwiped:function(t){for(var e=!1,i=this.__touchEvents.length-1;i>=0;i--){var n=this.__touchEvents[i];if("touchmove"==n.type){e=!0;break}if("touchstart"==n.type&&t===n.target)break}return e},_trigger:function(){var e=Array.prototype.slice.apply(arguments);return"string"==typeof e[0]&&(e[0]={type:e[0]}),e[0].instance=this,e[0].origin=this._$origin?this._$origin[0]:null,e[0].tooltip=this._$tooltip?this._$tooltip[0]:null,this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,e),t.tooltipster._trigger.apply(t.tooltipster,e),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,e),this},_unplug:function(e){var i=this;if(i[e]){var n=t.tooltipster._plugin(e);n.instance&&t.each(n.instance,function(t,n){i[t]&&i[t].bridged===i[e]&&delete i[t]}),i[e].__destroy&&i[e].__destroy(),delete i[e]}return i},close:function(t){return this.__destroyed?this.__destroyError():this._close(null,t),this},content:function(t){var e=this;if(void 0===t)return e.__Content;if(e.__destroyed)e.__destroyError();else if(e.__contentSet(t),null!==e.__Content){if("closed"!==e.__state&&(e.__contentInsert(),e.reposition(),e.__options.updateAnimation))if(s.hasTransitions){var i=e.__options.updateAnimation;e._$tooltip.addClass("tooltipster-update-"+i),setTimeout(function(){"closed"!=e.__state&&e._$tooltip.removeClass("tooltipster-update-"+i)},1e3)}else e._$tooltip.fadeTo(200,.5,function(){"closed"!=e.__state&&e._$tooltip.fadeTo(200,1)})}else e._close();return e},destroy:function(){var e=this;return e.__destroyed?e.__destroyError():e.__destroying||(e.__destroying=!0,e._close(null,function(){e._trigger("destroy"),e.__destroying=!1,e.__destroyed=!0,e._$origin.removeData(e.__namespace).off("."+e.__namespace+"-triggerOpen"),t("body").off("."+e.__namespace+"-triggerOpen");var i=e._$origin.data("tooltipster-ns");if(i)if(1===i.length){var n=null;"previous"==e.__options.restoration?n=e._$origin.data("tooltipster-initialTitle"):"current"==e.__options.restoration&&(n="string"==typeof e.__Content?e.__Content:t("<div></div>").append(e.__Content).html()),n&&e._$origin.attr("title",n),e._$origin.removeClass("tooltipstered"),e._$origin.removeData("tooltipster-ns").removeData("tooltipster-initialTitle")}else i=t.grep(i,function(t,i){return t!==e.__namespace}),e._$origin.data("tooltipster-ns",i);e._trigger("destroyed"),e._off(),e.off(),e.__Content=null,e.__$emitterPrivate=null,e.__$emitterPublic=null,e.__options.parent=null,e._$origin=null,e._$tooltip=null,t.tooltipster.__instancesLatestArr=t.grep(t.tooltipster.__instancesLatestArr,function(t,i){return e!==t}),clearInterval(e.__garbageCollector)})),e},disable:function(){return this.__destroyed?(this.__destroyError(),this):(this._close(),this.__enabled=!1,this)},elementOrigin:function(){return this.__destroyed?void this.__destroyError():this._$origin[0]},elementTooltip:function(){return this._$tooltip?this._$tooltip[0]:null},enable:function(){return this.__enabled=!0,this},hide:function(t){return this.close(t)},instance:function(){return this},off:function(){return this.__destroyed||this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},open:function(t){return this.__destroyed||this.__destroying?this.__destroyError():this._open(null,t),this},option:function(e,i){return void 0===i?this.__options[e]:(this.__destroyed?this.__destroyError():(this.__options[e]=i,this.__optionsFormat(),t.inArray(e,["trigger","triggerClose","triggerOpen"])>=0&&this.__prepareOrigin(),"selfDestruction"===e&&this.__prepareGC()),this)},reposition:function(t,e){var i=this;return i.__destroyed?i.__destroyError():"closed"!=i.__state&&n(i._$origin)&&(e||n(i._$tooltip))&&(e||i._$tooltip.detach(),i.__Geometry=i.__geometry(),i._trigger({type:"reposition",event:t,helper:{geo:i.__Geometry}})),i},show:function(t){return this.open(t)},status:function(){return{destroyed:this.__destroyed,destroying:this.__destroying,enabled:this.__enabled,open:"closed"!==this.__state,state:this.__state}},triggerHandler:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},t.fn.tooltipster=function(){var e=Array.prototype.slice.apply(arguments),i="You are using a single HTML element as content for several tooltips. You probably want to set the contentCloning option to TRUE.";if(0===this.length)return this;if("string"==typeof e[0]){var n="#*$~&";return this.each(function(){var r=t(this).data("tooltipster-ns"),o=r?t(this).data(r[0]):null;if(!o)throw new Error("You called Tooltipster's \""+e[0]+'" method on an uninitialized element');if("function"!=typeof o[e[0]])throw new Error('Unknown method "'+e[0]+'"');this.length>1&&"content"==e[0]&&(e[1]instanceof t||"object"==typeof e[1]&&null!=e[1]&&e[1].tagName)&&!o.__options.contentCloning&&o.__options.debug&&console.log(i);var s=o[e[0]](e[1],e[2]);return s!==o||"instance"===e[0]?(n=s,!1):void 0}),"#*$~&"!==n?n:this}t.tooltipster.__instancesLatestArr=[];var o=e[0]&&void 0!==e[0].multiple,s=o&&e[0].multiple||!o&&r.multiple,a=e[0]&&void 0!==e[0].content,c=a&&e[0].content||!a&&r.content,l=e[0]&&void 0!==e[0].contentCloning,u=l&&e[0].contentCloning||!l&&r.contentCloning,h=e[0]&&void 0!==e[0].debug,f=h&&e[0].debug||!h&&r.debug;return this.length>1&&(c instanceof t||"object"==typeof c&&null!=c&&c.tagName)&&!u&&f&&console.log(i),this.each(function(){var i=!1,n=t(this),r=n.data("tooltipster-ns"),o=null;r?s?i=!0:f&&(console.log("Tooltipster: one or more tooltips are already attached to the element below. Ignoring."),console.log(this)):i=!0,i&&(o=new t.Tooltipster(this,e[0]),r||(r=[]),r.push(o.__namespace),n.data("tooltipster-ns",r),n.data(o.__namespace,o),o.__options.functionInit&&o.__options.functionInit.call(o,o,{origin:this}),o._trigger("init")),t.tooltipster.__instancesLatestArr.push(o)}),this},e.prototype={__init:function(e){this.__$tooltip=e,this.__$tooltip.css({left:0,overflow:"hidden",position:"absolute",top:0}).find(".tooltipster-content").css("overflow","auto"),this.$container=t('<div class="tooltipster-ruler"></div>').append(this.__$tooltip).appendTo("body")},__forceRedraw:function(){var t=this.__$tooltip.parent();this.__$tooltip.detach(),this.__$tooltip.appendTo(t)},constrain:function(t,e){return this.constraints={width:t,height:e},this.__$tooltip.css({display:"block",height:"",overflow:"auto",width:t}),this},destroy:function(){this.__$tooltip.detach().find(".tooltipster-content").css({display:"",overflow:""}),this.$container.remove()},free:function(){return this.constraints=null,this.__$tooltip.css({display:"",height:"",overflow:"visible",width:""}),this},measure:function(){this.__forceRedraw();var t=this.__$tooltip[0].getBoundingClientRect(),e={size:{height:t.height||t.bottom,width:t.width||t.right}};if(this.constraints){var i=this.__$tooltip.find(".tooltipster-content"),n=this.__$tooltip.outerHeight(),r=i[0].getBoundingClientRect(),o={height:n<=this.constraints.height,width:t.width<=this.constraints.width&&r.width>=i[0].scrollWidth-1};e.fits=o.height&&o.width}return s.IE&&s.IE<=11&&e.size.width!==s.window.document.documentElement.clientWidth&&(e.size.width=Math.ceil(e.size.width)+1),e}};var c=navigator.userAgent.toLowerCase();-1!=c.indexOf("msie")?s.IE=parseInt(c.split("msie")[1]):-1!==c.toLowerCase().indexOf("trident")&&-1!==c.indexOf(" rv:11")?s.IE=11:-1!=c.toLowerCase().indexOf("edge/")&&(s.IE=parseInt(c.toLowerCase().split("edge/")[1]));var l="tooltipster.sideTip";return t.tooltipster._plugin({name:l,instance:{__defaults:function(){return{arrow:!0,distance:6,functionPosition:null,maxWidth:null,minIntersection:16,minWidth:0,position:null,side:"top",viewportAware:!0}},__init:function(t){var e=this;e.__instance=t,e.__namespace="tooltipster-sideTip-"+Math.round(1e6*Math.random()),e.__previousState="closed",e.__options,e.__optionsFormat(),e.__instance._on("state."+e.__namespace,function(t){"closed"==t.state?e.__close():"appearing"==t.state&&"closed"==e.__previousState&&e.__create(),e.__previousState=t.state}),e.__instance._on("options."+e.__namespace,function(){e.__optionsFormat()}),e.__instance._on("reposition."+e.__namespace,function(t){e.__reposition(t.event,t.helper)})},__close:function(){this.__instance.content()instanceof t&&this.__instance.content().detach(),this.__instance._$tooltip.remove(),this.__instance._$tooltip=null},__create:function(){var e=t('<div class="tooltipster-base tooltipster-sidetip"><div class="tooltipster-box"><div class="tooltipster-content"></div></div><div class="tooltipster-arrow"><div class="tooltipster-arrow-uncropped"><div class="tooltipster-arrow-border"></div><div class="tooltipster-arrow-background"></div></div></div></div>');this.__options.arrow||e.find(".tooltipster-box").css("margin",0).end().find(".tooltipster-arrow").hide(),this.__options.minWidth&&e.css("min-width",this.__options.minWidth+"px"),this.__options.maxWidth&&e.css("max-width",this.__options.maxWidth+"px"),this.__instance._$tooltip=e,this.__instance._trigger("created")},__destroy:function(){this.__instance._off("."+self.__namespace)},__optionsFormat:function(){var e=this;if(e.__options=e.__instance._optionsExtract(l,e.__defaults()),e.__options.position&&(e.__options.side=e.__options.position),"object"!=typeof e.__options.distance&&(e.__options.distance=[e.__options.distance]),e.__options.distance.length<4&&(void 0===e.__options.distance[1]&&(e.__options.distance[1]=e.__options.distance[0]),void 0===e.__options.distance[2]&&(e.__options.distance[2]=e.__options.distance[0]),void 0===e.__options.distance[3]&&(e.__options.distance[3]=e.__options.distance[1]),e.__options.distance={top:e.__options.distance[0],right:e.__options.distance[1],bottom:e.__options.distance[2],left:e.__options.distance[3]}),"string"==typeof e.__options.side){e.__options.side=[e.__options.side,{top:"bottom",right:"left",bottom:"top",left:"right"}[e.__options.side]],"left"==e.__options.side[0]||"right"==e.__options.side[0]?e.__options.side.push("top","bottom"):e.__options.side.push("right","left")}6===t.tooltipster._env.IE&&!0!==e.__options.arrow&&(e.__options.arrow=!1)},__reposition:function(e,i){var n,r=this,o=r.__targetFind(i),s=[];r.__instance._$tooltip.detach();var a=r.__instance._$tooltip.clone(),c=t.tooltipster._getRuler(a),l=!1,u=r.__instance.option("animation");switch(u&&a.removeClass("tooltipster-"+u),t.each(["window","document"],function(n,u){var h=null;if(r.__instance._trigger({container:u,helper:i,satisfied:l,takeTest:function(t){h=t},results:s,type:"positionTest"}),1==h||0!=h&&0==l&&("window"!=u||r.__options.viewportAware))for(n=0;n<r.__options.side.length;n++){var f={horizontal:0,vertical:0},p=r.__options.side[n];"top"==p||"bottom"==p?f.vertical=r.__options.distance[p]:f.horizontal=r.__options.distance[p],r.__sideChange(a,p),t.each(["natural","constrained"],function(t,n){if(h=null,r.__instance._trigger({container:u,event:e,helper:i,mode:n,results:s,satisfied:l,side:p,takeTest:function(t){h=t},type:"positionTest"}),1==h||0!=h&&0==l){var a={container:u,distance:f,fits:null,mode:n,outerSize:null,side:p,size:null,target:o[p],whole:null},d=("natural"==n?c.free():c.constrain(i.geo.available[u][p].width-f.horizontal,i.geo.available[u][p].height-f.vertical)).measure();if(a.size=d.size,a.outerSize={height:d.size.height+f.vertical,width:d.size.width+f.horizontal},"natural"==n?i.geo.available[u][p].width>=a.outerSize.width&&i.geo.available[u][p].height>=a.outerSize.height?a.fits=!0:a.fits=!1:a.fits=d.fits,"window"==u&&(a.fits?a.whole="top"==p||"bottom"==p?i.geo.origin.windowOffset.right>=r.__options.minIntersection&&i.geo.window.size.width-i.geo.origin.windowOffset.left>=r.__options.minIntersection:i.geo.origin.windowOffset.bottom>=r.__options.minIntersection&&i.geo.window.size.height-i.geo.origin.windowOffset.top>=r.__options.minIntersection:a.whole=!1),s.push(a),a.whole)l=!0;else if("natural"==a.mode&&(a.fits||a.size.width<=i.geo.available[u][p].width))return!1}})}}),r.__instance._trigger({edit:function(t){s=t},event:e,helper:i,results:s,type:"positionTested"}),s.sort(function(t,e){if(t.whole&&!e.whole)return-1;if(!t.whole&&e.whole)return 1;if(t.whole&&e.whole){var i=r.__options.side.indexOf(t.side);return(n=r.__options.side.indexOf(e.side))>i?-1:i>n?1:"natural"==t.mode?-1:1}if(t.fits&&!e.fits)return-1;if(!t.fits&&e.fits)return 1;if(t.fits&&e.fits){var n;i=r.__options.side.indexOf(t.side);return(n=r.__options.side.indexOf(e.side))>i?-1:i>n?1:"natural"==t.mode?-1:1}return"document"==t.container&&"bottom"==t.side&&"natural"==t.mode?-1:1}),(n=s[0]).coord={},n.side){case"left":case"right":n.coord.top=Math.floor(n.target-n.size.height/2);break;case"bottom":case"top":n.coord.left=Math.floor(n.target-n.size.width/2)}switch(n.side){case"left":n.coord.left=i.geo.origin.windowOffset.left-n.outerSize.width;break;case"right":n.coord.left=i.geo.origin.windowOffset.right+n.distance.horizontal;break;case"top":n.coord.top=i.geo.origin.windowOffset.top-n.outerSize.height;break;case"bottom":n.coord.top=i.geo.origin.windowOffset.bottom+n.distance.vertical}"window"==n.container?"top"==n.side||"bottom"==n.side?n.coord.left<0?i.geo.origin.windowOffset.right-this.__options.minIntersection>=0?n.coord.left=0:n.coord.left=i.geo.origin.windowOffset.right-this.__options.minIntersection-1:n.coord.left>i.geo.window.size.width-n.size.width&&(i.geo.origin.windowOffset.left+this.__options.minIntersection<=i.geo.window.size.width?n.coord.left=i.geo.window.size.width-n.size.width:n.coord.left=i.geo.origin.windowOffset.left+this.__options.minIntersection+1-n.size.width):n.coord.top<0?i.geo.origin.windowOffset.bottom-this.__options.minIntersection>=0?n.coord.top=0:n.coord.top=i.geo.origin.windowOffset.bottom-this.__options.minIntersection-1:n.coord.top>i.geo.window.size.height-n.size.height&&(i.geo.origin.windowOffset.top+this.__options.minIntersection<=i.geo.window.size.height?n.coord.top=i.geo.window.size.height-n.size.height:n.coord.top=i.geo.origin.windowOffset.top+this.__options.minIntersection+1-n.size.height):(n.coord.left>i.geo.window.size.width-n.size.width&&(n.coord.left=i.geo.window.size.width-n.size.width),n.coord.left<0&&(n.coord.left=0)),r.__sideChange(a,n.side),i.tooltipClone=a[0],i.tooltipParent=r.__instance.option("parent").parent[0],i.mode=n.mode,i.whole=n.whole,i.origin=r.__instance._$origin[0],i.tooltip=r.__instance._$tooltip[0],delete n.container,delete n.fits,delete n.mode,delete n.outerSize,delete n.whole,n.distance=n.distance.horizontal||n.distance.vertical;var h,f,p,d=t.extend(!0,{},n);if(r.__instance._trigger({edit:function(t){n=t},event:e,helper:i,position:d,type:"position"}),r.__options.functionPosition){var g=r.__options.functionPosition.call(r,r.__instance,i,d);g&&(n=g)}c.destroy(),"top"==n.side||"bottom"==n.side?(h={prop:"left",val:n.target-n.coord.left},f=n.size.width-this.__options.minIntersection):(h={prop:"top",val:n.target-n.coord.top},f=n.size.height-this.__options.minIntersection),h.val<this.__options.minIntersection?h.val=this.__options.minIntersection:h.val>f&&(h.val=f),p=i.geo.origin.fixedLineage?i.geo.origin.windowOffset:{left:i.geo.origin.windowOffset.left+i.geo.window.scroll.left,top:i.geo.origin.windowOffset.top+i.geo.window.scroll.top},n.coord={left:p.left+(n.coord.left-i.geo.origin.windowOffset.left),top:p.top+(n.coord.top-i.geo.origin.windowOffset.top)},r.__sideChange(r.__instance._$tooltip,n.side),i.geo.origin.fixedLineage?r.__instance._$tooltip.css("position","fixed"):r.__instance._$tooltip.css("position",""),r.__instance._$tooltip.css({left:n.coord.left,top:n.coord.top,height:n.size.height,width:n.size.width}).find(".tooltipster-arrow").css({left:"",top:""}).css(h.prop,h.val),r.__instance._$tooltip.appendTo(r.__instance.option("parent")),r.__instance._trigger({type:"repositioned",event:e,position:n})},__sideChange:function(t,e){t.removeClass("tooltipster-bottom").removeClass("tooltipster-left").removeClass("tooltipster-right").removeClass("tooltipster-top").addClass("tooltipster-"+e)},__targetFind:function(t){var e={},i=this.__instance._$origin[0].getClientRects();i.length>1&&(1==this.__instance._$origin.css("opacity")&&(this.__instance._$origin.css("opacity",.99),i=this.__instance._$origin[0].getClientRects(),this.__instance._$origin.css("opacity",1)));if(i.length<2)e.top=Math.floor(t.geo.origin.windowOffset.left+t.geo.origin.size.width/2),e.bottom=e.top,e.left=Math.floor(t.geo.origin.windowOffset.top+t.geo.origin.size.height/2),e.right=e.left;else{var n=i[0];e.top=Math.floor(n.left+(n.right-n.left)/2),n=i.length>2?i[Math.ceil(i.length/2)-1]:i[0],e.right=Math.floor(n.top+(n.bottom-n.top)/2),n=i[i.length-1],e.bottom=Math.floor(n.left+(n.right-n.left)/2),n=i.length>2?i[Math.ceil((i.length+1)/2)-1]:i[i.length-1],e.left=Math.floor(n.top+(n.bottom-n.top)/2)}return e}}}),t}),function(t){var e;function i(){var t=Error.apply(this,arguments);t.name=this.name="FlashError",this.stack=t.stack,this.message=t.message}function r(){var t=Error.apply(this,arguments);t.name=this.name="WebcamError",this.stack=t.stack,this.message=t.message}var o=function(){};o.prototype=Error.prototype,i.prototype=new o,r.prototype=new o;var s={version:"1.0.25",protocol:location.protocol.match(/https/i)?"https":"http",loaded:!1,live:!1,userMedia:!0,iOS:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!t.MSStream,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:"jpeg",jpeg_quality:90,enable_flash:!0,force_flash:!1,flip_horiz:!1,fps:30,upload_name:"webcam",constraints:null,swfURL:"",flashNotDetectedText:"ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).",noInterfaceFoundText:"No supported webcam interface found.",unfreeze_snap:!0,iosPlaceholderText:"Click here to open camera.",user_callback:null,user_canvas:null},errors:{FlashError:i,WebcamError:r},hooks:{},init:function(){var e=this;this.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(t){return new Promise(function(e,i){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,t,e,i)})}}:null,t.URL=t.URL||t.webkitURL||t.mozURL||t.msURL,this.userMedia=this.userMedia&&!!this.mediaDevices&&!!t.URL,this.iOS&&(this.userMedia=null),navigator.userAgent.match(/Firefox\D+(\d+)/)&&parseInt(RegExp.$1,10)<21&&(this.userMedia=null),this.userMedia&&t.addEventListener("beforeunload",function(t){e.reset()})},exifOrientation:function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return console.log("Not a valid JPEG file"),0;for(var i=2;i<t.byteLength;){if(255!=e.getUint8(i))return console.log("Not a valid marker at offset "+i+", found: "+e.getUint8(i)),0;if(225==e.getUint8(i+1)){i+=4;var r="";for(n=0;n<4;n++)r+=String.fromCharCode(e.getUint8(i+n));if("Exif"!=r)return console.log("Not valid EXIF data found"),0;i+=6;var o=null;if(18761==e.getUint16(i))o=!1;else{if(19789!=e.getUint16(i))return console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),0;o=!0}if(42!=e.getUint16(i+2,!o))return console.log("Not valid TIFF data! (no 0x002A)"),0;var s=e.getUint32(i+4,!o);if(s<8)return console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(i+4,!o)),0;for(var a=i+s,c=e.getUint16(a,!o),l=0;l<c;l++){var u=a+12*l+2;if(274==e.getUint16(u,!o)){var h=e.getUint16(u+2,!o),f=e.getUint32(u+4,!o);if(3!=h&&1!=f)return console.log("Invalid EXIF orientation value type ("+h+") or count ("+f+")"),0;var p=e.getUint16(u+8,!o);return p<1||p>8?(console.log("Invalid EXIF orientation value ("+p+")"),0):p}}}else i+=2+e.getUint16(i+2)}return 0},fixOrientation:function(t,e,i){var n=new Image;n.addEventListener("load",function(t){var r=document.createElement("canvas"),o=r.getContext("2d");switch(e<5?(r.width=n.width,r.height=n.height):(r.width=n.height,r.height=n.width),e){case 2:o.transform(-1,0,0,1,n.width,0);break;case 3:o.transform(-1,0,0,-1,n.width,n.height);break;case 4:o.transform(1,0,0,-1,0,n.height);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,n.height,0);break;case 7:o.transform(0,-1,-1,0,n.height,n.width);break;case 8:o.transform(0,-1,1,0,0,n.width)}o.drawImage(n,0,0),i.src=r.toDataURL()},!1),n.src=t},attach:function(i){if("string"==typeof i&&(i=document.getElementById(i)||document.querySelector(i)),!i)return this.dispatch("error",new r("Could not locate DOM element to attach to."));this.container=i,i.innerHTML="";var n=document.createElement("div");if(i.appendChild(n),this.peg=n,this.params.width||(this.params.width=i.offsetWidth),this.params.height||(this.params.height=i.offsetHeight),!this.params.width||!this.params.height)return this.dispatch("error",new r("No width and/or height for webcam.  Please call set() first, or attach to a visible element."));this.params.dest_width||(this.params.dest_width=this.params.width),this.params.dest_height||(this.params.dest_height=this.params.height),this.userMedia=void 0===e?this.userMedia:e,this.params.force_flash&&(e=this.userMedia,this.userMedia=null),"number"!=typeof this.params.fps&&(this.params.fps=30);var o=this.params.width/this.params.dest_width,a=this.params.height/this.params.dest_height;if(this.userMedia){var c=document.createElement("video");c.setAttribute("autoplay","autoplay"),c.style.width=this.params.dest_width+"px",c.style.height=this.params.dest_height+"px",1==o&&1==a||(i.style.overflow="hidden",c.style.webkitTransformOrigin="0px 0px",c.style.mozTransformOrigin="0px 0px",c.style.msTransformOrigin="0px 0px",c.style.oTransformOrigin="0px 0px",c.style.transformOrigin="0px 0px",c.style.webkitTransform="scaleX("+o+") scaleY("+a+")",c.style.mozTransform="scaleX("+o+") scaleY("+a+")",c.style.msTransform="scaleX("+o+") scaleY("+a+")",c.style.oTransform="scaleX("+o+") scaleY("+a+")",c.style.transform="scaleX("+o+") scaleY("+a+")"),i.appendChild(c),this.video=c;var l=this;this.mediaDevices.getUserMedia({audio:!1,video:this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then(function(e){c.onloadedmetadata=function(t){l.stream=e,l.loaded=!0,l.live=!0,l.dispatch("load"),l.dispatch("live"),l.flip()},"srcObject"in c?c.srcObject=e:c.src=t.URL.createObjectURL(e)}).catch(function(t){l.params.enable_flash&&l.detectFlash()?setTimeout(function(){l.params.force_flash=1,l.attach(i)},1):l.dispatch("error",t)})}else if(this.iOS){(d=document.createElement("div")).id=this.container.id+"-ios_div",d.className="webcamjs-ios-placeholder",d.style.width=this.params.width+"px",d.style.height=this.params.height+"px",d.style.textAlign="center",d.style.display="table-cell",d.style.verticalAlign="middle",d.style.backgroundRepeat="no-repeat",d.style.backgroundSize="contain",d.style.backgroundPosition="center";var u=document.createElement("span");u.className="webcamjs-ios-text",u.innerHTML=this.params.iosPlaceholderText,d.appendChild(u);var h=document.createElement("img");h.id=this.container.id+"-ios_img",h.style.width=this.params.dest_width+"px",h.style.height=this.params.dest_height+"px",h.style.display="none",d.appendChild(h);var f=document.createElement("input");f.id=this.container.id+"-ios_input",f.setAttribute("type","file"),f.setAttribute("accept","image/*"),f.setAttribute("capture","camera");l=this;var p=this.params;f.addEventListener("change",function(t){if(t.target.files.length>0&&0==t.target.files[0].type.indexOf("image/")){var e=URL.createObjectURL(t.target.files[0]),i=new Image;i.addEventListener("load",function(t){var e=document.createElement("canvas");e.width=p.dest_width,e.height=p.dest_height;var n=e.getContext("2d");ratio=Math.min(i.width/p.dest_width,i.height/p.dest_height);var r=p.dest_width*ratio,o=p.dest_height*ratio,s=(i.width-r)/2,a=(i.height-o)/2;n.drawImage(i,s,a,r,o,0,0,p.dest_width,p.dest_height);var c=e.toDataURL();h.src=c,d.style.backgroundImage="url('"+c+"')"},!1);var n=new FileReader;n.addEventListener("load",function(t){var n=l.exifOrientation(t.target.result);n>1?l.fixOrientation(e,n,i):i.src=e},!1);var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=function(t){200!=this.status&&0!==this.status||n.readAsArrayBuffer(this.response)},r.send()}},!1),f.style.display="none",i.appendChild(f),d.addEventListener("click",function(t){p.user_callback?l.snap(p.user_callback,p.user_canvas):(f.style.display="block",f.focus(),f.click(),f.style.display="none")},!1),i.appendChild(d),this.loaded=!0,this.live=!0}else if(this.params.enable_flash&&this.detectFlash()){var d;t.Webcam=s,(d=document.createElement("div")).innerHTML=this.getSWFHTML(),i.appendChild(d)}else this.dispatch("error",new r(this.params.noInterfaceFoundText));if(this.params.crop_width&&this.params.crop_height){var g=Math.floor(this.params.crop_width*o),m=Math.floor(this.params.crop_height*a);i.style.width=g+"px",i.style.height=m+"px",i.style.overflow="hidden",i.scrollLeft=Math.floor(this.params.width/2-g/2),i.scrollTop=Math.floor(this.params.height/2-m/2)}else i.style.width=this.params.width+"px",i.style.height=this.params.height+"px"},reset:function(){if(this.preview_active&&this.unfreeze(),this.unflip(),this.userMedia){if(this.stream)if(this.stream.getVideoTracks){var t=this.stream.getVideoTracks();t&&t[0]&&t[0].stop&&t[0].stop()}else this.stream.stop&&this.stream.stop();delete this.stream,delete this.video}if(!0!==this.userMedia&&this.loaded&&!this.iOS){var e=this.getMovie();e&&e._releaseCamera&&e._releaseCamera()}this.container&&(this.container.innerHTML="",delete this.container),this.loaded=!1,this.live=!1},set:function(){if(1==arguments.length)for(var t in arguments[0])this.params[t]=arguments[0][t];else this.params[arguments[0]]=arguments[1]},on:function(t,e){t=t.replace(/^on/i,"").toLowerCase(),this.hooks[t]||(this.hooks[t]=[]),this.hooks[t].push(e)},off:function(t,e){if(t=t.replace(/^on/i,"").toLowerCase(),this.hooks[t])if(e){var i=this.hooks[t].indexOf(e);i>-1&&this.hooks[t].splice(i,1)}else this.hooks[t]=[]},dispatch:function(){var e,n=arguments[0].replace(/^on/i,"").toLowerCase(),o=Array.prototype.slice.call(arguments,1);if(this.hooks[n]&&this.hooks[n].length){for(var s=0,a=this.hooks[n].length;s<a;s++){var c=this.hooks[n][s];"function"==typeof c?c.apply(this,o):"object"==typeof c&&2==c.length?c[0][c[1]].apply(c[0],o):t[c]&&t[c].apply(t,o)}return!0}return"error"==n&&(e=o[0]instanceof i||o[0]instanceof r?o[0].message:"Could not access webcam: "+o[0].name+": "+o[0].message+" "+o[0].toString(),alert("Webcam.js Error: "+e)),!1},setSWFLocation:function(t){this.set("swfURL",t)},detectFlash:function(){var e="Shockwave Flash",i="application/x-shockwave-flash",n=t,r=navigator,o=!1;if(void 0!==r.plugins&&"object"==typeof r.plugins[e])r.plugins[e].description&&void 0!==r.mimeTypes&&r.mimeTypes[i]&&r.mimeTypes[i].enabledPlugin&&(o=!0);else if(void 0!==n.ActiveXObject)try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(s)s.GetVariable("$version")&&(o=!0)}catch(t){}return o},getSWFHTML:function(){var e="",n=this.params.swfURL;if(location.protocol.match(/file/))return this.dispatch("error",new i("Flash does not work from local disk.  Please run from a web server.")),'<h3 style="color:red">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>';if(!this.detectFlash())return this.dispatch("error",new i("Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.")),'<h3 style="color:red">'+this.params.flashNotDetectedText+"</h3>";if(!n){for(var r="",o=document.getElementsByTagName("script"),s=0,a=o.length;s<a;s++){var c=o[s].getAttribute("src");c&&c.match(/\/webcam(\.min)?\.js/)&&(r=c.replace(/\/webcam(\.min)?\.js.*$/,""),s=a)}n=r?r+"/webcam.swf":"webcam.swf"}t.localStorage&&!localStorage.getItem("visited")&&(this.params.new_user=1,localStorage.setItem("visited",1));var l="";for(var u in this.params)l&&(l+="&"),l+=u+"="+escape(this.params[u]);return e+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+n+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+l+'"/><embed id="webcam_movie_embed" src="'+n+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+l+'"></embed></object>'},getMovie:function(){if(!this.loaded)return this.dispatch("error",new i("Flash Movie is not loaded yet"));var t=document.getElementById("webcam_movie_obj");return t&&t._snap||(t=document.getElementById("webcam_movie_embed")),t||this.dispatch("error",new i("Cannot locate Flash movie in DOM")),t},freeze:function(){var t=this,e=this.params;this.preview_active&&this.unfreeze();var i=this.params.width/this.params.dest_width,n=this.params.height/this.params.dest_height;this.unflip();var r=e.crop_width||e.dest_width,o=e.crop_height||e.dest_height,s=document.createElement("canvas");s.width=r,s.height=o;var a=s.getContext("2d");this.preview_canvas=s,this.preview_context=a,1==i&&1==n||(s.style.webkitTransformOrigin="0px 0px",s.style.mozTransformOrigin="0px 0px",s.style.msTransformOrigin="0px 0px",s.style.oTransformOrigin="0px 0px",s.style.transformOrigin="0px 0px",s.style.webkitTransform="scaleX("+i+") scaleY("+n+")",s.style.mozTransform="scaleX("+i+") scaleY("+n+")",s.style.msTransform="scaleX("+i+") scaleY("+n+")",s.style.oTransform="scaleX("+i+") scaleY("+n+")",s.style.transform="scaleX("+i+") scaleY("+n+")"),this.snap(function(){s.style.position="relative",s.style.left=t.container.scrollLeft+"px",s.style.top=t.container.scrollTop+"px",t.container.insertBefore(s,t.peg),t.container.style.overflow="hidden",t.preview_active=!0},s)},unfreeze:function(){this.preview_active&&(this.container.removeChild(this.preview_canvas),delete this.preview_context,delete this.preview_canvas,this.preview_active=!1,this.flip())},flip:function(){if(this.params.flip_horiz){var t=this.container.style;t.webkitTransform="scaleX(-1)",t.mozTransform="scaleX(-1)",t.msTransform="scaleX(-1)",t.oTransform="scaleX(-1)",t.transform="scaleX(-1)",t.filter="FlipH",t.msFilter="FlipH"}},unflip:function(){if(this.params.flip_horiz){var t=this.container.style;t.webkitTransform="scaleX(1)",t.mozTransform="scaleX(1)",t.msTransform="scaleX(1)",t.oTransform="scaleX(1)",t.transform="scaleX(1)",t.filter="",t.msFilter=""}},savePreview:function(t,e){var i=this.params,n=this.preview_canvas,r=this.preview_context;e&&e.getContext("2d").drawImage(n,0,0);t(e?null:n.toDataURL("image/"+i.image_format,i.jpeg_quality/100),n,r),this.params.unfreeze_snap&&this.unfreeze()},snap:function(t,e){t||(t=this.params.user_callback),e||(e=this.params.user_canvas);var i=this.params;if(!this.loaded)return this.dispatch("error",new r("Webcam is not loaded yet"));if(!t)return this.dispatch("error",new r("Please provide a callback function or canvas to snap()"));if(this.preview_active)return this.savePreview(t,e),null;var n=document.createElement("canvas");n.width=this.params.dest_width,n.height=this.params.dest_height;var o=n.getContext("2d");this.params.flip_horiz&&(o.translate(i.dest_width,0),o.scale(-1,1));var s=function(){if(this.src&&this.width&&this.height&&o.drawImage(this,0,0,i.dest_width,i.dest_height),i.crop_width&&i.crop_height){var r=document.createElement("canvas");r.width=i.crop_width,r.height=i.crop_height;var s=r.getContext("2d");s.drawImage(n,Math.floor(i.dest_width/2-i.crop_width/2),Math.floor(i.dest_height/2-i.crop_height/2),i.crop_width,i.crop_height,0,0,i.crop_width,i.crop_height),o=s,n=r}e&&e.getContext("2d").drawImage(n,0,0);t(e?null:n.toDataURL("image/"+i.image_format,i.jpeg_quality/100),n,o)};if(this.userMedia)o.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height),s();else if(this.iOS){var a=document.getElementById(this.container.id+"-ios_div"),c=document.getElementById(this.container.id+"-ios_img"),l=document.getElementById(this.container.id+"-ios_input");iFunc=function(t){s.call(c),c.removeEventListener("load",iFunc),a.style.backgroundImage="none",c.removeAttribute("src"),l.value=null},l.value?iFunc(null):(c.addEventListener("load",iFunc),l.style.display="block",l.focus(),l.click(),l.style.display="none")}else{var u=this.getMovie()._snap();(c=new Image).onload=s,c.src="data:image/"+this.params.image_format+";base64,"+u}return null},configure:function(t){t||(t="camera"),this.getMovie()._configure(t)},flashNotify:function(t,e){switch(t){case"flashLoadComplete":this.loaded=!0,this.dispatch("load");break;case"cameraLive":this.live=!0,this.dispatch("live");break;case"error":this.dispatch("error",new i(e))}},b64ToUint6:function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:43===t?62:47===t?63:0},base64DecToArr:function(t,e){for(var i,n,r=t.replace(/[^A-Za-z0-9\+\/]/g,""),o=r.length,s=e?Math.ceil((3*o+1>>2)/e)*e:3*o+1>>2,a=new Uint8Array(s),c=0,l=0,u=0;u<o;u++)if(n=3&u,c|=this.b64ToUint6(r.charCodeAt(u))<<18-6*n,3===n||o-u==1){for(i=0;i<3&&l<s;i++,l++)a[l]=c>>>(16>>>i&24)&255;c=0}return a},upload:function(t,e,i){var n=this.params.upload_name||"webcam",r="";if(!t.match(/^data\:image\/(\w+)/))throw"Cannot locate image format in Data URI";r=RegExp.$1;var o=t.replace(/^data\:image\/\w+\;base64\,/,""),a=new XMLHttpRequest;a.open("POST",e,!0),a.upload&&a.upload.addEventListener&&a.upload.addEventListener("progress",function(t){if(t.lengthComputable){var e=t.loaded/t.total;s.dispatch("uploadProgress",e,t)}},!1);var c=this;a.onload=function(){i&&i.apply(c,[a.status,a.responseText,a.statusText]),s.dispatch("uploadComplete",a.status,a.responseText,a.statusText)};var l=new Blob([this.base64DecToArr(o)],{type:"image/"+r}),u=new FormData;u.append(n,l,n+"."+r.replace(/e/,"")),a.send(u)}};s.init(),"function"==typeof define&&define.amd?define(function(){return s}):"object"==typeof module&&module.exports?module.exports=s:t.Webcam=s}(window),function(){"use strict";var t,e=[];function i(){for(;e.length;)e[0](),e.shift()}function n(t){this.a=r,this.b=void 0,this.f=[];var e=this;try{t(function(t){!function t(e,i){if(e.a==r){if(i==e)throw new TypeError;var n=!1;try{var o=i&&i.then;if(null!=i&&"object"==typeof i&&"function"==typeof o)return void o.call(i,function(i){n||t(e,i),n=!0},function(t){n||s(e,t),n=!0})}catch(t){return void(n||s(e,t))}e.a=0,e.b=i,a(e)}}(e,t)},function(t){s(e,t)})}catch(t){s(e,t)}}t=function(){setTimeout(i)};var r=2;function o(t){return new n(function(e){e(t)})}function s(t,e){if(t.a==r){if(e==t)throw new TypeError;t.a=1,t.b=e,a(t)}}function a(i){var n;n=function(){if(i.a!=r)for(;i.f.length;){var t=(o=i.f.shift())[0],e=o[1],n=o[2],o=o[3];try{0==i.a?n("function"==typeof t?t.call(void 0,i.b):i.b):1==i.a&&("function"==typeof e?n(e.call(void 0,i.b)):o(i.b))}catch(t){o(t)}}},e.push(n),1==e.length&&t()}n.prototype.g=function(t){return this.c(void 0,t)},n.prototype.c=function(t,e){var i=this;return new n(function(n,r){i.f.push([t,e,n,r]),a(i)})},window.Promise||(window.Promise=n,window.Promise.resolve=o,window.Promise.reject=function(t){return new n(function(e,i){i(t)})},window.Promise.race=function(t){return new n(function(e,i){for(var n=0;n<t.length;n+=1)o(t[n]).c(e,i)})},window.Promise.all=function(t){return new n(function(e,i){function n(i){return function(n){s[i]=n,(r+=1)==t.length&&e(s)}}var r=0,s=[];0==t.length&&e(s);for(var a=0;a<t.length;a+=1)o(t[a]).c(n(a),i)})},window.Promise.prototype.then=n.prototype.c,window.Promise.prototype.catch=n.prototype.g)}(),function(){function t(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function e(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function i(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+e+";"}function n(t){var e=t.a.offsetWidth,i=e+100;return t.f.style.width=i+"px",t.c.scrollLeft=i,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e&&(t.g=e,!0)}function r(e,i){function r(){var t=o;n(t)&&t.a.parentNode&&i(t.g)}var o=e;t(e.b,r),t(e.c,r),n(e)}function o(t,e){var i=e||{};this.family=t,this.style=i.style||"normal",this.weight=i.weight||"normal",this.stretch=i.stretch||"normal"}var s=null,a=null,c=null,l=null;function u(){return null===l&&(l=!!document.fonts),l}function h(t,e){return[t.style,t.weight,function(){if(null===c){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(t){}c=""!==t.style.font}return c}()?t.stretch:"","100px",e].join(" ")}o.prototype.load=function(t,n){var o=this,c=t||"BESbswy",l=0,f=n||3e3,p=(new Date).getTime();return new Promise(function(t,n){if(u()&&!function(){if(null===a)if(u()&&/Apple/.test(window.navigator.vendor)){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);a=!!t&&603>parseInt(t[1],10)}else a=!1;return a}()){var d=new Promise(function(t,e){!function i(){(new Date).getTime()-p>=f?e():document.fonts.load(h(o,'"'+o.family+'"'),c).then(function(e){1<=e.length?t():setTimeout(i,25)},function(){e()})}()}),g=new Promise(function(t,e){l=setTimeout(e,f)});Promise.race([g,d]).then(function(){clearTimeout(l),t(o)},function(){n(o)})}else m=function(){function a(){var e;(e=-1!=m&&-1!=v||-1!=m&&-1!=_||-1!=v&&-1!=_)&&((e=m!=v&&m!=_&&v!=_)||(null===s&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),s=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=s&&(m==b&&v==b&&_==b||m==y&&v==y&&_==y||m==w&&v==w&&_==w)),e=!e),e&&(x.parentNode&&x.parentNode.removeChild(x),clearTimeout(l),t(o))}var u=new e(c),d=new e(c),g=new e(c),m=-1,v=-1,_=-1,b=-1,y=-1,w=-1,x=document.createElement("div");x.dir="ltr",i(u,h(o,"sans-serif")),i(d,h(o,"serif")),i(g,h(o,"monospace")),x.appendChild(u.a),x.appendChild(d.a),x.appendChild(g.a),document.body.appendChild(x),b=u.a.offsetWidth,y=d.a.offsetWidth,w=g.a.offsetWidth,function t(){if((new Date).getTime()-p>=f)x.parentNode&&x.parentNode.removeChild(x),n(o);else{var e=document.hidden;!0!==e&&void 0!==e||(m=u.a.offsetWidth,v=d.a.offsetWidth,_=g.a.offsetWidth,a()),l=setTimeout(t,50)}}(),r(u,function(t){m=t,a()}),i(u,h(o,'"'+o.family+'",sans-serif')),r(d,function(t){v=t,a()}),i(d,h(o,'"'+o.family+'",serif')),r(g,function(t){_=t,a()}),i(g,h(o,'"'+o.family+'",monospace'))},document.body?m():document.addEventListener?document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t),m()}):document.attachEvent("onreadystatechange",function t(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",t),m())});var m})},"object"==typeof module?module.exports=o:(window.FontFaceObserver=o,window.FontFaceObserver.prototype.load=o.prototype.load)}(),function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return r(i||t)},u,u.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){"use strict";function n(t){t.fn.perfectScrollbar=function(t){return this.each(function(){if("object"==typeof t||void 0===t){var e=t;o.get(this)||r.initialize(this,e)}else{var i=t;"update"===i?r.update(this):"destroy"===i&&r.destroy(this)}})}}var r=t("../main"),o=t("../plugin/instances");if("function"==typeof define&&define.amd)define(["jquery"],n);else{var s=window.jQuery?window.jQuery:window.$;void 0!==s&&n(s)}e.exports=n},{"../main":6,"../plugin/instances":17}],2:[function(t,e,i){"use strict";var n={create:function(t,e){var i=document.createElement(t);return i.className=e,i},appendTo:function(t,e){return e.appendChild(t),t}};n.css=function(t,e,i){return"object"==typeof e?function(t,e){for(var i in e){var n=e[i];"number"==typeof n&&(n=n.toString()+"px"),t.style[i]=n}return t}(t,e):void 0===i?(s=t,a=e,window.getComputedStyle(s)[a]):(n=t,r=e,"number"==typeof(o=i)&&(o=o.toString()+"px"),n.style[r]=o,n);var n,r,o,s,a},n.matches=function(t,e){return void 0!==t.matches?t.matches(e):t.msMatchesSelector(e)},n.remove=function(t){void 0!==t.remove?t.remove():t.parentNode&&t.parentNode.removeChild(t)},n.queryChildren=function(t,e){return Array.prototype.filter.call(t.childNodes,function(t){return n.matches(t,e)})},e.exports=n},{}],3:[function(t,e,i){"use strict";var n=function(t){this.element=t,this.events={}};n.prototype.bind=function(t,e){void 0===this.events[t]&&(this.events[t]=[]),this.events[t].push(e),this.element.addEventListener(t,e,!1)},n.prototype.unbind=function(t,e){var i=void 0!==e;this.events[t]=this.events[t].filter(function(n){return!(!i||n===e)||(this.element.removeEventListener(t,n,!1),!1)},this)},n.prototype.unbindAll=function(){for(var t in this.events)this.unbind(t)};var r=function(){this.eventElements=[]};r.prototype.eventElement=function(t){var e=this.eventElements.filter(function(e){return e.element===t})[0];return void 0===e&&(e=new n(t),this.eventElements.push(e)),e},r.prototype.bind=function(t,e,i){this.eventElement(t).bind(e,i)},r.prototype.unbind=function(t,e,i){this.eventElement(t).unbind(e,i)},r.prototype.unbindAll=function(){for(var t=0;t<this.eventElements.length;t++)this.eventElements[t].unbindAll()},r.prototype.once=function(t,e,i){var n=this.eventElement(t),r=function(t){n.unbind(e,r),i(t)};n.bind(e,r)},e.exports=r},{}],4:[function(t,e,i){"use strict";e.exports=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}()},{}],5:[function(t,e,i){"use strict";function n(t){return["ps--in-scrolling"].concat(void 0===t?["ps--x","ps--y"]:["ps--"+t])}var r=t("./dom"),o=i.toInt=function(t){return parseInt(t,10)||0};i.isEditable=function(t){return r.matches(t,"input,[contenteditable]")||r.matches(t,"select,[contenteditable]")||r.matches(t,"textarea,[contenteditable]")||r.matches(t,"button,[contenteditable]")},i.removePsClasses=function(t){for(var e=0;e<t.classList.length;e++){var i=t.classList[e];0===i.indexOf("ps-")&&t.classList.remove(i)}},i.outerWidth=function(t){return o(r.css(t,"width"))+o(r.css(t,"paddingLeft"))+o(r.css(t,"paddingRight"))+o(r.css(t,"borderLeftWidth"))+o(r.css(t,"borderRightWidth"))},i.startScrolling=function(t,e){for(var i=n(e),r=0;r<i.length;r++)t.classList.add(i[r])},i.stopScrolling=function(t,e){for(var i=n(e),r=0;r<i.length;r++)t.classList.remove(i[r])},i.env={isWebKit:"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style,supportsTouch:"undefined"!=typeof window&&("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),supportsIePointer:"undefined"!=typeof window&&null!==window.navigator.msMaxTouchPoints}},{"./dom":2}],6:[function(t,e,i){"use strict";var n=t("./plugin/destroy"),r=t("./plugin/initialize"),o=t("./plugin/update");e.exports={initialize:r,update:o,destroy:n}},{"./plugin/destroy":8,"./plugin/initialize":16,"./plugin/update":20}],7:[function(t,e,i){"use strict";e.exports=function(){return{handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,swipeEasing:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default"}}},{}],8:[function(t,e,i){"use strict";var n=t("../lib/helper"),r=t("../lib/dom"),o=t("./instances");e.exports=function(t){var e=o.get(t);e&&(e.event.unbindAll(),r.remove(e.scrollbarX),r.remove(e.scrollbarY),r.remove(e.scrollbarXRail),r.remove(e.scrollbarYRail),n.removePsClasses(t),o.remove(t))}},{"../lib/dom":2,"../lib/helper":5,"./instances":17}],9:[function(t,e,i){"use strict";var n=t("../instances"),r=t("../update-geometry"),o=t("../update-scroll");e.exports=function(t){!function(t,e){function i(t){return t.getBoundingClientRect()}var n=function(t){t.stopPropagation()};e.event.bind(e.scrollbarY,"click",n),e.event.bind(e.scrollbarYRail,"click",function(n){var s=n.pageY-window.pageYOffset-i(e.scrollbarYRail).top>e.scrollbarYTop?1:-1;o(t,"top",t.scrollTop+s*e.containerHeight),r(t),n.stopPropagation()}),e.event.bind(e.scrollbarX,"click",n),e.event.bind(e.scrollbarXRail,"click",function(n){var s=n.pageX-window.pageXOffset-i(e.scrollbarXRail).left>e.scrollbarXLeft?1:-1;o(t,"left",t.scrollLeft+s*e.containerWidth),r(t),n.stopPropagation()})}(t,n.get(t))}},{"../instances":17,"../update-geometry":18,"../update-scroll":19}],10:[function(t,e,i){"use strict";function n(t,e){var i=null,n=null,r=function(r){(function(n){var r=i+n*e.railXRatio,s=Math.max(0,e.scrollbarXRail.getBoundingClientRect().left)+e.railXRatio*(e.railXWidth-e.scrollbarXWidth);e.scrollbarXLeft=r<0?0:r>s?s:r;var a=o.toInt(e.scrollbarXLeft*(e.contentWidth-e.containerWidth)/(e.containerWidth-e.railXRatio*e.scrollbarXWidth))-e.negativeScrollAdjustment;l(t,"left",a)})(r.pageX-n),c(t),r.stopPropagation(),r.preventDefault()},a=function(){o.stopScrolling(t,"x"),e.event.unbind(e.ownerDocument,"mousemove",r)};e.event.bind(e.scrollbarX,"mousedown",function(c){n=c.pageX,i=o.toInt(s.css(e.scrollbarX,"left"))*e.railXRatio,o.startScrolling(t,"x"),e.event.bind(e.ownerDocument,"mousemove",r),e.event.once(e.ownerDocument,"mouseup",a),c.stopPropagation(),c.preventDefault()})}function r(t,e){var i=null,n=null,r=function(r){(function(n){var r=i+n*e.railYRatio,s=Math.max(0,e.scrollbarYRail.getBoundingClientRect().top)+e.railYRatio*(e.railYHeight-e.scrollbarYHeight);e.scrollbarYTop=r<0?0:r>s?s:r;var a=o.toInt(e.scrollbarYTop*(e.contentHeight-e.containerHeight)/(e.containerHeight-e.railYRatio*e.scrollbarYHeight));l(t,"top",a)})(r.pageY-n),c(t),r.stopPropagation(),r.preventDefault()},a=function(){o.stopScrolling(t,"y"),e.event.unbind(e.ownerDocument,"mousemove",r)};e.event.bind(e.scrollbarY,"mousedown",function(c){n=c.pageY,i=o.toInt(s.css(e.scrollbarY,"top"))*e.railYRatio,o.startScrolling(t,"y"),e.event.bind(e.ownerDocument,"mousemove",r),e.event.once(e.ownerDocument,"mouseup",a),c.stopPropagation(),c.preventDefault()})}var o=t("../../lib/helper"),s=t("../../lib/dom"),a=t("../instances"),c=t("../update-geometry"),l=t("../update-scroll");e.exports=function(t){var e=a.get(t);n(t,e),r(t,e)}},{"../../lib/dom":2,"../../lib/helper":5,"../instances":17,"../update-geometry":18,"../update-scroll":19}],11:[function(t,e,i){"use strict";function n(t,e){var i=!1;e.event.bind(t,"mouseenter",function(){i=!0}),e.event.bind(t,"mouseleave",function(){i=!1});e.event.bind(e.ownerDocument,"keydown",function(n){if(!(n.isDefaultPrevented&&n.isDefaultPrevented()||n.defaultPrevented)){var s=o.matches(e.scrollbarX,":focus")||o.matches(e.scrollbarY,":focus");if(i||s){var l=document.activeElement?document.activeElement:e.ownerDocument.activeElement;if(l){if("IFRAME"===l.tagName)l=l.contentDocument.activeElement;else for(;l.shadowRoot;)l=l.shadowRoot.activeElement;if(r.isEditable(l))return}var u=0,h=0;switch(n.which){case 37:u=n.metaKey?-e.contentWidth:n.altKey?-e.containerWidth:-30;break;case 38:h=n.metaKey?e.contentHeight:n.altKey?e.containerHeight:30;break;case 39:u=n.metaKey?e.contentWidth:n.altKey?e.containerWidth:30;break;case 40:h=n.metaKey?-e.contentHeight:n.altKey?-e.containerHeight:-30;break;case 33:h=90;break;case 32:h=n.shiftKey?90:-90;break;case 34:h=-90;break;case 35:h=n.ctrlKey?-e.contentHeight:-e.containerHeight;break;case 36:h=n.ctrlKey?t.scrollTop:e.containerHeight;break;default:return}c(t,"top",t.scrollTop-h),c(t,"left",t.scrollLeft+u),a(t),function(i,n){var r=t.scrollTop;if(0===i){if(!e.scrollbarYActive)return!1;if(0===r&&n>0||r>=e.contentHeight-e.containerHeight&&n<0)return!e.settings.wheelPropagation}var o=t.scrollLeft;if(0===n){if(!e.scrollbarXActive)return!1;if(0===o&&i<0||o>=e.contentWidth-e.containerWidth&&i>0)return!e.settings.wheelPropagation}return!0}(u,h)&&n.preventDefault()}}})}var r=t("../../lib/helper"),o=t("../../lib/dom"),s=t("../instances"),a=t("../update-geometry"),c=t("../update-scroll");e.exports=function(t){n(t,s.get(t))}},{"../../lib/dom":2,"../../lib/helper":5,"../instances":17,"../update-geometry":18,"../update-scroll":19}],12:[function(t,e,i){"use strict";function n(t,e){function i(i){var r,a,c,l=(a=(r=i).deltaX,c=-1*r.deltaY,void 0!==a&&void 0!==c||(a=-1*r.wheelDeltaX/6,c=r.wheelDeltaY/6),r.deltaMode&&1===r.deltaMode&&(a*=10,c*=10),a!=a&&c!=c&&(a=0,c=r.wheelDelta),r.shiftKey?[-c,-a]:[a,c]),u=l[0],h=l[1];(function(e,i){var n=t.querySelector("textarea:hover, select[multiple]:hover, .ps-child:hover");if(n){var r=window.getComputedStyle(n);if(![r.overflow,r.overflowX,r.overflowY].join("").match(/(scroll|auto)/))return!1;var o=n.scrollHeight-n.clientHeight;if(o>0&&!(0===n.scrollTop&&i>0||n.scrollTop===o&&i<0))return!0;var s=n.scrollLeft-n.clientWidth;if(s>0&&!(0===n.scrollLeft&&e<0||n.scrollLeft===s&&e>0))return!0}return!1})(u,h)||(n=!1,e.settings.useBothWheelAxes?e.scrollbarYActive&&!e.scrollbarXActive?(s(t,"top",h?t.scrollTop-h*e.settings.wheelSpeed:t.scrollTop+u*e.settings.wheelSpeed),n=!0):e.scrollbarXActive&&!e.scrollbarYActive&&(s(t,"left",u?t.scrollLeft+u*e.settings.wheelSpeed:t.scrollLeft-h*e.settings.wheelSpeed),n=!0):(s(t,"top",t.scrollTop-h*e.settings.wheelSpeed),s(t,"left",t.scrollLeft+u*e.settings.wheelSpeed)),o(t),(n=n||function(i,n){var r=t.scrollTop;if(0===i){if(!e.scrollbarYActive)return!1;if(0===r&&n>0||r>=e.contentHeight-e.containerHeight&&n<0)return!e.settings.wheelPropagation}var o=t.scrollLeft;if(0===n){if(!e.scrollbarXActive)return!1;if(0===o&&i<0||o>=e.contentWidth-e.containerWidth&&i>0)return!e.settings.wheelPropagation}return!0}(u,h))&&(i.stopPropagation(),i.preventDefault()))}var n=!1;void 0!==window.onwheel?e.event.bind(t,"wheel",i):void 0!==window.onmousewheel&&e.event.bind(t,"mousewheel",i)}var r=t("../instances"),o=t("../update-geometry"),s=t("../update-scroll");e.exports=function(t){n(t,r.get(t))}},{"../instances":17,"../update-geometry":18,"../update-scroll":19}],13:[function(t,e,i){"use strict";var n=t("../instances"),r=t("../update-geometry");e.exports=function(t){var e,i=n.get(t);e=t,i.event.bind(e,"scroll",function(){r(e)})}},{"../instances":17,"../update-geometry":18}],14:[function(t,e,i){"use strict";function n(t,e){function i(){n&&(clearInterval(n),n=null),r.stopScrolling(t)}var n=null,c={top:0,left:0},l=!1;e.event.bind(e.ownerDocument,"selectionchange",function(){var e;t.contains(0===(e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"").toString().length?null:e.getRangeAt(0).commonAncestorContainer)?l=!0:(l=!1,i())}),e.event.bind(window,"mouseup",function(){l&&(l=!1,i())}),e.event.bind(window,"keyup",function(){l&&(l=!1,i())}),e.event.bind(window,"mousemove",function(e){if(l){var u=e.pageX,h=e.pageY,f=t.offsetLeft,p=t.offsetLeft+t.offsetWidth,d=t.offsetTop,g=t.offsetTop+t.offsetHeight;u<f+3?(c.left=-5,r.startScrolling(t,"x")):u>p-3?(c.left=5,r.startScrolling(t,"x")):c.left=0,h<d+3?(c.top=d+3-h<5?-5:-20,r.startScrolling(t,"y")):h>g-3?(c.top=h-g+3<5?5:20,r.startScrolling(t,"y")):c.top=0,0===c.top&&0===c.left?i():n||(n=setInterval(function(){return o.get(t)?(a(t,"top",t.scrollTop+c.top),a(t,"left",t.scrollLeft+c.left),void s(t)):void clearInterval(n)},50))}})}var r=t("../../lib/helper"),o=t("../instances"),s=t("../update-geometry"),a=t("../update-scroll");e.exports=function(t){n(t,o.get(t))}},{"../../lib/helper":5,"../instances":17,"../update-geometry":18,"../update-scroll":19}],15:[function(t,e,i){"use strict";function n(t,e,i,n){function r(e,i){a(t,"top",t.scrollTop-i),a(t,"left",t.scrollLeft-e),s(t)}function c(){b=!0}function l(){b=!1}function u(t){return t.targetTouches?t.targetTouches[0]:t}function h(t){return!(t.pointerType&&"pen"===t.pointerType&&0===t.buttons||(!t.targetTouches||1!==t.targetTouches.length)&&(!t.pointerType||"mouse"===t.pointerType||t.pointerType===t.MSPOINTER_TYPE_MOUSE))}function f(t){if(h(t)){y=!0;var e=u(t);g.pageX=e.pageX,g.pageY=e.pageY,m=(new Date).getTime(),null!==_&&clearInterval(_),t.stopPropagation()}}function p(i){if(!y&&e.settings.swipePropagation&&f(i),!b&&y&&h(i)){var n=u(i),o={pageX:n.pageX,pageY:n.pageY},s=o.pageX-g.pageX,a=o.pageY-g.pageY;r(s,a),g=o;var c=(new Date).getTime(),l=c-m;l>0&&(v.x=s/l,v.y=a/l,m=c),function(i,n){var r=t.scrollTop,o=t.scrollLeft,s=Math.abs(i),a=Math.abs(n);if(a>s){if(n<0&&r===e.contentHeight-e.containerHeight||n>0&&0===r)return!e.settings.swipePropagation}else if(s>a&&(i<0&&o===e.contentWidth-e.containerWidth||i>0&&0===o))return!e.settings.swipePropagation;return!0}(s,a)&&(i.stopPropagation(),i.preventDefault())}}function d(){!b&&y&&(y=!1,e.settings.swipeEasing&&(clearInterval(_),_=setInterval(function(){return o.get(t)&&(v.x||v.y)?Math.abs(v.x)<.01&&Math.abs(v.y)<.01?void clearInterval(_):(r(30*v.x,30*v.y),v.x*=.8,void(v.y*=.8)):void clearInterval(_)},10)))}var g={},m=0,v={},_=null,b=!1,y=!1;i?(e.event.bind(window,"touchstart",c),e.event.bind(window,"touchend",l),e.event.bind(t,"touchstart",f),e.event.bind(t,"touchmove",p),e.event.bind(t,"touchend",d)):n&&(window.PointerEvent?(e.event.bind(window,"pointerdown",c),e.event.bind(window,"pointerup",l),e.event.bind(t,"pointerdown",f),e.event.bind(t,"pointermove",p),e.event.bind(t,"pointerup",d)):window.MSPointerEvent&&(e.event.bind(window,"MSPointerDown",c),e.event.bind(window,"MSPointerUp",l),e.event.bind(t,"MSPointerDown",f),e.event.bind(t,"MSPointerMove",p),e.event.bind(t,"MSPointerUp",d)))}var r=t("../../lib/helper"),o=t("../instances"),s=t("../update-geometry"),a=t("../update-scroll");e.exports=function(t){(r.env.supportsTouch||r.env.supportsIePointer)&&n(t,o.get(t),r.env.supportsTouch,r.env.supportsIePointer)}},{"../../lib/helper":5,"../instances":17,"../update-geometry":18,"../update-scroll":19}],16:[function(t,e,i){"use strict";var n=t("./instances"),r=t("./update-geometry"),o={"click-rail":t("./handler/click-rail"),"drag-scrollbar":t("./handler/drag-scrollbar"),keyboard:t("./handler/keyboard"),wheel:t("./handler/mouse-wheel"),touch:t("./handler/touch"),selection:t("./handler/selection")},s=t("./handler/native-scroll");e.exports=function(t,e){t.classList.add("ps");var i=n.add(t,"object"==typeof e?e:{});t.classList.add("ps--theme_"+i.settings.theme),i.settings.handlers.forEach(function(e){o[e](t)}),s(t),r(t)}},{"./handler/click-rail":9,"./handler/drag-scrollbar":10,"./handler/keyboard":11,"./handler/mouse-wheel":12,"./handler/native-scroll":13,"./handler/selection":14,"./handler/touch":15,"./instances":17,"./update-geometry":18}],17:[function(t,e,i){"use strict";function n(t){return t.getAttribute("data-ps-id")}var r=t("../lib/helper"),o=t("./default-setting"),s=t("../lib/dom"),a=t("../lib/event-manager"),c=t("../lib/guid"),l={};i.add=function(t,e){var i,n=c();return i=n,t.setAttribute("data-ps-id",i),l[n]=new function(t,e){function i(){t.classList.add("ps--focus")}function n(){t.classList.remove("ps--focus")}var c,l,u=this;u.settings=o();for(var h in e)u.settings[h]=e[h];u.containerWidth=null,u.containerHeight=null,u.contentWidth=null,u.contentHeight=null,u.isRtl="rtl"===s.css(t,"direction"),u.isNegativeScroll=(l=t.scrollLeft,t.scrollLeft=-1,c=t.scrollLeft<0,t.scrollLeft=l,c),u.negativeScrollAdjustment=u.isNegativeScroll?t.scrollWidth-t.clientWidth:0,u.event=new a,u.ownerDocument=t.ownerDocument||document,u.scrollbarXRail=s.appendTo(s.create("div","ps__scrollbar-x-rail"),t),u.scrollbarX=s.appendTo(s.create("div","ps__scrollbar-x"),u.scrollbarXRail),u.scrollbarX.setAttribute("tabindex",0),u.event.bind(u.scrollbarX,"focus",i),u.event.bind(u.scrollbarX,"blur",n),u.scrollbarXActive=null,u.scrollbarXWidth=null,u.scrollbarXLeft=null,u.scrollbarXBottom=r.toInt(s.css(u.scrollbarXRail,"bottom")),u.isScrollbarXUsingBottom=u.scrollbarXBottom==u.scrollbarXBottom,u.scrollbarXTop=u.isScrollbarXUsingBottom?null:r.toInt(s.css(u.scrollbarXRail,"top")),u.railBorderXWidth=r.toInt(s.css(u.scrollbarXRail,"borderLeftWidth"))+r.toInt(s.css(u.scrollbarXRail,"borderRightWidth")),s.css(u.scrollbarXRail,"display","block"),u.railXMarginWidth=r.toInt(s.css(u.scrollbarXRail,"marginLeft"))+r.toInt(s.css(u.scrollbarXRail,"marginRight")),s.css(u.scrollbarXRail,"display",""),u.railXWidth=null,u.railXRatio=null,u.scrollbarYRail=s.appendTo(s.create("div","ps__scrollbar-y-rail"),t),u.scrollbarY=s.appendTo(s.create("div","ps__scrollbar-y"),u.scrollbarYRail),u.scrollbarY.setAttribute("tabindex",0),u.event.bind(u.scrollbarY,"focus",i),u.event.bind(u.scrollbarY,"blur",n),u.scrollbarYActive=null,u.scrollbarYHeight=null,u.scrollbarYTop=null,u.scrollbarYRight=r.toInt(s.css(u.scrollbarYRail,"right")),u.isScrollbarYUsingRight=u.scrollbarYRight==u.scrollbarYRight,u.scrollbarYLeft=u.isScrollbarYUsingRight?null:r.toInt(s.css(u.scrollbarYRail,"left")),u.scrollbarYOuterWidth=u.isRtl?r.outerWidth(u.scrollbarY):null,u.railBorderYWidth=r.toInt(s.css(u.scrollbarYRail,"borderTopWidth"))+r.toInt(s.css(u.scrollbarYRail,"borderBottomWidth")),s.css(u.scrollbarYRail,"display","block"),u.railYMarginHeight=r.toInt(s.css(u.scrollbarYRail,"marginTop"))+r.toInt(s.css(u.scrollbarYRail,"marginBottom")),s.css(u.scrollbarYRail,"display",""),u.railYHeight=null,u.railYRatio=null}(t,e),l[n]},i.remove=function(t){delete l[n(t)],t.removeAttribute("data-ps-id")},i.get=function(t){return l[n(t)]}},{"../lib/dom":2,"../lib/event-manager":3,"../lib/guid":4,"../lib/helper":5,"./default-setting":7}],18:[function(t,e,i){"use strict";function n(t,e){return t.settings.minScrollbarLength&&(e=Math.max(e,t.settings.minScrollbarLength)),t.settings.maxScrollbarLength&&(e=Math.min(e,t.settings.maxScrollbarLength)),e}var r=t("../lib/helper"),o=t("../lib/dom"),s=t("./instances"),a=t("./update-scroll");e.exports=function(t){var e,i=s.get(t);i.containerWidth=t.clientWidth,i.containerHeight=t.clientHeight,i.contentWidth=t.scrollWidth,i.contentHeight=t.scrollHeight,t.contains(i.scrollbarXRail)||((e=o.queryChildren(t,".ps__scrollbar-x-rail")).length>0&&e.forEach(function(t){o.remove(t)}),o.appendTo(i.scrollbarXRail,t)),t.contains(i.scrollbarYRail)||((e=o.queryChildren(t,".ps__scrollbar-y-rail")).length>0&&e.forEach(function(t){o.remove(t)}),o.appendTo(i.scrollbarYRail,t)),!i.settings.suppressScrollX&&i.containerWidth+i.settings.scrollXMarginOffset<i.contentWidth?(i.scrollbarXActive=!0,i.railXWidth=i.containerWidth-i.railXMarginWidth,i.railXRatio=i.containerWidth/i.railXWidth,i.scrollbarXWidth=n(i,r.toInt(i.railXWidth*i.containerWidth/i.contentWidth)),i.scrollbarXLeft=r.toInt((i.negativeScrollAdjustment+t.scrollLeft)*(i.railXWidth-i.scrollbarXWidth)/(i.contentWidth-i.containerWidth))):i.scrollbarXActive=!1,!i.settings.suppressScrollY&&i.containerHeight+i.settings.scrollYMarginOffset<i.contentHeight?(i.scrollbarYActive=!0,i.railYHeight=i.containerHeight-i.railYMarginHeight,i.railYRatio=i.containerHeight/i.railYHeight,i.scrollbarYHeight=n(i,r.toInt(i.railYHeight*i.containerHeight/i.contentHeight)),i.scrollbarYTop=r.toInt(t.scrollTop*(i.railYHeight-i.scrollbarYHeight)/(i.contentHeight-i.containerHeight))):i.scrollbarYActive=!1,i.scrollbarXLeft>=i.railXWidth-i.scrollbarXWidth&&(i.scrollbarXLeft=i.railXWidth-i.scrollbarXWidth),i.scrollbarYTop>=i.railYHeight-i.scrollbarYHeight&&(i.scrollbarYTop=i.railYHeight-i.scrollbarYHeight),function(t,e){var i={width:e.railXWidth};e.isRtl?i.left=e.negativeScrollAdjustment+t.scrollLeft+e.containerWidth-e.contentWidth:i.left=t.scrollLeft,e.isScrollbarXUsingBottom?i.bottom=e.scrollbarXBottom-t.scrollTop:i.top=e.scrollbarXTop+t.scrollTop,o.css(e.scrollbarXRail,i);var n={top:t.scrollTop,height:e.railYHeight};e.isScrollbarYUsingRight?e.isRtl?n.right=e.contentWidth-(e.negativeScrollAdjustment+t.scrollLeft)-e.scrollbarYRight-e.scrollbarYOuterWidth:n.right=e.scrollbarYRight-t.scrollLeft:e.isRtl?n.left=e.negativeScrollAdjustment+t.scrollLeft+2*e.containerWidth-e.contentWidth-e.scrollbarYLeft-e.scrollbarYOuterWidth:n.left=e.scrollbarYLeft+t.scrollLeft,o.css(e.scrollbarYRail,n),o.css(e.scrollbarX,{left:e.scrollbarXLeft,width:e.scrollbarXWidth-e.railBorderXWidth}),o.css(e.scrollbarY,{top:e.scrollbarYTop,height:e.scrollbarYHeight-e.railBorderYWidth})}(t,i),i.scrollbarXActive?t.classList.add("ps--active-x"):(t.classList.remove("ps--active-x"),i.scrollbarXWidth=0,i.scrollbarXLeft=0,a(t,"left",0)),i.scrollbarYActive?t.classList.add("ps--active-y"):(t.classList.remove("ps--active-y"),i.scrollbarYHeight=0,i.scrollbarYTop=0,a(t,"top",0))}},{"../lib/dom":2,"../lib/helper":5,"./instances":17,"./update-scroll":19}],19:[function(t,e,i){"use strict";var n=t("./instances"),r=function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!0),e};e.exports=function(t,e,i){if(void 0===t)throw"You must provide an element to the update-scroll function";if(void 0===e)throw"You must provide an axis to the update-scroll function";if(void 0===i)throw"You must provide a value to the update-scroll function";"top"===e&&i<=0&&(t.scrollTop=i=0,t.dispatchEvent(r("ps-y-reach-start"))),"left"===e&&i<=0&&(t.scrollLeft=i=0,t.dispatchEvent(r("ps-x-reach-start")));var o=n.get(t);"top"===e&&i>=o.contentHeight-o.containerHeight&&((i=o.contentHeight-o.containerHeight)-t.scrollTop<=2?i=t.scrollTop:t.scrollTop=i,t.dispatchEvent(r("ps-y-reach-end"))),"left"===e&&i>=o.contentWidth-o.containerWidth&&((i=o.contentWidth-o.containerWidth)-t.scrollLeft<=2?i=t.scrollLeft:t.scrollLeft=i,t.dispatchEvent(r("ps-x-reach-end"))),void 0===o.lastTop&&(o.lastTop=t.scrollTop),void 0===o.lastLeft&&(o.lastLeft=t.scrollLeft),"top"===e&&i<o.lastTop&&t.dispatchEvent(r("ps-scroll-up")),"top"===e&&i>o.lastTop&&t.dispatchEvent(r("ps-scroll-down")),"left"===e&&i<o.lastLeft&&t.dispatchEvent(r("ps-scroll-left")),"left"===e&&i>o.lastLeft&&t.dispatchEvent(r("ps-scroll-right")),"top"===e&&i!==o.lastTop&&(t.scrollTop=o.lastTop=i,t.dispatchEvent(r("ps-scroll-y"))),"left"===e&&i!==o.lastLeft&&(t.scrollLeft=o.lastLeft=i,t.dispatchEvent(r("ps-scroll-x")))}},{"./instances":17}],20:[function(t,e,i){"use strict";var n=t("../lib/helper"),r=t("../lib/dom"),o=t("./instances"),s=t("./update-geometry"),a=t("./update-scroll");e.exports=function(t){var e=o.get(t);e&&(e.negativeScrollAdjustment=e.isNegativeScroll?t.scrollWidth-t.clientWidth:0,r.css(e.scrollbarXRail,"display","block"),r.css(e.scrollbarYRail,"display","block"),e.railXMarginWidth=n.toInt(r.css(e.scrollbarXRail,"marginLeft"))+n.toInt(r.css(e.scrollbarXRail,"marginRight")),e.railYMarginHeight=n.toInt(r.css(e.scrollbarYRail,"marginTop"))+n.toInt(r.css(e.scrollbarYRail,"marginBottom")),r.css(e.scrollbarXRail,"display","none"),r.css(e.scrollbarYRail,"display","none"),s(t),a(t,"top",t.scrollTop),a(t,"left",t.scrollLeft),r.css(e.scrollbarXRail,"display",""),r.css(e.scrollbarYRail,"display",""))}},{"../lib/dom":2,"../lib/helper":5,"./instances":17,"./update-geometry":18,"./update-scroll":19}]},{},[1]),function(t,e){"use strict";t.module("angularSpectrumColorpicker",[]).directive("spectrumColorpicker",function(){return{restrict:"EA",require:"ngModel",scope:{fallbackValue:"=",disabled:"=?",format:"=?",options:"=?",triggerId:"@?",palette:"=?",onChange:"&?",onShow:"&?",onHide:"&?",onMove:"&?",onBeforeShow:"&?",onChangeOptions:"=?",onShowOptions:"=?",onHideOptions:"=?",onMoveOptions:"=?"},replace:!0,templateUrl:"directive.html",link:function(e,i,n,r){function o(t){var i=t;return i&&(i=t.toString(e.format)),i}function s(i){t.isFunction(e.onChange)&&e.onChange({color:i})}function a(i){var n=e.fallbackValue;i?n=o(i):t.isUndefined(e.fallbackValue)&&(n=i),r.$setViewValue(n),s(n)}var c=i.find("input"),l=function(){return c.spectrum("toggle"),!1},u={color:r.$viewValue},h={};t.forEach({change:"onChange",move:"onMove",hide:"onHide",show:"onShow"},function(i,n){var r=e[i+"Options"];h[n]=function(n){return(!r||r.update)&&(s=n,e.$evalAsync(function(){a(s)})),"change"!==i&&t.isFunction(e[i])?e[i]({color:o(n)}):null;var s}}),t.isFunction(e.onBeforeShow)&&(h.beforeShow=function(t){return e.onBeforeShow({color:o(t)})}),e.palette&&(h.palette=e.palette);var f=t.extend({},u,e.options,h);e.triggerId&&t.element(document.body).on("click","#"+e.triggerId,l),r.$render=function(){c.spectrum("set",r.$viewValue||""),s(r.$viewValue)},f.color&&(c.spectrum("set",f.color||""),a(f.color)),c.spectrum(f),e.$on("$destroy",function(){e.triggerId&&t.element(document.body).off("click","#"+e.triggerId,l)}),i.on("$destroy",function(){c.spectrum("destroy")}),t.isDefined(f.disabled)&&(e.disabled=!!f.disabled),e.$watch("disabled",function(t){c.spectrum(t?"disable":"enable")}),e.$watch("palette",function(t){c.spectrum("option","palette",t)},!0)}}}),t.module("angularSpectrumColorpicker").run(["$templateCache",function(t){t.put("directive.html",'<span><input class="input-small"></span>')}])}(window.angular),function(t){function e(t,e){if(!(t.originalEvent.touches.length>1)){t.preventDefault();var i=t.originalEvent.changedTouches[0],n=document.createEvent("MouseEvents");n.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n)}}if(t.support.touch="ontouchend"in document,t.support.touch){var i,n=t.ui.mouse.prototype,r=n._mouseInit,o=n._mouseDestroy;n._touchStart=function(t){!i&&this._mouseCapture(t.originalEvent.changedTouches[0])&&(i=!0,this._touchMoved=!1,e(t,"mouseover"),e(t,"mousemove"),e(t,"mousedown"))},n._touchMove=function(t){i&&(this._touchMoved=!0,e(t,"mousemove"))},n._touchEnd=function(t){i&&(e(t,"mouseup"),e(t,"mouseout"),this._touchMoved||e(t,"click"),i=!1)},n._mouseInit=function(){this.element.bind({touchstart:t.proxy(this,"_touchStart"),touchmove:t.proxy(this,"_touchMove"),touchend:t.proxy(this,"_touchEnd")}),r.call(this)},n._mouseDestroy=function(){this.element.unbind({touchstart:t.proxy(this,"_touchStart"),touchmove:t.proxy(this,"_touchMove"),touchend:t.proxy(this,"_touchEnd")}),o.call(this)}}}(jQuery),function(){function t(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function e(t,e,i,n){for(var r=-1,o=null==t?0:t.length;++r<o;){var s=t[r];e(n,s,i(s),t)}return n}function i(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function n(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function r(t,e){for(var i=-1,n=null==t?0:t.length,r=0,o=[];++i<n;){var s=t[i];e(s,i,t)&&(o[r++]=s)}return o}function o(t,e){return!(null==t||!t.length)&&-1<d(t,e,0)}function s(t,e,i){for(var n=-1,r=null==t?0:t.length;++n<r;)if(i(e,t[n]))return!0;return!1}function a(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}function c(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}function l(t,e,i,n){var r=-1,o=null==t?0:t.length;for(n&&o&&(i=t[++r]);++r<o;)i=e(i,t[r],r,t);return i}function u(t,e,i,n){var r=null==t?0:t.length;for(n&&r&&(i=t[--r]);r--;)i=e(i,t[r],r,t);return i}function h(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function f(t,e,i){var n;return i(t,function(t,i,r){if(e(t,i,r))return n=i,!1}),n}function p(t,e,i,n){var r=t.length;for(i+=n?1:-1;n?i--:++i<r;)if(e(t[i],i,t))return i;return-1}function d(t,e,i){if(e==e)t:{--i;for(var n=t.length;++i<n;)if(t[i]===e){t=i;break t}t=-1}else t=p(t,m,i);return t}function g(t,e,i,n){--i;for(var r=t.length;++i<r;)if(n(t[i],e))return i;return-1}function m(t){return t!=t}function v(t,e){var i=null==t?0:t.length;return i?w(t,e)/i:L}function _(t){return function(e){return null==e?D:e[t]}}function b(t){return function(e){return null==t?D:t[e]}}function y(t,e,i,n,r){return r(t,function(t,r,o){i=n?(n=!1,t):e(i,t,r,o)}),i}function w(t,e){for(var i,n=-1,r=t.length;++n<r;){var o=e(t[n]);o!==D&&(i=i===D?o:i+o)}return i}function x(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function C(t){return function(e){return t(e)}}function S(t,e){return a(e,function(e){return t[e]})}function T(t,e){return t.has(e)}function O(t,e){for(var i=-1,n=t.length;++i<n&&-1<d(e,t[i],0););return i}function k(t,e){for(var i=t.length;i--&&-1<d(e,t[i],0););return i}function $(t){return"\\"+At[t]}function A(t){var e=-1,i=Array(t.size);return t.forEach(function(t,n){i[++e]=[n,t]}),i}function E(t,e){return function(i){return t(e(i))}}function j(t,e){for(var i=-1,n=t.length,r=0,o=[];++i<n;){var s=t[i];s!==e&&"__lodash_placeholder__"!==s||(t[i]="__lodash_placeholder__",o[r++]=i)}return o}function I(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}function M(t){if(St.test(t)){for(var e=xt.lastIndex=0;xt.test(t);)++e;t=e}else t=Yt(t);return t}function P(t){return St.test(t)?t.match(xt)||[]:t.split("")}var D,F=1/0,L=NaN,R=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],B=/\b__p\+='';/g,z=/\b(__p\+=)''\+/g,H=/(__e\(.*?\)|\b__t\))\+'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,W=/[&<>"']/g,G=RegExp(X.source),N=RegExp(W.source),Y=/<%-([\s\S]+?)%>/g,U=/<%([\s\S]+?)%>/g,V=/<%=([\s\S]+?)%>/g,K=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,q=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,J=/[\\^$.*+?()[\]{}|]/g,Z=RegExp(J.source),tt=/^\s+|\s+$/g,et=/^\s+/,it=/\s+$/,nt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,rt=/\{\n\/\* \[wrapped with (.+)\] \*/,ot=/,? & /,st=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,at=/\\(\\)?/g,ct=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,lt=/\w*$/,ut=/^[-+]0x[0-9a-f]+$/i,ht=/^0b[01]+$/i,ft=/^\[object .+?Constructor\]$/,pt=/^0o[0-7]+$/i,dt=/^(?:0|[1-9]\d*)$/,gt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,mt=/($^)/,vt=/['\n\r\u2028\u2029\\]/g,_t="[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*",bt="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+_t,yt=RegExp("[']","g"),wt=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g"),xt=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])"+_t,"g"),Ct=RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",bt].join("|"),"g"),St=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),Tt=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ot="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),kt={};kt["[object Float32Array]"]=kt["[object Float64Array]"]=kt["[object Int8Array]"]=kt["[object Int16Array]"]=kt["[object Int32Array]"]=kt["[object Uint8Array]"]=kt["[object Uint8ClampedArray]"]=kt["[object Uint16Array]"]=kt["[object Uint32Array]"]=!0,kt["[object Arguments]"]=kt["[object Array]"]=kt["[object ArrayBuffer]"]=kt["[object Boolean]"]=kt["[object DataView]"]=kt["[object Date]"]=kt["[object Error]"]=kt["[object Function]"]=kt["[object Map]"]=kt["[object Number]"]=kt["[object Object]"]=kt["[object RegExp]"]=kt["[object Set]"]=kt["[object String]"]=kt["[object WeakMap]"]=!1;var $t={};$t["[object Arguments]"]=$t["[object Array]"]=$t["[object ArrayBuffer]"]=$t["[object DataView]"]=$t["[object Boolean]"]=$t["[object Date]"]=$t["[object Float32Array]"]=$t["[object Float64Array]"]=$t["[object Int8Array]"]=$t["[object Int16Array]"]=$t["[object Int32Array]"]=$t["[object Map]"]=$t["[object Number]"]=$t["[object Object]"]=$t["[object RegExp]"]=$t["[object Set]"]=$t["[object String]"]=$t["[object Symbol]"]=$t["[object Uint8Array]"]=$t["[object Uint8ClampedArray]"]=$t["[object Uint16Array]"]=$t["[object Uint32Array]"]=!0,$t["[object Error]"]=$t["[object Function]"]=$t["[object WeakMap]"]=!1;var At={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Et=parseFloat,jt=parseInt,It="object"==typeof global&&global&&global.Object===Object&&global,Mt="object"==typeof self&&self&&self.Object===Object&&self,Pt=It||Mt||Function("return this")(),Dt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ft=Dt&&"object"==typeof module&&module&&!module.nodeType&&module,Lt=Ft&&Ft.exports===Dt,Rt=Lt&&It.process,Bt=function(){try{var t=Ft&&Ft.f&&Ft.f("util").types;return t||Rt&&Rt.binding&&Rt.binding("util")}catch(t){}}(),zt=Bt&&Bt.isArrayBuffer,Ht=Bt&&Bt.isDate,Xt=Bt&&Bt.isMap,Wt=Bt&&Bt.isRegExp,Gt=Bt&&Bt.isSet,Nt=Bt&&Bt.isTypedArray,Yt=_("length"),Ut=b({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),Vt=b({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Kt=b({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),qt=function b(_t){function bt(t){if(zn(t)&&!Is(t)&&!(t instanceof It)){if(t instanceof At)return t;if(Ar.call(t,"__wrapped__"))return fn(t)}return new At(t)}function xt(){}function At(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=D}function It(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Mt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Dt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ft(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Rt(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Ft;++e<i;)this.add(t[e])}function Bt(t){this.size=(this.__data__=new Dt(t)).size}function Yt(t,e){var i,n=Is(t),r=!n&&js(t),o=!n&&!r&&Ps(t),s=!n&&!r&&!o&&Bs(t),a=(r=(n=n||r||o||s)?x(t.length,Cr):[]).length;for(i in t)!e&&!Ar.call(t,i)||n&&("length"==i||o&&("offset"==i||"parent"==i)||s&&("buffer"==i||"byteLength"==i||"byteOffset"==i)||Ji(i,a))||r.push(i);return r}function Qt(t){var e=t.length;return e?t[He(0,e-1)]:D}function Jt(t,e,i){(i===D||In(t[e],i))&&(i!==D||e in t)||ne(t,e,i)}function Zt(t,e,i){var n=t[e];Ar.call(t,e)&&In(n,i)&&(i!==D||e in t)||ne(t,e,i)}function te(t,e){for(var i=t.length;i--;)if(In(t[i][0],e))return i;return-1}function ee(t,e,i,n){return $o(t,function(t,r,o){e(n,t,i(t),o)}),n}function ie(t,e){return t&&gi(e,tr(e),t)}function ne(t,e,i){"__proto__"==e&&Ur?Ur(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function re(t,e){for(var i=-1,n=e.length,r=mr(n),o=null==t;++i<n;)r[i]=o?D:Jn(t,e[i]);return r}function oe(t,e,i){return t==t&&(i!==D&&(t=t<=i?t:i),e!==D&&(t=t>=e?t:e)),t}function se(t,e,n,r,o,s){var a,c,l,u,h,f,p,d,g,m,v=1&e,_=2&e,b=4&e;if(n&&(a=o?n(t,r,o,s):n(t)),a!==D)return a;if(!Bn(t))return t;if(r=Is(t)){if(g=(d=t).length,m=new d.constructor(g),g&&"string"==typeof d[0]&&Ar.call(d,"index")&&(m.index=d.index,m.input=d.input),a=m,!v)return di(t,a)}else{var y=Bo(t),w="[object Function]"==y||"[object GeneratorFunction]"==y;if(Ps(t))return ci(t,v);if("[object Object]"==y||"[object Arguments]"==y||w&&!o){if(a=_||w?{}:qi(t),!v)return _?(u=t,f=a,p=t,h=f&&gi(p,er(p),f),gi(u,Ro(u),h)):(c=t,l=ie(a,t),gi(c,Lo(c),l))}else{if(!$t[y])return o?t:{};a=function(t,e,i){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return li(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return e=i?li(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ui(t,i);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return(e=new t.constructor(t.source,lt.exec(t))).lastIndex=t.lastIndex,e;case"[object Set]":return new n;case"[object Symbol]":return To?wr(To.call(t)):{}}}(t,y,v)}}if(s||(s=new Bt),o=s.get(t))return o;if(s.set(t,a),Rs(t))return t.forEach(function(i){a.add(se(i,e,n,i,t,s))}),a;if(Fs(t))return t.forEach(function(i,r){a.set(r,se(i,e,n,r,t,s))}),a;_=b?_?Xi:Hi:_?er:tr;var x=r?D:_(t);return i(x||t,function(i,r){x&&(i=t[r=i]),Zt(a,r,se(i,e,n,r,t,s))}),a}function ae(t,e,i){var n=i.length;if(null==t)return!n;for(t=wr(t);n--;){var r=i[n],o=e[r],s=t[r];if(s===D&&!(r in t)||!o(s))return!1}return!0}function ce(t,e,i){if("function"!=typeof t)throw new Sr("Expected a function");return Go(function(){t.apply(D,i)},e)}function le(t,e,i,n){var r=-1,c=o,l=!0,u=t.length,h=[],f=e.length;if(!u)return h;i&&(e=a(e,C(i))),n?(c=s,l=!1):200<=e.length&&(c=T,l=!1,e=new Rt(e));t:for(;++r<u;){var p=t[r],d=null==i?p:i(p);p=n||0!==p?p:0;if(l&&d==d){for(var g=f;g--;)if(e[g]===d)continue t;h.push(p)}else c(e,d,n)||h.push(p)}return h}function ue(t,e){var i=!0;return $o(t,function(t,n,r){return i=!!e(t,n,r)}),i}function he(t,e,i){for(var n=-1,r=t.length;++n<r;){var o=t[n],s=e(o);if(null!=s&&(a===D?s==s&&!Gn(s):i(s,a)))var a=s,c=o}return c}function fe(t,e){var i=[];return $o(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i}function pe(t,e,i,n,r){var o=-1,s=t.length;for(i||(i=Qi),r||(r=[]);++o<s;){var a=t[o];0<e&&i(a)?1<e?pe(a,e-1,i,n,r):c(r,a):n||(r[r.length]=a)}return r}function de(t,e){return t&&Eo(t,e,tr)}function ge(t,e){return t&&jo(t,e,tr)}function me(t,e){return r(e,function(e){return Fn(t[e])})}function ve(t,e){for(var i=0,n=(e=si(e,t)).length;null!=t&&i<n;)t=t[ln(e[i++])];return i&&i==n?t:D}function _e(t,e,i){return e=e(t),Is(t)?e:c(e,i(t))}function be(t){if(null==t)t=t===D?"[object Undefined]":"[object Null]";else if(Yr&&Yr in wr(t)){var e=Ar.call(t,Yr),i=t[Yr];try{t[Yr]=D;var n=!0}catch(t){}var r=Ir.call(t);n&&(e?t[Yr]=i:delete t[Yr]),t=r}else t=Ir.call(t);return t}function ye(t,e){return t>e}function we(t,e){return null!=t&&Ar.call(t,e)}function xe(t,e){return null!=t&&e in wr(t)}function Ce(t,e,i){for(var n=i?s:o,r=t[0].length,c=t.length,l=c,u=mr(c),h=1/0,f=[];l--;){var p=t[l];l&&e&&(p=a(p,C(e))),h=oo(p.length,h),u[l]=!i&&(e||120<=r&&120<=p.length)?new Rt(l&&p):D}p=t[0];var d=-1,g=u[0];t:for(;++d<r&&f.length<h;){var m=p[d],v=e?e(m):m;m=i||0!==m?m:0;if(g?!T(g,v):!n(f,v,i)){for(l=c;--l;){var _=u[l];if(_?!T(_,v):!n(t[l],v,i))continue t}g&&g.push(v),f.push(m)}}return f}function Se(e,i,n){return null==(i=null==(e=2>(i=si(i,e)).length?e:ve(e,Ne(i,0,-1)))?e:e[ln(vn(i))])?D:t(i,e,n)}function Te(t){return zn(t)&&"[object Arguments]"==be(t)}function Oe(t,e,i,n,r){if(t===e)e=!0;else if(null==t||null==e||!zn(t)&&!zn(e))e=t!=t&&e!=e;else t:{var o=Is(t),s=Is(e),a=o?"[object Array]":Bo(t),c=s?"[object Array]":Bo(e),l="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);s="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c);if((c=a==c)&&Ps(t)){if(!Ps(e)){e=!1;break t}o=!0,l=!1}if(c&&!l)r||(r=new Bt),e=o||Bs(t)?Bi(t,e,i,n,Oe,r):function(t,e,i,n,r,o,s){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!o(new Rr(t),new Rr(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return In(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=A;case"[object Set]":if(a||(a=I),t.size!=e.size&&!(1&n))break;return(i=s.get(t))?i==e:(n|=2,s.set(t,e),e=Bi(a(t),a(e),n,r,o,s),s.delete(t),e);case"[object Symbol]":if(To)return To.call(t)==To.call(e)}return!1}(t,e,a,i,n,Oe,r);else{if(!(1&i)&&(o=l&&Ar.call(t,"__wrapped__"),a=s&&Ar.call(e,"__wrapped__"),o||a)){t=o?t.value():t,e=a?e.value():e,r||(r=new Bt),e=Oe(t,e,i,n,r);break t}if(c)e:if(r||(r=new Bt),o=1&i,a=Hi(t),s=a.length,c=Hi(e).length,s==c||o){for(l=s;l--;){var u=a[l];if(!(o?u in e:Ar.call(e,u))){e=!1;break e}}if((c=r.get(t))&&r.get(e))e=c==e;else{c=!0,r.set(t,e),r.set(e,t);for(var h=o;++l<s;){var f=t[u=a[l]],p=e[u];if(n)var d=o?n(p,f,u,e,t,r):n(f,p,u,t,e,r);if(d===D?f!==p&&!Oe(f,p,i,n,r):!d){c=!1;break}h||(h="constructor"==u)}c&&!h&&((i=t.constructor)!=(n=e.constructor)&&"constructor"in t&&"constructor"in e&&!("function"==typeof i&&i instanceof i&&"function"==typeof n&&n instanceof n)&&(c=!1)),r.delete(t),r.delete(e),e=c}}else e=!1;else e=!1}}return e}function ke(t,e,i,n){var r=i.length,o=r,s=!n;if(null==t)return!o;for(t=wr(t);r--;){var a=i[r];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++r<o;){var c=(a=i[r])[0],l=t[c],u=a[1];if(s&&a[2]){if(l===D&&!(c in t))return!1}else{if(a=new Bt,n)var h=n(l,u,c,t,e,a);if(h===D?!Oe(u,l,3,n,a):!h)return!1}}return!0}function $e(t){return!(!Bn(t)||jr&&jr in t)&&(Fn(t)?Dr:ft).test(un(t))}function Ae(t){return"function"==typeof t?t:null==t?cr:"object"==typeof t?Is(t)?Pe(t[0],t[1]):Me(t):fr(t)}function Ee(t){if(!nn(t))return no(t);var e,i=[];for(e in wr(t))Ar.call(t,e)&&"constructor"!=e&&i.push(e);return i}function je(t,e){return t<e}function Ie(t,e){var i=-1,n=Mn(t)?mr(t.length):[];return $o(t,function(t,r,o){n[++i]=e(t,r,o)}),n}function Me(t){var e=Ui(t);return 1==e.length&&e[0][2]?rn(e[0][0],e[0][1]):function(i){return i===t||ke(i,t,e)}}function Pe(t,e){return tn(t)&&e==e&&!Bn(e)?rn(ln(t),e):function(i){var n=Jn(i,t);return n===D&&n===e?Zn(i,t):Oe(e,n,3)}}function De(t,e,i,n,r){t!==e&&Eo(e,function(o,s){if(Bn(o)){r||(r=new Bt);var a=r,c="__proto__"==s?D:t[s],l="__proto__"==s?D:e[s];if(d=a.get(l))Jt(t,s,d);else{var u=(d=n?n(c,l,s+"",t,e,a):D)===D;if(u){var h=Is(l),f=!h&&Ps(l),p=!h&&!f&&Bs(l),d=l;h||f||p?Is(c)?d=c:Pn(c)?d=di(c):f?(u=!1,d=ci(l,!0)):p?(u=!1,d=ui(l,!0)):d=[]:Xn(l)||js(l)?(d=c,js(c)?d=qn(c):(!Bn(c)||i&&Fn(c))&&(d=qi(l))):u=!1}u&&(a.set(l,d),De(d,l,i,n,a),a.delete(l)),Jt(t,s,d)}}else a=n?n("__proto__"==s?D:t[s],o,s+"",t,e,r):D,a===D&&(a=o),Jt(t,s,a)},er)}function Fe(t,e){var i=t.length;if(i)return e+=0>e?i:0,Ji(e,i)?t[e]:D}function Le(t,e,i){var n=-1;return e=a(e.length?e:[cr],C(Ni())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].c;return t}(t=Ie(t,function(t){return{a:a(e,function(e){return e(t)}),b:++n,c:t}}),function(t,e){var n;t:{n=-1;for(var r=t.a,o=e.a,s=r.length,a=i.length;++n<s;){var c=hi(r[n],o[n]);if(c){n=n>=a?c:c*("desc"==i[n]?-1:1);break t}}n=t.b-e.b}return n})}function Re(t,e,i){for(var n=-1,r=e.length,o={};++n<r;){var s=e[n],a=ve(t,s);i(a,s)&&Ge(o,si(s,t),a)}return o}function Be(t,e,i,n){var r=n?g:d,o=-1,s=e.length,c=t;for(t===e&&(e=di(e)),i&&(c=a(t,C(i)));++o<s;){var l=0,u=e[o];for(u=i?i(u):u;-1<(l=r(c,u,l,n));)c!==t&&Wr.call(c,l,1),Wr.call(t,l,1)}return t}function ze(t,e){for(var i=t?e.length:0,n=i-1;i--;){var r=e[i];if(i==n||r!==o){var o=r;Ji(r)?Wr.call(t,r,1):Ze(t,r)}}}function He(t,e){return t+Jr(co()*(e-t+1))}function Xe(t,e){var i="";if(!t||1>e||9007199254740991<e)return i;do{e%2&&(i+=t),(e=Jr(e/2))&&(t+=t)}while(e);return i}function We(t,e){return No(on(t,e,cr),t+"")}function Ge(t,e,i,n){if(!Bn(t))return t;for(var r=-1,o=(e=si(e,t)).length,s=o-1,a=t;null!=a&&++r<o;){var c=ln(e[r]),l=i;if(r!=s){var u=a[c];(l=n?n(u,c,a):D)===D&&(l=Bn(u)?u:Ji(e[r+1])?[]:{})}Zt(a,c,l),a=a[c]}return t}function Ne(t,e,i){var n=-1,r=t.length;for(0>e&&(e=-e>r?0:r+e),0>(i=i>r?r:i)&&(i+=r),r=e>i?0:i-e>>>0,e>>>=0,i=mr(r);++n<r;)i[n]=t[n+e];return i}function Ye(t,e){var i;return $o(t,function(t,n,r){return!(i=e(t,n,r))}),!!i}function Ue(t,e,i){var n=0,r=null==t?n:t.length;if("number"==typeof e&&e==e&&2147483647>=r){for(;n<r;){var o=n+r>>>1,s=t[o];null!==s&&!Gn(s)&&(i?s<=e:s<e)?n=o+1:r=o}return r}return Ve(t,e,cr,i)}function Ve(t,e,i,n){e=i(e);for(var r=0,o=null==t?0:t.length,s=e!=e,a=null===e,c=Gn(e),l=e===D;r<o;){var u=Jr((r+o)/2),h=i(t[u]),f=h!==D,p=null===h,d=h==h,g=Gn(h);(s?n||d:l?d&&(n||f):a?d&&f&&(n||!p):c?d&&f&&!p&&(n||!g):!p&&!g&&(n?h<=e:h<e))?r=u+1:o=u}return oo(o,4294967294)}function Ke(t,e){for(var i=-1,n=t.length,r=0,o=[];++i<n;){var s=t[i],a=e?e(s):s;if(!i||!In(a,c)){var c=a;o[r++]=0===s?0:s}}return o}function qe(t){return"number"==typeof t?t:Gn(t)?L:+t}function Qe(t){if("string"==typeof t)return t;if(Is(t))return a(t,Qe)+"";if(Gn(t))return Oo?Oo.call(t):"";var e=t+"";return"0"==e&&1/t==-F?"-0":e}function Je(t,e,i){var n=-1,r=o,a=t.length,c=!0,l=[],u=l;if(i)c=!1,r=s;else if(200<=a){if(r=e?null:Do(t))return I(r);c=!1,r=T,u=new Rt}else u=e?[]:l;t:for(;++n<a;){var h=t[n],f=e?e(h):h;h=i||0!==h?h:0;if(c&&f==f){for(var p=u.length;p--;)if(u[p]===f)continue t;e&&u.push(f),l.push(h)}else r(u,f,i)||(u!==l&&u.push(f),l.push(h))}return l}function Ze(t,e){return null==(t=2>(e=si(e,t)).length?t:ve(t,Ne(e,0,-1)))||delete t[ln(vn(e))]}function ti(t,e,i,n){for(var r=t.length,o=n?r:-1;(n?o--:++o<r)&&e(t[o],o,t););return i?Ne(t,n?0:o,n?o+1:r):Ne(t,n?o+1:0,n?r:o)}function ei(t,e){var i=t;return i instanceof It&&(i=i.value()),l(e,function(t,e){return e.func.apply(e.thisArg,c([t],e.args))},i)}function ii(t,e,i){var n=t.length;if(2>n)return n?Je(t[0]):[];for(var r=-1,o=mr(n);++r<n;)for(var s=t[r],a=-1;++a<n;)a!=r&&(o[r]=le(o[r]||s,t[a],e,i));return Je(pe(o,1),e,i)}function ni(t,e,i){for(var n=-1,r=t.length,o=e.length,s={};++n<r;)i(s,t[n],n<o?e[n]:D);return s}function ri(t){return Pn(t)?t:[]}function oi(t){return"function"==typeof t?t:cr}function si(t,e){return Is(t)?t:tn(t,e)?[t]:Yo(Qn(t))}function ai(t,e,i){var n=t.length;return i=i===D?n:i,!e&&i>=n?t:Ne(t,e,i)}function ci(t,e){if(e)return t.slice();var i=t.length;i=Br?Br(i):new t.constructor(i);return t.copy(i),i}function li(t){var e=new t.constructor(t.byteLength);return new Rr(e).set(new Rr(t)),e}function ui(t,e){return new t.constructor(e?li(t.buffer):t.buffer,t.byteOffset,t.length)}function hi(t,e){if(t!==e){var i=t!==D,n=null===t,r=t==t,o=Gn(t),s=e!==D,a=null===e,c=e==e,l=Gn(e);if(!a&&!l&&!o&&t>e||o&&s&&c&&!a&&!l||n&&s&&c||!i&&c||!r)return 1;if(!n&&!o&&!l&&t<e||l&&i&&r&&!n&&!o||a&&i&&r||!s&&r||!c)return-1}return 0}function fi(t,e,i,n){var r=-1,o=t.length,s=i.length,a=-1,c=e.length,l=ro(o-s,0),u=mr(c+l);for(n=!n;++a<c;)u[a]=e[a];for(;++r<s;)(n||r<o)&&(u[i[r]]=t[r]);for(;l--;)u[a++]=t[r++];return u}function pi(t,e,i,n){var r=-1,o=t.length,s=-1,a=i.length,c=-1,l=e.length,u=ro(o-a,0),h=mr(u+l);for(n=!n;++r<u;)h[r]=t[r];for(u=r;++c<l;)h[u+c]=e[c];for(;++s<a;)(n||r<o)&&(h[u+i[s]]=t[r++]);return h}function di(t,e){var i=-1,n=t.length;for(e||(e=mr(n));++i<n;)e[i]=t[i];return e}function gi(t,e,i,n){var r=!i;i||(i={});for(var o=-1,s=e.length;++o<s;){var a=e[o],c=n?n(i[a],t[a],a,i,t):D;c===D&&(c=t[a]),r?ne(i,a,c):Zt(i,a,c)}return i}function mi(t,i){return function(n,r){var o=Is(n)?e:ee,s=i?i():{};return o(n,t,Ni(r,2),s)}}function vi(t){return We(function(e,i){var n=-1,r=i.length,o=1<r?i[r-1]:D,s=2<r?i[2]:D;o=3<t.length&&"function"==typeof o?(r--,o):D;for(s&&Zi(i[0],i[1],s)&&(o=3>r?D:o,r=1),e=wr(e);++n<r;)(s=i[n])&&t(e,s,n,o);return e})}function _i(t,e){return function(i,n){if(null==i)return i;if(!Mn(i))return t(i,n);for(var r=i.length,o=e?r:-1,s=wr(i);(e?o--:++o<r)&&!1!==n(s[o],o,s););return i}}function bi(t){return function(e,i,n){for(var r=-1,o=wr(e),s=(n=n(e)).length;s--;){var a=n[t?s:++r];if(!1===i(o[a],a,o))break}return e}}function yi(t){return function(e){e=Qn(e);var i=St.test(e)?P(e):D,n=i?i[0]:e.charAt(0);return e=i?ai(i,1).join(""):e.slice(1),n[t]()+e}}function wi(t){return function(e){return l(sr(or(e).replace(yt,"")),t,"")}}function xi(t){return function(){switch((e=arguments).length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var e,i=ko(t.prototype);return Bn(e=t.apply(i,e))?e:i}}function Ci(t){return function(e,i,n){var r=wr(e);if(!Mn(e)){var o=Ni(i,3);e=tr(e),i=function(t){return o(r[t],t,r)}}return-1<(i=t(e,i,n))?r[o?e[i]:i]:D}}function Si(t){return zi(function(e){var i=e.length,n=i,r=At.prototype.thru;for(t&&e.reverse();n--;){if("function"!=typeof(s=e[n]))throw new Sr("Expected a function");if(r&&!o&&"wrapper"==Wi(s))var o=new At([],!0)}for(n=o?n:i;++n<i;){var s=e[n],a=(r=Wi(s),"wrapper"==r?Fo(s):D);o=a&&en(a[0])&&424==a[1]&&!a[4].length&&1==a[9]?o[Wi(a[0])].apply(o,a[3]):1==s.length&&en(s)?o[r]():o.thru(s)}return function(){var t=(r=arguments)[0];if(o&&1==r.length&&Is(t))return o.plant(t).value();for(var n=0,r=i?e[n].apply(this,r):t;++n<i;)r=e[n].call(this,r);return r}})}function Ti(t,e,i,n,r,o,s,a,c,l){var u=128&e,h=1&e,f=2&e,p=24&e,d=512&e,g=f?D:xi(t);return function m(){for(var v=arguments.length,_=mr(v),b=v;b--;)_[b]=arguments[b];if(p){var y,w=Gi(m);for(b=_.length,y=0;b--;)_[b]===w&&++y}if(n&&(_=fi(_,n,r,p)),o&&(_=pi(_,o,s,p)),v-=y,p&&v<l)return w=j(_,w),Ii(t,e,Ti,m.placeholder,i,_,w,a,c,l-v);if(w=h?i:this,b=f?w[t]:t,v=_.length,a){y=_.length;for(var x=oo(a.length,y),C=di(_);x--;){var S=a[x];_[x]=Ji(S,y)?C[S]:D}}else d&&1<v&&_.reverse();return u&&c<v&&(_.length=c),this&&this!==Pt&&this instanceof m&&(b=g||xi(b)),b.apply(w,_)}}function Oi(t,e){return function(i,n){return r=i,o=t,s=e(n),a={},de(r,function(t,e,i){o(a,s(t),e,i)}),a;var r,o,s,a}}function ki(t,e){return function(i,n){var r;if(i===D&&n===D)return e;if(i!==D&&(r=i),n!==D){if(r===D)return n;"string"==typeof i||"string"==typeof n?(i=Qe(i),n=Qe(n)):(i=qe(i),n=qe(n)),r=t(i,n)}return r}}function $i(e){return zi(function(i){return i=a(i,C(Ni())),We(function(n){var r=this;return e(i,function(e){return t(e,r,n)})})})}function Ai(t,e){var i=(e=e===D?" ":Qe(e)).length;return 2>i?i?Xe(e,t):e:(i=Xe(e,Qr(t/M(e))),St.test(e)?ai(P(i),0,t).join(""):i.slice(0,t))}function Ei(t){return function(e,i,n){n&&"number"!=typeof n&&Zi(e,i,n)&&(i=n=D),e=Yn(e),i===D?(i=e,e=0):i=Yn(i),n=n===D?e<i?1:-1:Yn(n);var r=-1;i=ro(Qr((i-e)/(n||1)),0);for(var o=mr(i);i--;)o[t?i:++r]=e,e+=n;return o}}function ji(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=Kn(e),i=Kn(i)),t(e,i)}}function Ii(t,e,i,n,r,o,s,a,c,l){var u=8&e,h=u?s:D;s=u?D:s;var f=u?o:D;return o=u?D:o,4&(e=(e|(u?32:64))&~(u?64:32))||(e&=-4),r=[t,e,r,f,h,o,s,a,c,l],i=i.apply(D,r),en(t)&&Wo(i,r),i.placeholder=n,sn(i,t,e)}function Mi(t){var e=yr[t];return function(t,i){if(t=Kn(t),i=null==i?0:oo(Un(i),292)){var n=(Qn(t)+"e").split("e");return+((n=(Qn(n=e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}function Pi(t){return function(e){var i,n,r,o,s=Bo(e);return"[object Map]"==s?A(e):"[object Set]"==s?(n=e,r=-1,o=Array(n.size),n.forEach(function(t){o[++r]=[t,t]}),o):(i=e,a(t(e),function(t){return[t,i[t]]}))}}function Di(e,i,n,r,o,s,a,c){var l=2&i;if(!l&&"function"!=typeof e)throw new Sr("Expected a function");var u=r?r.length:0;if(u||(i&=-97,r=o=D),a=a===D?a:ro(Un(a),0),c=c===D?c:Un(c),u-=o?o.length:0,64&i){var h=r,f=o;r=o=D}var p,d,g,m,v,_,b,y,w,x,C,S,T,O=l?D:Fo(e);return s=[e,i,n,r,o,h,f,s,a,c],O&&(i=(n=s[1])|(e=O[1]),r=128==e&&8==n||128==e&&256==n&&s[7].length<=O[8]||384==e&&O[7].length<=O[8]&&8==n,131>i||r)&&(1&e&&(s[2]=O[2],i|=1&n?0:4),(n=O[3])&&(r=s[3],s[3]=r?fi(r,n,O[4]):n,s[4]=r?j(s[3],"__lodash_placeholder__"):O[4]),(n=O[5])&&(r=s[5],s[5]=r?pi(r,n,O[6]):n,s[6]=r?j(s[5],"__lodash_placeholder__"):O[6]),(n=O[7])&&(s[7]=n),128&e&&(s[8]=null==s[8]?O[8]:oo(s[8],O[8])),null==s[9]&&(s[9]=O[9]),s[0]=O[0],s[1]=i),e=s[0],i=s[1],n=s[2],r=s[3],o=s[4],!(c=s[9]=s[9]===D?l?0:e.length:ro(s[9]-u,0))&&24&i&&(i&=-25),sn((O?Io:Wo)(i&&1!=i?8==i||16==i?(C=i,S=c,T=xi(x=e),function e(){for(var i=arguments.length,n=mr(i),r=i,o=Gi(e);r--;)n[r]=arguments[r];return(i-=(r=3>i&&n[0]!==o&&n[i-1]!==o?[]:j(n,o)).length)<S?Ii(x,C,Ti,e.placeholder,D,n,r,D,D,S-i):t(this&&this!==Pt&&this instanceof e?T:x,this,n)}):32!=i&&33!=i||o.length?Ti.apply(D,s):(_=n,b=r,y=1&i,w=xi(v=e),function e(){for(var i=-1,n=arguments.length,r=-1,o=b.length,s=mr(o+n),a=this&&this!==Pt&&this instanceof e?w:v;++r<o;)s[r]=b[r];for(;n--;)s[r++]=arguments[++i];return t(a,y?_:this,s)}):(d=n,g=1&i,m=xi(p=e),function t(){return(this&&this!==Pt&&this instanceof t?m:p).apply(g?d:this,arguments)}),s),e,i)}function Fi(t,e,i,n){return t===D||In(t,Or[i])&&!Ar.call(n,i)?e:t}function Li(t,e,i,n,r,o){return Bn(t)&&Bn(e)&&(o.set(e,t),De(t,e,D,Li,o),o.delete(e)),t}function Ri(t){return Xn(t)?D:t}function Bi(t,e,i,n,r,o){var s=1&i,a=t.length;if(a!=(c=e.length)&&!(s&&c>a))return!1;if((c=o.get(t))&&o.get(e))return c==e;var c=-1,l=!0,u=2&i?new Rt:D;for(o.set(t,e),o.set(e,t);++c<a;){var f=t[c],p=e[c];if(n)var d=s?n(p,f,c,e,t,o):n(f,p,c,t,e,o);if(d!==D){if(d)continue;l=!1;break}if(u){if(!h(e,function(t,e){if(!T(u,e)&&(f===t||r(f,t,i,n,o)))return u.push(e)})){l=!1;break}}else if(f!==p&&!r(f,p,i,n,o)){l=!1;break}}return o.delete(t),o.delete(e),l}function zi(t){return No(on(t,D,gn),t+"")}function Hi(t){return _e(t,tr,Lo)}function Xi(t){return _e(t,er,Ro)}function Wi(t){for(var e=t.name+"",i=_o[e],n=Ar.call(_o,e)?i.length:0;n--;){var r=i[n],o=r.func;if(null==o||o==t)return r.name}return e}function Gi(t){return(Ar.call(bt,"placeholder")?bt:t).placeholder}function Ni(){var t=(t=bt.iteratee||lr)===lr?Ae:t;return arguments.length?t(arguments[0],arguments[1]):t}function Yi(t,e){var i=t.__data__,n=typeof e;return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?i["string"==typeof e?"string":"hash"]:i.map}function Ui(t){for(var e=tr(t),i=e.length;i--;){var n=e[i],r=t[n];e[i]=[n,r,r==r&&!Bn(r)]}return e}function Vi(t,e){var i=null==t?D:t[e];return $e(i)?i:D}function Ki(t,e,i){for(var n=-1,r=(e=si(e,t)).length,o=!1;++n<r;){var s=ln(e[n]);if(!(o=null!=t&&i(t,s)))break;t=t[s]}return o||++n!=r?o:!!(r=null==t?0:t.length)&&Rn(r)&&Ji(s,r)&&(Is(t)||js(t))}function qi(t){return"function"!=typeof t.constructor||nn(t)?{}:ko(zr(t))}function Qi(t){return Is(t)||js(t)||!!(Gr&&t&&t[Gr])}function Ji(t,e){var i=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&dt.test(t))&&-1<t&&0==t%1&&t<e}function Zi(t,e,i){if(!Bn(i))return!1;var n=typeof e;return!!("number"==n?Mn(i)&&Ji(e,i.length):"string"==n&&e in i)&&In(i[e],t)}function tn(t,e){if(Is(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Gn(t))||q.test(t)||!K.test(t)||null!=e&&t in wr(e)}function en(t){var e=Wi(t),i=bt[e];return"function"==typeof i&&e in It.prototype&&(t===i||!!(e=Fo(i))&&t===e[0])}function nn(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Or)}function rn(t,e){return function(i){return null!=i&&i[t]===e&&(e!==D||t in wr(i))}}function on(e,i,n){return i=ro(i===D?e.length-1:i,0),function(){for(var r=arguments,o=-1,s=ro(r.length-i,0),a=mr(s);++o<s;)a[o]=r[i+o];for(o=-1,s=mr(i+1);++o<i;)s[o]=r[o];return s[i]=n(a),t(e,this,s)}}function sn(t,e,i){var n=e+"";e=No;var r,o=hn;return(o=(i=o(r=(r=n.match(rt))?r[1].split(ot):[],i)).length)&&(i[r=o-1]=(1<o?"& ":"")+i[r],i=i.join(2<o?", ":" "),n=n.replace(nt,"{\n/* [wrapped with "+i+"] */\n")),e(t,n)}function an(t){var e=0,i=0;return function(){var n=so(),r=16-(n-i);if(i=n,0<r){if(800<=++e)return arguments[0]}else e=0;return t.apply(D,arguments)}}function cn(t,e){var i=-1,n=(r=t.length)-1;for(e=e===D?r:e;++i<e;){var r,o=t[r=He(i,n)];t[r]=t[i],t[i]=o}return t.length=e,t}function ln(t){if("string"==typeof t||Gn(t))return t;var e=t+"";return"0"==e&&1/t==-F?"-0":e}function un(t){if(null!=t){try{return $r.call(t)}catch(t){}return t+""}return""}function hn(t,e){return i(R,function(i){var n="_."+i[0];e&i[1]&&!o(t,n)&&t.push(n)}),t.sort()}function fn(t){if(t instanceof It)return t.clone();var e=new At(t.__wrapped__,t.__chain__);return e.__actions__=di(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function pn(t,e,i){var n=null==t?0:t.length;return n?(0>(i=null==i?0:Un(i))&&(i=ro(n+i,0)),p(t,Ni(e,3),i)):-1}function dn(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=n-1;return i!==D&&(r=Un(i),r=0>i?ro(n+r,0):oo(r,n-1)),p(t,Ni(e,3),r,!0)}function gn(t){return null!=t&&t.length?pe(t,1):[]}function mn(t){return t&&t.length?t[0]:D}function vn(t){var e=null==t?0:t.length;return e?t[e-1]:D}function _n(t,e){return t&&t.length&&e&&e.length?Be(t,e):t}function bn(t){return null==t?t:lo.call(t)}function yn(t){if(!t||!t.length)return[];var e=0;return t=r(t,function(t){if(Pn(t))return e=ro(t.length,e),!0}),x(e,function(e){return a(t,_(e))})}function wn(e,i){if(!e||!e.length)return[];var n=yn(e);return null==i?n:a(n,function(e){return t(i,D,e)})}function xn(t){return(t=bt(t)).__chain__=!0,t}function Cn(t,e){return e(t)}function Sn(t,e){return(Is(t)?i:$o)(t,Ni(e,3))}function Tn(t,e){return(Is(t)?function(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}:Ao)(t,Ni(e,3))}function On(t,e){return(Is(t)?a:Ie)(t,Ni(e,3))}function kn(t,e,i){return e=i?D:e,e=t&&null==e?t.length:e,Di(t,128,D,D,D,D,e)}function $n(t,e){var i;if("function"!=typeof e)throw new Sr("Expected a function");return t=Un(t),function(){return 0<--t&&(i=e.apply(this,arguments)),1>=t&&(e=D),i}}function An(t,e,i){function n(e){var i=c,n=l;return c=l=D,d=e,h=t.apply(n,i)}function r(t){var i=t-p;return t-=d,p===D||i>=e||0>i||m&&t>=u}function o(){var t=bs();if(r(t))return s(t);var i,n=Go;i=t-d,t=e-(t-p),i=m?oo(t,u-i):t,f=n(o,i)}function s(t){return f=D,v&&c?n(t):(c=l=D,h)}function a(){var t=bs(),i=r(t);if(c=arguments,l=this,p=t,i){if(f===D)return d=t=p,f=Go(o,e),g?n(t):h;if(m)return f=Go(o,e),n(p)}return f===D&&(f=Go(o,e)),h}var c,l,u,h,f,p,d=0,g=!1,m=!1,v=!0;if("function"!=typeof t)throw new Sr("Expected a function");return e=Kn(e)||0,Bn(i)&&(g=!!i.leading,u=(m="maxWait"in i)?ro(Kn(i.maxWait)||0,e):u,v="trailing"in i?!!i.trailing:v),a.cancel=function(){f!==D&&Po(f),d=0,c=p=l=f=D},a.flush=function(){return f===D?h:s(bs())},a}function En(t,e){function i(){var n=arguments,r=e?e.apply(this,n):n[0],o=i.cache;return o.has(r)?o.get(r):(n=t.apply(this,n),i.cache=o.set(r,n)||o,n)}if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Sr("Expected a function");return i.cache=new(En.Cache||Ft),i}function jn(t){if("function"!=typeof t)throw new Sr("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function In(t,e){return t===e||t!=t&&e!=e}function Mn(t){return null!=t&&Rn(t.length)&&!Fn(t)}function Pn(t){return zn(t)&&Mn(t)}function Dn(t){if(!zn(t))return!1;var e=be(t);return"[object Error]"==e||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!Xn(t)}function Fn(t){return!!Bn(t)&&("[object Function]"==(t=be(t))||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t)}function Ln(t){return"number"==typeof t&&t==Un(t)}function Rn(t){return"number"==typeof t&&-1<t&&0==t%1&&9007199254740991>=t}function Bn(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function zn(t){return null!=t&&"object"==typeof t}function Hn(t){return"number"==typeof t||zn(t)&&"[object Number]"==be(t)}function Xn(t){return!(!zn(t)||"[object Object]"!=be(t))&&(null===(t=zr(t))||"function"==typeof(t=Ar.call(t,"constructor")&&t.constructor)&&t instanceof t&&$r.call(t)==Mr)}function Wn(t){return"string"==typeof t||!Is(t)&&zn(t)&&"[object String]"==be(t)}function Gn(t){return"symbol"==typeof t||zn(t)&&"[object Symbol]"==be(t)}function Nn(t){if(!t)return[];if(Mn(t))return Wn(t)?P(t):di(t);if(Nr&&t[Nr]){t=t[Nr]();for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}return("[object Map]"==(e=Bo(t))?A:"[object Set]"==e?I:nr)(t)}function Yn(t){return t?(t=Kn(t))===F||t===-F?1.7976931348623157e308*(0>t?-1:1):t==t?t:0:0===t?t:0}function Un(t){var e=(t=Yn(t))%1;return t==t?e?t-e:t:0}function Vn(t){return t?oe(Un(t),0,4294967295):0}function Kn(t){if("number"==typeof t)return t;if(Gn(t))return L;if(Bn(t)&&(t=Bn(t="function"==typeof t.valueOf?t.valueOf():t)?t+"":t),"string"!=typeof t)return 0===t?t:+t;t=t.replace(tt,"");var e=ht.test(t);return e||pt.test(t)?jt(t.slice(2),e?2:8):ut.test(t)?L:+t}function qn(t){return gi(t,er(t))}function Qn(t){return null==t?"":Qe(t)}function Jn(t,e,i){return(t=null==t?D:ve(t,e))===D?i:t}function Zn(t,e){return null!=t&&Ki(t,e,xe)}function tr(t){return Mn(t)?Yt(t):Ee(t)}function er(t){if(Mn(t))t=Yt(t,!0);else if(Bn(t)){var e,i=nn(t),n=[];for(e in t)("constructor"!=e||!i&&Ar.call(t,e))&&n.push(e);t=n}else{if(e=[],null!=t)for(i in wr(t))e.push(i);t=e}return t}function ir(t,e){if(null==t)return{};var i=a(Xi(t),function(t){return[t]});return e=Ni(e),Re(t,i,function(t,i){return e(t,i[0])})}function nr(t){return null==t?[]:S(t,tr(t))}function rr(t){return ha(Qn(t).toLowerCase())}function or(t){return(t=Qn(t))&&t.replace(gt,Ut).replace(wt,"")}function sr(t,e,i){return t=Qn(t),(e=i?D:e)===D?Tt.test(t)?t.match(Ct)||[]:t.match(st)||[]:t.match(e)||[]}function ar(t){return function(){return t}}function cr(t){return t}function lr(t){return Ae("function"==typeof t?t:se(t,1))}function ur(t,e,n){var r=tr(e),o=me(e,r);null!=n||Bn(e)&&(o.length||!r.length)||(n=e,e=t,t=this,o=me(e,tr(e)));var s=!(Bn(n)&&"chain"in n&&!n.chain),a=Fn(t);return i(o,function(i){var n=e[i];t[i]=n,a&&(t.prototype[i]=function(){var e=this.__chain__;if(s||e){var i=t(this.__wrapped__);return(i.__actions__=di(this.__actions__)).push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,c([this.value()],arguments))})}),t}function hr(){}function fr(t){return tn(t)?_(ln(t)):(e=t,function(t){return ve(t,e)});var e}function pr(){return[]}function dr(){return!1}var gr,mr=(_t=null==_t?Pt:qt.defaults(Pt.Object(),_t,qt.pick(Pt,Ot))).Array,vr=_t.Date,_r=_t.Error,br=_t.Function,yr=_t.Math,wr=_t.Object,xr=_t.RegExp,Cr=_t.String,Sr=_t.TypeError,Tr=mr.prototype,Or=wr.prototype,kr=_t["__core-js_shared__"],$r=br.prototype.toString,Ar=Or.hasOwnProperty,Er=0,jr=(gr=/[^.]+$/.exec(kr&&kr.keys&&kr.keys.IE_PROTO||""))?"Symbol(src)_1."+gr:"",Ir=Or.toString,Mr=$r.call(wr),Pr=Pt._,Dr=xr("^"+$r.call(Ar).replace(J,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fr=Lt?_t.Buffer:D,Lr=_t.Symbol,Rr=_t.Uint8Array,Br=Fr?Fr.g:D,zr=E(wr.getPrototypeOf,wr),Hr=wr.create,Xr=Or.propertyIsEnumerable,Wr=Tr.splice,Gr=Lr?Lr.isConcatSpreadable:D,Nr=Lr?Lr.iterator:D,Yr=Lr?Lr.toStringTag:D,Ur=function(){try{var t=Vi(wr,"defineProperty");return t({},"",{}),t}catch(t){}}(),Vr=_t.clearTimeout!==Pt.clearTimeout&&_t.clearTimeout,Kr=vr&&vr.now!==Pt.Date.now&&vr.now,qr=_t.setTimeout!==Pt.setTimeout&&_t.setTimeout,Qr=yr.ceil,Jr=yr.floor,Zr=wr.getOwnPropertySymbols,to=Fr?Fr.isBuffer:D,eo=_t.isFinite,io=Tr.join,no=E(wr.keys,wr),ro=yr.max,oo=yr.min,so=vr.now,ao=_t.parseInt,co=yr.random,lo=Tr.reverse,uo=Vi(_t,"DataView"),ho=Vi(_t,"Map"),fo=Vi(_t,"Promise"),po=Vi(_t,"Set"),go=Vi(_t,"WeakMap"),mo=Vi(wr,"create"),vo=go&&new go,_o={},bo=un(uo),yo=un(ho),wo=un(fo),xo=un(po),Co=un(go),So=Lr?Lr.prototype:D,To=So?So.valueOf:D,Oo=So?So.toString:D,ko=function(){function t(){}return function(e){return Bn(e)?Hr?Hr(e):(t.prototype=e,e=new t,t.prototype=D,e):{}}}();bt.templateSettings={escape:Y,evaluate:U,interpolate:V,variable:"",imports:{_:bt}},bt.prototype=xt.prototype,bt.prototype.constructor=bt,At.prototype=ko(xt.prototype),At.prototype.constructor=At,It.prototype=ko(xt.prototype),It.prototype.constructor=It,Mt.prototype.clear=function(){this.__data__=mo?mo(null):{},this.size=0},Mt.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},Mt.prototype.get=function(t){var e=this.__data__;return mo?"__lodash_hash_undefined__"===(t=e[t])?D:t:Ar.call(e,t)?e[t]:D},Mt.prototype.has=function(t){var e=this.__data__;return mo?e[t]!==D:Ar.call(e,t)},Mt.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=mo&&e===D?"__lodash_hash_undefined__":e,this},Dt.prototype.clear=function(){this.__data__=[],this.size=0},Dt.prototype.delete=function(t){var e=this.__data__;return!(0>(t=te(e,t))||(t==e.length-1?e.pop():Wr.call(e,t,1),--this.size,0))},Dt.prototype.get=function(t){var e=this.__data__;return 0>(t=te(e,t))?D:e[t][1]},Dt.prototype.has=function(t){return-1<te(this.__data__,t)},Dt.prototype.set=function(t,e){var i=this.__data__,n=te(i,t);return 0>n?(++this.size,i.push([t,e])):i[n][1]=e,this},Ft.prototype.clear=function(){this.size=0,this.__data__={hash:new Mt,map:new(ho||Dt),string:new Mt}},Ft.prototype.delete=function(t){return t=Yi(this,t).delete(t),this.size-=t?1:0,t},Ft.prototype.get=function(t){return Yi(this,t).get(t)},Ft.prototype.has=function(t){return Yi(this,t).has(t)},Ft.prototype.set=function(t,e){var i=Yi(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},Rt.prototype.add=Rt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Rt.prototype.has=function(t){return this.__data__.has(t)},Bt.prototype.clear=function(){this.__data__=new Dt,this.size=0},Bt.prototype.delete=function(t){var e=this.__data__;return t=e.delete(t),this.size=e.size,t},Bt.prototype.get=function(t){return this.__data__.get(t)},Bt.prototype.has=function(t){return this.__data__.has(t)},Bt.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Dt){var n=i.__data__;if(!ho||199>n.length)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Ft(n)}return i.set(t,e),this.size=i.size,this};var $o=_i(de),Ao=_i(ge,!0),Eo=bi(),jo=bi(!0),Io=vo?function(t,e){return vo.set(t,e),t}:cr,Mo=Ur?function(t,e){return Ur(t,"toString",{configurable:!0,enumerable:!1,value:ar(e),writable:!0})}:cr,Po=Vr||function(t){return Pt.clearTimeout(t)},Do=po&&1/I(new po([,-0]))[1]==F?function(t){return new po(t)}:hr,Fo=vo?function(t){return vo.get(t)}:hr,Lo=Zr?function(t){return null==t?[]:(t=wr(t),r(Zr(t),function(e){return Xr.call(t,e)}))}:pr,Ro=Zr?function(t){for(var e=[];t;)c(e,Lo(t)),t=zr(t);return e}:pr,Bo=be;(uo&&"[object DataView]"!=Bo(new uo(new ArrayBuffer(1)))||ho&&"[object Map]"!=Bo(new ho)||fo&&"[object Promise]"!=Bo(fo.resolve())||po&&"[object Set]"!=Bo(new po)||go&&"[object WeakMap]"!=Bo(new go))&&(Bo=function(t){var e=be(t);if(t=(t="[object Object]"==e?t.constructor:D)?un(t):"")switch(t){case bo:return"[object DataView]";case yo:return"[object Map]";case wo:return"[object Promise]";case xo:return"[object Set]";case Co:return"[object WeakMap]"}return e});var zo,Ho,Xo=kr?Fn:dr,Wo=an(Io),Go=qr||function(t,e){return Pt.setTimeout(t,e)},No=an(Mo),Yo=(Ho=(zo=En(zo=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Q,function(t,i,n,r){e.push(n?r.replace(at,"$1"):i||t)}),e},function(t){return 500===Ho.size&&Ho.clear(),t})).cache,zo),Uo=We(function(t,e){return Pn(t)?le(t,pe(e,1,Pn,!0)):[]}),Vo=We(function(t,e){var i=vn(e);return Pn(i)&&(i=D),Pn(t)?le(t,pe(e,1,Pn,!0),Ni(i,2)):[]}),Ko=We(function(t,e){var i=vn(e);return Pn(i)&&(i=D),Pn(t)?le(t,pe(e,1,Pn,!0),D,i):[]}),qo=We(function(t){var e=a(t,ri);return e.length&&e[0]===t[0]?Ce(e):[]}),Qo=We(function(t){var e=vn(t),i=a(t,ri);return e===vn(i)?e=D:i.pop(),i.length&&i[0]===t[0]?Ce(i,Ni(e,2)):[]}),Jo=We(function(t){var e=vn(t),i=a(t,ri);return(e="function"==typeof e?e:D)&&i.pop(),i.length&&i[0]===t[0]?Ce(i,D,e):[]}),Zo=We(_n),ts=zi(function(t,e){var i=null==t?0:t.length,n=re(t,e);return ze(t,a(e,function(t){return Ji(t,i)?+t:t}).sort(hi)),n}),es=We(function(t){return Je(pe(t,1,Pn,!0))}),is=We(function(t){var e=vn(t);return Pn(e)&&(e=D),Je(pe(t,1,Pn,!0),Ni(e,2))}),ns=We(function(t){var e="function"==typeof(e=vn(t))?e:D;return Je(pe(t,1,Pn,!0),D,e)}),rs=We(function(t,e){return Pn(t)?le(t,e):[]}),os=We(function(t){return ii(r(t,Pn))}),ss=We(function(t){var e=vn(t);return Pn(e)&&(e=D),ii(r(t,Pn),Ni(e,2))}),as=We(function(t){var e="function"==typeof(e=vn(t))?e:D;return ii(r(t,Pn),D,e)}),cs=We(yn),ls=We(function(t){var e;return wn(t,e="function"==typeof(e=1<(e=t.length)?t[e-1]:D)?(t.pop(),e):D)}),us=zi(function(t){function e(e){return re(e,t)}var i=t.length,n=i?t[0]:0,r=this.__wrapped__;return!(1<i||this.__actions__.length)&&r instanceof It&&Ji(n)?((r=r.slice(n,+n+(i?1:0))).__actions__.push({func:Cn,args:[e],thisArg:D}),new At(r,this.__chain__).thru(function(t){return i&&!t.length&&t.push(D),t})):this.thru(e)}),hs=mi(function(t,e,i){Ar.call(t,i)?++t[i]:ne(t,i,1)}),fs=Ci(pn),ps=Ci(dn),ds=mi(function(t,e,i){Ar.call(t,i)?t[i].push(e):ne(t,i,[e])}),gs=We(function(e,i,n){var r=-1,o="function"==typeof i,s=Mn(e)?mr(e.length):[];return $o(e,function(e){s[++r]=o?t(i,e,n):Se(e,i,n)}),s}),ms=mi(function(t,e,i){ne(t,i,e)}),vs=mi(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]}),_s=We(function(t,e){if(null==t)return[];var i=e.length;return 1<i&&Zi(t,e[0],e[1])?e=[]:2<i&&Zi(e[0],e[1],e[2])&&(e=[e[0]]),Le(t,pe(e,1),[])}),bs=Kr||function(){return Pt.Date.now()},ys=We(function(t,e,i){var n=1;if(i.length){var r=j(i,Gi(ys));n=32|n}return Di(t,n,e,i,r)}),ws=We(function(t,e,i){var n=3;if(i.length){var r=j(i,Gi(ws));n=32|n}return Di(e,n,t,i,r)}),xs=We(function(t,e){return ce(t,1,e)}),Cs=We(function(t,e,i){return ce(t,Kn(e)||0,i)});En.Cache=Ft;var Ss,Ts=We(function(e,i){var n=(i=1==i.length&&Is(i[0])?a(i[0],C(Ni())):a(pe(i,1),C(Ni()))).length;return We(function(r){for(var o=-1,s=oo(r.length,n);++o<s;)r[o]=i[o].call(this,r[o]);return t(e,this,r)})}),Os=We(function(t,e){return Di(t,32,D,e,j(e,Gi(Os)))}),ks=We(function(t,e){return Di(t,64,D,e,j(e,Gi(ks)))}),$s=zi(function(t,e){return Di(t,256,D,D,D,e)}),As=ji(ye),Es=ji(function(t,e){return t>=e}),js=Te(function(){return arguments}())?Te:function(t){return zn(t)&&Ar.call(t,"callee")&&!Xr.call(t,"callee")},Is=mr.isArray,Ms=zt?C(zt):function(t){return zn(t)&&"[object ArrayBuffer]"==be(t)},Ps=to||dr,Ds=Ht?C(Ht):function(t){return zn(t)&&"[object Date]"==be(t)},Fs=Xt?C(Xt):function(t){return zn(t)&&"[object Map]"==Bo(t)},Ls=Wt?C(Wt):function(t){return zn(t)&&"[object RegExp]"==be(t)},Rs=Gt?C(Gt):function(t){return zn(t)&&"[object Set]"==Bo(t)},Bs=Nt?C(Nt):function(t){return zn(t)&&Rn(t.length)&&!!kt[be(t)]},zs=ji(je),Hs=ji(function(t,e){return t<=e}),Xs=vi(function(t,e){if(nn(e)||Mn(e))gi(e,tr(e),t);else for(var i in e)Ar.call(e,i)&&Zt(t,i,e[i])}),Ws=vi(function(t,e){gi(e,er(e),t)}),Gs=vi(function(t,e,i,n){gi(e,er(e),t,n)}),Ns=vi(function(t,e,i,n){gi(e,tr(e),t,n)}),Ys=zi(re),Us=We(function(t,e){t=wr(t);var i=-1,n=e.length;for((r=2<n?e[2]:D)&&Zi(e[0],e[1],r)&&(n=1);++i<n;)for(var r=e[i],o=er(r),s=-1,a=o.length;++s<a;){var c=o[s],l=t[c];(l===D||In(l,Or[c])&&!Ar.call(t,c))&&(t[c]=r[c])}return t}),Vs=We(function(e){return e.push(D,Li),t(Zs,D,e)}),Ks=Oi(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Ir.call(e)),t[e]=i},ar(cr)),qs=Oi(function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Ir.call(e)),Ar.call(t,e)?t[e].push(i):t[e]=[i]},Ni),Qs=We(Se),Js=vi(function(t,e,i){De(t,e,i)}),Zs=vi(function(t,e,i,n){De(t,e,i,n)}),ta=zi(function(t,e){var i={};if(null==t)return i;var n=!1;e=a(e,function(e){return e=si(e,t),n||(n=1<e.length),e}),gi(t,Xi(t),i),n&&(i=se(i,7,Ri));for(var r=e.length;r--;)Ze(i,e[r]);return i}),ea=zi(function(t,e){return null==t?{}:Re(i=t,e,function(t,e){return Zn(i,e)});var i}),ia=Pi(tr),na=Pi(er),ra=wi(function(t,e,i){return e=e.toLowerCase(),t+(i?rr(e):e)}),oa=wi(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()}),sa=wi(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()}),aa=yi("toLowerCase"),ca=wi(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}),la=wi(function(t,e,i){return t+(i?" ":"")+ha(e)}),ua=wi(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()}),ha=yi("toUpperCase"),fa=We(function(e,i){try{return t(e,D,i)}catch(t){return Dn(t)?t:new _r(t)}}),pa=zi(function(t,e){return i(e,function(e){e=ln(e),ne(t,e,ys(t[e],t))}),t}),da=Si(),ga=Si(!0),ma=We(function(t,e){return function(i){return Se(i,t,e)}}),va=We(function(t,e){return function(i){return Se(t,i,e)}}),_a=$i(a),ba=$i(n),ya=$i(h),wa=Ei(),xa=Ei(!0),Ca=ki(function(t,e){return t+e},0),Sa=Mi("ceil"),Ta=ki(function(t,e){return t/e},1),Oa=Mi("floor"),ka=ki(function(t,e){return t*e},1),$a=Mi("round"),Aa=ki(function(t,e){return t-e},0);return bt.after=function(t,e){if("function"!=typeof e)throw new Sr("Expected a function");return t=Un(t),function(){if(1>--t)return e.apply(this,arguments)}},bt.ary=kn,bt.assign=Xs,bt.assignIn=Ws,bt.assignInWith=Gs,bt.assignWith=Ns,bt.at=Ys,bt.before=$n,bt.bind=ys,bt.bindAll=pa,bt.bindKey=ws,bt.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Is(t)?t:[t]},bt.chain=xn,bt.chunk=function(t,e,i){if(e=(i?Zi(t,e,i):e===D)?1:ro(Un(e),0),!(i=null==t?0:t.length)||1>e)return[];for(var n=0,r=0,o=mr(Qr(i/e));n<i;)o[r++]=Ne(t,n,n+=e);return o},bt.compact=function(t){for(var e=-1,i=null==t?0:t.length,n=0,r=[];++e<i;){var o=t[e];o&&(r[n++]=o)}return r},bt.concat=function(){var t=arguments.length;if(!t)return[];for(var e=mr(t-1),i=arguments[0];t--;)e[t-1]=arguments[t];return c(Is(i)?di(i):[i],pe(e,1))},bt.cond=function(e){var i=null==e?0:e.length,n=Ni();return e=i?a(e,function(t){if("function"!=typeof t[1])throw new Sr("Expected a function");return[n(t[0]),t[1]]}):[],We(function(n){for(var r=-1;++r<i;){var o=e[r];if(t(o[0],this,n))return t(o[1],this,n)}})},bt.conforms=function(t){return e=se(t,1),i=tr(e),function(t){return ae(t,e,i)};var e,i},bt.constant=ar,bt.countBy=hs,bt.create=function(t,e){var i=ko(t);return null==e?i:ie(i,e)},bt.curry=function t(e,i,n){return(e=Di(e,8,D,D,D,D,D,i=n?D:i)).placeholder=t.placeholder,e},bt.curryRight=function t(e,i,n){return(e=Di(e,16,D,D,D,D,D,i=n?D:i)).placeholder=t.placeholder,e},bt.debounce=An,bt.defaults=Us,bt.defaultsDeep=Vs,bt.defer=xs,bt.delay=Cs,bt.difference=Uo,bt.differenceBy=Vo,bt.differenceWith=Ko,bt.drop=function(t,e,i){var n=null==t?0:t.length;return n?Ne(t,0>(e=i||e===D?1:Un(e))?0:e,n):[]},bt.dropRight=function(t,e,i){var n=null==t?0:t.length;return n?Ne(t,0,0>(e=n-(e=i||e===D?1:Un(e)))?0:e):[]},bt.dropRightWhile=function(t,e){return t&&t.length?ti(t,Ni(e,3),!0,!0):[]},bt.dropWhile=function(t,e){return t&&t.length?ti(t,Ni(e,3),!0):[]},bt.fill=function(t,e,i,n){var r=null==t?0:t.length;if(!r)return[];for(i&&"number"!=typeof i&&Zi(t,e,i)&&(i=0,n=r),r=t.length,0>(i=Un(i))&&(i=-i>r?0:r+i),0>(n=n===D||n>r?r:Un(n))&&(n+=r),n=i>n?0:Vn(n);i<n;)t[i++]=e;return t},bt.filter=function(t,e){return(Is(t)?r:fe)(t,Ni(e,3))},bt.flatMap=function(t,e){return pe(On(t,e),1)},bt.flatMapDeep=function(t,e){return pe(On(t,e),F)},bt.flatMapDepth=function(t,e,i){return i=i===D?1:Un(i),pe(On(t,e),i)},bt.flatten=gn,bt.flattenDeep=function(t){return null!=t&&t.length?pe(t,F):[]},bt.flattenDepth=function(t,e){return null!=t&&t.length?pe(t,e=e===D?1:Un(e)):[]},bt.flip=function(t){return Di(t,512)},bt.flow=da,bt.flowRight=ga,bt.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,n={};++e<i;){var r=t[e];n[r[0]]=r[1]}return n},bt.functions=function(t){return null==t?[]:me(t,tr(t))},bt.functionsIn=function(t){return null==t?[]:me(t,er(t))},bt.groupBy=ds,bt.initial=function(t){return null!=t&&t.length?Ne(t,0,-1):[]},bt.intersection=qo,bt.intersectionBy=Qo,bt.intersectionWith=Jo,bt.invert=Ks,bt.invertBy=qs,bt.invokeMap=gs,bt.iteratee=lr,bt.keyBy=ms,bt.keys=tr,bt.keysIn=er,bt.map=On,bt.mapKeys=function(t,e){var i={};return e=Ni(e,3),de(t,function(t,n,r){ne(i,e(t,n,r),t)}),i},bt.mapValues=function(t,e){var i={};return e=Ni(e,3),de(t,function(t,n,r){ne(i,n,e(t,n,r))}),i},bt.matches=function(t){return Me(se(t,1))},bt.matchesProperty=function(t,e){return Pe(t,se(e,1))},bt.memoize=En,bt.merge=Js,bt.mergeWith=Zs,bt.method=ma,bt.methodOf=va,bt.mixin=ur,bt.negate=jn,bt.nthArg=function(t){return t=Un(t),We(function(e){return Fe(e,t)})},bt.omit=ta,bt.omitBy=function(t,e){return ir(t,jn(Ni(e)))},bt.once=function(t){return $n(2,t)},bt.orderBy=function(t,e,i,n){return null==t?[]:(Is(e)||(e=null==e?[]:[e]),Is(i=n?D:i)||(i=null==i?[]:[i]),Le(t,e,i))},bt.over=_a,bt.overArgs=Ts,bt.overEvery=ba,bt.overSome=ya,bt.partial=Os,bt.partialRight=ks,bt.partition=vs,bt.pick=ea,bt.pickBy=ir,bt.property=fr,bt.propertyOf=function(t){return function(e){return null==t?D:ve(t,e)}},bt.pull=Zo,bt.pullAll=_n,bt.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?Be(t,e,Ni(i,2)):t},bt.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?Be(t,e,D,i):t},bt.pullAt=ts,bt.range=wa,bt.rangeRight=xa,bt.rearg=$s,bt.reject=function(t,e){return(Is(t)?r:fe)(t,jn(Ni(e,3)))},bt.remove=function(t,e){var i=[];if(!t||!t.length)return i;var n=-1,r=[],o=t.length;for(e=Ni(e,3);++n<o;){var s=t[n];e(s,n,t)&&(i.push(s),r.push(n))}return ze(t,r),i},bt.rest=function(t,e){if("function"!=typeof t)throw new Sr("Expected a function");return We(t,e=e===D?e:Un(e))},bt.reverse=bn,bt.sampleSize=function(t,e,i){return e=(i?Zi(t,e,i):e===D)?1:Un(e),(Is(t)?function(t,e){return cn(di(t),oe(e,0,t.length))}:function(t,e){var i=nr(t);return cn(i,oe(e,0,i.length))})(t,e)},bt.set=function(t,e,i){return null==t?t:Ge(t,e,i)},bt.setWith=function(t,e,i,n){return n="function"==typeof n?n:D,null==t?t:Ge(t,e,i,n)},bt.shuffle=function(t){return(Is(t)?function(t){return cn(di(t))}:function(t){return cn(nr(t))})(t)},bt.slice=function(t,e,i){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&Zi(t,e,i)?(e=0,i=n):(e=null==e?0:Un(e),i=i===D?n:Un(i)),Ne(t,e,i)):[]},bt.sortBy=_s,bt.sortedUniq=function(t){return t&&t.length?Ke(t):[]},bt.sortedUniqBy=function(t,e){return t&&t.length?Ke(t,Ni(e,2)):[]},bt.split=function(t,e,i){return i&&"number"!=typeof i&&Zi(t,e,i)&&(e=i=D),(i=i===D?4294967295:i>>>0)?(t=Qn(t))&&("string"==typeof e||null!=e&&!Ls(e))&&(!(e=Qe(e))&&St.test(t))?ai(P(t),0,i):t.split(e,i):[]},bt.spread=function(e,i){if("function"!=typeof e)throw new Sr("Expected a function");return i=null==i?0:ro(Un(i),0),We(function(n){var r=n[i];return n=ai(n,0,i),r&&c(n,r),t(e,this,n)})},bt.tail=function(t){var e=null==t?0:t.length;return e?Ne(t,1,e):[]},bt.take=function(t,e,i){return t&&t.length?Ne(t,0,0>(e=i||e===D?1:Un(e))?0:e):[]},bt.takeRight=function(t,e,i){var n=null==t?0:t.length;return n?Ne(t,0>(e=n-(e=i||e===D?1:Un(e)))?0:e,n):[]},bt.takeRightWhile=function(t,e){return t&&t.length?ti(t,Ni(e,3),!1,!0):[]},bt.takeWhile=function(t,e){return t&&t.length?ti(t,Ni(e,3)):[]},bt.tap=function(t,e){return e(t),t},bt.throttle=function(t,e,i){var n=!0,r=!0;if("function"!=typeof t)throw new Sr("Expected a function");return Bn(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),An(t,e,{leading:n,maxWait:e,trailing:r})},bt.thru=Cn,bt.toArray=Nn,bt.toPairs=ia,bt.toPairsIn=na,bt.toPath=function(t){return Is(t)?a(t,ln):Gn(t)?[t]:di(Yo(Qn(t)))},bt.toPlainObject=qn,bt.transform=function(t,e,n){var r=Is(t),o=r||Ps(t)||Bs(t);if(e=Ni(e,4),null==n){var s=t&&t.constructor;n=o?r?new s:[]:Bn(t)&&Fn(s)?ko(zr(t)):{}}return(o?i:de)(t,function(t,i,r){return e(n,t,i,r)}),n},bt.unary=function(t){return kn(t,1)},bt.union=es,bt.unionBy=is,bt.unionWith=ns,bt.uniq=function(t){return t&&t.length?Je(t):[]},bt.uniqBy=function(t,e){return t&&t.length?Je(t,Ni(e,2)):[]},bt.uniqWith=function(t,e){return e="function"==typeof e?e:D,t&&t.length?Je(t,D,e):[]},bt.unset=function(t,e){return null==t||Ze(t,e)},bt.unzip=yn,bt.unzipWith=wn,bt.update=function(t,e,i){return null==t?t:Ge(t,e,oi(i)(ve(t,e)),void 0)},bt.updateWith=function(t,e,i,n){return n="function"==typeof n?n:D,null!=t&&(t=Ge(t,e,oi(i)(ve(t,e)),n)),t},bt.values=nr,bt.valuesIn=function(t){return null==t?[]:S(t,er(t))},bt.without=rs,bt.words=sr,bt.wrap=function(t,e){return Os(oi(e),t)},bt.xor=os,bt.xorBy=ss,bt.xorWith=as,bt.zip=cs,bt.zipObject=function(t,e){return ni(t||[],e||[],Zt)},bt.zipObjectDeep=function(t,e){return ni(t||[],e||[],Ge)},bt.zipWith=ls,bt.entries=ia,bt.entriesIn=na,bt.extend=Ws,bt.extendWith=Gs,ur(bt,bt),bt.add=Ca,bt.attempt=fa,bt.camelCase=ra,bt.capitalize=rr,bt.ceil=Sa,bt.clamp=function(t,e,i){return i===D&&(i=e,e=D),i!==D&&(i=(i=Kn(i))==i?i:0),e!==D&&(e=(e=Kn(e))==e?e:0),oe(Kn(t),e,i)},bt.clone=function(t){return se(t,4)},bt.cloneDeep=function(t){return se(t,5)},bt.cloneDeepWith=function(t,e){return se(t,5,e="function"==typeof e?e:D)},bt.cloneWith=function(t,e){return se(t,4,e="function"==typeof e?e:D)},bt.conformsTo=function(t,e){return null==e||ae(t,e,tr(e))},bt.deburr=or,bt.defaultTo=function(t,e){return null==t||t!=t?e:t},bt.divide=Ta,bt.endsWith=function(t,e,i){t=Qn(t),e=Qe(e);var n=t.length;n=i=i===D?n:oe(Un(i),0,n);return 0<=(i-=e.length)&&t.slice(i,n)==e},bt.eq=In,bt.escape=function(t){return(t=Qn(t))&&N.test(t)?t.replace(W,Vt):t},bt.escapeRegExp=function(t){return(t=Qn(t))&&Z.test(t)?t.replace(J,"\\$&"):t},bt.every=function(t,e,i){var r=Is(t)?n:ue;return i&&Zi(t,e,i)&&(e=D),r(t,Ni(e,3))},bt.find=fs,bt.findIndex=pn,bt.findKey=function(t,e){return f(t,Ni(e,3),de)},bt.findLast=ps,bt.findLastIndex=dn,bt.findLastKey=function(t,e){return f(t,Ni(e,3),ge)},bt.floor=Oa,bt.forEach=Sn,bt.forEachRight=Tn,bt.forIn=function(t,e){return null==t?t:Eo(t,Ni(e,3),er)},bt.forInRight=function(t,e){return null==t?t:jo(t,Ni(e,3),er)},bt.forOwn=function(t,e){return t&&de(t,Ni(e,3))},bt.forOwnRight=function(t,e){return t&&ge(t,Ni(e,3))},bt.get=Jn,bt.gt=As,bt.gte=Es,bt.has=function(t,e){return null!=t&&Ki(t,e,we)},bt.hasIn=Zn,bt.head=mn,bt.identity=cr,bt.includes=function(t,e,i,n){return t=Mn(t)?t:nr(t),i=i&&!n?Un(i):0,n=t.length,0>i&&(i=ro(n+i,0)),Wn(t)?i<=n&&-1<t.indexOf(e,i):!!n&&-1<d(t,e,i)},bt.indexOf=function(t,e,i){var n=null==t?0:t.length;return n?(0>(i=null==i?0:Un(i))&&(i=ro(n+i,0)),d(t,e,i)):-1},bt.inRange=function(t,e,i){return e=Yn(e),i===D?(i=e,e=0):i=Yn(i),(t=Kn(t))>=oo(e,i)&&t<ro(e,i)},bt.invoke=Qs,bt.isArguments=js,bt.isArray=Is,bt.isArrayBuffer=Ms,bt.isArrayLike=Mn,bt.isArrayLikeObject=Pn,bt.isBoolean=function(t){return!0===t||!1===t||zn(t)&&"[object Boolean]"==be(t)},bt.isBuffer=Ps,bt.isDate=Ds,bt.isElement=function(t){return zn(t)&&1===t.nodeType&&!Xn(t)},bt.isEmpty=function(t){if(null==t)return!0;if(Mn(t)&&(Is(t)||"string"==typeof t||"function"==typeof t.splice||Ps(t)||Bs(t)||js(t)))return!t.length;var e=Bo(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(nn(t))return!Ee(t).length;for(var i in t)if(Ar.call(t,i))return!1;return!0},bt.isEqual=function(t,e){return Oe(t,e)},bt.isEqualWith=function(t,e,i){var n=(i="function"==typeof i?i:D)?i(t,e):D;return n===D?Oe(t,e,D,i):!!n},bt.isError=Dn,bt.isFinite=function(t){return"number"==typeof t&&eo(t)},bt.isFunction=Fn,bt.isInteger=Ln,bt.isLength=Rn,bt.isMap=Fs,bt.isMatch=function(t,e){return t===e||ke(t,e,Ui(e))},bt.isMatchWith=function(t,e,i){return i="function"==typeof i?i:D,ke(t,e,Ui(e),i)},bt.isNaN=function(t){return Hn(t)&&t!=+t},bt.isNative=function(t){if(Xo(t))throw new _r("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return $e(t)},bt.isNil=function(t){return null==t},bt.isNull=function(t){return null===t},bt.isNumber=Hn,bt.isObject=Bn,bt.isObjectLike=zn,bt.isPlainObject=Xn,bt.isRegExp=Ls,bt.isSafeInteger=function(t){return Ln(t)&&-9007199254740991<=t&&9007199254740991>=t},bt.isSet=Rs,bt.isString=Wn,bt.isSymbol=Gn,bt.isTypedArray=Bs,bt.isUndefined=function(t){return t===D},bt.isWeakMap=function(t){return zn(t)&&"[object WeakMap]"==Bo(t)},bt.isWeakSet=function(t){return zn(t)&&"[object WeakSet]"==be(t)},bt.join=function(t,e){return null==t?"":io.call(t,e)},bt.kebabCase=oa,bt.last=vn,bt.lastIndexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=n;if(i!==D&&(r=0>(r=Un(i))?ro(n+r,0):oo(r,n-1)),e==e){for(i=r+1;i--&&t[i]!==e;);t=i}else t=p(t,m,r,!0);return t},bt.lowerCase=sa,bt.lowerFirst=aa,bt.lt=zs,bt.lte=Hs,bt.max=function(t){return t&&t.length?he(t,cr,ye):D},bt.maxBy=function(t,e){return t&&t.length?he(t,Ni(e,2),ye):D},bt.mean=function(t){return v(t,cr)},bt.meanBy=function(t,e){return v(t,Ni(e,2))},bt.min=function(t){return t&&t.length?he(t,cr,je):D},bt.minBy=function(t,e){return t&&t.length?he(t,Ni(e,2),je):D},bt.stubArray=pr,bt.stubFalse=dr,bt.stubObject=function(){return{}},bt.stubString=function(){return""},bt.stubTrue=function(){return!0},bt.multiply=ka,bt.nth=function(t,e){return t&&t.length?Fe(t,Un(e)):D},bt.noConflict=function(){return Pt._===this&&(Pt._=Pr),this},bt.noop=hr,bt.now=bs,bt.pad=function(t,e,i){t=Qn(t);var n=(e=Un(e))?M(t):0;return!e||n>=e?t:Ai(Jr(e=(e-n)/2),i)+t+Ai(Qr(e),i)},bt.padEnd=function(t,e,i){t=Qn(t);var n=(e=Un(e))?M(t):0;return e&&n<e?t+Ai(e-n,i):t},bt.padStart=function(t,e,i){t=Qn(t);var n=(e=Un(e))?M(t):0;return e&&n<e?Ai(e-n,i)+t:t},bt.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),ao(Qn(t).replace(et,""),e||0)},bt.random=function(t,e,i){if(i&&"boolean"!=typeof i&&Zi(t,e,i)&&(e=i=D),i===D&&("boolean"==typeof e?(i=e,e=D):"boolean"==typeof t&&(i=t,t=D)),t===D&&e===D?(t=0,e=1):(t=Yn(t),e===D?(e=t,t=0):e=Yn(e)),t>e){var n=t;t=e,e=n}return i||t%1||e%1?(i=co(),oo(t+i*(e-t+Et("1e-"+((i+"").length-1))),e)):He(t,e)},bt.reduce=function(t,e,i){var n=Is(t)?l:y,r=3>arguments.length;return n(t,Ni(e,4),i,r,$o)},bt.reduceRight=function(t,e,i){var n=Is(t)?u:y,r=3>arguments.length;return n(t,Ni(e,4),i,r,Ao)},bt.repeat=function(t,e,i){return e=(i?Zi(t,e,i):e===D)?1:Un(e),Xe(Qn(t),e)},bt.replace=function(){var t=arguments,e=Qn(t[0]);return 3>t.length?e:e.replace(t[1],t[2])},bt.result=function(t,e,i){var n=-1,r=(e=si(e,t)).length;for(r||(r=1,t=D);++n<r;){var o=null==t?D:t[ln(e[n])];o===D&&(n=r,o=i),t=Fn(o)?o.call(t):o}return t},bt.round=$a,bt.runInContext=b,bt.sample=function(t){return(Is(t)?Qt:function(t){return Qt(nr(t))})(t)},bt.size=function(t){if(null==t)return 0;if(Mn(t))return Wn(t)?M(t):t.length;var e=Bo(t);return"[object Map]"==e||"[object Set]"==e?t.size:Ee(t).length},bt.snakeCase=ca,bt.some=function(t,e,i){var n=Is(t)?h:Ye;return i&&Zi(t,e,i)&&(e=D),n(t,Ni(e,3))},bt.sortedIndex=function(t,e){return Ue(t,e)},bt.sortedIndexBy=function(t,e,i){return Ve(t,e,Ni(i,2))},bt.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var n=Ue(t,e);if(n<i&&In(t[n],e))return n}return-1},bt.sortedLastIndex=function(t,e){return Ue(t,e,!0)},bt.sortedLastIndexBy=function(t,e,i){return Ve(t,e,Ni(i,2),!0)},bt.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var i=Ue(t,e,!0)-1;if(In(t[i],e))return i}return-1},bt.startCase=la,bt.startsWith=function(t,e,i){return t=Qn(t),i=null==i?0:oe(Un(i),0,t.length),e=Qe(e),t.slice(i,i+e.length)==e},bt.subtract=Aa,bt.sum=function(t){return t&&t.length?w(t,cr):0},bt.sumBy=function(t,e){return t&&t.length?w(t,Ni(e,2)):0},bt.template=function(t,e,i){var n=bt.templateSettings;i&&Zi(t,e,i)&&(e=D),t=Qn(t),e=Gs({},e,n,Fi);var r,o,s=tr(i=Gs({},e.imports,n.imports,Fi)),a=S(i,s),c=0;i=e.interpolate||mt;var l="__p+='";i=xr((e.escape||mt).source+"|"+i.source+"|"+(i===V?ct:mt).source+"|"+(e.evaluate||mt).source+"|$","g");var u="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";if(t.replace(i,function(e,i,n,s,a,u){return n||(n=s),l+=t.slice(c,u).replace(vt,$),i&&(r=!0,l+="'+__e("+i+")+'"),a&&(o=!0,l+="';"+a+";\n__p+='"),n&&(l+="'+((__t=("+n+"))==null?'':__t)+'"),c=u+e.length,e}),l+="';",(e=e.variable)||(l="with(obj){"+l+"}"),l=(o?l.replace(B,""):l).replace(z,"$1").replace(H,"$1;"),l="function("+(e||"obj")+"){"+(e?"":"obj||(obj={});")+"var __t,__p=''"+(r?",__e=_.escape":"")+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}",(e=fa(function(){return br(s,u+"return "+l).apply(D,a)})).source=l,Dn(e))throw e;return e},bt.times=function(t,e){if(1>(t=Un(t))||9007199254740991<t)return[];var i=4294967295,n=oo(t,4294967295);for(t-=4294967295,n=x(n,e=Ni(e));++i<t;)e(i);return n},bt.toFinite=Yn,bt.toInteger=Un,bt.toLength=Vn,bt.toLower=function(t){return Qn(t).toLowerCase()},bt.toNumber=Kn,bt.toSafeInteger=function(t){return t?oe(Un(t),-9007199254740991,9007199254740991):0===t?t:0},bt.toString=Qn,bt.toUpper=function(t){return Qn(t).toUpperCase()},bt.trim=function(t,e,i){return(t=Qn(t))&&(i||e===D)?t.replace(tt,""):t&&(e=Qe(e))?ai(t=P(t),e=O(t,i=P(e)),i=k(t,i)+1).join(""):t},bt.trimEnd=function(t,e,i){return(t=Qn(t))&&(i||e===D)?t.replace(it,""):t&&(e=Qe(e))?ai(t=P(t),0,e=k(t,P(e))+1).join(""):t},bt.trimStart=function(t,e,i){return(t=Qn(t))&&(i||e===D)?t.replace(et,""):t&&(e=Qe(e))?ai(t=P(t),e=O(t,P(e))).join(""):t},bt.truncate=function(t,e){var i=30,n="...";if(Bn(e)){var r="separator"in e?e.separator:r;i="length"in e?Un(e.length):i,n="omission"in e?Qe(e.omission):n}var o=(t=Qn(t)).length;if(St.test(t)){var s=P(t);o=s.length}if(i>=o)return t;if(1>(o=i-M(n)))return n;if(i=s?ai(s,0,o).join(""):t.slice(0,o),r===D)return i+n;if(s&&(o+=i.length-o),Ls(r)){if(t.slice(o).search(r)){var a=i;for(r.global||(r=xr(r.source,Qn(lt.exec(r))+"g")),r.lastIndex=0;s=r.exec(a);)var c=s.index;i=i.slice(0,c===D?o:c)}}else t.indexOf(Qe(r),o)!=o&&(r=i.lastIndexOf(r),-1<r&&(i=i.slice(0,r)));return i+n},bt.unescape=function(t){return(t=Qn(t))&&G.test(t)?t.replace(X,Kt):t},bt.uniqueId=function(t){var e=++Er;return Qn(t)+e},bt.upperCase=ua,bt.upperFirst=ha,bt.each=Sn,bt.eachRight=Tn,bt.first=mn,ur(bt,(Ss={},de(bt,function(t,e){Ar.call(bt.prototype,e)||(Ss[e]=t)}),Ss),{chain:!1}),bt.VERSION="4.17.10",i("bind bindKey curry curryRight partial partialRight".split(" "),function(t){bt[t].placeholder=bt}),i(["drop","take"],function(t,e){It.prototype[t]=function(i){i=i===D?1:ro(Un(i),0);var n=this.__filtered__&&!e?new It(this):this.clone();return n.__filtered__?n.__takeCount__=oo(i,n.__takeCount__):n.__views__.push({size:oo(i,4294967295),type:t+(0>n.__dir__?"Right":"")}),n},It.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),i(["filter","map","takeWhile"],function(t,e){var i=e+1,n=1==i||3==i;It.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Ni(t,3),type:i}),e.__filtered__=e.__filtered__||n,e}}),i(["head","last"],function(t,e){var i="take"+(e?"Right":"");It.prototype[t]=function(){return this[i](1).value()[0]}}),i(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");It.prototype[t]=function(){return this.__filtered__?new It(this):this[i](1)}}),It.prototype.compact=function(){return this.filter(cr)},It.prototype.find=function(t){return this.filter(t).head()},It.prototype.findLast=function(t){return this.reverse().find(t)},It.prototype.invokeMap=We(function(t,e){return"function"==typeof t?new It(this):this.map(function(i){return Se(i,t,e)})}),It.prototype.reject=function(t){return this.filter(jn(Ni(t)))},It.prototype.slice=function(t,e){t=Un(t);var i=this;return i.__filtered__&&(0<t||0>e)?new It(i):(0>t?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==D&&(i=0>(e=Un(e))?i.dropRight(-e):i.take(e-t)),i)},It.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},It.prototype.toArray=function(){return this.take(4294967295)},de(It.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),r=bt[n?"take"+("last"==e?"Right":""):e],o=n||/^find/.test(e);r&&(bt.prototype[e]=function(){function e(t){return t=r.apply(bt,c([t],a)),n&&f?t[0]:t}var s=this.__wrapped__,a=n?[1]:arguments,l=s instanceof It,u=a[0],h=l||Is(s);h&&i&&"function"==typeof u&&1!=u.length&&(l=h=!1);var f=this.__chain__,p=!!this.__actions__.length;u=o&&!f,l=l&&!p;return!o&&h?(s=l?s:new It(this),(s=t.apply(s,a)).__actions__.push({func:Cn,args:[e],thisArg:D}),new At(s,f)):u&&l?t.apply(this,a):(s=this.thru(e),u?n?s.value()[0]:s.value():s)})}),i("pop push shift sort splice unshift".split(" "),function(t){var e=Tr[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);bt.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var r=this.value();return e.apply(Is(r)?r:[],t)}return this[i](function(i){return e.apply(Is(i)?i:[],t)})}}),de(It.prototype,function(t,e){var i=bt[e];if(i){var n=i.name+"";(_o[n]||(_o[n]=[])).push({name:e,func:i})}}),_o[Ti(D,2).name]=[{name:"wrapper",func:D}],It.prototype.clone=function(){var t=new It(this.__wrapped__);return t.__actions__=di(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=di(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=di(this.__views__),t},It.prototype.reverse=function(){if(this.__filtered__){var t=new It(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t},It.prototype.value=function(){var t,e=this.__wrapped__.value(),i=this.__dir__,n=Is(e),r=0>i,o=n?e.length:0;t=o;for(var s=this.__views__,a=0,c=-1,l=s.length;++c<l;){var u=s[c],h=u.size;switch(u.type){case"drop":a+=h;break;case"dropRight":t-=h;break;case"take":t=oo(t,a+h);break;case"takeRight":a=ro(a,t-h)}}if(s=(t={start:a,end:t}).start,t=(a=t.end)-s,s=r?a:s-1,c=(a=this.__iteratees__).length,l=0,u=oo(t,this.__takeCount__),!n||!r&&o==t&&u==t)return ei(e,this.__actions__);n=[];t:for(;t--&&l<u;){for(r=-1,o=e[s+=i];++r<c;){h=(f=a[r]).type;var f=(0,f.iteratee)(o);if(2==h)o=f;else if(!f){if(1==h)continue t;break t}}n[l++]=o}return n},bt.prototype.at=us,bt.prototype.chain=function(){return xn(this)},bt.prototype.commit=function(){return new At(this.value(),this.__chain__)},bt.prototype.next=function(){this.__values__===D&&(this.__values__=Nn(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?D:this.__values__[this.__index__++]}},bt.prototype.plant=function(t){for(var e,i=this;i instanceof xt;){var n=fn(i);n.__index__=0,n.__values__=D,e?r.__wrapped__=n:e=n;var r=n;i=i.__wrapped__}return r.__wrapped__=t,e},bt.prototype.reverse=function(){var t=this.__wrapped__;return t instanceof It?(this.__actions__.length&&(t=new It(this)),(t=t.reverse()).__actions__.push({func:Cn,args:[bn],thisArg:D}),new At(t,this.__chain__)):this.thru(bn)},bt.prototype.toJSON=bt.prototype.valueOf=bt.prototype.value=function(){return ei(this.__wrapped__,this.__actions__)},bt.prototype.first=bt.prototype.head,Nr&&(bt.prototype[Nr]=function(){return this}),bt}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Pt._=qt,define(function(){return qt})):Ft?((Ft.exports=qt)._=qt,Dt._=qt):Pt._=qt}.call(this),function(t){var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.util.object.clone;if(e.CurvedText)e.warn("fabric.CurvedText is already defined");else{var n=e.Text.prototype.stateProperties.concat();n.push("radius","spacing","reverse","effect","range","largeFont","smallFont");var r=e.Text.prototype._dimensionAffectingProps.concat(["radius","spacing","reverse","fill","effect","width","height","range","fontSize","shadow","largeFont","smallFont"]),o=["backgroundColor","textBackgroundColor","textDecoration","stroke","strokeWidth","shadow","fontWeight","fontStyle","strokeWidth","textAlign"];e.CurvedText=e.util.createClass(e.Text,e.Collection,{type:"curvedText",radius:50,range:5,smallFont:10,largeFont:30,effect:"curved",spacing:20,reverse:!1,stateProperties:n,_dimensionAffectingProps:r,_isRendering:0,complexity:function(){this.callSuper("complexity")},initialize:function(t,i){i||(i={}),this.__skipDimension=!0,delete i.text,this.setOptions(i),this.__skipDimension=!1,this.callSuper("initialize",t,i),this.letters=new e.Group([],{selectable:!1,padding:0}),this.setText(t)},setText:function(t){if(this.letters){for(;this.letters.size();)this.letters.remove(this.letters.item(0));for(var i=0;i<t.length;i++)void 0===this.letters.item(i)?this.letters.add(new e.IText(t[i])):this.letters.item(i).text=t[i]}this.text=t;for(i=this.letters.size();i--;){this.letters.item(i).set({objectCaching:!1,fill:this.fill,stroke:this.stroke,strokeWidth:this.strokeWidth,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontWeight:this.fontWeight,underline:this.underline,overline:this.overline,linethrough:this.linethrough,lineHeight:this.lineHeight})}this._updateLetters(),this.canvas&&this.canvas.renderAll()},_initDimensions:function(t){if(!this.__skipDimension){t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this.text.split(this._reNewline),this._clearCache();var i=this.textAlign;this.textAlign="left",this.width=this.get("width"),this.textAlign=i,this.height=this.get("height"),this._updateLetters()}},_updateLetters:function(){var t=e.util.getRandomInt(100,999);if(this._isRendering=t,this.letters&&this.text){var i=0,n=0,r=0,s=parseInt(this.spacing),a=0;if("curved"===this.effect){for(var c=0,l=this.text.length;c<l;c++)r+=this.letters.item(c).width+s;r-=s}else"arc"===this.effect&&(a=(this.letters.item(0).fontSize+s)/this.radius/(Math.PI/180),r=(this.text.length+1)*(this.letters.item(0).fontSize+s));i=-r/2/this.radius/(Math.PI/180),this.reverse&&(i=-i);var u=0,h=this.reverse?-1:1,f=0,p=0;for(c=0,l=this.text.length;c<l;c++){if(t!==this._isRendering)return;for(var d in o)this.letters.item(c).set(d,this.get(d));if(this.letters.item(c).set("left",u),this.letters.item(c).set("top",0),this.letters.item(c).set("angle",0),this.letters.item(c).set("padding",0),"curved"===this.effect)f=(this.letters.item(c).width+s)/this.radius/(Math.PI/180),n=(i=h*(h*i+p))*(Math.PI/180),p=f,this.letters.item(c).set("angle",i),this.letters.item(c).set("top",-1*h*(Math.cos(n)*this.radius)),this.letters.item(c).set("left",h*(Math.sin(n)*this.radius)),this.letters.item(c).set("padding",0),this.letters.item(c).set("selectable",!1);else if("arc"===this.effect)n=(i=h*(h*i+a))*(Math.PI/180),this.letters.item(c).set("top",-1*h*(Math.cos(n)*this.radius)),this.letters.item(c).set("left",h*(Math.sin(n)*this.radius)),this.letters.item(c).set("padding",0),this.letters.item(c).set("selectable",!1);else if("STRAIGHT"===this.effect)this.letters.item(c).set("left",u),this.letters.item(c).set("top",0),this.letters.item(c).set("angle",0),u+=this.letters.item(c).get("width"),this.letters.item(c).set("padding",0),this.letters.item(c).set({borderColor:"red",cornerColor:"green",cornerSize:6,transparentCorners:!1}),this.letters.item(c).set("selectable",!1);else if("smallToLarge"===this.effect){var g=parseInt(this.smallFont),m=(b=parseInt(this.largeFont))-g,v=Math.ceil(this.text.length/2),_=g+c*(y=m/this.text.length);this.letters.item(c).set("fontSize",_),this.letters.item(c).set("left",u),u+=this.letters.item(c).get("width"),this.letters.item(c).set("padding",0),this.letters.item(c).set("selectable",!1),this.letters.item(c).set("top",-1*this.letters.item(c).get("fontSize")+c)}else if("largeToSmallTop"===this.effect){g=parseInt(this.largeFont),m=(b=parseInt(this.smallFont))-g,v=Math.ceil(this.text.length/2),_=g+c*(y=m/this.text.length);this.letters.item(c).set("fontSize",_),this.letters.item(c).set("left",u),u+=this.letters.item(c).get("width"),this.letters.item(c).set("padding",0),this.letters.item(c).set({borderColor:"red",cornerColor:"green",cornerSize:6,transparentCorners:!1}),this.letters.item(c).set("padding",0),this.letters.item(c).set("selectable",!1),this.letters.item(c).top=-1*this.letters.item(c).get("fontSize")+c/this.text.length}else if("largeToSmallBottom"===this.effect){g=parseInt(this.largeFont),m=(b=parseInt(this.smallFont))-g,v=Math.ceil(this.text.length/2),_=g+c*(y=m/this.text.length);this.letters.item(c).set("fontSize",_),this.letters.item(c).set("left",u),u+=this.letters.item(c).get("width"),this.letters.item(c).set("padding",0),this.letters.item(c).set({borderColor:"red",cornerColor:"green",cornerSize:6,transparentCorners:!1}),this.letters.item(c).set("padding",0),this.letters.item(c).set("selectable",!1),this.letters.item(c).top=-1*this.letters.item(c).get("fontSize")-c}else if("bulge"===this.effect){g=parseInt(this.smallFont),m=(b=parseInt(this.largeFont))-g,v=Math.ceil(this.text.length/2);var b,y=m/(this.text.length-v);if(c<v)_=g+c*y;else _=b-(c-v+1)*y;this.letters.item(c).set("fontSize",_),this.letters.item(c).set("left",u),u+=this.letters.item(c).get("width"),this.letters.item(c).set("padding",0),this.letters.item(c).set("selectable",!1),this.letters.item(c).set("top",-1*this.letters.item(c).get("height")/2)}}var w=this.letters.get("scaleX"),x=this.letters.get("scaleY"),C=this.letters.get("angle");this.letters.set("scaleX",1),this.letters.set("scaleY",1),this.letters.set("angle",0),this.letters._calcBounds(),this.letters._updateObjectsCoords(),this.letters.set("scaleX",w),this.letters.set("scaleY",x),this.letters.set("angle",C),this.width=this.letters.width,this.height=this.letters.height,this.letters.left=-this.letters.width/2,this.letters.top=-this.letters.height/2}},render:function(t){if(this.visible&&this.letters){t.save(),this.transform(t);Math.max(this.scaleX,this.scaleY);this.clipTo&&e.util.clipContext(this,t);for(var i=0,n=this.letters.size();i<n;i++){var r=this.letters.item(i);r.borderScaleFactor,r.hasRotatingPoint;r.visible&&r.render(t)}this.clipTo&&t.restore(),t.restore(),this.setCoords()}},_set:function(t,e){if("text"!==t){if(this.callSuper("_set",t,e),this.text&&this.letters){if(-1===["angle","left","top","scaleX","scaleY","width","height"].indexOf(t))for(var i=this.letters.size();i--;)this.letters.item(i).set(t,e);-1!==this._dimensionAffectingProps.indexOf(t)&&(this._updateLetters(),this.setCoords())}}else this.setText(e)},initDimensions:function(){},toObject:function(t){var e=i(this.callSuper("toObject",t),{radius:this.radius,spacing:this.spacing,reverse:this.reverse,effect:this.effect,range:this.range,smallFont:this.smallFont,largeFont:this.largeFont,rtl:this.rtl});return this.includeDefaultValues||this._removeDefaultValues(e),e},toString:function(){return"#<fabric.CurvedText ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'", "radius": "'+this.radius+'", "spacing": "'+this.spacing+'", "reverse": "'+this.reverse+'" }>'},toSVG:function(t){var e=["<g ",'transform="',this.getSvgTransform(),'">'];if(this.letters)for(var i=0,n=this.letters.size();i<n;i++)e.push(this.letters.item(i).toSVG(t));return e.push("</g>"),t?t(e.join("")):e.join("")}}),e.CurvedText.fromObject=function(t,i){return e.Object._fromObject("CurvedText",t,i,"text")},e.CurvedText.async=!1}}("undefined"!=typeof exports?exports:this),function(t){t.attrFn=t.attrFn||{};var e="ontouchstart"in window,i={tap_pixel_range:5,swipe_h_threshold:50,swipe_v_threshold:50,taphold_threshold:750,doubletap_int:500,shake_threshold:15,touch_capable:e,orientation_support:"orientation"in window&&"onorientationchange"in window,startevent:e?"touchstart":"mousedown",endevent:e?"touchend":"mouseup",moveevent:e?"touchmove":"mousemove",tapevent:e?"tap":"click",scrollevent:e?"touchmove":"scroll",hold_timer:null,tap_timer:null};t.touch={},t.isTouchCapable=function(){return i.touch_capable},t.getStartEvent=function(){return i.startevent},t.getEndEvent=function(){return i.endevent},t.getMoveEvent=function(){return i.moveevent},t.getTapEvent=function(){return i.tapevent},t.getScrollEvent=function(){return i.scrollevent},t.touch.setSwipeThresholdX=function(t){if("number"!=typeof t)throw new Error("Threshold parameter must be a type of number");i.swipe_h_threshold=t},t.touch.setSwipeThresholdY=function(t){if("number"!=typeof t)throw new Error("Threshold parameter must be a type of number");i.swipe_v_threshold=t},t.touch.setDoubleTapInt=function(t){if("number"!=typeof t)throw new Error("Interval parameter must be a type of number");i.doubletap_int=t},t.touch.setTapHoldThreshold=function(t){if("number"!=typeof t)throw new Error("Threshold parameter must be a type of number");i.taphold_threshold=t},t.touch.setTapRange=function(t){if("number"!=typeof t)throw new Error("Ranger parameter must be a type of number");i.tap_pixel_range=threshold},t.each(["tapstart","tapend","tapmove","tap","singletap","doubletap","taphold","swipe","swipeup","swiperight","swipedown","swipeleft","swipeend","scrollstart","scrollend","orientationchange","tap2","taphold2"],function(e,i){t.fn[i]=function(t){return t?this.on(i,t):this.trigger(i)},t.attrFn[i]=!0}),t.event.special.tapstart={setup:function(){var e=this,n=t(e);n.on(i.startevent,function t(r){if(n.data("callee",t),r.which&&1!==r.which)return!1;var o=r.originalEvent,s={position:{x:i.touch_capable?o.touches[0].pageX:r.pageX,y:i.touch_capable?o.touches[0].pageY:r.pageY},offset:{x:i.touch_capable?Math.round(o.changedTouches[0].pageX-(n.offset()?n.offset().left:0)):Math.round(r.pageX-(n.offset()?n.offset().left:0)),y:i.touch_capable?Math.round(o.changedTouches[0].pageY-(n.offset()?n.offset().top:0)):Math.round(r.pageY-(n.offset()?n.offset().top:0))},time:Date.now(),target:r.target};return v(e,"tapstart",r,s),!0})},remove:function(){t(this).off(i.startevent,t(this).data.callee)}},t.event.special.tapmove={setup:function(){var e=this,n=t(e);n.on(i.moveevent,function t(r){n.data("callee",t);var o=r.originalEvent,s={position:{x:i.touch_capable?o.touches[0].pageX:r.pageX,y:i.touch_capable?o.touches[0].pageY:r.pageY},offset:{x:i.touch_capable?Math.round(o.changedTouches[0].pageX-(n.offset()?n.offset().left:0)):Math.round(r.pageX-(n.offset()?n.offset().left:0)),y:i.touch_capable?Math.round(o.changedTouches[0].pageY-(n.offset()?n.offset().top:0)):Math.round(r.pageY-(n.offset()?n.offset().top:0))},time:Date.now(),target:r.target};return v(e,"tapmove",r,s),!0})},remove:function(){t(this).off(i.moveevent,t(this).data.callee)}},t.event.special.tapend={setup:function(){var e=this,n=t(e);n.on(i.endevent,function t(r){n.data("callee",t);var o=r.originalEvent,s={position:{x:i.touch_capable?o.changedTouches[0].pageX:r.pageX,y:i.touch_capable?o.changedTouches[0].pageY:r.pageY},offset:{x:i.touch_capable?Math.round(o.changedTouches[0].pageX-(n.offset()?n.offset().left:0)):Math.round(r.pageX-(n.offset()?n.offset().left:0)),y:i.touch_capable?Math.round(o.changedTouches[0].pageY-(n.offset()?n.offset().top:0)):Math.round(r.pageY-(n.offset()?n.offset().top:0))},time:Date.now(),target:r.target};return v(e,"tapend",r,s),!0})},remove:function(){t(this).off(i.endevent,t(this).data.callee)}},t.event.special.taphold={setup:function(){var e,n=this,r=t(n),o={x:0,y:0},s=0,a=0;r.on(i.startevent,function t(c){if(c.which&&1!==c.which)return!1;r.data("tapheld",!1),e=c.target;var l=c.originalEvent,u=Date.now();i.touch_capable?l.touches[0].pageX:c.pageX,i.touch_capable?l.touches[0].pageY:c.pageY,i.touch_capable?(l.touches[0].pageX,l.touches[0].target.offsetLeft):c.offsetX,i.touch_capable?(l.touches[0].pageY,l.touches[0].target.offsetTop):c.offsetY,o.x=c.originalEvent.targetTouches?c.originalEvent.targetTouches[0].pageX:c.pageX,o.y=c.originalEvent.targetTouches?c.originalEvent.targetTouches[0].pageY:c.pageY,s=o.x,a=o.y;var h=r.parent().data("threshold")?r.parent().data("threshold"):r.data("threshold"),f=void 0!==h&&!1!==h&&parseInt(h)?parseInt(h):i.taphold_threshold;return i.hold_timer=window.setTimeout(function(){var h=o.x-s,f=o.y-a;if(c.target==e&&(o.x==s&&o.y==a||h>=-i.tap_pixel_range&&h<=i.tap_pixel_range&&f>=-i.tap_pixel_range&&f<=i.tap_pixel_range)){r.data("tapheld",!0);for(var p=Date.now()-u,d=c.originalEvent.targetTouches?c.originalEvent.targetTouches:[c],g=[],m=0;m<d.length;m++){var _={position:{x:i.touch_capable?l.changedTouches[m].pageX:c.pageX,y:i.touch_capable?l.changedTouches[m].pageY:c.pageY},offset:{x:i.touch_capable?Math.round(l.changedTouches[m].pageX-(r.offset()?r.offset().left:0)):Math.round(c.pageX-(r.offset()?r.offset().left:0)),y:i.touch_capable?Math.round(l.changedTouches[m].pageY-(r.offset()?r.offset().top:0)):Math.round(c.pageY-(r.offset()?r.offset().top:0))},time:Date.now(),target:c.target,duration:p};g.push(_)}var b=2==d.length?"taphold2":"taphold";r.data("callee1",t),v(n,b,c,g)}},f),!0}).on(i.endevent,function t(){r.data("callee2",t),r.data("tapheld",!1),window.clearTimeout(i.hold_timer)}).on(i.moveevent,function t(e){r.data("callee3",t),s=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX,a=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY})},remove:function(){t(this).off(i.startevent,t(this).data.callee1).off(i.endevent,t(this).data.callee2).off(i.moveevent,t(this).data.callee3)}},t.event.special.doubletap={setup:function(){var e,n,r=this,o=t(r),s=null,a=!1;o.on(i.startevent,function e(r){return!(r.which&&1!==r.which||(o.data("doubletapped",!1),r.target,o.data("callee1",e),n=r.originalEvent,s||(s={position:{x:i.touch_capable?n.touches[0].pageX:r.pageX,y:i.touch_capable?n.touches[0].pageY:r.pageY},offset:{x:i.touch_capable?Math.round(n.changedTouches[0].pageX-(o.offset()?o.offset().left:0)):Math.round(r.pageX-(o.offset()?o.offset().left:0)),y:i.touch_capable?Math.round(n.changedTouches[0].pageY-(o.offset()?o.offset().top:0)):Math.round(r.pageY-(o.offset()?o.offset().top:0))},time:Date.now(),target:r.target,element:r.originalEvent.srcElement,index:t(r.target).index()}),0))}).on(i.endevent,function c(l){var u=Date.now(),h=u-(o.data("lastTouch")||u+1);if(window.clearTimeout(e),o.data("callee2",c),h<i.doubletap_int&&t(l.target).index()==s.index&&h>100){o.data("doubletapped",!0),window.clearTimeout(i.tap_timer);var f={position:{x:i.touch_capable?l.originalEvent.changedTouches[0].pageX:l.pageX,y:i.touch_capable?l.originalEvent.changedTouches[0].pageY:l.pageY},offset:{x:i.touch_capable?Math.round(n.changedTouches[0].pageX-(o.offset()?o.offset().left:0)):Math.round(l.pageX-(o.offset()?o.offset().left:0)),y:i.touch_capable?Math.round(n.changedTouches[0].pageY-(o.offset()?o.offset().top:0)):Math.round(l.pageY-(o.offset()?o.offset().top:0))},time:Date.now(),target:l.target,element:l.originalEvent.srcElement,index:t(l.target).index()},p={firstTap:s,secondTap:f,interval:f.time-s.time};a||(v(r,"doubletap",l,p),s=null),a=!0,window.setTimeout(function(){a=!1},i.doubletap_int)}else o.data("lastTouch",u),e=window.setTimeout(function(){s=null,window.clearTimeout(e)},i.doubletap_int,[l]);o.data("lastTouch",u)})},remove:function(){t(this).off(i.startevent,t(this).data.callee1).off(i.endevent,t(this).data.callee2)}},t.event.special.singletap={setup:function(){var e=this,n=t(e),r=null,o=null,s={x:0,y:0};n.on(i.startevent,function t(e){return!(e.which&&1!==e.which||(o=Date.now(),r=e.target,n.data("callee1",t),s.x=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX,s.y=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY,0))}).on(i.endevent,function t(a){if(n.data("callee2",t),a.target==r){var c=a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageX:a.pageX,l=a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageY:a.pageY;i.tap_timer=window.setTimeout(function(){var t=s.x-c,r=s.y-l;if(!n.data("doubletapped")&&!n.data("tapheld")&&(s.x==c&&s.y==l||t>=-i.tap_pixel_range&&t<=i.tap_pixel_range&&r>=-i.tap_pixel_range&&r<=i.tap_pixel_range)){var u=a.originalEvent,h={position:{x:i.touch_capable?u.changedTouches[0].pageX:a.pageX,y:i.touch_capable?u.changedTouches[0].pageY:a.pageY},offset:{x:i.touch_capable?Math.round(u.changedTouches[0].pageX-(n.offset()?n.offset().left:0)):Math.round(a.pageX-(n.offset()?n.offset().left:0)),y:i.touch_capable?Math.round(u.changedTouches[0].pageY-(n.offset()?n.offset().top:0)):Math.round(a.pageY-(n.offset()?n.offset().top:0))},time:Date.now(),target:a.target};h.time-o<i.taphold_threshold&&v(e,"singletap",a,h)}},i.doubletap_int)}})},remove:function(){t(this).off(i.startevent,t(this).data.callee1).off(i.endevent,t(this).data.callee2)}},t.event.special.tap={setup:function(){var e,n,r=this,o=t(r),s=!1,a=null,c={x:0,y:0};o.on(i.startevent,function t(i){return o.data("callee1",t),!(i.which&&1!==i.which||(s=!0,c.x=i.originalEvent.targetTouches?i.originalEvent.targetTouches[0].pageX:i.pageX,c.y=i.originalEvent.targetTouches?i.originalEvent.targetTouches[0].pageY:i.pageY,e=Date.now(),a=i.target,n=i.originalEvent.targetTouches?i.originalEvent.targetTouches:[i],0))}).on(i.endevent,function t(l){o.data("callee2",t);var u=l.originalEvent.targetTouches?l.originalEvent.changedTouches[0].pageX:l.pageX,h=l.originalEvent.targetTouches?l.originalEvent.changedTouches[0].pageY:l.pageY,f=c.x-u,p=c.y-h;if(a==l.target&&s&&Date.now()-e<i.taphold_threshold&&(c.x==u&&c.y==h||f>=-i.tap_pixel_range&&f<=i.tap_pixel_range&&p>=-i.tap_pixel_range&&p<=i.tap_pixel_range)){for(var d=l.originalEvent,g=[],m=0;m<n.length;m++){var _={position:{x:i.touch_capable?d.changedTouches[m].pageX:l.pageX,y:i.touch_capable?d.changedTouches[m].pageY:l.pageY},offset:{x:i.touch_capable?Math.round(d.changedTouches[m].pageX-(o.offset()?o.offset().left:0)):Math.round(l.pageX-(o.offset()?o.offset().left:0)),y:i.touch_capable?Math.round(d.changedTouches[m].pageY-(o.offset()?o.offset().top:0)):Math.round(l.pageY-(o.offset()?o.offset().top:0))},time:Date.now(),target:l.target};g.push(_)}var b=2==n.length?"tap2":"tap";v(r,b,l,g)}})},remove:function(){t(this).off(i.startevent,t(this).data.callee1).off(i.endevent,t(this).data.callee2)}},t.event.special.swipe={setup:function(){var e,n=t(this),r=!1,o=!1,s={x:0,y:0},a={x:0,y:0};n.on(i.startevent,function o(c){(n=t(c.currentTarget)).data("callee1",o),s.x=c.originalEvent.targetTouches?c.originalEvent.targetTouches[0].pageX:c.pageX,s.y=c.originalEvent.targetTouches?c.originalEvent.targetTouches[0].pageY:c.pageY,a.x=s.x,a.y=s.y,r=!0;var l=c.originalEvent;e={position:{x:i.touch_capable?l.touches[0].pageX:c.pageX,y:i.touch_capable?l.touches[0].pageY:c.pageY},offset:{x:i.touch_capable?Math.round(l.changedTouches[0].pageX-(n.offset()?n.offset().left:0)):Math.round(c.pageX-(n.offset()?n.offset().left:0)),y:i.touch_capable?Math.round(l.changedTouches[0].pageY-(n.offset()?n.offset().top:0)):Math.round(c.pageY-(n.offset()?n.offset().top:0))},time:Date.now(),target:c.target}}),n.on(i.moveevent,function c(l){var u;(n=t(l.currentTarget)).data("callee2",c),a.x=l.originalEvent.targetTouches?l.originalEvent.targetTouches[0].pageX:l.pageX,a.y=l.originalEvent.targetTouches?l.originalEvent.targetTouches[0].pageY:l.pageY;var h=n.parent().data("xthreshold")?n.parent().data("xthreshold"):n.data("xthreshold"),f=n.parent().data("ythreshold")?n.parent().data("ythreshold"):n.data("ythreshold"),p=void 0!==h&&!1!==h&&parseInt(h)?parseInt(h):i.swipe_h_threshold,d=void 0!==f&&!1!==f&&parseInt(f)?parseInt(f):i.swipe_v_threshold;if(s.y>a.y&&s.y-a.y>d&&(u="swipeup"),s.x<a.x&&a.x-s.x>p&&(u="swiperight"),s.y<a.y&&a.y-s.y>d&&(u="swipedown"),s.x>a.x&&s.x-a.x>p&&(u="swipeleft"),void 0!=u&&r){s.x=0,s.y=0,a.x=0,a.y=0,r=!1;var g=l.originalEvent,m={position:{x:i.touch_capable?g.touches[0].pageX:l.pageX,y:i.touch_capable?g.touches[0].pageY:l.pageY},offset:{x:i.touch_capable?Math.round(g.changedTouches[0].pageX-(n.offset()?n.offset().left:0)):Math.round(l.pageX-(n.offset()?n.offset().left:0)),y:i.touch_capable?Math.round(g.changedTouches[0].pageY-(n.offset()?n.offset().top:0)):Math.round(l.pageY-(n.offset()?n.offset().top:0))},time:Date.now(),target:l.target},v=Math.abs(e.position.x-m.position.x),_=Math.abs(e.position.y-m.position.y),b={startEvnt:e,endEvnt:m,direction:u.replace("swipe",""),xAmount:v,yAmount:_,duration:m.time-e.time};o=!0,n.trigger("swipe",b).trigger(u,b)}}),n.on(i.endevent,function s(a){var c="";if((n=t(a.currentTarget)).data("callee3",s),o){var l=n.data("xthreshold"),u=n.data("ythreshold"),h=void 0!==l&&!1!==l&&parseInt(l)?parseInt(l):i.swipe_h_threshold,f=void 0!==u&&!1!==u&&parseInt(u)?parseInt(u):i.swipe_v_threshold,p=a.originalEvent,d={position:{x:i.touch_capable?p.changedTouches[0].pageX:a.pageX,y:i.touch_capable?p.changedTouches[0].pageY:a.pageY},offset:{x:i.touch_capable?Math.round(p.changedTouches[0].pageX-(n.offset()?n.offset().left:0)):Math.round(a.pageX-(n.offset()?n.offset().left:0)),y:i.touch_capable?Math.round(p.changedTouches[0].pageY-(n.offset()?n.offset().top:0)):Math.round(a.pageY-(n.offset()?n.offset().top:0))},time:Date.now(),target:a.target};e.position.y>d.position.y&&e.position.y-d.position.y>f&&(c="swipeup"),e.position.x<d.position.x&&d.position.x-e.position.x>h&&(c="swiperight"),e.position.y<d.position.y&&d.position.y-e.position.y>f&&(c="swipedown"),e.position.x>d.position.x&&e.position.x-d.position.x>h&&(c="swipeleft");var g=Math.abs(e.position.x-d.position.x),m=Math.abs(e.position.y-d.position.y),v={startEvnt:e,endEvnt:d,direction:c.replace("swipe",""),xAmount:g,yAmount:m,duration:d.time-e.time};n.trigger("swipeend",v)}r=!1,o=!1})},remove:function(){t(this).off(i.startevent,t(this).data.callee1).off(i.moveevent,t(this).data.callee2).off(i.endevent,t(this).data.callee3)}},t.event.special.scrollstart={setup:function(){var e,n,r=this,o=t(r);function s(t,i){v(r,(e=i)?"scrollstart":"scrollend",t)}o.on(i.scrollevent,function t(i){o.data("callee",t),e||s(i,!0),clearTimeout(n),n=setTimeout(function(){s(i,!1)},50)})},remove:function(){t(this).off(i.scrollevent,t(this).data.callee)}};var n,r,o,s,a=t(window),c={0:!0,180:!0};if(i.orientation_support){var l=window.innerWidth||a.width(),u=window.innerHeight||a.height();o=l>u&&l-u>50,s=c[window.orientation],(o&&s||!o&&!s)&&(c={"-90":!0,90:!0})}function h(){var t=n();t!==r&&(r=t,a.trigger("orientationchange"))}t.event.special.orientationchange={setup:function(){return!i.orientation_support&&(r=n(),a.on("throttledresize",h),!0)},teardown:function(){return!i.orientation_support&&(a.off("throttledresize",h),!0)},add:function(t){var e=t.handler;t.handler=function(t){return t.orientation=n(),e.apply(this,arguments)}}},t.event.special.orientationchange.orientation=n=function(){var t=document.documentElement;return(i.orientation_support?c[window.orientation]:t&&t.clientWidth/t.clientHeight<1.1)?"portrait":"landscape"},t.event.special.throttledresize={setup:function(){t(this).on("resize",g)},teardown:function(){t(this).off("resize",g)}};var f,p,d,g=function(){p=Date.now(),(d=p-m)>=250?(m=p,t(this).trigger("throttledresize")):(f&&window.clearTimeout(f),f=window.setTimeout(h,250-d))},m=0;function v(e,i,n,r){var o=n.type;n.type=i,t.event.dispatch.call(e,n,r),n.type=o}t.each({scrollend:"scrollstart",swipeup:"swipe",swiperight:"swipe",swipedown:"swipe",swipeleft:"swipe",swipeend:"swipe",tap2:"tap",taphold2:"taphold"},function(e,i){t.event.special[e]={setup:function(){t(this).on(i,t.noop)}}})}(jQuery),function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}("undefined"!=typeof window?window:this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{};return(i[t]=i[t]||{})[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){i=i.slice(0),e=e||[];for(var n=this._onceEvents&&this._onceEvents[t],r=0;r<i.length;r++){var o=i[r];n&&n[o]&&(this.off(t,o),delete n[o]),o.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter")):t.imagesLoaded=e(t,t.EvEmitter)}("undefined"!=typeof window?window:this,function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}function n(t,e,r){if(!(this instanceof n))return new n(t,e,r);var o,l=t;return"string"==typeof t&&(l=document.querySelectorAll(t)),l?(this.elements=(o=l,Array.isArray(o)?o:"object"==typeof o&&"number"==typeof o.length?c.call(o):[o]),this.options=i({},this.options),"function"==typeof e?r=e:i(this.options,e),r&&this.on("always",r),this.getImages(),s&&(this.jqDeferred=new s.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(l||t))}function r(t){this.img=t}function o(t,e){this.url=t,this.element=e,this.img=new Image}var s=t.jQuery,a=t.console,c=Array.prototype.slice;n.prototype=Object.create(e.prototype),n.prototype.options={},n.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},n.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),!0===this.options.background&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&l[e]){for(var i=t.querySelectorAll("img"),n=0;n<i.length;n++){var r=i[n];this.addImage(r)}if("string"==typeof this.options.background){var o=t.querySelectorAll(this.options.background);for(n=0;n<o.length;n++){var s=o[n];this.addElementBackgroundImages(s)}}}};var l={1:!0,9:!0,11:!0};return n.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(e.backgroundImage);null!==n;){var r=n&&n[2];r&&this.addBackground(r,t),n=i.exec(e.backgroundImage)}},n.prototype.addImage=function(t){var e=new r(t);this.images.push(e)},n.prototype.addBackground=function(t,e){var i=new o(t,e);this.images.push(i)},n.prototype.check=function(){function t(t,i,n){setTimeout(function(){e.progress(t,i,n)})}var e=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(e){e.once("progress",t),e.check()}):void this.complete()},n.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,t,e)},n.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},r.prototype=Object.create(e.prototype),r.prototype.check=function(){return this.getIsImageComplete()?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},r.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},o.prototype=Object.create(r.prototype),o.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},o.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},o.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},n.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((s=e).fn.imagesLoaded=function(t,e){return new n(this,t,e).jqDeferred.promise(s(this))})},n.makeJQueryPlugin(),n}),function(t,e){"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("jquery")):t.jQueryBridget=e(t,t.jQuery)}(window,function(t,e){"use strict";function i(i,o,a){(a=a||e||t.jQuery)&&(o.prototype.option||(o.prototype.option=function(t){a.isPlainObject(t)&&(this.options=a.extend(!0,this.options,t))}),a.fn[i]=function(t){if("string"==typeof t){var e=r.call(arguments,1);return l=e,h="$()."+i+'("'+(c=t)+'")',(n=this).each(function(t,e){var n=a.data(e,i);if(n){var r=n[c];if(r&&"_"!=c.charAt(0)){var o=r.apply(n,l);u=void 0===u?o:u}else s(h+" is not a valid method")}else s(i+" not initialized. Cannot call methods, i.e. "+h)}),void 0!==u?u:n}var n,c,l,u,h,f;return f=t,this.each(function(t,e){var n=a.data(e,i);n?(n.option(f),n._init()):(n=new o(e,f),a.data(e,i,n))}),this},n(a))}function n(t){!t||t&&t.bridget||(t.bridget=i)}var r=Array.prototype.slice,o=t.console,s=void 0===o?function(){}:function(t){o.error(t)};return n(e||t.jQuery),i}),function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}("undefined"!=typeof window?window:this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{};return(i[t]=i[t]||{})[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){i=i.slice(0),e=e||[];for(var n=this._onceEvents&&this._onceEvents[t],r=0;r<i.length;r++){var o=i[r];n&&n[o]&&(this.off(t,o),delete n[o]),o.apply(this,e)}return this}},e.allOff=function(){delete this._events,delete this._onceEvents},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return e()}):"object"==typeof module&&module.exports?module.exports=e():t.getSize=e()}(window,function(){"use strict";function t(t){var e=parseFloat(t);return-1==t.indexOf("%")&&!isNaN(e)&&e}function e(t){var e=getComputedStyle(t);return e||r("Style returned "+e+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),e}function i(r){if(function(){if(!a){a=!0;var r=document.createElement("div");r.style.width="200px",r.style.padding="1px 2px 3px 4px",r.style.borderStyle="solid",r.style.borderWidth="1px 2px 3px 4px",r.style.boxSizing="border-box";var o=document.body||document.documentElement;o.appendChild(r);var s=e(r);i.isBoxSizeOuter=n=200==t(s.width),o.removeChild(r)}}(),"string"==typeof r&&(r=document.querySelector(r)),r&&"object"==typeof r&&r.nodeType){var c=e(r);if("none"==c.display)return function(){for(var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},e=0;s>e;e++)t[o[e]]=0;return t}();var l={};l.width=r.offsetWidth,l.height=r.offsetHeight;for(var u=l.isBorderBox="border-box"==c.boxSizing,h=0;s>h;h++){var f=o[h],p=c[f],d=parseFloat(p);l[f]=isNaN(d)?0:d}var g=l.paddingLeft+l.paddingRight,m=l.paddingTop+l.paddingBottom,v=l.marginLeft+l.marginRight,_=l.marginTop+l.marginBottom,b=l.borderLeftWidth+l.borderRightWidth,y=l.borderTopWidth+l.borderBottomWidth,w=u&&n,x=t(c.width);!1!==x&&(l.width=x+(w?0:g+b));var C=t(c.height);return!1!==C&&(l.height=C+(w?0:m+y)),l.innerWidth=l.width-(g+b),l.innerHeight=l.height-(m+y),l.outerWidth=l.width+v,l.outerHeight=l.height+_,l}}var n,r="undefined"==typeof console?function(){}:function(t){console.error(t)},o=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],s=o.length,a=!1;return i}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("desandro-matches-selector/matches-selector",e):"object"==typeof module&&module.exports?module.exports=e():t.matchesSelector=e()}(window,function(){"use strict";var t=function(){var t=window.Element.prototype;if(t.matches)return"matches";if(t.matchesSelector)return"matchesSelector";for(var e=["webkit","moz","ms","o"],i=0;i<e.length;i++){var n=e[i]+"MatchesSelector";if(t[n])return n}}();return function(e,i){return e[t](i)}}),function(t,e){"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("desandro-matches-selector")):t.fizzyUIUtils=e(t,t.matchesSelector)}(window,function(t,e){var i={extend:function(t,e){for(var i in e)t[i]=e[i];return t},modulo:function(t,e){return(t%e+e)%e},makeArray:function(t){var e=[];if(Array.isArray(t))e=t;else if(t&&"object"==typeof t&&"number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e},removeFrom:function(t,e){var i=t.indexOf(e);-1!=i&&t.splice(i,1)},getParent:function(t,i){for(;t.parentNode&&t!=document.body;)if(t=t.parentNode,e(t,i))return t},getQueryElement:function(t){return"string"==typeof t?document.querySelector(t):t},handleEvent:function(t){var e="on"+t.type;this[e]&&this[e](t)},filterFindElements:function(t,n){var r=[];return(t=i.makeArray(t)).forEach(function(t){if(t instanceof HTMLElement){if(!n)return void r.push(t);e(t,n)&&r.push(t);for(var i=t.querySelectorAll(n),o=0;o<i.length;o++)r.push(i[o])}}),r},debounceMethod:function(t,e,i){var n=t.prototype[e],r=e+"Timeout";t.prototype[e]=function(){var t=this[r];t&&clearTimeout(t);var e=arguments,o=this;this[r]=setTimeout(function(){n.apply(o,e),delete o[r]},i||100)}},docReady:function(t){var e=document.readyState;"complete"==e||"interactive"==e?setTimeout(t):document.addEventListener("DOMContentLoaded",t)},toDashed:function(t){return t.replace(/(.)([A-Z])/g,function(t,e,i){return e+"-"+i}).toLowerCase()}},n=t.console;return i.htmlInit=function(e,r){i.docReady(function(){var o=i.toDashed(r),s="data-"+o,a=document.querySelectorAll("["+s+"]"),c=document.querySelectorAll(".js-"+o),l=i.makeArray(a).concat(i.makeArray(c)),u=s+"-options",h=t.jQuery;l.forEach(function(t){var i,o=t.getAttribute(s)||t.getAttribute(u);try{i=o&&JSON.parse(o)}catch(e){return void(n&&n.error("Error parsing "+s+" on "+t.className+": "+e))}var a=new e(t,i);h&&h.data(t,r,a)})})},i}),function(t,e){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],e):"object"==typeof module&&module.exports?module.exports=e(require("ev-emitter"),require("get-size")):(t.Outlayer={},t.Outlayer.Item=e(t.EvEmitter,t.getSize))}(window,function(t,e){"use strict";function i(t,e){t&&(this.element=t,this.layout=e,this.position={x:0,y:0},this._create())}var n=document.documentElement.style,r="string"==typeof n.transition?"transition":"WebkitTransition",o="string"==typeof n.transform?"transform":"WebkitTransform",s={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[r],a={transform:o,transition:r,transitionDuration:r+"Duration",transitionProperty:r+"Property",transitionDelay:r+"Delay"},c=i.prototype=Object.create(t.prototype);c.constructor=i,c._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},c.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},c.getSize=function(){this.size=e(this.element)},c.css=function(t){var e=this.element.style;for(var i in t){e[a[i]||i]=t[i]}},c.getPosition=function(){var t=getComputedStyle(this.element),e=this.layout._getOption("originLeft"),i=this.layout._getOption("originTop"),n=t[e?"left":"right"],r=t[i?"top":"bottom"],o=this.layout.size,s=-1!=n.indexOf("%")?parseFloat(n)/100*o.width:parseInt(n,10),a=-1!=r.indexOf("%")?parseFloat(r)/100*o.height:parseInt(r,10);s=isNaN(s)?0:s,a=isNaN(a)?0:a,s-=e?o.paddingLeft:o.paddingRight,a-=i?o.paddingTop:o.paddingBottom,this.position.x=s,this.position.y=a},c.layoutPosition=function(){var t=this.layout.size,e={},i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop"),r=i?"paddingLeft":"paddingRight",o=i?"left":"right",s=i?"right":"left",a=this.position.x+t[r];e[o]=this.getXValue(a),e[s]="";var c=n?"paddingTop":"paddingBottom",l=n?"top":"bottom",u=n?"bottom":"top",h=this.position.y+t[c];e[l]=this.getYValue(h),e[u]="",this.css(e),this.emitEvent("layout",[this])},c.getXValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!e?t/this.layout.size.width*100+"%":t+"px"},c.getYValue=function(t){var e=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&e?t/this.layout.size.height*100+"%":t+"px"},c._transitionTo=function(t,e){this.getPosition();var i=this.position.x,n=this.position.y,r=parseInt(t,10),o=parseInt(e,10),s=r===this.position.x&&o===this.position.y;if(this.setPosition(t,e),!s||this.isTransitioning){var a=t-i,c=e-n,l={};l.transform=this.getTranslate(a,c),this.transition({to:l,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})}else this.layoutPosition()},c.getTranslate=function(t,e){var i=this.layout._getOption("originLeft"),n=this.layout._getOption("originTop");return"translate3d("+(t=i?t:-t)+"px, "+(e=n?e:-e)+"px, 0)"},c.goTo=function(t,e){this.setPosition(t,e),this.layoutPosition()},c.moveTo=c._transitionTo,c.setPosition=function(t,e){this.position.x=parseInt(t,10),this.position.y=parseInt(e,10)},c._nonTransition=function(t){this.css(t.to),t.isCleaning&&this._removeStyles(t.to);for(var e in t.onTransitionEnd)t.onTransitionEnd[e].call(this)},c.transition=function(t){if(parseFloat(this.layout.options.transitionDuration)){var e=this._transn;for(var i in t.onTransitionEnd)e.onEnd[i]=t.onTransitionEnd[i];for(i in t.to)e.ingProperties[i]=!0,t.isCleaning&&(e.clean[i]=!0);if(t.from){this.css(t.from);this.element.offsetHeight;null}this.enableTransition(t.to),this.css(t.to),this.isTransitioning=!0}else this._nonTransition(t)};var l="opacity,"+o.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()});c.enableTransition=function(){if(!this.isTransitioning){var t=this.layout.options.transitionDuration;t="number"==typeof t?t+"ms":t,this.css({transitionProperty:l,transitionDuration:t,transitionDelay:this.staggerDelay||0}),this.element.addEventListener(s,this,!1)}},c.onwebkitTransitionEnd=function(t){this.ontransitionend(t)},c.onotransitionend=function(t){this.ontransitionend(t)};var u={"-webkit-transform":"transform"};c.ontransitionend=function(t){if(t.target===this.element){var e=this._transn,i=u[t.propertyName]||t.propertyName;if(delete e.ingProperties[i],function(t){for(var e in t)return!1;return!0}(e.ingProperties)&&this.disableTransition(),i in e.clean&&(this.element.style[t.propertyName]="",delete e.clean[i]),i in e.onEnd)e.onEnd[i].call(this),delete e.onEnd[i];this.emitEvent("transitionEnd",[this])}},c.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(s,this,!1),this.isTransitioning=!1},c._removeStyles=function(t){var e={};for(var i in t)e[i]="";this.css(e)};var h={transitionProperty:"",transitionDuration:"",transitionDelay:""};return c.removeTransitionStyles=function(){this.css(h)},c.stagger=function(t){t=isNaN(t)?0:t,this.staggerDelay=t+"ms"},c.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},c.remove=function(){return r&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),void this.hide()):void this.removeElem()},c.reveal=function(){delete this.isHidden,this.css({display:""});var t=this.layout.options,e={};e[this.getHideRevealTransitionEndProperty("visibleStyle")]=this.onRevealTransitionEnd,this.transition({from:t.hiddenStyle,to:t.visibleStyle,isCleaning:!0,onTransitionEnd:e})},c.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},c.getHideRevealTransitionEndProperty=function(t){var e=this.layout.options[t];if(e.opacity)return"opacity";for(var i in e)return i},c.hide=function(){this.isHidden=!0,this.css({display:""});var t=this.layout.options,e={};e[this.getHideRevealTransitionEndProperty("hiddenStyle")]=this.onHideTransitionEnd,this.transition({from:t.visibleStyle,to:t.hiddenStyle,isCleaning:!0,onTransitionEnd:e})},c.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},c.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},i}),function(t,e){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(i,n,r,o){return e(t,i,n,r,o)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):t.Outlayer=e(t,t.EvEmitter,t.getSize,t.fizzyUIUtils,t.Outlayer.Item)}(window,function(t,e,i,n,r){"use strict";function o(t,e){var i=n.getQueryElement(t);if(i){this.element=i,c&&(this.$element=c(this.element)),this.options=n.extend({},this.constructor.defaults),this.option(e);var r=++u;this.element.outlayerGUID=r,h[r]=this,this._create(),this._getOption("initLayout")&&this.layout()}else a&&a.error("Bad element for "+this.constructor.namespace+": "+(i||t))}function s(t){function e(){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}var a=t.console,c=t.jQuery,l=function(){},u=0,h={};o.namespace="outlayer",o.Item=r,o.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var f=o.prototype;n.extend(f,e.prototype),f.option=function(t){n.extend(this.options,t)},f._getOption=function(t){var e=this.constructor.compatOptions[t];return e&&void 0!==this.options[e]?this.options[e]:this.options[t]},o.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},f._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),n.extend(this.element.style,this.options.containerStyle),this._getOption("resize")&&this.bindResize()},f.reloadItems=function(){this.items=this._itemize(this.element.children)},f._itemize=function(t){for(var e=this._filterFindItemElements(t),i=this.constructor.Item,n=[],r=0;r<e.length;r++){var o=new i(e[r],this);n.push(o)}return n},f._filterFindItemElements=function(t){return n.filterFindElements(t,this.options.itemSelector)},f.getItemElements=function(){return this.items.map(function(t){return t.element})},f.layout=function(){this._resetLayout(),this._manageStamps();var t=this._getOption("layoutInstant"),e=void 0!==t?t:!this._isLayoutInited;this.layoutItems(this.items,e),this._isLayoutInited=!0},f._init=f.layout,f._resetLayout=function(){this.getSize()},f.getSize=function(){this.size=i(this.element)},f._getMeasurement=function(t,e){var n,r=this.options[t];r?("string"==typeof r?n=this.element.querySelector(r):r instanceof HTMLElement&&(n=r),this[t]=n?i(n)[e]:r):this[t]=0},f.layoutItems=function(t,e){t=this._getItemsForLayout(t),this._layoutItems(t,e),this._postLayout()},f._getItemsForLayout=function(t){return t.filter(function(t){return!t.isIgnored})},f._layoutItems=function(t,e){if(this._emitCompleteOnItems("layout",t),t&&t.length){var i=[];t.forEach(function(t){var n=this._getItemLayoutPosition(t);n.item=t,n.isInstant=e||t.isLayoutInstant,i.push(n)},this),this._processLayoutQueue(i)}},f._getItemLayoutPosition=function(){return{x:0,y:0}},f._processLayoutQueue=function(t){this.updateStagger(),t.forEach(function(t,e){this._positionItem(t.item,t.x,t.y,t.isInstant,e)},this)},f.updateStagger=function(){var t=this.options.stagger;return null===t||void 0===t?void(this.stagger=0):(this.stagger=function(t){if("number"==typeof t)return t;var e=t.match(/(^\d*\.?\d*)(\w*)/),i=e&&e[1],n=e&&e[2];return i.length?(i=parseFloat(i))*(p[n]||1):0}(t),this.stagger)},f._positionItem=function(t,e,i,n,r){n?t.goTo(e,i):(t.stagger(r*this.stagger),t.moveTo(e,i))},f._postLayout=function(){this.resizeContainer()},f.resizeContainer=function(){if(this._getOption("resizeContainer")){var t=this._getContainerSize();t&&(this._setContainerMeasure(t.width,!0),this._setContainerMeasure(t.height,!1))}},f._getContainerSize=l,f._setContainerMeasure=function(t,e){if(void 0!==t){var i=this.size;i.isBorderBox&&(t+=e?i.paddingLeft+i.paddingRight+i.borderLeftWidth+i.borderRightWidth:i.paddingBottom+i.paddingTop+i.borderTopWidth+i.borderBottomWidth),t=Math.max(t,0),this.element.style[e?"width":"height"]=t+"px"}},f._emitCompleteOnItems=function(t,e){function i(){r.dispatchEvent(t+"Complete",null,[e])}function n(){++s==o&&i()}var r=this,o=e.length;if(e&&o){var s=0;e.forEach(function(e){e.once(t,n)})}else i()},f.dispatchEvent=function(t,e,i){var n=e?[e].concat(i):i;if(this.emitEvent(t,n),c)if(this.$element=this.$element||c(this.element),e){var r=c.Event(e);r.type=t,this.$element.trigger(r,i)}else this.$element.trigger(t,i)},f.ignore=function(t){var e=this.getItem(t);e&&(e.isIgnored=!0)},f.unignore=function(t){var e=this.getItem(t);e&&delete e.isIgnored},f.stamp=function(t){(t=this._find(t))&&(this.stamps=this.stamps.concat(t),t.forEach(this.ignore,this))},f.unstamp=function(t){(t=this._find(t))&&t.forEach(function(t){n.removeFrom(this.stamps,t),this.unignore(t)},this)},f._find=function(t){return t?("string"==typeof t&&(t=this.element.querySelectorAll(t)),t=n.makeArray(t)):void 0},f._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},f._getBoundingRect=function(){var t=this.element.getBoundingClientRect(),e=this.size;this._boundingRect={left:t.left+e.paddingLeft+e.borderLeftWidth,top:t.top+e.paddingTop+e.borderTopWidth,right:t.right-(e.paddingRight+e.borderRightWidth),bottom:t.bottom-(e.paddingBottom+e.borderBottomWidth)}},f._manageStamp=l,f._getElementOffset=function(t){var e=t.getBoundingClientRect(),n=this._boundingRect,r=i(t);return{left:e.left-n.left-r.marginLeft,top:e.top-n.top-r.marginTop,right:n.right-e.right-r.marginRight,bottom:n.bottom-e.bottom-r.marginBottom}},f.handleEvent=n.handleEvent,f.bindResize=function(){t.addEventListener("resize",this),this.isResizeBound=!0},f.unbindResize=function(){t.removeEventListener("resize",this),this.isResizeBound=!1},f.onresize=function(){this.resize()},n.debounceMethod(o,"onresize",100),f.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},f.needsResizeLayout=function(){var t=i(this.element);return this.size&&t&&t.innerWidth!==this.size.innerWidth},f.addItems=function(t){var e=this._itemize(t);return e.length&&(this.items=this.items.concat(e)),e},f.appended=function(t){var e=this.addItems(t);e.length&&(this.layoutItems(e,!0),this.reveal(e))},f.prepended=function(t){var e=this._itemize(t);if(e.length){var i=this.items.slice(0);this.items=e.concat(i),this._resetLayout(),this._manageStamps(),this.layoutItems(e,!0),this.reveal(e),this.layoutItems(i)}},f.reveal=function(t){if(this._emitCompleteOnItems("reveal",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.reveal()})}},f.hide=function(t){if(this._emitCompleteOnItems("hide",t),t&&t.length){var e=this.updateStagger();t.forEach(function(t,i){t.stagger(i*e),t.hide()})}},f.revealItemElements=function(t){var e=this.getItems(t);this.reveal(e)},f.hideItemElements=function(t){var e=this.getItems(t);this.hide(e)},f.getItem=function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];if(i.element==t)return i}},f.getItems=function(t){var e=[];return(t=n.makeArray(t)).forEach(function(t){var i=this.getItem(t);i&&e.push(i)},this),e},f.remove=function(t){var e=this.getItems(t);this._emitCompleteOnItems("remove",e),e&&e.length&&e.forEach(function(t){t.remove(),n.removeFrom(this.items,t)},this)},f.destroy=function(){var t=this.element.style;t.height="",t.position="",t.width="",this.items.forEach(function(t){t.destroy()}),this.unbindResize();var e=this.element.outlayerGUID;delete h[e],delete this.element.outlayerGUID,c&&c.removeData(this.element,this.constructor.namespace)},o.data=function(t){var e=(t=n.getQueryElement(t))&&t.outlayerGUID;return e&&h[e]},o.create=function(t,e){var i=s(o);return i.defaults=n.extend({},o.defaults),n.extend(i.defaults,e),i.compatOptions=n.extend({},o.compatOptions),i.namespace=t,i.data=o.data,i.Item=s(r),n.htmlInit(i,t),c&&c.bridget&&c.bridget(t,i),i};var p={ms:1,s:1e3};return o.Item=r,o}),function(t,e){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],e):"object"==typeof module&&module.exports?module.exports=e(require("outlayer"),require("get-size")):t.Masonry=e(t.Outlayer,t.getSize)}(window,function(t,e){var i=t.create("masonry");i.compatOptions.fitWidth="isFitWidth";var n=i.prototype;return n._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var t=0;t<this.cols;t++)this.colYs.push(0);this.maxY=0,this.horizontalColIndex=0},n.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var t=this.items[0],i=t&&t.element;this.columnWidth=i&&e(i).outerWidth||this.containerWidth}var n=this.columnWidth+=this.gutter,r=this.containerWidth+this.gutter,o=r/n,s=n-r%n;o=Math[s&&1>s?"round":"floor"](o),this.cols=Math.max(o,1)},n.getContainerWidth=function(){var t=this._getOption("fitWidth")?this.element.parentNode:this.element,i=e(t);this.containerWidth=i&&i.innerWidth},n._getItemLayoutPosition=function(t){t.getSize();var e=t.size.outerWidth%this.columnWidth,i=Math[e&&1>e?"round":"ceil"](t.size.outerWidth/this.columnWidth);i=Math.min(i,this.cols);for(var n=this[this.options.horizontalOrder?"_getHorizontalColPosition":"_getTopColPosition"](i,t),r={x:this.columnWidth*n.col,y:n.y},o=n.y+t.size.outerHeight,s=i+n.col,a=n.col;s>a;a++)this.colYs[a]=o;return r},n._getTopColPosition=function(t){var e=this._getTopColGroup(t),i=Math.min.apply(Math,e);return{col:e.indexOf(i),y:i}},n._getTopColGroup=function(t){if(2>t)return this.colYs;for(var e=[],i=this.cols+1-t,n=0;i>n;n++)e[n]=this._getColGroupY(n,t);return e},n._getColGroupY=function(t,e){if(2>e)return this.colYs[t];var i=this.colYs.slice(t,t+e);return Math.max.apply(Math,i)},n._getHorizontalColPosition=function(t,e){var i=this.horizontalColIndex%this.cols;i=t>1&&i+t>this.cols?0:i;var n=e.size.outerWidth&&e.size.outerHeight;return this.horizontalColIndex=n?i+t:this.horizontalColIndex,{col:i,y:this._getColGroupY(i,t)}},n._manageStamp=function(t){var i=e(t),n=this._getElementOffset(t),r=this._getOption("originLeft")?n.left:n.right,o=r+i.outerWidth,s=Math.floor(r/this.columnWidth);s=Math.max(0,s);var a=Math.floor(o/this.columnWidth);a-=o%this.columnWidth?0:1,a=Math.min(this.cols-1,a);for(var c=(this._getOption("originTop")?n.top:n.bottom)+i.outerHeight,l=s;a>=l;l++)this.colYs[l]=Math.max(c,this.colYs[l])},n._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var t={height:this.maxY};return this._getOption("fitWidth")&&(t.width=this._getContainerFitWidth()),t},n._getContainerFitWidth=function(){for(var t=0,e=this.cols;--e&&0===this.colYs[e];)t++;return(this.cols-t)*this.columnWidth-this.gutter},n.needsResizeLayout=function(){var t=this.containerWidth;return this.getContainerWidth(),t!=this.containerWidth},i});var qrcode=function(){var t=function(t,e){var i=t,n=r[e],s=null,c=0,l=null,m=[],v={},b=function(t,e){s=function(t){for(var e=new Array(t),i=0;i<t;i+=1){e[i]=new Array(t);for(var n=0;n<t;n+=1)e[i][n]=null}return e}(c=4*i+17),y(0,0),y(c-7,0),y(0,c-7),x(),w(),S(t,e),7<=i&&C(t),null==l&&(l=O(i,n,m)),T(l,e)},y=function(t,e){for(var i=-1;i<=7;i+=1)if(!(t+i<=-1||c<=t+i))for(var n=-1;n<=7;n+=1)e+n<=-1||c<=e+n||(s[t+i][e+n]=0<=i&&i<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=n&&n<=4)},w=function(){for(var t=8;t<c-8;t+=1)null==s[t][6]&&(s[t][6]=t%2==0);for(var e=8;e<c-8;e+=1)null==s[6][e]&&(s[6][e]=e%2==0)},x=function(){for(var t=o.getPatternPosition(i),e=0;e<t.length;e+=1)for(var n=0;n<t.length;n+=1){var r=t[e],a=t[n];if(null==s[r][a])for(var c=-2;c<=2;c+=1)for(var l=-2;l<=2;l+=1)s[r+c][a+l]=-2==c||2==c||-2==l||2==l||0==c&&0==l}},C=function(t){for(var e=o.getBCHTypeNumber(i),n=0;n<18;n+=1){var r=!t&&1==(e>>n&1);s[Math.floor(n/3)][n%3+c-8-3]=r}for(n=0;n<18;n+=1)r=!t&&1==(e>>n&1),s[n%3+c-8-3][Math.floor(n/3)]=r},S=function(t,e){for(var i=n<<3|e,r=o.getBCHTypeInfo(i),a=0;a<15;a+=1){var l=!t&&1==(r>>a&1);a<6?s[a][8]=l:a<8?s[a+1][8]=l:s[c-15+a][8]=l}for(a=0;a<15;a+=1)l=!t&&1==(r>>a&1),a<8?s[8][c-a-1]=l:a<9?s[8][15-a-1+1]=l:s[8][15-a-1]=l;s[c-8][8]=!t},T=function(t,e){for(var i=-1,n=c-1,r=7,a=0,l=o.getMaskFunction(e),u=c-1;0<u;u-=2)for(6==u&&(u-=1);;){for(var h=0;h<2;h+=1)if(null==s[n][u-h]){var f=!1;a<t.length&&(f=1==(t[a]>>>r&1)),l(n,u-h)&&(f=!f),s[n][u-h]=f,-1==(r-=1)&&(a+=1,r=7)}if((n+=i)<0||c<=n){n-=i,i=-i;break}}},O=function(t,e,i){for(var n=u.getRSBlocks(t,e),r=h(),s=0;s<i.length;s+=1){var c=i[s];r.put(c.getMode(),4),r.put(c.getLength(),o.getLengthInBits(c.getMode(),t)),c.write(r)}var l=0;for(s=0;s<n.length;s+=1)l+=n[s].dataCount;if(r.getLengthInBits()>8*l)throw"code length overflow. ("+r.getLengthInBits()+">"+8*l+")";for(r.getLengthInBits()+4<=8*l&&r.put(0,4);r.getLengthInBits()%8!=0;)r.putBit(!1);for(;!(r.getLengthInBits()>=8*l||(r.put(236,8),r.getLengthInBits()>=8*l));)r.put(17,8);return function(t,e){for(var i=0,n=0,r=0,s=new Array(e.length),c=new Array(e.length),l=0;l<e.length;l+=1){var u=e[l].dataCount,h=e[l].totalCount-u;n=Math.max(n,u),r=Math.max(r,h),s[l]=new Array(u);for(var f=0;f<s[l].length;f+=1)s[l][f]=255&t.getBuffer()[f+i];i+=u;var p=o.getErrorCorrectPolynomial(h),d=a(s[l],p.getLength()-1).mod(p);for(c[l]=new Array(p.getLength()-1),f=0;f<c[l].length;f+=1){var g=f+d.getLength()-c[l].length;c[l][f]=0<=g?d.getAt(g):0}}var m=0;for(f=0;f<e.length;f+=1)m+=e[f].totalCount;var v=new Array(m),_=0;for(f=0;f<n;f+=1)for(l=0;l<e.length;l+=1)f<s[l].length&&(v[_]=s[l][f],_+=1);for(f=0;f<r;f+=1)for(l=0;l<e.length;l+=1)f<c[l].length&&(v[_]=c[l][f],_+=1);return v}(r,n)};return v.addData=function(t,e){var i=null;switch(e=e||"Byte"){case"Numeric":i=f(t);break;case"Alphanumeric":i=p(t);break;case"Byte":i=d(t);break;case"Kanji":i=g(t);break;default:throw"mode:"+e}m.push(i),l=null},v.isDark=function(t,e){if(t<0||c<=t||e<0||c<=e)throw t+","+e;return s[t][e]},v.getModuleCount=function(){return c},v.make=function(){if(i<1){for(var t=1;t<40;t++){for(var e=u.getRSBlocks(t,n),r=h(),s=0;s<m.length;s++){var a=m[s];r.put(a.getMode(),4),r.put(a.getLength(),o.getLengthInBits(a.getMode(),t)),a.write(r)}var c=0;for(s=0;s<e.length;s++)c+=e[s].dataCount;if(r.getLengthInBits()<=8*c)break}i=t}b(!1,function(){for(var t=0,e=0,i=0;i<8;i+=1){b(!0,i);var n=o.getLostPoint(v);(0==i||n<t)&&(t=n,e=i)}return e}())},v.createTableTag=function(t,e){t=t||2;var i="";i+='<table style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: "+(e=void 0===e?4*t:e)+"px;",i+='">',i+="<tbody>";for(var n=0;n<v.getModuleCount();n+=1){i+="<tr>";for(var r=0;r<v.getModuleCount();r+=1)i+='<td style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: 0px;",i+=" width: "+t+"px;",i+=" height: "+t+"px;",i+=" background-color: ",i+=v.isDark(n,r)?"#000000":"#ffffff",i+=";",i+='"/>';i+="</tr>"}return(i+="</tbody>")+"</table>"},v.createSvgTag=function(t,e){t=t||4,e=void 0===e?4*t:e,e=0;var i,n,r,o,s=v.getModuleCount()*t+2*e,a="";for(o="l"+t+",0 0,"+t+" -"+t+",0 0,-"+t+"z ",a+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',a+=' width="'+s+'px"',a+=' height="'+s+'px"',a+=' viewBox="0 0 '+s+" "+s+'" ',a+=' preserveAspectRatio="xMinYMin meet">',a+='<path d="',n=0;n<v.getModuleCount();n+=1)for(r=n*t+e,i=0;i<v.getModuleCount();i+=1)v.isDark(n,i)&&(a+="M"+(i*t+e)+","+r+o);return(a+='" stroke="transparent" fill="black"/>')+"</svg>"},v.createImgTag=function(t,e){t=t||2,e=void 0===e?4*t:e;var i=v.getModuleCount()*t+2*e,n=e,r=i-e;return _(i,i,function(e,i){if(n<=e&&e<r&&n<=i&&i<r){var o=Math.floor((e-n)/t),s=Math.floor((i-n)/t);return v.isDark(s,o)?0:1}return 1})},v};t.stringToBytes=(t.stringToBytesFuncs={default:function(t){for(var e=[],i=0;i<t.length;i+=1){var n=t.charCodeAt(i);e.push(255&n)}return e}}).default,t.createStringToBytes=function(t,e){var i=function(){for(var i=v(t),n=function(){var t=i.read();if(-1==t)throw"eof";return t},r=0,o={};;){var s=i.read();if(-1==s)break;var a=n(),c=n()<<8|n();o[String.fromCharCode(s<<8|a)]=c,r+=1}if(r!=e)throw r+" != "+e;return o}(),n="?".charCodeAt(0);return function(t){for(var e=[],r=0;r<t.length;r+=1){var o=t.charCodeAt(r);if(o<128)e.push(o);else{var s=i[t.charAt(r)];"number"==typeof s?(255&s)==s?e.push(s):(e.push(s>>>8),e.push(255&s)):e.push(n)}}return e}};var e,i,n,r={L:1,M:0,Q:3,H:2},o=(e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],n=function(t){for(var e=0;0!=t;)e+=1,t>>>=1;return e},(i={}).getBCHTypeInfo=function(t){for(var e=t<<10;0<=n(e)-n(1335);)e^=1335<<n(e)-n(1335);return 21522^(t<<10|e)},i.getBCHTypeNumber=function(t){for(var e=t<<12;0<=n(e)-n(7973);)e^=7973<<n(e)-n(7973);return t<<12|e},i.getPatternPosition=function(t){return e[t-1]},i.getMaskFunction=function(t){switch(t){case 0:return function(t,e){return(t+e)%2==0};case 1:return function(t,e){return t%2==0};case 2:return function(t,e){return e%3==0};case 3:return function(t,e){return(t+e)%3==0};case 4:return function(t,e){return(Math.floor(t/2)+Math.floor(e/3))%2==0};case 5:return function(t,e){return t*e%2+t*e%3==0};case 6:return function(t,e){return(t*e%2+t*e%3)%2==0};case 7:return function(t,e){return(t*e%3+(t+e)%2)%2==0};default:throw"bad maskPattern:"+t}},i.getErrorCorrectPolynomial=function(t){for(var e=a([1],0),i=0;i<t;i+=1)e=e.multiply(a([1,s.gexp(i)],0));return e},i.getLengthInBits=function(t,e){if(1<=e&&e<10)switch(t){case 1:return 10;case 2:return 9;case 4:case 8:return 8;default:throw"mode:"+t}else if(e<27)switch(t){case 1:return 12;case 2:return 11;case 4:return 16;case 8:return 10;default:throw"mode:"+t}else{if(!(e<41))throw"type:"+e;switch(t){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw"mode:"+t}}},i.getLostPoint=function(t){for(var e=t.getModuleCount(),i=0,n=0;n<e;n+=1)for(var r=0;r<e;r+=1){for(var o=0,s=t.isDark(n,r),a=-1;a<=1;a+=1)if(!(n+a<0||e<=n+a))for(var c=-1;c<=1;c+=1)r+c<0||e<=r+c||0==a&&0==c||s==t.isDark(n+a,r+c)&&(o+=1);5<o&&(i+=3+o-5)}for(n=0;n<e-1;n+=1)for(r=0;r<e-1;r+=1){var l=0;t.isDark(n,r)&&(l+=1),t.isDark(n+1,r)&&(l+=1),t.isDark(n,r+1)&&(l+=1),t.isDark(n+1,r+1)&&(l+=1),0!=l&&4!=l||(i+=3)}for(n=0;n<e;n+=1)for(r=0;r<e-6;r+=1)t.isDark(n,r)&&!t.isDark(n,r+1)&&t.isDark(n,r+2)&&t.isDark(n,r+3)&&t.isDark(n,r+4)&&!t.isDark(n,r+5)&&t.isDark(n,r+6)&&(i+=40);for(r=0;r<e;r+=1)for(n=0;n<e-6;n+=1)t.isDark(n,r)&&!t.isDark(n+1,r)&&t.isDark(n+2,r)&&t.isDark(n+3,r)&&t.isDark(n+4,r)&&!t.isDark(n+5,r)&&t.isDark(n+6,r)&&(i+=40);var u=0;for(r=0;r<e;r+=1)for(n=0;n<e;n+=1)t.isDark(n,r)&&(u+=1);return i+Math.abs(100*u/e/e-50)/5*10},i),s=function(){for(var t=new Array(256),e=new Array(256),i=0;i<8;i+=1)t[i]=1<<i;for(i=8;i<256;i+=1)t[i]=t[i-4]^t[i-5]^t[i-6]^t[i-8];for(i=0;i<255;i+=1)e[t[i]]=i;return{glog:function(t){if(t<1)throw"glog("+t+")";return e[t]},gexp:function(e){for(;e<0;)e+=255;for(;256<=e;)e-=255;return t[e]}}}();function a(t,e){if(void 0===t.length)throw t.length+"/"+e;var i=function(){for(var i=0;i<t.length&&0==t[i];)i+=1;for(var n=new Array(t.length-i+e),r=0;r<t.length-i;r+=1)n[r]=t[r+i];return n}(),n={getAt:function(t){return i[t]},getLength:function(){return i.length},multiply:function(t){for(var e=new Array(n.getLength()+t.getLength()-1),i=0;i<n.getLength();i+=1)for(var r=0;r<t.getLength();r+=1)e[i+r]^=s.gexp(s.glog(n.getAt(i))+s.glog(t.getAt(r)));return a(e,0)},mod:function(t){if(n.getLength()-t.getLength()<0)return n;for(var e=s.glog(n.getAt(0))-s.glog(t.getAt(0)),i=new Array(n.getLength()),r=0;r<n.getLength();r+=1)i[r]=n.getAt(r);for(r=0;r<t.getLength();r+=1)i[r]^=s.gexp(s.glog(t.getAt(r))+e);return a(i,0).mod(t)}};return n}var c,l,u=(c=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],(l={}).getRSBlocks=function(t,e){var i=function(t,i){switch(e){case r.L:return c[4*(t-1)+0];case r.M:return c[4*(t-1)+1];case r.Q:return c[4*(t-1)+2];case r.H:return c[4*(t-1)+3];default:return}}(t);if(void 0===i)throw"bad rs block @ typeNumber:"+t+"/errorCorrectionLevel:"+e;for(var n,o,s=i.length/3,a=[],l=0;l<s;l+=1)for(var u=i[3*l+0],h=i[3*l+1],f=i[3*l+2],p=0;p<u;p+=1)a.push((n=f,o=void 0,(o={}).totalCount=h,o.dataCount=n,o));return a},l),h=function(){var t=[],e=0,i={getBuffer:function(){return t},getAt:function(e){var i=Math.floor(e/8);return 1==(t[i]>>>7-e%8&1)},put:function(t,e){for(var n=0;n<e;n+=1)i.putBit(1==(t>>>e-n-1&1))},getLengthInBits:function(){return e},putBit:function(i){var n=Math.floor(e/8);t.length<=n&&t.push(0),i&&(t[n]|=128>>>e%8),e+=1}};return i},f=function(t){var e=t,i={getMode:function(){return 1},getLength:function(t){return e.length},write:function(t){for(var i=e,r=0;r+2<i.length;)t.put(n(i.substring(r,r+3)),10),r+=3;r<i.length&&(i.length-r==1?t.put(n(i.substring(r,r+1)),4):i.length-r==2&&t.put(n(i.substring(r,r+2)),7))}},n=function(t){for(var e=0,i=0;i<t.length;i+=1)e=10*e+r(t.charAt(i));return e},r=function(t){if("0"<=t&&t<="9")return t.charCodeAt(0)-"0".charCodeAt(0);throw"illegal char :"+t};return i},p=function(t){var e=t,i={getMode:function(){return 2},getLength:function(t){return e.length},write:function(t){for(var i=e,r=0;r+1<i.length;)t.put(45*n(i.charAt(r))+n(i.charAt(r+1)),11),r+=2;r<i.length&&t.put(n(i.charAt(r)),6)}},n=function(t){if("0"<=t&&t<="9")return t.charCodeAt(0)-"0".charCodeAt(0);if("A"<=t&&t<="Z")return t.charCodeAt(0)-"A".charCodeAt(0)+10;switch(t){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+t}};return i},d=function(e){var i=t.stringToBytes(e);return{getMode:function(){return 4},getLength:function(t){return i.length},write:function(t){for(var e=0;e<i.length;e+=1)t.put(i[e],8)}}},g=function(e){var i=t.stringToBytesFuncs.SJIS;if(!i)throw"sjis not supported.";!function(t,e){var n=i("");if(2!=n.length||38726!=(n[0]<<8|n[1]))throw"sjis not supported."}();var n=i(e);return{getMode:function(){return 8},getLength:function(t){return~~(n.length/2)},write:function(t){for(var e=n,i=0;i+1<e.length;){var r=(255&e[i])<<8|255&e[i+1];if(33088<=r&&r<=40956)r-=33088;else{if(!(57408<=r&&r<=60351))throw"illegal char at "+(i+1)+"/"+r;r-=49472}r=192*(r>>>8&255)+(255&r),t.put(r,13),i+=2}if(i<e.length)throw"illegal char at "+(i+1)}}},m=function(){var t=[],e={writeByte:function(e){t.push(255&e)},writeShort:function(t){e.writeByte(t),e.writeByte(t>>>8)},writeBytes:function(t,i,n){i=i||0,n=n||t.length;for(var r=0;r<n;r+=1)e.writeByte(t[r+i])},writeString:function(t){for(var i=0;i<t.length;i+=1)e.writeByte(t.charCodeAt(i))},toByteArray:function(){return t},toString:function(){var e="";e+="[";for(var i=0;i<t.length;i+=1)0<i&&(e+=","),e+=t[i];return e+"]"}};return e},v=function(t){var e=t,i=0,n=0,r=0,o={read:function(){for(;r<8;){if(i>=e.length){if(0==r)return-1;throw"unexpected end of file./"+r}var t=e.charAt(i);if(i+=1,"="==t)return r=0,-1;t.match(/^\s$/)||(n=n<<6|s(t.charCodeAt(0)),r+=6)}var o=n>>>r-8&255;return r-=8,o}},s=function(t){if(65<=t&&t<=90)return t-65;if(97<=t&&t<=122)return t-97+26;if(48<=t&&t<=57)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw"c:"+t};return o},_=function(t,e,i,n){for(var r,o,s,a,c,l,u,h,f=(s=r=t,a=o=e,c=new Array(r*o),l={setPixel:function(t,e,i){c[e*s+t]=i},write:function(t){t.writeString("GIF87a"),t.writeShort(s),t.writeShort(a),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(s),t.writeShort(a),t.writeByte(0);var e=u(2);t.writeByte(2);for(var i=0;255<e.length-i;)t.writeByte(255),t.writeBytes(e,i,255),i+=255;t.writeByte(e.length-i),t.writeBytes(e,i,e.length-i),t.writeByte(0),t.writeString(";")}},u=function(t){for(var e=1<<t,i=1+(1<<t),n=t+1,r=h(),o=0;o<e;o+=1)r.add(String.fromCharCode(o));r.add(String.fromCharCode(e)),r.add(String.fromCharCode(i));var s,a,l,u=m(),f=(s=u,l=a=0,{write:function(t,e){if(t>>>e!=0)throw"length over";for(;8<=a+e;)s.writeByte(255&(t<<a|l)),e-=8-a,t>>>=8-a,a=l=0;l|=t<<a,a+=e},flush:function(){0<a&&s.writeByte(l)}});f.write(e,n);var p=0,d=String.fromCharCode(c[p]);for(p+=1;p<c.length;){var g=String.fromCharCode(c[p]);p+=1,r.contains(d+g)?d+=g:(f.write(r.indexOf(d),n),r.size()<4095&&(r.size()==1<<n&&(n+=1),r.add(d+g)),d=g)}return f.write(r.indexOf(d),n),f.write(i,n),f.flush(),u.toByteArray()},h=function(){var t={},e=0,i={add:function(n){if(i.contains(n))throw"dup key:"+n;t[n]=e,e+=1},size:function(){return e},indexOf:function(e){return t[e]},contains:function(e){return void 0!==t[e]}};return i},l),p=0;p<e;p+=1)for(var d=0;d<t;d+=1)f.setPixel(d,p,i(d,p));var g=m();f.write(g);for(var v,_,b,y,w,x,C,S=(b=_=v=0,y="",x=function(t){y+=String.fromCharCode(C(63&t))},C=function(t){if(t<0);else{if(t<26)return 65+t;if(t<52)return t-26+97;if(t<62)return t-52+48;if(62==t)return 43;if(63==t)return 47}throw"n:"+t},(w={}).writeByte=function(t){for(v=v<<8|255&t,_+=8,b+=1;6<=_;)x(v>>>_-6),_-=6},w.flush=function(){if(0<_&&(x(v<<6-_),_=v=0),b%3!=0)for(var t=3-b%3,e=0;e<t;e+=1)y+="="},w.toString=function(){return y},w),T=g.toByteArray(),O=0;O<T.length;O+=1)S.writeByte(T[O]);S.flush();var k="";return k+="<img",k+=' src="',k+="data:image/gif;base64,",k+=S,k+='"',k+=' width="',k+=t,k+='"',k+=' height="',k+=e,k+='"',n&&(k+=' alt="',k+=n,k+='"'),k+"/>"};return t}();function checkMobileDevice(){var t=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(t=!0),t}qrcode.stringToBytesFuncs["UTF-8"]=function(t){return function(t){for(var e=[],i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e.push(n):n<2048?e.push(192|n>>6,128|63&n):n<55296||57344<=n?e.push(224|n>>12,128|n>>6&63,128|63&n):(i++,n=65536+((1023&n)<<10|1023&t.charCodeAt(i)),e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return e}(t)},function(t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports&&(module.exports=t())}(function(){return qrcode}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery")):t(jQuery)}(function(t,e){var i={beforeShow:u,move:u,change:u,show:u,hide:u,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},n=[],r=!!/msie/i.exec(window.navigator.userAgent),o=function(){function t(t,e){return!!~(""+t).indexOf(e)}var e=document.createElement("div").style;return e.cssText="background-color:rgba(0,0,0,.5)",t(e.backgroundColor,"rgba")||t(e.backgroundColor,"hsla")}(),s=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),a=function(){var t="";if(r)for(var e=1;e<=6;e++)t+="<div class='sp-"+e+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",t,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function c(e,i,n,r){for(var s=[],a=0;a<e.length;a++){var c=e[a];if(c){var l=tinycolor(c),u=l.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";u+=tinycolor.equals(i,c)?" sp-thumb-active":"";var h=l.toString(r.preferredFormat||"rgb"),f=o?"background-color:"+l.toRgbString():"filter:"+l.toFilter();s.push('<span title="'+h+'" data-color="'+l.toRgbString()+'" class="'+u+'"><span class="sp-thumb-inner" style="'+f+';" /></span>')}else{s.push(t("<div />").append(t('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",r.noColorSelectedText)).html())}}return"<div class='sp-cf "+n+"'>"+s.join("")+"</div>"}function l(l,u){var g,m,v,_,b,y,w,x=(b=u,y=l,(w=t.extend({},i,b)).callbacks={move:f(w.move,y),change:f(w.change,y),show:f(w.show,y),hide:f(w.hide,y),beforeShow:f(w.beforeShow,y)},w),C=x.flat,S=x.showSelectionPalette,T=x.localStorageKey,O=x.theme,k=x.callbacks,$=(g=Yt,m=10,function(){var t=this,e=arguments;v&&clearTimeout(_),!v&&_||(_=setTimeout(function(){_=null,g.apply(t,e)},m))}),A=!1,E=!1,j=0,I=0,M=0,P=0,D=0,F=0,L=0,R=0,B=0,z=0,H=1,X=[],W=[],G={},N=x.selectionPalette.slice(0),Y=x.maxSelectionSize,U="sp-dragging",V=null,K=l.ownerDocument,q=(K.body,t(l)),Q=!1,J=t(a,K).addClass(O),Z=J.find(".sp-picker-container"),tt=J.find(".sp-color"),et=J.find(".sp-dragger"),it=J.find(".sp-hue"),nt=J.find(".sp-slider"),rt=J.find(".sp-alpha-inner"),ot=J.find(".sp-alpha"),st=J.find(".sp-alpha-handle"),at=J.find(".sp-input"),ct=J.find(".sp-palette"),lt=J.find(".sp-initial"),ut=J.find(".sp-cancel"),ht=J.find(".sp-clear"),ft=J.find(".sp-choose"),pt=J.find(".sp-palette-toggle"),dt=q.is("input"),gt=dt&&"color"===q.attr("type")&&d(),mt=dt&&!C,vt=mt?t(s).addClass(O).addClass(x.className).addClass(x.replacerClassName):t([]),_t=mt?vt:q,bt=vt.find(".sp-preview-inner"),yt=x.color||dt&&q.val(),wt=!1,xt=x.preferredFormat,Ct=!x.showButtons||x.clickoutFiresChange,St=!yt,Tt=x.allowEmpty&&!gt;function Ot(){if(x.showPaletteOnly&&(x.showPalette=!0),pt.text(x.showPaletteOnly?x.togglePaletteMoreText:x.togglePaletteLessText),x.palette){X=x.palette.slice(0),W=t.isArray(X[0])?X:[X],G={};for(var e=0;e<W.length;e++)for(var i=0;i<W[e].length;i++){var n=tinycolor(W[e][i]).toRgbString();G[n]=!0}}J.toggleClass("sp-flat",C),J.toggleClass("sp-input-disabled",!x.showInput),J.toggleClass("sp-alpha-enabled",x.showAlpha),J.toggleClass("sp-clear-enabled",Tt),J.toggleClass("sp-buttons-disabled",!x.showButtons),J.toggleClass("sp-palette-buttons-disabled",!x.togglePaletteOnly),J.toggleClass("sp-palette-disabled",!x.showPalette),J.toggleClass("sp-palette-only",x.showPaletteOnly),J.toggleClass("sp-initial-disabled",!x.showInitial),J.addClass(x.className).addClass(x.containerClassName),Yt()}function kt(){if(T&&window.localStorage){try{var e=window.localStorage[T].split(",#");e.length>1&&(delete window.localStorage[T],t.each(e,function(t,e){$t(e)}))}catch(t){}try{N=window.localStorage[T].split(";")}catch(t){}}}function $t(e){if(S){var i=tinycolor(e).toRgbString();if(!G[i]&&-1===t.inArray(i,N))for(N.push(i);N.length>Y;)N.shift();if(T&&window.localStorage)try{window.localStorage[T]=N.join(";")}catch(t){}}}function At(){var e=Ht(),i=t.map(W,function(t,i){return c(t,e,"sp-palette-row sp-palette-row-"+i,x)});kt(),N&&i.push(c(function(){var t=[];if(x.showPalette)for(var e=0;e<N.length;e++){var i=tinycolor(N[e]).toRgbString();G[i]||t.push(N[e])}return t.reverse().slice(0,x.maxSelectionSize)}(),e,"sp-palette-row sp-palette-row-selection",x)),ct.html(i.join(""))}function Et(){if(x.showInitial){var t=wt,e=Ht();lt.html(c([t,e],e,"sp-palette-row-initial",x))}}function jt(){(I<=0||j<=0||P<=0)&&Yt(),E=!0,J.addClass(U),V=null,q.trigger("dragstart.spectrum",[Ht()])}function It(){E=!1,J.removeClass(U),q.trigger("dragstop.spectrum",[Ht()])}function Mt(){var t=at.val();if(null!==t&&""!==t||!Tt){var e=tinycolor(t);e.isValid()?(zt(e),Nt(!0)):at.addClass("sp-validation-error")}else zt(null),Nt(!0)}function Pt(){A?Rt():Dt()}function Dt(){var e=t.Event("beforeShow.spectrum");A?Yt():(q.trigger(e,[Ht()]),!1===k.beforeShow(Ht())||e.isDefaultPrevented()||(!function(){for(var t=0;t<n.length;t++)n[t]&&n[t].hide()}(),A=!0,t(K).bind("keydown.spectrum",Ft),t(K).bind("click.spectrum",Lt),t(window).bind("resize.spectrum",$),vt.addClass("sp-active"),J.removeClass("sp-hidden"),Yt(),Wt(),wt=Ht(),Et(),k.show(wt),q.trigger("show.spectrum",[wt])))}function Ft(t){27===t.keyCode&&Rt()}function Lt(t){2!=t.button&&(E||(Ct?Nt(!0):Bt(),Rt()))}function Rt(){A&&!C&&(A=!1,t(K).unbind("keydown.spectrum",Ft),t(K).unbind("click.spectrum",Lt),t(window).unbind("resize.spectrum",$),vt.removeClass("sp-active"),J.addClass("sp-hidden"),k.hide(Ht()),q.trigger("hide.spectrum",[Ht()]))}function Bt(){zt(wt,!0)}function zt(t,e){var i,n;tinycolor.equals(t,Ht())?Wt():(!t&&Tt?St=!0:(St=!1,n=(i=tinycolor(t)).toHsv(),R=n.h%360/360,B=n.s,z=n.v,H=n.a),Wt(),i&&i.isValid()&&!e&&(xt=x.preferredFormat||i.getFormat()))}function Ht(t){return t=t||{},Tt&&St?null:tinycolor.fromRatio({h:R,s:B,v:z,a:Math.round(100*H)/100},{format:t.format||xt})}function Xt(){Wt(),k.move(Ht()),q.trigger("move.spectrum",[Ht()])}function Wt(){at.removeClass("sp-validation-error"),Gt();var t=tinycolor.fromRatio({h:R,s:1,v:1});tt.css("background-color",t.toHexString());var e=xt;H<1&&(0!==H||"name"!==e)&&("hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb"));var i=Ht({format:e}),n="";if(bt.removeClass("sp-clear-display"),bt.css("background-color","transparent"),!i&&Tt)bt.addClass("sp-clear-display");else{var s=i.toHexString(),a=i.toRgbString();if(o||1===i.alpha?bt.css("background-color",a):(bt.css("background-color","transparent"),bt.css("filter",i.toFilter())),x.showAlpha){var c=i.toRgb();c.a=0;var l=tinycolor(c).toRgbString(),u="linear-gradient(left, "+l+", "+s+")";r?rt.css("filter",tinycolor(l).toFilter({gradientType:1},s)):(rt.css("background","-webkit-"+u),rt.css("background","-moz-"+u),rt.css("background","-ms-"+u),rt.css("background","linear-gradient(to right, "+l+", "+s+")"))}n=i.toString(e)}x.showInput&&at.val(n),x.showPalette&&At(),Et()}function Gt(){var t=B,e=z;if(Tt&&St)st.hide(),nt.hide(),et.hide();else{st.show(),nt.show(),et.show();var i=t*j,n=I-e*I;i=Math.max(-M,Math.min(j-M,i-M)),n=Math.max(-M,Math.min(I-M,n-M)),et.css({top:n+"px",left:i+"px"});var r=H*D;st.css({left:r-F/2+"px"});var o=R*P;nt.css({top:o-L+"px"})}}function Nt(t){var e=Ht(),i="",n=!tinycolor.equals(e,wt);e&&(i=e.toString(xt),$t(e)),dt&&q.val(i),t&&n&&(k.change(e),q.trigger("change",[e]))}function Yt(){var e,i,n,r,o,s,a,c,l,u;A&&(j=tt.width(),I=tt.height(),M=et.height(),it.width(),P=it.height(),L=nt.height(),D=ot.width(),F=st.width(),C||(J.css("position","absolute"),x.offset?J.offset(x.offset):J.offset((i=_t,n=(e=J).outerWidth(),r=e.outerHeight(),o=i.outerHeight(),s=e[0].ownerDocument,a=s.documentElement,c=a.clientWidth+t(s).scrollLeft(),l=a.clientHeight+t(s).scrollTop(),(u=i.offset()).top+=o,u.left-=Math.min(u.left,u.left+n>c&&c>n?Math.abs(u.left+n-c):0),u.top-=Math.min(u.top,u.top+r>l&&l>r?Math.abs(r+o-0):0),u))),Gt(),x.showPalette&&At(),q.trigger("reflow.spectrum"))}function Ut(){Rt(),Q=!0,q.attr("disabled",!0),_t.addClass("sp-disabled")}!function(){if(r&&J.find("*:not(input)").attr("unselectable","on"),Ot(),mt&&q.after(vt).hide(),Tt||ht.hide(),C)q.after(J).hide();else{var e="parent"===x.appendTo?q.parent():t(x.appendTo);1!==e.length&&(e=t("body")),e.append(J)}function i(e){return e.data&&e.data.ignore?(zt(t(e.target).closest(".sp-thumb-el").data("color")),Xt()):(zt(t(e.target).closest(".sp-thumb-el").data("color")),Xt(),Nt(!0),x.hideAfterPaletteSelect&&Rt()),!1}kt(),_t.bind("click.spectrum touchstart.spectrum",function(e){Q||Pt(),e.stopPropagation(),t(e.target).is("input")||e.preventDefault()}),(q.is(":disabled")||!0===x.disabled)&&Ut(),J.click(h),at.change(Mt),at.bind("paste",function(){setTimeout(Mt,1)}),at.keydown(function(t){13==t.keyCode&&Mt()}),ut.text(x.cancelText),ut.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),Bt(),Rt()}),ht.attr("title",x.clearText),ht.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),St=!0,Xt(),C&&Nt(!0)}),ft.text(x.chooseText),ft.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),r&&at.is(":focus")&&at.trigger("change"),at.hasClass("sp-validation-error")||(Nt(!0),Rt())}),pt.text(x.showPaletteOnly?x.togglePaletteMoreText:x.togglePaletteLessText),pt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),x.showPaletteOnly=!x.showPaletteOnly,x.showPaletteOnly||C||J.css("left","-="+(Z.outerWidth(!0)+5)),Ot()}),p(ot,function(t,e,i){H=t/D,St=!1,i.shiftKey&&(H=Math.round(10*H)/10),Xt()},jt,It),p(it,function(t,e){R=parseFloat(e/P),St=!1,x.showAlpha||(H=1),Xt()},jt,It),p(tt,function(t,e,i){if(i.shiftKey){if(!V){var n=B*j,r=I-z*I,o=Math.abs(t-n)>Math.abs(e-r);V=o?"x":"y"}}else V=null;var s=!V||"y"===V;(!V||"x"===V)&&(B=parseFloat(t/j)),s&&(z=parseFloat((I-e)/I)),St=!1,x.showAlpha||(H=1),Xt()},jt,It),yt?(zt(yt),Wt(),xt=x.preferredFormat||tinycolor(yt).format,$t(yt)):Wt(),C&&Dt();var n=r?"mousedown.spectrum":"click.spectrum touchstart.spectrum";ct.delegate(".sp-thumb-el",n,i),lt.delegate(".sp-thumb-el:nth-child(1)",n,{ignore:!0},i)}();var Vt={show:Dt,hide:Rt,toggle:Pt,reflow:Yt,option:function(i,n){return i===e?t.extend({},x):n===e?x[i]:(x[i]=n,"preferredFormat"===i&&(xt=x.preferredFormat),void Ot())},enable:function(){Q=!1,q.attr("disabled",!1),_t.removeClass("sp-disabled")},disable:Ut,offset:function(t){x.offset=t,Yt()},set:function(t){zt(t),Nt()},get:Ht,destroy:function(){q.show(),_t.unbind("click.spectrum touchstart.spectrum"),J.remove(),vt.remove(),n[Vt.id]=null},container:J};return Vt.id=n.push(Vt)-1,Vt}function u(){}function h(t){t.stopPropagation()}function f(t,e){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}}function p(e,i,n,o){i=i||function(){},n=n||function(){},o=o||function(){};var s=document,a=!1,c={},l=0,u=0,h="ontouchstart"in window,f={};function p(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.returnValue=!1}function d(t){if(a){if(r&&s.documentMode<9&&!t.button)return g();var n=t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0],o=n&&n.pageX||t.pageX,f=n&&n.pageY||t.pageY,d=Math.max(0,Math.min(o-c.left,u)),m=Math.max(0,Math.min(f-c.top,l));h&&p(t),i.apply(e,[d,m,t])}}function g(){a&&(t(s).unbind(f),t(s.body).removeClass("sp-dragging"),setTimeout(function(){o.apply(e,arguments)},0)),a=!1}f.selectstart=p,f.dragstart=p,f["touchmove mousemove"]=d,f["touchend mouseup"]=g,t(e).bind("touchstart mousedown",function(i){(i.which?3==i.which:2==i.button)||a||!1!==n.apply(e,arguments)&&(a=!0,l=t(e).height(),u=t(e).width(),c=t(e).offset(),t(s).bind(f),t(s.body).addClass("sp-dragging"),d(i),p(i))})}function d(){return t.fn.spectrum.inputTypeColorSupport()}var g="spectrum.id";t.fn.spectrum=function(e,i){if("string"==typeof e){var r=this,o=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=n[t(this).data(g)];if(i){var s=i[e];if(!s)throw new Error("Spectrum: no such method: '"+e+"'");"get"==e?r=i.get():"container"==e?r=i.container:"option"==e?r=i.option.apply(i,o):"destroy"==e?(i.destroy(),t(this).removeData(g)):s.apply(i,o)}}),r}return this.spectrum("destroy").each(function(){var i=l(this,t.extend({},e,t(this).data()));t(this).data(g,i.id)})},t.fn.spectrum.load=!0,t.fn.spectrum.loadOpts={},t.fn.spectrum.draggable=p,t.fn.spectrum.defaults=i,t.fn.spectrum.inputTypeColorSupport=function e(){if(void 0===e._cachedResult){var i=t("<input type='color'/>")[0];e._cachedResult="color"===i.type&&""!==i.value}return e._cachedResult},t.spectrum={},t.spectrum.localization={},t.spectrum.palettes={},t.fn.spectrum.processNativeColorInputs=function(){var e=t("input[type=color]");e.length&&!d()&&e.spectrum({preferredFormat:"hex6"})},function(){var t=/^[\s,#]+/,e=/\s+$/,i=0,n=Math,r=n.round,o=n.min,s=n.max,a=n.random,c=function(a,l){if(a=a||"",l=l||{},a instanceof c)return a;if(!(this instanceof c))return new c(a,l);var u=function(i){var r={r:0,g:0,b:0},a=1,c=!1,l=!1;"string"==typeof i&&(i=function(i){i=i.replace(t,"").replace(e,"").toLowerCase();var n,r=!1;if(O[i])i=O[i],r=!0;else if("transparent"==i)return{r:0,g:0,b:0,a:0,format:"name"};return(n=L.rgb.exec(i))?{r:n[1],g:n[2],b:n[3]}:(n=L.rgba.exec(i))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=L.hsl.exec(i))?{h:n[1],s:n[2],l:n[3]}:(n=L.hsla.exec(i))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=L.hsv.exec(i))?{h:n[1],s:n[2],v:n[3]}:(n=L.hsva.exec(i))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=L.hex8.exec(i))?{a:(o=n[1],j(o)/255),r:j(n[2]),g:j(n[3]),b:j(n[4]),format:r?"name":"hex8"}:(n=L.hex6.exec(i))?{r:j(n[1]),g:j(n[2]),b:j(n[3]),format:r?"name":"hex"}:!!(n=L.hex3.exec(i))&&{r:j(n[1]+""+n[1]),g:j(n[2]+""+n[2]),b:j(n[3]+""+n[3]),format:r?"name":"hex"};var o}(i));"object"==typeof i&&(i.hasOwnProperty("r")&&i.hasOwnProperty("g")&&i.hasOwnProperty("b")?(u=i.r,h=i.g,f=i.b,r={r:255*A(u,255),g:255*A(h,255),b:255*A(f,255)},c=!0,l="%"===String(i.r).substr(-1)?"prgb":"rgb"):i.hasOwnProperty("h")&&i.hasOwnProperty("s")&&i.hasOwnProperty("v")?(i.s=M(i.s),i.v=M(i.v),r=function(t,e,i){t=6*A(t,360),e=A(e,100),i=A(i,100);var r=n.floor(t),o=t-r,s=i*(1-e),a=i*(1-o*e),c=i*(1-(1-o)*e),l=r%6;return{r:255*[i,a,s,s,c,i][l],g:255*[c,i,i,a,s,s][l],b:255*[s,s,c,i,i,a][l]}}(i.h,i.s,i.v),c=!0,l="hsv"):i.hasOwnProperty("h")&&i.hasOwnProperty("s")&&i.hasOwnProperty("l")&&(i.s=M(i.s),i.l=M(i.l),r=function(t,e,i){var n,r,o;function s(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}if(t=A(t,360),e=A(e,100),i=A(i,100),0===e)n=r=o=i;else{var a=i<.5?i*(1+e):i+e-i*e,c=2*i-a;n=s(c,a,t+1/3),r=s(c,a,t),o=s(c,a,t-1/3)}return{r:255*n,g:255*r,b:255*o}}(i.h,i.s,i.l),c=!0,l="hsl"),i.hasOwnProperty("a")&&(a=i.a));var u,h,f;return a=$(a),{ok:c,format:i.format||l,r:o(255,s(r.r,0)),g:o(255,s(r.g,0)),b:o(255,s(r.b,0)),a:a}}(a);this._originalInput=a,this._r=u.r,this._g=u.g,this._b=u.b,this._a=u.a,this._roundA=r(100*this._a)/100,this._format=l.format||u.format,this._gradientType=l.gradientType,this._r<1&&(this._r=r(this._r)),this._g<1&&(this._g=r(this._g)),this._b<1&&(this._b=r(this._b)),this._ok=u.ok,this._tc_id=i++};function l(t,e,i){t=A(t,255),e=A(e,255),i=A(i,255);var n,r,a=s(t,e,i),c=o(t,e,i),l=(a+c)/2;if(a==c)n=r=0;else{var u=a-c;switch(r=l>.5?u/(2-a-c):u/(a+c),a){case t:n=(e-i)/u+(e<i?6:0);break;case e:n=(i-t)/u+2;break;case i:n=(t-e)/u+4}n/=6}return{h:n,s:r,l:l}}function u(t,e,i){t=A(t,255),e=A(e,255),i=A(i,255);var n,r,a=s(t,e,i),c=o(t,e,i),l=a,u=a-c;if(r=0===a?0:u/a,a==c)n=0;else{switch(a){case t:n=(e-i)/u+(e<i?6:0);break;case e:n=(i-t)/u+2;break;case i:n=(t-e)/u+4}n/=6}return{h:n,s:r,v:l}}function h(t,e,i,n){var o=[I(r(t).toString(16)),I(r(e).toString(16)),I(r(i).toString(16))];return n&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function f(t,e,i,n){var o;return[I((o=n,Math.round(255*parseFloat(o)).toString(16))),I(r(t).toString(16)),I(r(e).toString(16)),I(r(i).toString(16))].join("")}function p(t,e){e=0===e?0:e||10;var i=c(t).toHsl();return i.s-=e/100,i.s=E(i.s),c(i)}function d(t,e){e=0===e?0:e||10;var i=c(t).toHsl();return i.s+=e/100,i.s=E(i.s),c(i)}function g(t){return c(t).desaturate(100)}function m(t,e){e=0===e?0:e||10;var i=c(t).toHsl();return i.l+=e/100,i.l=E(i.l),c(i)}function v(t,e){e=0===e?0:e||10;var i=c(t).toRgb();return i.r=s(0,o(255,i.r-r(-e/100*255))),i.g=s(0,o(255,i.g-r(-e/100*255))),i.b=s(0,o(255,i.b-r(-e/100*255))),c(i)}function _(t,e){e=0===e?0:e||10;var i=c(t).toHsl();return i.l-=e/100,i.l=E(i.l),c(i)}function b(t,e){var i=c(t).toHsl(),n=(r(i.h)+e)%360;return i.h=n<0?360+n:n,c(i)}function y(t){var e=c(t).toHsl();return e.h=(e.h+180)%360,c(e)}function w(t){var e=c(t).toHsl(),i=e.h;return[c(t),c({h:(i+120)%360,s:e.s,l:e.l}),c({h:(i+240)%360,s:e.s,l:e.l})]}function x(t){var e=c(t).toHsl(),i=e.h;return[c(t),c({h:(i+90)%360,s:e.s,l:e.l}),c({h:(i+180)%360,s:e.s,l:e.l}),c({h:(i+270)%360,s:e.s,l:e.l})]}function C(t){var e=c(t).toHsl(),i=e.h;return[c(t),c({h:(i+72)%360,s:e.s,l:e.l}),c({h:(i+216)%360,s:e.s,l:e.l})]}function S(t,e,i){e=e||6,i=i||30;var n=c(t).toHsl(),r=360/i,o=[c(t)];for(n.h=(n.h-(r*e>>1)+720)%360;--e;)n.h=(n.h+r)%360,o.push(c(n));return o}function T(t,e){e=e||6;for(var i=c(t).toHsv(),n=i.h,r=i.s,o=i.v,s=[],a=1/e;e--;)s.push(c({h:n,s:r,v:o})),o=(o+a)%1;return s}c.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},setAlpha:function(t){return this._a=$(t),this._roundA=r(100*this._a)/100,this},toHsv:function(){var t=u(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=u(this._r,this._g,this._b),e=r(360*t.h),i=r(100*t.s),n=r(100*t.v);return 1==this._a?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=l(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=l(this._r,this._g,this._b),e=r(360*t.h),i=r(100*t.s),n=r(100*t.l);return 1==this._a?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(t){return h(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(){return f(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:r(this._r),g:r(this._g),b:r(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+r(this._r)+", "+r(this._g)+", "+r(this._b)+")":"rgba("+r(this._r)+", "+r(this._g)+", "+r(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:r(100*A(this._r,255))+"%",g:r(100*A(this._g,255))+"%",b:r(100*A(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+r(100*A(this._r,255))+"%, "+r(100*A(this._g,255))+"%, "+r(100*A(this._b,255))+"%)":"rgba("+r(100*A(this._r,255))+"%, "+r(100*A(this._g,255))+"%, "+r(100*A(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(k[h(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+f(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";t&&(i=c(t).toHex8String());return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0;return e||!n||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"name"!==t?("rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),i||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(m,arguments)},brighten:function(){return this._applyModification(v,arguments)},darken:function(){return this._applyModification(_,arguments)},desaturate:function(){return this._applyModification(p,arguments)},saturate:function(){return this._applyModification(d,arguments)},greyscale:function(){return this._applyModification(g,arguments)},spin:function(){return this._applyModification(b,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(S,arguments)},complement:function(){return this._applyCombination(y,arguments)},monochromatic:function(){return this._applyCombination(T,arguments)},splitcomplement:function(){return this._applyCombination(C,arguments)},triad:function(){return this._applyCombination(w,arguments)},tetrad:function(){return this._applyCombination(x,arguments)}},c.fromRatio=function(t,e){if("object"==typeof t){var i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]="a"===n?t[n]:M(t[n]));t=i}return c(t,e)},c.equals=function(t,e){return!(!t||!e)&&c(t).toRgbString()==c(e).toRgbString()},c.random=function(){return c.fromRatio({r:a(),g:a(),b:a()})},c.mix=function(t,e,i){i=0===i?0:i||50;var n,r=c(t).toRgb(),o=c(e).toRgb(),s=i/100,a=2*s-1,l=o.a-r.a,u=1-(n=((n=a*l==-1?a:(a+l)/(1+a*l))+1)/2),h={r:o.r*n+r.r*u,g:o.g*n+r.g*u,b:o.b*n+r.b*u,a:o.a*s+r.a*(1-s)};return c(h)},c.readability=function(t,e){var i=c(t),n=c(e),r=i.toRgb(),o=n.toRgb(),s=i.getBrightness(),a=n.getBrightness(),l=Math.max(r.r,o.r)-Math.min(r.r,o.r)+Math.max(r.g,o.g)-Math.min(r.g,o.g)+Math.max(r.b,o.b)-Math.min(r.b,o.b);return{brightness:Math.abs(s-a),color:l}},c.isReadable=function(t,e){var i=c.readability(t,e);return i.brightness>125&&i.color>500},c.mostReadable=function(t,e){for(var i=null,n=0,r=!1,o=0;o<e.length;o++){var s=c.readability(t,e[o]),a=s.brightness>125&&s.color>500,l=s.brightness/125*3+s.color/500;(a&&!r||a&&r&&l>n||!a&&!r&&l>n)&&(r=a,n=l,i=c(e[o]))}return i};var O=c.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},k=c.hexNames=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}(O);function $(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function A(t,e){var i;"string"==typeof(i=t)&&-1!=i.indexOf(".")&&1===parseFloat(i)&&(t="100%");var r,a="string"==typeof(r=t)&&-1!=r.indexOf("%");return t=o(e,s(0,parseFloat(t))),a&&(t=parseInt(t*e,10)/100),n.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function E(t){return o(1,s(0,t))}function j(t){return parseInt(t,16)}function I(t){return 1==t.length?"0"+t:""+t}function M(t){return t<=1&&(t=100*t+"%"),t}var P,D,F,L=(D="[\\s|\\(]+("+(P="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",F="[\\s|\\(]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",{rgb:new RegExp("rgb"+D),rgba:new RegExp("rgba"+F),hsl:new RegExp("hsl"+D),hsla:new RegExp("hsla"+F),hsv:new RegExp("hsv"+D),hsva:new RegExp("hsva"+F),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});window.tinycolor=c}(),t(function(){t.fn.spectrum.load&&t.fn.spectrum.processNativeColorInputs()})}),function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,e,i){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=42)}([function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function t(e,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.data=e,this.text=i.text||e,this.options=i}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.startBin="101",this.endBin="101",this.middleBin="01010",this.Lbinary=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],this.Gbinary=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],this.Rbinary=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"]}return t.prototype.encode=function(t,e,i){var n="";i=i||"";for(var r=0;r<t.length;r++)"L"==e[r]?n+=this.Lbinary[t[r]]:"G"==e[r]?n+=this.Gbinary[t[r]]:"R"==e[r]&&(n+=this.Rbinary[t[r]]),r<t.length-1&&(n+=i);return n},t}();e.default=i},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e;i++)t="0"+t;return t}Object.defineProperty(e,"__esModule",{value:!0});var r,o=i(0),s=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.encode=function(){for(var t="110",e=0;e<this.data.length;e++){var i=parseInt(this.data[e]).toString(2);i=n(i,4-i.length);for(var r=0;r<i.length;r++)t+="0"==i[r]?"100":"110"}return{data:t+="1001",text:this.text}},e.prototype.valid=function(){return-1!==this.data.search(/^[0-9]+$/)},e}(((r=o)&&r.__esModule?r:{default:r}).default);e.default=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var i,n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);for(i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&(n[i]=e[i]);return n}},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s,a=i(0),c=function(t){function e(i,o){n(this,e);var s=r(this,t.call(this,i.substring(1),o));s.bytes=[];for(var a=0;a<i.length;++a)s.bytes.push(i.charCodeAt(a));return s.encodings=[740,644,638,176,164,100,224,220,124,608,604,572,436,244,230,484,260,254,650,628,614,764,652,902,868,836,830,892,844,842,752,734,590,304,112,94,416,128,122,672,576,570,464,422,134,496,478,142,910,678,582,768,762,774,880,862,814,896,890,818,914,602,930,328,292,200,158,68,62,424,412,232,218,76,74,554,616,978,556,146,340,212,182,508,268,266,956,940,938,758,782,974,400,310,118,512,506,960,954,502,518,886,966,668,680,692,5379],s}return o(e,t),e.prototype.encode=function(){var t,e=this.bytes,i=e.shift()-105;if(103===i)t=this.nextA(e,1);else if(104===i)t=this.nextB(e,1);else{if(105!==i)throw new l;t=this.nextC(e,1)}return{text:this.text==this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:this.getEncoding(i)+t.result+this.getEncoding((t.checksum+i)%103)+this.getEncoding(106)}},e.prototype.getEncoding=function(t){return this.encodings[t]?(this.encodings[t]+1e3).toString(2):""},e.prototype.valid=function(){return-1!==this.data.search(/^[\x00-\x7F\xC8-\xD3]+$/)},e.prototype.nextA=function(t,e){if(t.length<=0)return{result:"",checksum:0};var i,n;if(t[0]>=200)n=t[0]-105,t.shift(),99===n?i=this.nextC(t,e+1):100===n?i=this.nextB(t,e+1):98===n?(t[0]=t[0]>95?t[0]-96:t[0],i=this.nextA(t,e+1)):i=this.nextA(t,e+1);else{var r=t[0];n=r<32?r+64:r-32,t.shift(),i=this.nextA(t,e+1)}var o=n*e;return{result:this.getEncoding(n)+i.result,checksum:o+i.checksum}},e.prototype.nextB=function(t,e){if(t.length<=0)return{result:"",checksum:0};var i,n;t[0]>=200?(n=t[0]-105,t.shift(),99===n?i=this.nextC(t,e+1):101===n?i=this.nextA(t,e+1):98===n?(t[0]=t[0]<32?t[0]+96:t[0],i=this.nextB(t,e+1)):i=this.nextB(t,e+1)):(n=t[0]-32,t.shift(),i=this.nextB(t,e+1));var r=n*e;return{result:this.getEncoding(n)+i.result,checksum:r+i.checksum}},e.prototype.nextC=function(t,e){if(t.length<=0)return{result:"",checksum:0};var i,n;t[0]>=200?(n=t[0]-105,t.shift(),i=100===n?this.nextB(t,e+1):101===n?this.nextA(t,e+1):this.nextC(t,e+1)):(n=10*(t[0]-48)+t[1]-48,t.shift(),t.shift(),i=this.nextC(t,e+1));var r=n*e;return{result:this.getEncoding(n)+i.result,checksum:r+i.checksum}},e}(((s=a)&&s.__esModule?s:{default:s}).default),l=function(t){function e(){n(this,e);var i=r(this,t.call(this));return i.name="InvalidStartCharacterException",i.message="The encoding does not start with a start character.",i}return o(e,t),e}(Error);e.default=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mod10=function(t){for(var e=0,i=0;i<t.length;i++){var n=parseInt(t[i]);e+=(i+t.length)%2==0?n:2*n%10+Math.floor(2*n/10)}return(10-e%10)%10},e.mod11=function(t){for(var e=0,i=[2,3,4,5,6,7],n=0;n<t.length;n++){var r=parseInt(t[t.length-1-n]);e+=i[n%i.length]*r}return(11-e%11)%11}},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(r,o){i(this,e);var s=n(this,t.call(this));return s.name="InvalidInputException",s.symbology=r,s.input=o,s.message='"'+s.input+'" is not a valid input for '+s.symbology,s}return r(e,t),e}(Error),s=function(t){function e(){i(this,e);var r=n(this,t.call(this));return r.name="InvalidElementException",r.message="Not supported type to render on",r}return r(e,t),e}(Error),a=function(t){function e(){i(this,e);var r=n(this,t.call(this));return r.name="NoElementException",r.message="No element to render on.",r}return r(e,t),e}(Error);e.InvalidInputException=o,e.InvalidElementException=s,e.NoElementException=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=["width","height","textMargin","fontSize","margin","marginTop","marginBottom","marginLeft","marginRight"];for(var i in e)e.hasOwnProperty(i)&&(i=e[i],"string"==typeof t[i]&&(t[i]=parseInt(t[i],10)));return"string"==typeof t.displayValue&&(t.displayValue="false"!=t.displayValue),t}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={width:2,height:100,format:"auto",displayValue:!0,fontOptions:"",font:"monospace",text:void 0,textAlign:"center",textPosition:"bottom",textMargin:2,fontSize:20,background:"#ffffff",lineColor:"#000000",margin:10,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(){}}},function(t,e,i){"use strict";function n(t,e){return e.height+(e.displayValue&&t.text.length>0?e.fontSize+e.textMargin:0)+e.marginTop+e.marginBottom}function r(t,e,i){if(i.displayValue&&e<t){if("center"==i.textAlign)return Math.floor((t-e)/2);if("left"==i.textAlign)return 0;if("right"==i.textAlign)return Math.floor(t-e)}return 0}Object.defineProperty(e,"__esModule",{value:!0}),e.getTotalWidthOfEncodings=e.calculateEncodingAttributes=e.getBarcodePadding=e.getEncodingHeight=e.getMaximumHeightOfEncodings=void 0;var o,s=i(3),a=(o=s)&&o.__esModule?o:{default:o};e.getMaximumHeightOfEncodings=function(t){for(var e=0,i=0;i<t.length;i++)t[i].height>e&&(e=t[i].height);return e},e.getEncodingHeight=n,e.getBarcodePadding=r,e.calculateEncodingAttributes=function(t,e,i){for(var o=0;o<t.length;o++){var s,c=t[o],l=(0,a.default)(e,c.options);s=l.displayValue?(h=c.text,f=l,d=void 0,(d=void 0===(p=i)?document.createElement("canvas").getContext("2d"):p).font=f.fontOptions+" "+f.fontSize+"px "+f.font,d.measureText(h).width):0;var u=c.data.length*l.width;c.width=Math.ceil(Math.max(s,u)),c.height=n(c,l),c.barcodePadding=r(s,u,l)}var h,f,p,d},e.getTotalWidthOfEncodings=function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i].width;return e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(20),r=i(19),o=i(26),s=i(29),a=i(28),c=i(34),l=i(36),u=i(35),h=i(27);e.default={CODE39:n.CODE39,CODE128:r.CODE128,CODE128A:r.CODE128A,CODE128B:r.CODE128B,CODE128C:r.CODE128C,EAN13:o.EAN13,EAN8:o.EAN8,EAN5:o.EAN5,EAN2:o.EAN2,UPC:o.UPC,ITF14:s.ITF14,ITF:a.ITF,MSI:c.MSI,MSI10:c.MSI10,MSI11:c.MSI11,MSI1010:c.MSI1010,MSI1110:c.MSI1110,pharmacode:l.pharmacode,codabar:u.codabar,GenericBarcode:h.GenericBarcode}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.api=e}return t.prototype.handleCatch=function(t){if("InvalidInputException"!==t.name)throw t;if(this.api._options.valid===this.api._defaults.valid)throw t.message;this.api._options.valid(!1),this.api.render=function(){}},t.prototype.wrapBarcodeCall=function(t){try{var e=t.apply(void 0,arguments);return this.api._options.valid(!0),e}catch(t){return this.handleCatch(t),this.api}},t}();e.default=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.marginTop=t.marginTop||t.margin,t.marginBottom=t.marginBottom||t.margin,t.marginRight=t.marginRight||t.margin,t.marginLeft=t.marginLeft||t.margin,t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if("string"==typeof t)return function(t){var e=document.querySelectorAll(t);if(0!==e.length){for(var i=[],n=0;n<e.length;n++)i.push(r(e[n]));return i}}(t);if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(r(t[i]));return e}if("undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLImageElement)return n=t,l=document.createElement("canvas"),{element:l,options:(0,s.default)(n),renderer:a.default.CanvasRenderer,afterRender:function(){n.setAttribute("src",l.toDataURL())}};var n,l;if("undefined"!=typeof SVGElement&&t instanceof SVGElement)return{element:t,options:(0,s.default)(t),renderer:a.default.SVGRenderer};if("undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement)return{element:t,options:(0,s.default)(t),renderer:a.default.CanvasRenderer};if(t&&t.getContext)return{element:t,renderer:a.default.CanvasRenderer};if(t&&"object"===(void 0===t?"undefined":o(t))&&!t.nodeName)return{element:t,renderer:a.default.ObjectRenderer};throw new c.InvalidElementException}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=n(i(37)),a=n(i(39)),c=i(6);e.default=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=[];return function t(i){if(Array.isArray(i))for(var n=0;n<i.length;n++)t(i[n]);else i.text=i.text||"",i.data=i.data||"",e.push(i)}(t),e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(4),o=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,String.fromCharCode(208)+i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[\x00-\x5F\xC8-\xCF]+$/)},e}(((n=r)&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(4),o=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,String.fromCharCode(209)+i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[\x20-\x7F\xC8-\xCF]+$/)},e}(((n=r)&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(4),o=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,String.fromCharCode(210)+i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^(\xCF*[0-9]{2}\xCF*)+$/)},e}(((n=r)&&n.__esModule?n:{default:n}).default);e.default=o},function(t,e,i){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t){var e=t.match(/^([\x00-\x5F\xC8-\xCF]+?)(([0-9]{2}){2,})([^0-9]|$)/);if(e)return e[1]+String.fromCharCode(204)+s(t.substring(e[1].length));var i=t.match(/^[\x00-\x5F\xC8-\xCF]+/);return i[0].length===t.length?t:i[0]+String.fromCharCode(205)+o(t.substring(i[0].length))}function o(t){var e=t.match(/^([\x20-\x7F\xC8-\xCF]+?)(([0-9]{2}){2,})([^0-9]|$)/);if(e)return e[1]+String.fromCharCode(204)+s(t.substring(e[1].length));var i=t.match(/^[\x20-\x7F\xC8-\xCF]+/);return i[0].length===t.length?t:i[0]+String.fromCharCode(206)+r(t.substring(i[0].length))}function s(t){var e=t.match(/^(\xCF*[0-9]{2}\xCF*)+/)[0],i=e.length;return i===t.length?t:(t=t.substring(i)).match(/^[\x00-\x5F\xC8-\xCF]*/)[0].length>=t.match(/^[\x20-\x7F\xC8-\xCF]*/)[0].length?e+String.fromCharCode(206)+r(t):e+String.fromCharCode(205)+o(t)}Object.defineProperty(e,"__esModule",{value:!0});var a,c=i(4),l=function(t){function e(i,a){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),-1!==i.search(/^[\x00-\x7F\xC8-\xD3]+$/))var c=n(this,t.call(this,(l=i,u=l.match(/^[\x00-\x5F\xC8-\xCF]*/)[0].length,h=l.match(/^[\x20-\x7F\xC8-\xCF]*/)[0].length,(l.match(/^(\xCF*[0-9]{2}\xCF*)*/)[0].length>=2?String.fromCharCode(210)+s(l):u>h?String.fromCharCode(208)+r(l):String.fromCharCode(209)+o(l)).replace(/[\xCD\xCE]([^])[\xCD\xCE]/,function(t,e){return String.fromCharCode(203)+e})),a));else c=n(this,t.call(this,i,a));var l,u,h;return n(c)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(((a=c)&&a.__esModule?a:{default:a}).default);e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.CODE128C=e.CODE128B=e.CODE128A=e.CODE128=void 0;var r=n(i(18)),o=n(i(15)),s=n(i(16)),a=n(i(17));e.CODE128=r.default,e.CODE128A=o.default,e.CODE128B=s.default,e.CODE128C=a.default},function(t,e,i){"use strict";function n(t){return e=r(t),l[e].toString(2);var e}function r(t){return c.indexOf(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.CODE39=void 0;var o,s=i(0),a=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i=i.toUpperCase(),n.mod43&&(i+=(o=function(t){for(var e=0,i=0;i<t.length;i++)e+=r(t[i]);return e%43}(i),c[o])),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n));var o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.encode=function(){for(var t=n("*"),e=0;e<this.data.length;e++)t+=n(this.data[e])+"0";return{data:t+=n("*"),text:this.text}},e.prototype.valid=function(){return-1!==this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)},e}(((o=s)&&o.__esModule?o:{default:o}).default),c=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],l=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];e.CODE39=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){var e,i=0;for(e=0;e<12;e+=2)i+=parseInt(t[e]);for(e=1;e<12;e+=2)i+=3*parseInt(t[e]);return(10-i%10)%10}Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(1)),s=function(t){function e(i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),-1!==i.search(/^[0-9]{12}$/)&&(i+=r(i));var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n));return!n.flat&&n.fontSize>10*n.width?o.fontSize=10*n.width:o.fontSize=n.fontSize,o.guardHeight=n.height+o.fontSize/2+n.textMargin,o.lastChar=n.lastChar,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[0-9]{13}$/)&&this.data[12]==r(this.data)},e.prototype.encode=function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()},e.prototype.getStructure=function(){return["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"]},e.prototype.guardedEncoding=function(){var t=new o.default,e=[],i=this.getStructure()[this.data[0]],n=this.data.substr(1,6),r=this.data.substr(7,6);return this.options.displayValue&&e.push({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),e.push({data:"101",options:{height:this.guardHeight}}),e.push({data:t.encode(n,i),text:this.text.substr(1,6),options:{fontSize:this.fontSize}}),e.push({data:"01010",options:{height:this.guardHeight}}),e.push({data:t.encode(r,"RRRRRR"),text:this.text.substr(7,6),options:{fontSize:this.fontSize}}),e.push({data:"101",options:{height:this.guardHeight}}),this.options.lastChar&&this.options.displayValue&&(e.push({data:"00"}),e.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}})),e},e.prototype.flatEncoding=function(){var t=new o.default,e="",i=this.getStructure()[this.data[0]];return e+="101",e+=t.encode(this.data.substr(1,6),i),e+="01010",e+=t.encode(this.data.substr(7,6),"RRRRRR"),{data:e+="101",text:this.text}},e}(n(i(0)).default);e.default=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(1)),o=function(t){function e(i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n));return r.structure=["LL","LG","GL","GG"],r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[0-9]{2}$/)},e.prototype.encode=function(){var t=new r.default,e=this.structure[parseInt(this.data)%4],i="1011";return{data:i+=t.encode(this.data,e,"01"),text:this.text}},e}(n(i(0)).default);e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(1)),o=function(t){function e(i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n));return r.structure=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[0-9]{5}$/)},e.prototype.encode=function(){var t=new r.default,e=this.checksum(),i="1011";return{data:i+=t.encode(this.data,this.structure[e],"01"),text:this.text}},e.prototype.checksum=function(){var t=0;return t+=3*parseInt(this.data[0]),t+=9*parseInt(this.data[1]),t+=3*parseInt(this.data[2]),t+=9*parseInt(this.data[3]),(t+=3*parseInt(this.data[4]))%10},e}(n(i(0)).default);e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){var e,i=0;for(e=0;e<7;e+=2)i+=3*parseInt(t[e]);for(e=1;e<7;e+=2)i+=parseInt(t[e]);return(10-i%10)%10}Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(1)),s=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),-1!==i.search(/^[0-9]{7}$/)&&(i+=r(i)),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[0-9]{8}$/)&&this.data[7]==r(this.data)},e.prototype.encode=function(){var t=new o.default,e="",i=this.data.substr(0,4),n=this.data.substr(4,4);return e+=t.startBin,e+=t.encode(i,"LLLL"),e+=t.middleBin,e+=t.encode(n,"RRRR"),{data:e+=t.endBin,text:this.text}},e}(n(i(0)).default);e.default=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){var e,i=0;for(e=1;e<11;e+=2)i+=parseInt(t[e]);for(e=0;e<11;e+=2)i+=3*parseInt(t[e]);return(10-i%10)%10}Object.defineProperty(e,"__esModule",{value:!0});var o=n(i(1)),s=function(t){function e(i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),-1!==i.search(/^[0-9]{11}$/)&&(i+=r(i));var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n));return o.displayValue=n.displayValue,n.fontSize>10*n.width?o.fontSize=10*n.width:o.fontSize=n.fontSize,o.guardHeight=n.height+o.fontSize/2+n.textMargin,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[0-9]{12}$/)&&this.data[11]==r(this.data)},e.prototype.encode=function(){return this.options.flat?this.flatEncoding():this.guardedEncoding()},e.prototype.flatEncoding=function(){var t=new o.default,e="";return e+="101",e+=t.encode(this.data.substr(0,6),"LLLLLL"),e+="01010",e+=t.encode(this.data.substr(6,6),"RRRRRR"),{data:e+="101",text:this.text}},e.prototype.guardedEncoding=function(){var t=new o.default,e=[];return this.displayValue&&e.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),e.push({data:"101"+t.encode(this.data[0],"L"),options:{height:this.guardHeight}}),e.push({data:t.encode(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),e.push({data:"01010",options:{height:this.guardHeight}}),e.push({data:t.encode(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),e.push({data:t.encode(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&e.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),e},e}(n(i(0)).default);e.default=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.UPC=e.EAN2=e.EAN5=e.EAN8=e.EAN13=void 0;var r=n(i(21)),o=n(i(24)),s=n(i(23)),a=n(i(22)),c=n(i(25));e.EAN13=r.default,e.EAN8=o.default,e.EAN5=s.default,e.EAN2=a.default,e.UPC=c.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GenericBarcode=void 0;var n,r=i(0),o=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.encode=function(){return{data:"10101010101010101010101010101010101010101",text:this.text}},e.prototype.valid=function(){return!0},e}(((n=r)&&n.__esModule?n:{default:n}).default);e.GenericBarcode=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ITF=void 0;var n,r=i(0),o=function(t){function e(i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n));return r.binaryRepresentation={0:"00110",1:"10001",2:"01001",3:"11000",4:"00101",5:"10100",6:"01100",7:"00011",8:"10010",9:"01010"},r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^([0-9]{2})+$/)},e.prototype.encode=function(){for(var t="1010",e=0;e<this.data.length;e+=2)t+=this.calculatePair(this.data.substr(e,2));return{data:t+="11101",text:this.text}},e.prototype.calculatePair=function(t){for(var e="",i=this.binaryRepresentation[t[0]],n=this.binaryRepresentation[t[1]],r=0;r<5;r++)e+="1"==i[r]?"111":"1",e+="1"==n[r]?"000":"0";return e},e}(((n=r)&&n.__esModule?n:{default:n}).default);e.ITF=o},function(t,e,i){"use strict";function n(t){for(var e=0,i=0;i<13;i++)e+=parseInt(t[i])*(3-i%2*2);return 10*Math.ceil(e/10)-e}Object.defineProperty(e,"__esModule",{value:!0}),e.ITF14=void 0;var r,o=i(0),s=function(t){function e(i,r){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),-1!==i.search(/^[0-9]{13}$/)&&(i+=n(i));var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,r));return o.binaryRepresentation={0:"00110",1:"10001",2:"01001",3:"11000",4:"00101",5:"10100",6:"01100",7:"00011",8:"10010",9:"01010"},o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[0-9]{14}$/)&&this.data[13]==n(this.data)},e.prototype.encode=function(){for(var t="1010",e=0;e<14;e+=2)t+=this.calculatePair(this.data.substr(e,2));return{data:t+="11101",text:this.text}},e.prototype.calculatePair=function(t){for(var e="",i=this.binaryRepresentation[t[0]],n=this.binaryRepresentation[t[1]],r=0;r<5;r++)e+="1"==i[r]?"111":"1",e+="1"==n[r]?"000":"0";return e},e}(((r=o)&&r.__esModule?r:{default:r}).default);e.ITF14=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(2),o=(n=r)&&n.__esModule?n:{default:n},s=i(5),a=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i+(0,s.mod10)(i),n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(o.default);e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(2),o=(n=r)&&n.__esModule?n:{default:n},s=i(5),a=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i+=(0,s.mod10)(i),i+=(0,s.mod10)(i),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(o.default);e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(2),o=(n=r)&&n.__esModule?n:{default:n},s=i(5),a=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i+(0,s.mod11)(i),n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(o.default);e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(2),o=(n=r)&&n.__esModule?n:{default:n},s=i(5),a=function(t){function e(i,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i+=(0,s.mod11)(i),i+=(0,s.mod10)(i),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(o.default);e.default=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.MSI1110=e.MSI1010=e.MSI11=e.MSI10=e.MSI=void 0;var r=n(i(2)),o=n(i(30)),s=n(i(32)),a=n(i(31)),c=n(i(33));e.MSI=r.default,e.MSI10=o.default,e.MSI11=s.default,e.MSI1010=a.default,e.MSI1110=c.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.codabar=void 0;var n,r=i(0),o=function(t){function e(i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,e),0===i.search(/^[0-9\-\$\:\.\+\/]+$/)&&(i="A"+i+"A");var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i.toUpperCase(),n));return r.text=r.options.text||r.text.replace(/[A-D]/g,""),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.valid=function(){return-1!==this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)},e.prototype.encode=function(){for(var t=[],e=this.getEncodings(),i=0;i<this.data.length;i++)t.push(e[this.data.charAt(i)]),i!==this.data.length-1&&t.push("0");return{text:this.text,data:t.join("")}},e.prototype.getEncodings=function(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"101100110011",A:"1011001001",B:"1010010011",C:"1001001011",D:"1010011001"}},e}(((n=r)&&n.__esModule?n:{default:n}).default);e.codabar=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pharmacode=void 0;var n,r=i(0),o=function(t){function e(i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,n));return r.number=parseInt(i,10),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.encode=function(){for(var t=this.number,e="";!isNaN(t)&&0!=t;)t%2==0?(e="11100"+e,t=(t-2)/2):(e="100"+e,t=(t-1)/2);return{data:e=e.slice(0,-2),text:this.text}},e.prototype.valid=function(){return this.number>=3&&this.number<=131070},e}(((n=r)&&n.__esModule?n:{default:n}).default);e.pharmacode=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(7)),o=n(i(8));e.default=function(t){var e={};for(var i in o.default)o.default.hasOwnProperty(i)&&(t.hasAttribute("jsbarcode-"+i.toLowerCase())&&(e[i]=t.getAttribute("jsbarcode-"+i.toLowerCase())),t.hasAttribute("data-"+i.toLowerCase())&&(e[i]=t.getAttribute("data-"+i.toLowerCase())));return e.value=t.getAttribute("jsbarcode-value")||t.getAttribute("data-value"),(0,r.default)(e)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=i(3),o=(n=r)&&n.__esModule?n:{default:n},s=i(9),a=function(){function t(e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.canvas=e,this.encodings=i,this.options=n}return t.prototype.render=function(){if(!this.canvas.getContext)throw new Error("The browser does not support canvas.");this.prepareCanvas();for(var t=0;t<this.encodings.length;t++){var e=(0,o.default)(this.options,this.encodings[t].options);this.drawCanvasBarcode(e,this.encodings[t]),this.drawCanvasText(e,this.encodings[t]),this.moveCanvasDrawing(this.encodings[t])}this.restoreCanvas()},t.prototype.prepareCanvas=function(){var t=this.canvas.getContext("2d");t.save(),(0,s.calculateEncodingAttributes)(this.encodings,this.options,t);var e=(0,s.getTotalWidthOfEncodings)(this.encodings),i=(0,s.getMaximumHeightOfEncodings)(this.encodings);this.canvas.width=e+this.options.marginLeft+this.options.marginRight,this.canvas.height=i,t.clearRect(0,0,this.canvas.width,this.canvas.height),this.options.background&&(t.fillStyle=this.options.background,t.fillRect(0,0,this.canvas.width,this.canvas.height)),t.translate(this.options.marginLeft,0)},t.prototype.drawCanvasBarcode=function(t,e){var i,n=this.canvas.getContext("2d"),r=e.data;i="top"==t.textPosition?t.marginTop+t.fontSize+t.textMargin:t.marginTop,n.fillStyle=t.lineColor;for(var o=0;o<r.length;o++){var s=o*t.width+e.barcodePadding;"1"===r[o]?n.fillRect(s,i,t.width,t.height):r[o]&&n.fillRect(s,i,t.width,t.height*r[o])}},t.prototype.drawCanvasText=function(t,e){var i,n,r=this.canvas.getContext("2d"),o=t.fontOptions+" "+t.fontSize+"px "+t.font;t.displayValue&&(n="top"==t.textPosition?t.marginTop+t.fontSize-t.textMargin:t.height+t.textMargin+t.marginTop+t.fontSize,r.font=o,"left"==t.textAlign||e.barcodePadding>0?(i=0,r.textAlign="left"):"right"==t.textAlign?(i=e.width-1,r.textAlign="right"):(i=e.width/2,r.textAlign="center"),r.fillText(e.text,i,n))},t.prototype.moveCanvasDrawing=function(t){this.canvas.getContext("2d").translate(t.width,0)},t.prototype.restoreCanvas=function(){this.canvas.getContext("2d").restore()},t}();e.default=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(38)),o=n(i(41)),s=n(i(40));e.default={CanvasRenderer:r.default,SVGRenderer:o.default,ObjectRenderer:s.default}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.object=e,this.encodings=i,this.options=n}return t.prototype.render=function(){this.object.encodings=this.encodings},t}();e.default=i},function(t,e,i){"use strict";function n(t,e,i,n,r){var o=document.createElementNS(c,"rect");return o.setAttribute("x",t),o.setAttribute("y",e),o.setAttribute("width",i),o.setAttribute("height",n),r.appendChild(o),o}Object.defineProperty(e,"__esModule",{value:!0});var r,o=i(3),s=(r=o)&&r.__esModule?r:{default:r},a=i(9),c="http://www.w3.org/2000/svg",l=function(){function t(e,i,n){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.svg=e,this.encodings=i,this.options=n}return t.prototype.render=function(){var t,e,i,n,r,o=this.options.marginLeft;this.prepareSVG();for(var a=0;a<this.encodings.length;a++){var l=this.encodings[a],u=(0,s.default)(this.options,l.options),h=(e=o,i=u.marginTop,n=this.svg,r=void 0,(r=document.createElementNS(c,"g")).setAttribute("transform","translate("+e+", "+i+")"),n.appendChild(r),r);t=u,h.setAttribute("style","fill:"+t.lineColor+";"),this.drawSvgBarcode(h,u,l),this.drawSVGText(h,u,l),o+=l.width}},t.prototype.prepareSVG=function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);(0,a.calculateEncodingAttributes)(this.encodings,this.options);var t=(0,a.getTotalWidthOfEncodings)(this.encodings),e=(0,a.getMaximumHeightOfEncodings)(this.encodings),i=t+this.options.marginLeft+this.options.marginRight;this.setSvgAttributes(i,e),this.options.background&&n(0,0,i,e,this.svg).setAttribute("style","fill:"+this.options.background+";")},t.prototype.drawSvgBarcode=function(t,e,i){var r,o=i.data;r="top"==e.textPosition?e.fontSize+e.textMargin:0;for(var s=0,a=0,c=0;c<o.length;c++)a=c*e.width+i.barcodePadding,"1"===o[c]?s++:s>0&&(n(a-e.width*s,r,e.width*s,e.height,t),s=0);s>0&&n(a-e.width*(s-1),r,e.width*s,e.height,t)},t.prototype.drawSVGText=function(t,e,i){var n,r,o=document.createElementNS(c,"text");e.displayValue&&(o.setAttribute("font-family",e.font),o.setAttribute("font-size",e.fontSize+"px"),r="top"==e.textPosition?e.fontSize-e.textMargin:e.height+e.textMargin+e.fontSize,"left"==e.textAlign||i.barcodePadding>0?(n=0,o.setAttribute("text-anchor","start")):"right"==e.textAlign?(n=i.width-1,o.setAttribute("text-anchor","end")):(n=i.width/2,o.setAttribute("text-anchor","middle")),o.setAttribute("x",n),o.setAttribute("y",r),o.appendChild(document.createTextNode(i.text)),t.appendChild(o))},t.prototype.setSvgAttributes=function(t,e){var i=this.svg;i.setAttribute("width",t+"px"),i.setAttribute("height",e+"px"),i.setAttribute("x","0px"),i.setAttribute("y","0px"),i.setAttribute("viewBox","0 0 "+t+" "+e),i.setAttribute("xmlns",c),i.setAttribute("version","1.1"),i.style.transform="translate(0,0)"},t}();e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){v.prototype[e]=v.prototype[e.toUpperCase()]=v.prototype[e.toLowerCase()]=function(i,n){var r=this;return r._errorHandler.wrapBarcodeCall(function(){n.text=void 0===n.text?void 0:""+n.text;var s=(0,l.default)(r._options,n);s=(0,p.default)(s);var a=t[e],c=o(i,a,s);return r._encodings.push(c),r})}}function o(t,e,i){var n=new e(t=""+t,i);if(!n.valid())throw new g.InvalidInputException(n.constructor.name,t);var r=n.encode();r=(0,u.default)(r);for(var o=0;o<r.length;o++)r[o].options=(0,l.default)(i,r[o].options);return r}function s(){return c.default.CODE128?"CODE128":Object.keys(c.default)[0]}function a(t,e,i){e=(0,u.default)(e);for(var n=0;n<e.length;n++)e[n].options=(0,l.default)(i,e[n].options),(0,h.default)(e[n].options);(0,h.default)(i),new(0,t.renderer)(t.element,e,i).render(),t.afterRender&&t.afterRender()}var c=n(i(10)),l=n(i(3)),u=n(i(14)),h=n(i(12)),f=n(i(13)),p=n(i(7)),d=n(i(11)),g=i(6),m=n(i(8)),v=function(){},_=function(t,e,i){var n=new v;if(void 0===t)throw Error("No element to render on was provided.");return n._renderProperties=(0,f.default)(t),n._encodings=[],n._options=m.default,n._errorHandler=new d.default(n),void 0!==e&&((i=i||{}).format||(i.format=s()),n.options(i)[i.format](e,i).render()),n};_.getModule=function(t){return c.default[t]};for(var b in c.default)c.default.hasOwnProperty(b)&&r(c.default,b);v.prototype.options=function(t){return this._options=(0,l.default)(this._options,t),this},v.prototype.blank=function(t){var e="0".repeat(t);return this._encodings.push({data:e}),this},v.prototype.init=function(){if(this._renderProperties){var t;Array.isArray(this._renderProperties)||(this._renderProperties=[this._renderProperties]);for(var e in this._renderProperties){t=this._renderProperties[e];var i=(0,l.default)(this._options,t.options);"auto"==i.format&&(i.format=s()),this._errorHandler.wrapBarcodeCall(function(){var e=o(i.value,c.default[i.format.toUpperCase()],i);a(t,e,i)})}}},v.prototype.render=function(){if(!this._renderProperties)throw new g.NoElementException;if(Array.isArray(this._renderProperties))for(var t=0;t<this._renderProperties.length;t++)a(this._renderProperties[t],this._encodings,this._options);else a(this._renderProperties,this._encodings,this._options);return this},v.prototype._defaults=m.default,"undefined"!=typeof window&&(window.JsBarcode=_),"undefined"!=typeof jQuery&&(jQuery.fn.JsBarcode=function(t,e){var i=[];return jQuery(this).each(function(){i.push(this)}),_(i,t,e)}),t.exports=_}]),function(t,e){"use strict";function i(i,o){function s(){u.width=i.offsetWidth,u.height=i.offsetHeight,h.fillStyle=o.dotColor,h.strokeStyle=o.lineColor,h.lineWidth=o.lineWidth}function a(){if(m){f=t.innerWidth,p=t.innerHeight,h.clearRect(0,0,u.width,u.height);for(var e=0;e<v.length;e++)v[e].updatePosition();for(e=0;e<v.length;e++)v[e].draw();S||requestAnimationFrame(a)}}function c(){switch(this.stackPos,this.active=!0,this.layer=Math.ceil(3*Math.random()),this.parallaxOffsetX=0,this.parallaxOffsetY=0,this.position={x:Math.ceil(Math.random()*u.width),y:Math.ceil(Math.random()*u.height)},this.speed={},o.directionX){case"left":this.speed.x=+(-o.maxSpeedX+Math.random()*o.maxSpeedX-o.minSpeedX).toFixed(2);break;case"right":this.speed.x=+(Math.random()*o.maxSpeedX+o.minSpeedX).toFixed(2);break;default:this.speed.x=+(-o.maxSpeedX/2+Math.random()*o.maxSpeedX).toFixed(2),this.speed.x+=0<this.speed.x?o.minSpeedX:-o.minSpeedX}switch(o.directionY){case"up":this.speed.y=+(-o.maxSpeedY+Math.random()*o.maxSpeedY-o.minSpeedY).toFixed(2);break;case"down":this.speed.y=+(Math.random()*o.maxSpeedY+o.minSpeedY).toFixed(2);break;default:this.speed.y=+(-o.maxSpeedY/2+Math.random()*o.maxSpeedY).toFixed(2),this.speed.x+=0<this.speed.y?o.minSpeedY:-o.minSpeedY}}function l(t){void 0!==o[t]&&o[t].call(i)}var u,h,f,p,d,g,m=!!e.createElement("canvas").getContext,v=[],_=0,b=0,y=!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|mobi|tablet|opera mini|nexus 7)/i),w=!!t.DeviceOrientationEvent,x=0,C=0,S=!1;return o=function(t){t=t||{};for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n in i)i.hasOwnProperty(n)&&("object"==typeof i[n]?deepExtend(t[n],i[n]):t[n]=i[n])}return t}({},t[n].defaults,o),c.prototype.draw=function(){h.beginPath(),h.arc(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY,o.particleRadius/2,0,2*Math.PI,!0),h.closePath(),h.fill(),h.beginPath();for(var t=v.length-1;t>this.stackPos;t--){var e=v[t],i=this.position.x-e.position.x,n=this.position.y-e.position.y;Math.sqrt(i*i+n*n).toFixed(2)<o.proximity&&(h.moveTo(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY),o.curvedLines?h.quadraticCurveTo(Math.max(e.position.x,e.position.x),Math.min(e.position.y,e.position.y),e.position.x+e.parallaxOffsetX,e.position.y+e.parallaxOffsetY):h.lineTo(e.position.x+e.parallaxOffsetX,e.position.y+e.parallaxOffsetY))}h.stroke(),h.closePath()},c.prototype.updatePosition=function(){o.parallax&&(w&&!y?(d=(f-0)/60*(x- -30)+0,g=(p-0)/60*(C- -30)+0):(d=_,g=b),this.parallaxTargX=(d-f/2)/(o.parallaxMultiplier*this.layer),this.parallaxOffsetX+=(this.parallaxTargX-this.parallaxOffsetX)/10,this.parallaxTargY=(g-p/2)/(o.parallaxMultiplier*this.layer),this.parallaxOffsetY+=(this.parallaxTargY-this.parallaxOffsetY)/10);var t=i.offsetWidth,e=i.offsetHeight;switch(o.directionX){case"left":this.position.x+this.speed.x+this.parallaxOffsetX<0&&(this.position.x=t-this.parallaxOffsetX);break;case"right":this.position.x+this.speed.x+this.parallaxOffsetX>t&&(this.position.x=0-this.parallaxOffsetX);break;default:(this.position.x+this.speed.x+this.parallaxOffsetX>t||this.position.x+this.speed.x+this.parallaxOffsetX<0)&&(this.speed.x=-this.speed.x)}switch(o.directionY){case"up":this.position.y+this.speed.y+this.parallaxOffsetY<0&&(this.position.y=e-this.parallaxOffsetY);break;case"down":this.position.y+this.speed.y+this.parallaxOffsetY>e&&(this.position.y=0-this.parallaxOffsetY);break;default:(this.position.y+this.speed.y+this.parallaxOffsetY>e||this.position.y+this.speed.y+this.parallaxOffsetY<0)&&(this.speed.y=-this.speed.y)}this.position.x+=this.speed.x,this.position.y+=this.speed.y},c.prototype.setStackPos=function(t){this.stackPos=t},function(){if(m){(u=e.createElement("canvas")).className="pg-canvas",u.style.display="block",i.insertBefore(u,i.firstChild),h=u.getContext("2d"),s();for(var n=Math.round(u.width*u.height/o.density),r=0;r<n;r++){var f=new c;f.setStackPos(r),v.push(f)}t.addEventListener("resize",function(){!function(){s();for(var t=i.offsetWidth,e=i.offsetHeight,n=v.length-1;0<=n;n--)(v[n].position.x>t||v[n].position.y>e)&&v.splice(n,1);var r=Math.round(u.width*u.height/o.density);if(r>v.length)for(;r>v.length;){var a=new c;v.push(a)}else r<v.length&&v.splice(r);for(n=v.length-1;0<=n;n--)v[n].setStackPos(n)}()},!1),e.addEventListener("mousemove",function(t){_=t.pageX,b=t.pageY},!1),w&&!y&&t.addEventListener("deviceorientation",function(){C=Math.min(Math.max(-event.beta,-30),30),x=Math.min(Math.max(-event.gamma,-30),30)},!0),a(),l("onInit")}}(),{option:function(t,e){return e?void(o[t]=e):o[t]},destroy:function(){console.log("destroy"),u.parentNode.removeChild(u),l("onDestroy"),r&&r(i).removeData("plugin_"+n)},start:function(){S=!1,a()},pause:function(){S=!0}}}var n="particleground",r=t.jQuery;t[n]=function(t,e){return new i(t,e)},t[n].defaults={minSpeedX:.1,maxSpeedX:.7,minSpeedY:.1,maxSpeedY:.7,directionX:"center",directionY:"center",density:1e4,dotColor:"#666666",lineColor:"#666666",particleRadius:7,lineWidth:1,curvedLines:!1,proximity:100,parallax:!0,parallaxMultiplier:5,onInit:function(){},onDestroy:function(){}},r&&(r.fn[n]=function(t){if("string"!=typeof t)return"object"!=typeof t&&t?void 0:this.each(function(){r.data(this,"plugin_"+n)||r.data(this,"plugin_"+n,new i(this,t))});var e,o=t,s=Array.prototype.slice.call(arguments,1);return this.each(function(){r.data(this,"plugin_"+n)&&"function"==typeof r.data(this,"plugin_"+n)[o]&&(e=r.data(this,"plugin_"+n)[o].apply(this,s))}),void 0!==e?e:this})}(window,document),function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),r=window.setTimeout(function(){e(i+n)},n);return t=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(t,e){var i={init:function(){this.mainBar(),this.mainMenu(),this.clickOutside(),this.sideBar.init(),this.toolBar.init(),this.showPopup(),this.actionPopupShare(),this.actionShowPreview(),this.responsive(),this.checkDevice()},checkDevice:function(){var e=navigator.userAgent;e.indexOf("Android")>=0&&t("body").addClass("android"),-1!=e.indexOf("Trident")&&-1!=e.indexOf("rv:11")?t("body").addClass("ie"):-1!=navigator.userAgent.indexOf("Firefox")?t("body").addClass("firefox"):-1!=navigator.userAgent.indexOf("Opera")?t("body").addClass("Opera"):-1!=navigator.userAgent.indexOf("Chrome")?t("body").addClass("chrome"):-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("CriOS")&&t("body").addClass("safari")},clickOutside:function(){var e=t(".mskh-main-menu .menu-item,.mskh-dropdown"),i=t(".mskh-color-palette");t(document).on("click",function(n){0!=e.has(n.target).length||e.is(n.target)||(e.removeClass("active"),checkMobileDevice()&&t(".main-toolbar").removeClass("overflow-hidden")),0!=i.has(n.target).length||i.is(n.target)||t(".mskh-show-color-palette span").is(n.target)||(i.removeClass("show"),t(".mskh-show-color-palette").removeClass("mskh-show"))})},mainMenu:function(){var e=t(".mskh-main-menu .menu-item"),i=t(".mskh-dropdown"),n=(t(".mskh-main-menu .menu-item .sub-menu"),t(".mskh-sub-dropdown"),t(".mskh-main-menu .menu-item .sub-menu-item"),t(".mskh-close-sub-menu")),r=t(".mskh-main-menu .sub-menu .hover-menu");e.on("click touch",function(i){var n=t(i.target);e.not(this).removeClass("active"),(n.hasClass("sub-menu-item")||n.parents(".sub-menu-item").length||!n.hasClass("sub-menu")&&!n.parents(".sub-menu").length)&&t(this).find(".sub-menu").length&&(t(this).hasClass("active")?(t(this).removeClass("active"),checkMobileDevice()&&"true"==t(this).attr("data-range")&&t(this).closest(".main-toolbar").removeClass("overflow-hidden")):(e.removeClass("active"),t(this).addClass("active"),checkMobileDevice()&&"true"==t(this).attr("data-range")&&t(this).closest(".main-toolbar").addClass("overflow-hidden")))}),i.on("click",function(){t(this).find(".mskh-sub-dropdown").length&&(t(this).hasClass("active")?t(this).removeClass("active"):(t(this).addClass("active"),t(this).find(".mskh-perfect-scroll").perfectScrollbar("update")))}),n.on("click",function(){e.removeClass("active")}),r.on({mouseenter:function(){checkMobileDevice()||t(this).addClass("show")},mouseleave:function(){checkMobileDevice()||t(this).removeClass("show")},click:function(e){if(t(this).hasClass("show")?(t(this).removeClass("show"),checkMobileDevice()&&t(this).find(".hover-sub-menu-item").slideUp()):(t(this).siblings().removeClass("show"),t(this).addClass("show"),checkMobileDevice()&&t(this).find(".hover-sub-menu-item").slideDown()),0==t(this).find(".hover-sub-menu-item").has(event.target).length&&!t(this).find(".hover-sub-menu-item").is(e.target))return!1}}),checkMobileDevice()&&r.find(" > i").removeClass("rotate-90")},mainBar:function(){t(".mskh-main-bar")},sideBar:{init:function(){this.tab(),this.tabPhto.init(),this.tabProductTemplate(),this.tabElement.init()},tab:function(){var i=t(".mskh-sidebar .tabs-nav .tab"),n=t(".mskh-sidebar .tabs-content .tab"),r=t(".mskh-sidebar .tabs-nav .tab.layerTab");t(e).width();checkMobileDevice()?(n.filter(".active").prevAll().addClass("left"),n.filter(".active").nextAll().addClass("right"),i.filter(".tab-first").removeClass("active"),t(".mskh-sidebar .tabs-content").addClass("mskh-hidden")):(n.filter(".active").prevAll().addClass("before"),n.filter(".active").nextAll().addClass("after")),i.on("click",function(){var e=t(this).index(),o="tab-"+(e=r.length?parseInt(e)-1:parseInt(e));checkMobileDevice()&&(t(this).hasClass("layerTab")?(t(".mskh-workspace .main").addClass("active"),t(".mskh-sidebar .tabs-content").removeClass("active")):(t(".mskh-workspace .main").removeClass("active"),t(".mskh-sidebar .tabs-content").addClass("active"),t(".mskh-sidebar .tabs-content").removeClass("mskh-hidden"))),t(this).parent().removeAttr("data-tab").attr("data-tab",o),i.removeClass("active"),t(this).addClass("active"),n.removeClass("before after left right"),n.each(function(i){e==(i+=1)?(t(this).addClass("active"),checkMobileDevice()?(t(this).prevAll().addClass("left"),t(this).nextAll().addClass("right")):(t(this).prevAll().addClass("before"),t(this).nextAll().addClass("after"))):t(this).removeClass("active")})})},tabPhto:{init:function(){t("#tab-photo .mskh-items-dropdown").mskhDropdown({getServer:{},itemInRow:3,itemDistance:20});var e=t(".type-upload .mskh-term .mskh-checkbox input"),i=t(".mskh-sidebar .type-upload .form-upload"),n=!1;e.on("click",function(){var e=t(this).closest(".type-upload");t(this).is(":checked")?(e.addClass("accept"),n=!0):(e.removeClass("accept"),n=!1)}),i.on("click",function(){if(!n)return!1})},initPositionCate:function(){t(".mskh-sidebar #tab-photo .categories .category").each(function(){var e=t(this).index(),i=e%3,n=parseInt(e/3);t(this).css({left:115*i+"px",top:132*n+"px"})})}},tabProductTemplate:function(){t(".mskh-sidebar #tab-product-template"),t(".mskh-sidebar #tab-product .mskh-product"),t(".mskh-sidebar #tab-template"),t(".mskh-sidebar #tab-template .close-template"),t(".mskh-sidebar #tab-product .mskh-product .mskh-product-img"),t(".mskh-sidebar #tab-template .mskh-items-dropdown .main-items item");t("#tab-template .mskh-items-dropdown").mskhDropdown({getServer:{},itemInRow:2,itemDistance:10})},tabElement:{init:function(){t("#tab-element .mskh-items-dropdown").mskhDropdown({getServer:{},itemInRow:3,itemDistance:20})}}},toolBar:{init:function(){this.toolBarImage()},toolBarImage:function(){var e=t(".mskh-toolbar .toolbar-image .filter-scroll"),i=t(".mskh-toolbar .toolbar-image .filter-scroll.scrollRight"),n=t(".mskh-toolbar .toolbar-image .filter-scroll.scrollLeft"),r=t(".mskh-toolbar .toolbar-image .main-presets .preset");t(".mskh-toolbar .toolbar-image .main-ranges .range"),t(".mskh-toolbar .toolbar-image .main-ranges .range .slide-input");e.on("click",function(){var e=r.css("transform").split(/[()]/)[1],o=parseInt(e.split(",")[4]),s=0,a=3*r.outerWidth(),c=-(parseInt(r.length/3)-1)*a;if(t(this).hasClass("scrollLeft")){s=o+a;if(o>=0)return t(this).filter(".scrollLeft").addClass("disable"),!1;i.hasClass("disable")&&i.removeClass("disable"),r.css({transform:"translateX("+s+"px)"})}else{if(!t(this).hasClass("scrollRight"))return!1;s=o-a;if(o<=c)return t(this).filter(".scrollRight").addClass("disable"),!1;n.hasClass("disable")&&n.removeClass("disable"),r.css({transform:"translateX("+s+"px)"})}}),r.on("click",function(){r.removeClass("active"),t(this).addClass("active")})}},showPopup:function(){t(".mskh-show-popup-share").on("click",function(){t(".mskh-popup.popup-share").nbShowPopup(),t(".mskh-popup.popup-share").find(".overlay-main").addClass("active")}),t(".mskh-show-popup-fileType").on("click",function(){t(".mskh-popup.popup-fileType").nbShowPopup()}),t(".mskh-term .term-read").on("click",function(){t(".mskh-popup.popup-term").nbShowPopup()}),t(".mskh-stages .icon-mskh-refresh").on("click",function(){t(".mskh-popup.popup-select").nbShowPopup()}),t(".mskh-sidebar .keyboard-shortcuts i").on("click",function(){t(".mskh-popup.popup-keyboard").nbShowPopup(),t(".mskh-popup.popup-keyboard .mskh-tabs").nbTab()}),t(".mskh-main-bar #save-template").on("click",function(){t(".mskh-popup.popup-template").nbShowPopup()})},actionPopupShare:function(){var e=t(".popup-share .socials .social");e.on("click",function(){e.removeClass("active"),t(this).hasClass("active")||t(this).addClass("active")})},actionShowPreview:function(){var e=t(".mskh-sidebar #tab-product .mskh-product .product-more-info"),i=t(".mskh-sidebar .mskh-sidebar-preview");e.on("click",function(){i.hasClass("show")?i.removeClass("show"):i.addClass("show")}),i.find(".close-preview").on("click",function(){i.removeClass("show")})},responsive:function(){if(checkMobileDevice()){var e=t(".mskh-sidebar .main-tabs"),i=(t(".mskh-sidebar .main-tabs .tab"),t(".mskh-main-bar .menu-mobile")),n=(t(".mskh-sidebar .tabs-content .tab"),t(".mskh-sidebar .tabs-content .tab .tab-main")),r=function(){var e=!1;t("body").hasClass("mskh-modern-rtl")&&(e=!0);return e}();i.on("click",function(){var e=t(".mskh-main-bar .mskh-main-menu");t(this).hasClass("icon-mskh-menu")?(t(this).removeClass("icon-mskh-menu").addClass("icon-mskh-clear"),e.each(function(e){t(this).hasClass("menu-left")?t(this).show():t(this).hide()})):(t(this).removeClass("icon-mskh-clear").addClass("icon-mskh-menu"),e.each(function(e){t(this).hasClass("menu-left")?t(this).hide():t(this).show()}))}),n.on({swiperight:function(){var i=t(this).closest(".tab"),n=i.prev().index(),o=e.scrollLeft(),s=t(".mskh-sidebar .main-tabs .tab").eq(n-1).width();i.hasClass("tab-first")||(r?e.animate({scrollLeft:o+s},300):e.animate({scrollLeft:o-s},300),t(".mskh-sidebar .main-tabs .tab").eq(n-1).triggerHandler("click"))},swipeleft:function(){var i=t(this).closest(".tab"),n=i.next().index(),o=e.scrollLeft(),s=t(".mskh-sidebar .main-tabs .tab").eq(n-1).width();i.hasClass("tab-last")||(r?e.animate({scrollLeft:o-s},300):e.animate({scrollLeft:o+s},300),t(".mskh-sidebar .main-tabs .tab").eq(n-1).triggerHandler("click"))}})}}};t.fn.mskhDropdown=function(e){var i=this,n=t.extend({},t.fn.mskhDropdown.default,e);return this.initPositionItem=function(e,i,n,r){var o=e.width()/n,s=i.height()+r;i.show(),i.each(function(){var e=t(this).index(),i=e%n,r=parseInt(e/n);t(this).css({left:o*i+"px",top:s*r+"px"})})},this.each(function(){var e=t(this).find(".items"),r=t(this).find(".item"),o=t(this).find(".main-items"),s=t(this).find(".result-loaded"),a=t(this).find(".mkdesigner-gallery"),c=t(this).find(".info-support"),l=t(this).closest(".tab-scroll"),u=t(this).find(".result-loaded .content-item"),h=r.length,f=parseInt(h/n.itemInRow),p=r.outerHeight()+n.itemDistance;t(this).find(".loading-photo");i.initPositionItem(e,r,n.itemInRow,n.itemDistance),o.css({height:f*p+"px"}),r.on("click",function(){var h=t(this).index(),f=parseInt(h/n.itemInRow)+1,d=t(this).outerWidth(),g=t(this).find(".item-name").text(),m=t(this).attr("data-type"),v=t(this).attr("data-api");if("webcam"==m)return t(".mskh-popup.popup-webcam").addClass("nb-show"),!1;if(c.find("span").text(g),o.css({height:f*(p-15)+"px"}),o.find(".pointer").css({left:d*(h%n.itemInRow+1)-d/2+"px"}),"false"!=v){if(s.removeClass("overflow-visible"),o.hasClass("active-expanded"))t(this).css({opacity:"1"}),t(this).siblings().css({opacity:"1"}),o.removeClass("active-expanded"),i.initPositionItem(e,r,n.itemInRow,n.itemDistance),s.hide(),s.removeClass("loaded"),a.hide(),u.hide();else{t(this).siblings().css({opacity:"0.5"});_=e.find(".item:nth-child("+f*n.itemInRow+")").nextAll();t(_).each(function(){t(this).hide()}),s.show(),a.show(),o.addClass("active-expanded"),s.addClass("loaded")}return c.find(".close-result-loaded").on("click",function(){o.removeClass("active-expanded"),i.initPositionItem(e,r,n.itemInRow,n.itemDistance),s.hide(),r.show().css({opacity:"1"}),s.removeClass("loaded"),l.scrollTop(0),c.removeClass("slideInDown animated show")}),!1}if(s.show().addClass("overflow-visible"),u.filter(function(e){return t(this).attr("data-type")===m}).show().find('input[type="text"]').first().focus(),a.hide(),o.hasClass("active-expanded"))t(this).css({opacity:"1"}),t(this).siblings().css({opacity:"1"}),o.removeClass("active-expanded"),i.initPositionItem(e,r,n.itemInRow,n.itemDistance),s.hide(),u.hide(),s.removeClass("loaded");else{t(this).siblings().css({opacity:"0.5"}),o.addClass("active-expanded"),s.addClass("loaded");var _=e.find(".item:nth-child("+f*n.itemInRow+")").nextAll();t(_).each(function(){t(this).hide()})}c.find(".close-result-loaded").on("click",function(){o.removeClass("active-expanded"),i.initPositionItem(e,r,n.itemInRow,n.itemDistance),s.hide(),u.hide(),r.show().css({opacity:"1"}),s.removeClass("loaded"),l.scrollTop(0),c.removeClass("slideInDown animated show")})})})},t.fn.mskhColorPalette=function(e){t.extend({},t.fn.mskhColorPalette.defaults,e);return this.each(function(){var e=t("#mskh-color-palette");t(this).on("click",function(i){var n=t(this).offset().left,r=t(".mskh-toolbar").offset().left;t(".mskh-main-menu .menu-item").removeClass("active"),e.css({left:n-r+"px"}),t(this).hasClass("mskh-show")?(e.removeClass("show"),t(this).removeClass("mskh-show")):(t(".mskh-show-color-palette").removeClass("mskh-show"),e.addClass("show"),t(this).addClass("mskh-show"))})})},t.fn.nbTab=function(){return this.each(function(){var e=t(this).find(".mskh-tab"),i=t(".mskh-tab-contents .mskh-tab-content");e.on("click",function(){var n=t(this).attr("data-tab");e.removeClass("active"),t(this).addClass("active"),i.removeClass("active"),t(".mskh-tab-contents #"+n).addClass("active"),t(".mskh-tab-contents .tab-scroll").stop().animate({scrollTop:0},100)})})},t.fn.nbShowPopup=function(){return this.each(function(){var e=this,i=t(this).find(".overlay-popup, .close-popup");t(this).hasClass("nb-show")||t(this).addClass("nb-show"),i.on("click",function(){t(e).removeClass("nb-show")})})},t.fn.nbToasts=function(){return this.each(function(){var e=t(this).find(".toast"),i=t(this);t(this).addClass("mskh-show"),e.addClass("nbSlideInUp"),e.find(".mskh-close-toast").on("click",function(){e.removeClass("nbSlideInUp").addClass("nbSlideInDown"),e.bind("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){i.removeClass("mskh-show")})}),n&&clearTimeout(n);var n=setTimeout(function(){i.hasClass("mskh-show")?(e.removeClass("nbSlideInUp").addClass("nbSlideInDown"),e.bind("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){i.removeClass("mskh-show")})):clearTimeout(n)},3e3)})},t.fn.nbWarning=function(e){return this.each(function(){var i=t(this).find(".item");if(t(this).addClass("mskh-show"),i.length<3){var n=t('<div class="item animate300 animated nbScaleOut main-warning mskh-show"><i class="icon-mskh icon-mskh-baseline-warning warning"></i><span class="title-warning">'+e+'</span><i class="icon-mskh icon-mskh-clear close-warning"></i></div>'),r=n.find(".close-warning");t(this).append(n),r.on("click",function(){n.removeClass("nbScaleOut").addClass("nbScaleIn"),n.bind("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){n.remove()})}),setTimeout(function(){n.removeClass("nbScaleOut").addClass("nbScaleIn"),n.bind("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){n.remove()})},1e4)}})},t.fn.mskhRuler=function(t){var i=this,n="http://www.w3.org/2000/svg";function r(){return"vertical"===rulerConfig.layout}function o(t){rulerConfig.divisions.forEach(function(e){!function(t,e){for(var i=0;i<=rulerConfig.size;i+=e.pixelGap){var n=a(i,e);t.appendChild(n)}}(t,e)}),function(t,e){for(var i=0,n=0;n<=rulerConfig.size;n+=e.pixelGap){var r=0==n?" "+e.unit:"",o=s(n,e,i,r);t.appendChild(o),i++}}(t,rulerConfig.text),function(t,i){var o,s,a,c,l=e.document.createElementNS(n,"rect");r()?(o="y",s="x",a="width",c="height"):(o="x",s="y",a="height",c="width");var u=r()?i.cursorPos.y:i.cursorPos.x,h=r()?"rulez-indicator-ver":"rulez-indicator-hoz";l.setAttribute("class",h),l.setAttribute(o,0),l.setAttribute(s,u),l.setAttribute(a,.75*i.divisions[i.divisions.length-1].lineLength),l.setAttribute(c,1),l.setAttribute("fill","red"),t.appendChild(l)}(t,rulerConfig)}function s(t,i,o,s){var a,c,l=e.document.createElementNS(n,"text"),u=i.offset;l.setAttribute("class","rulez-text"),r()?(a="y",c="x"):(a="x",c="y");var h=r()?"rotate(90 "+u+" "+t+")":"rotate(0 "+t+" "+u+")";return l.origPos=t,l.origPosAttribute=a,l.setAttribute(a,t),l.setAttribute(c,u),l.setAttribute("transform",h),l.textContent=o*(r()?i.multiplesY:i.multiplesX)+s,l}function a(t,i){var o,s,a,c,l=e.document.createElementNS(n,"rect");return r()?(o="y",s="x",a="width",c="height"):(o="x",s="y",a="height",c="width"),l.setAttribute("class","rulez-rect"),l.setAttribute(o,t),l.setAttribute(s,0),l.setAttribute(a,i.lineLength),l.setAttribute(c,.5),l}return this.update=function(t){this.rulerConfig.config=JSON.parse(JSON.stringify(t.config)),this.rulerConfig.zoomRatio=JSON.parse(JSON.stringify(t.zoomRatio)),this.render()},this.updateCursorIndicator=function(t){this.rulerConfig.cursorPos=JSON.parse(JSON.stringify(t));var e=this.find(".rulez-indicator-hoz"),i=this.find(".rulez-indicator-ver");e.attr("x",t.x),i.attr("y",t.y)},this.render=function(){this.rulerConfig=t||this.rulerConfig;var r=e.document.createElementNS(n,"g");rulerConfig=function(t){var e=t.config.cwidth*t.zoomRatio,n=t.config.cheight*t.zoomRatio,r=100,o=[],s=1,a=1;if("vertical"===t.layout){var c=parseFloat(t.config.pHeight);if(c>1)for(;0!=Math.floor(c/10);)c/=10,a*=10;else for(;c>1;)c*=10,a/=10;r=n/c}else{var l=parseFloat(t.config.pWidth);if(l>1)for(;0!=Math.floor(l/10);)l/=10,s*=10;else for(;l>1;)l*=10,s/=10;r=e/l}return o=r/10>10?[{pixelGap:r/50,lineLength:5},{pixelGap:r/10,lineLength:10},{pixelGap:r,lineLength:20}]:[{pixelGap:r/10,lineLength:5},{pixelGap:r,lineLength:15}],{width:"vertical"===t.layout?i.width():e,height:"horizontal"===t.layout?i.height():n,layout:t.layout,alignment:"top",size:"vertical"===t.layout?n:e,divisions:o,text:{offset:27,pixelGap:r,multiplesX:s,multiplesY:a,unit:t.unit},cursorPos:{x:0,y:0}}}(this.rulerConfig),o(r),i.html("").append(r)},this},e.initModernLayout=function(){i.init(),t(".mskh-tooltip-hover").tooltipster({side:"top",theme:"tooltipster-borderless"}),t(".mskh-tooltip-hover-left").tooltipster({side:"left",theme:"tooltipster-borderless"}),t(".mskh-tooltip-hover-right").tooltipster({side:"right",theme:"tooltipster-borderless"}),t("#toolbar-font-size-dropdown,#toolbar-font-familly-dropdown, .mskh-sidebar .tab-scroll,.mskh-popup .tab-scroll, .mskh-perfect-scroll").perfectScrollbar(),t(".mskh-show-color-palette").mskhColorPalette();var n=jQuery(e).width();n>767&&n<=1024&&(jQuery(".main-tabs .tab").on("click",function(){jQuery(".mskh-sidebar").addClass("is_open")}),jQuery(".hide-tablet").on("click",function(){jQuery(".mskh-sidebar").removeClass("is_open")})),jQuery(".popup-webcam .close-popup, .popup-webcam .overlay-popup").on("click",function(){jQuery(".popup-webcam").removeClass("nb-show")})}}(jQuery,window),window.wp=window.wp||{},wp.template=_.memoize(function(t){var e,i={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(n){return(e=e||_.template($("#tmpl-"+t).html(),i))(n)}}),$(document).ready(function(){$(".close-email-window").off("click").on("click",function(){$(".maskh-info-wrapper").hide()}),$(".bg-particle").particleground({minSpeedX:.6,minSpeedY:.6,dotColor:"rgba(255, 255, 255, .3)",lineColor:"rgba(255, 255, 255, .12)",density:1e4,particleRadius:8,parallaxMultiplier:8,proximity:80});var t=[];t.push(document.querySelector("#secondhand > *")),t.push(document.querySelector("#minutehand > *")),t.push(document.querySelector("#hourhand > *"));var e=100,i=100;function n(t){return[t,e,i].join(" ")}var r=new Date,o=360*r.getHours()/12+r.getMinutes()/2,s=360*r.getMinutes()/60,a=360*r.getSeconds()/60;t[0].setAttribute("from",n(a)),t[0].setAttribute("to",n(a+360)),t[1].setAttribute("from",n(s)),t[1].setAttribute("to",n(s+360)),t[2].setAttribute("from",n(o)),t[2].setAttribute("to",n(o+360));for(var c=1;c<=12;c++){var l=document.createElementNS("http://www.w3.org/2000/svg","line");l.setAttribute("x1","100"),l.setAttribute("y1","30"),l.setAttribute("x2","100"),l.setAttribute("y2","40"),l.setAttribute("transform","rotate("+360*c/12+" 100 100)"),l.setAttribute("style","stroke: #ffffff;"),document.querySelector("#clocksvg").appendChild(l)}});var appConfig={localMode:!1,debugMode:!1,isModern:!0,isVisual:!1,isCuz:!1,ready:!1,domainChanged:!1,init:function(){this.mediaUrl=this.localMode?"http://localhost/nbmedia/v1":"https://studio.cmsmart.net/v1",this.domainChanged="yes"==MSKHCONFIG._fix_domain_changed,this.isModern="modern"==MSKHCONFIG.layout,this.isVisual="visual"==MSKHCONFIG.layout}};function arrayMin(t){return t.reduce(function(t,e){return(t=parseInt(t))<(e=parseInt(e))?t:e})}if(3!=MSKHCONFIG.ui_mode)var mskhApp=angular.module("mskh-app",["angularSpectrumColorpicker"]);else var mskhApp=angular.module("mskhApp",["angularSpectrumColorpicker"]);if(mskhApp.constant("_",window._),mskhApp.config(function(t,e,i){mskhApp.controller=function(e,i){return t.register(e,i),this},mskhApp.directive=function(t,i){return e.directive(t,i),this},mskhApp.filter=function(t,e){return i.register(t,e),this}}),mskhApp.controller("designCtrl",["$scope","FabricWindow","$window","MSKHDataFactory","filterFontFilter","filterArtFilter","$timeout","$http","$document","$interval",function($scope,FabricWindow,$window,MSKHDataFactory,filterFontFilter,filterArtFilter,$timeout,$http,$document,$interval){$scope.stages=[],$scope.defaultStageStates={isActiveLayer:!1,isLayer:!1,isGroup:!1,isNativeGroup:!1,isText:!1,isImage:!1,isPath:!1,isShape:!1,isEditing:!1,isRedoable:!1,isUndoable:!1,elementUpload:!1,isShowToolBox:!1,oos:!1,ilr:!1,boundingObject:{},boundingRealSize:{},coordinates:{},rotate:{},uploadZone:{},opacity:100,snaplines:{},itemId:null,tempParameters:null,usedFonts:[],type:null,text:{fontFamily:{alias:MSKHCONFIG.default_font.alias,r:MSKHCONFIG.default_font.file.r,b:MSKHCONFIG.default_font.file.b,i:MSKHCONFIG.default_font.file.i,bi:MSKHCONFIG.default_font.file.bi},fontSize:14,fontFamily:MSKHCONFIG.default_font.alias,textAlign:"left",fontWeight:!1,textDecoration:!1,fontStyle:"",spacing:0,lineHeight:1.16,is_uppercase:!1,fill:"#06d79c"},svg:{groupPath:{},currentPath:null},image:{},scaleRange:[],currentScaleIndex:0,fitScaleIndex:0,fillScaleIndex:0},$scope.defaultConfig={name:"Typography",width:200,height:200,cheight:200,cwidth:200,left:0,top:0,bleed_lr:0,bleed_tb:0,margin_lr:0,margin_tb:0,bgType:"tran",bgColor:"#ffffff",bgImage:0,showBleed:0,showOverlay:0,showSafeZone:0},$scope.initSettings=function(){if($scope.debugMode=appConfig.debugMode,angular.copy(MSKHCONFIG,$scope.settings),angular.extend($scope.settings,{showRuler:!checkMobileDevice()&&"yes"==MSKHCONFIG._show_ruler,showGrid:"yes"==MSKHCONFIG._show_grid,bleedLine:"yes"==MSKHCONFIG._show_bleed,snapMode:{status:!1,type:"layer"},showWarning:{oos:"yes"==MSKHCONFIG._show_warning_oos,ilr:"yes"==MSKHCONFIG._show_warning_ilr}}),$scope.rateConvertCm2Px96dpi=37.795275591,$scope.currentStage=0,$scope.showTextColorPicker=!1,$scope.showBgColorPicker=!1,$scope.__colorPalette=__colorPalette,$scope.currentColor=MSKHCONFIG._default_color,$scope.listAddedColor=[],$scope.tempStageDesign=null,$scope.listFontSizeInPt=["6","8","10","12","14","16","18","21","24","28","32","36","42","48","56","64","72","80","88","96","104","120","144","288","576","1152"],$scope.forceMinSize=!0,angular.isDefined(MSKHCONFIG.product_data.option.listFontSizeInPt)&&""!=MSKHCONFIG.product_data.option.listFontSizeInPt&&(MSKHCONFIG.product_data.option.listFontSizeInPt=MSKHCONFIG.product_data.option.listFontSizeInPt.replace(/ /g,""),$scope.listFontSizeInPt=MSKHCONFIG.product_data.option.listFontSizeInPt.split(",")),angular.isDefined(MSKHCONFIG.product_data.config)&&angular.isDefined(MSKHCONFIG.product_data.config.dpi)&&($scope.settings.product_data.option.dpi=MSKHCONFIG.product_data.config.dpi),$scope.changePrintingOptions(!0),$scope.processProductSettings(),$scope.resource={defaultPalette:[["#ff5c5c","#ffbd4a","#fff952","#99e265","#35b729","#44d9e6","#2eb2ff","#5271ff","#b760e6","#ff63b1"],["#000000","#666666","#a8a8a8","#d9d9d9","#ffffff"]],social:{link:""},config:{},jsonDesign:{},usedFonts:[],imageFromUrl:"",svgCode:"",qrText:"",gapi:{},tempData:{template:[]},templates:[],myTemplates:[],cartTemplates:[],templateCats:[],drawMode:{status:!1,brushWidth:1,brushType:"Pencil",brushColor:MSKHCONFIG._default_color},personal:{status:!1,type:""},webcam:{status:!1},typography:{filter:{perPage:20,currentPage:1,total:0},data:[],init:!0,onload:!1},clipart:{filter:{perPage:20,currentPage:1,total:0,currentCat:{}},data:[],onload:!1,init:!0,filteredArts:[]},font:{filter:{perPage:10,currentPage:1,total:0},data:[],filteredFonts:[]},photo:{filter:{perPage:20,currentPage:1,total:0,totalPage:1},data:[],init:!0,onload:!1,type:"",photoSearch:"",onclick:!1},dropbox:{filter:{perPage:10,currentPage:1,total:0},data:[],onload:!1,init:!0,filteredPhoto:[]},facebook:{filter:{perPage:15,currentPage:1,total:0},data:[],onload:!1,init:!0,nextUrl:"",uid:"",accessToken:""},instagram:{filter:{perPage:10,currentPage:1,total:0},data:[],onload:!1,init:!0,token:""},upload:{filter:{perPage:10,currentPage:1,total:0},data:[],onload:!1,init:!0,ilr:!1},element:{onclick:!1,onload:!1,contentSearch:""},shape:{filter:{perPage:20,currentPage:1,totalPage:0},data:[],init:!0,onload:!1},icon:{filter:{perPage:20,currentPage:1,totalPage:0},data:[],init:!0,onload:!1},line:{filter:{perPage:20,currentPage:1,totalPage:0},data:[],init:!0,onload:!1},globalTemplate:{filter:{perPage:20,currentPage:1,totalPage:0},data:[],init:!0,onload:!1}},$scope.cuzIncludeExport=["first_name","last_name","full_name","company","address","postcode","city","phone","email","mobile","website","vcard","title","date","avatar","c_full_name","c_title","c_mobile","c_phone","c_email","c_avatar"],$scope.includeExport=["objectCaching","itemId","selectable","editable","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockRotation","rtl","elementUpload","forceLock","isBg","is_uppercase","available_color","available_color_list","color_link_group","isOverlay","isAlwaysOnTop","ilr","oos","evented","ptFontSize","origin_src","reverse","spacing","radius"],appConfig.isCuz&&($scope.includeExport=$scope.includeExport.concat($scope.cuzIncludeExport)),angular.isDefined(MSKHCONFIG.product_data.option.font_cats)&&($scope.settings.fonts=$scope.settings.fonts.filter(function(t){return 0==t.cat.length&&(t.cat=["0"]),!t.cat.some(function(t){return-1===MSKHCONFIG.product_data.option.font_cats.indexOf(t)&&"99"!=t})})),$scope.resource.font.data=$scope.settings.fonts,_.filter($scope.resource.font.data,["alias",$scope.settings.default_font.alias]).length||$scope.resource.font.data.push($scope.settings.default_font),$scope.resource.templates=$scope.settings.templates,0!=$scope.resource.templates.length&&"1"==MSKHCONFIG.product_data.option.admindesign||$scope.getResource("typography","#tab-typography"),MSKHCONFIG.show_nbo_option&&$timeout(function(){$scope.getPrintingOptions()},100),"create_template"!=$scope.settings.task&&"1"==MSKHCONFIG.product_data.option.admindesign&&"1"==MSKHCONFIG.product_data.option.global_template&&""!=MSKHCONFIG.product_data.option.global_template_cat){var t=parseInt(MSKHCONFIG.product_data.option.global_template_cat);$scope.templateCat=t,$scope.loadGlobalTemplate(t,!0)}$scope.resource.font.filter.total=$scope.resource.font.data.length,$scope.$watchCollection("resource.font.filter",function(t,e){t.search!=e.search&&$timeout(function(){jQuery("#toolbar-font-familly-dropdown").stop().animate({scrollTop:0},100)}),$scope.resource.font.filteredFonts=filterFontFilter($scope.resource.font.data,$scope.resource.font.filter)},!0),$scope.$watchCollection("resource.clipart.filter",function(t,e){$scope.resource.clipart.filteredArts=filterArtFilter($scope.resource.clipart.data.arts,$scope.resource.clipart.filter),t.search!=e.search&&$timeout(function(){jQuery("#tab-svg .tab-scroll").stop().animate({scrollTop:0},100)}),$scope.onEndRepeat("clipart")},!0)},$scope.addColor=function(t){var e=angular.isDefined(t)?t:$scope.currentColor;$scope.listAddedColor.push(e),$scope.listAddedColor=_.uniq($scope.listAddedColor),jQuery(".mskh-perfect-scroll").perfectScrollbar("update")},$scope.showTextColorPalette=function(){$scope.showTextColorPicker=!$scope.showTextColorPicker},$scope.showBgColorPalette=function(){$scope.showBgColorPicker=!$scope.showBgColorPicker},$scope.hasGetUserMedia=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},$scope.settings={},$scope.init=function(){appConfig.init(),$scope.localStore.init(),void 0!==mskh_window.MSKHPRODUCT&&mskh_window.MSKHPRODUCT.hide_loading_iframe(),$scope.isTemplateMode="create"===MSKHCONFIG.task||"edit"==MSKHCONFIG.task&&"template"==MSKHCONFIG.design_type,$scope.initSettings(),$scope.contextAddLayers="normal",$scope.workBenchHeight=$window.innerHeight,$scope.workBenchWidth=$window.innerWidth,$timeout(function(){jQuery(".mskh-load-page").hide(),appConfig.isModern?window.initModernLayout():appConfig.isVisual&&window.initVisualLayout(),$scope.initDropboxChooser()});var _window=angular.element($window);_window.bind("resize",function(){$scope.reCalcViewPort()}),$scope.fullScreenMode=!1;var _document=angular.element($document);_document.bind("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){$scope.fullScreenMode=!$scope.fullScreenMode,jQuery("body").toggleClass("fullScreenMode"),$timeout(function(){$scope.toggleStageFullScreenMode()})});var _intervalOptions=$interval(function(){$scope.awaitLoadPrintingOptions&&$scope.changePrintingOptions()},100),log="console.log('MSKH')",lgc,mgc;eval(log),"0"==$scope.settings.valid_license&&(lgc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAIAAAABc2X6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAD+dJREFUeNrsW2lwHMd1fq+759rZA1jiBgECBHgIJACBoiiIokydNC1FR2RHsXW4XElVYvlHKlYqqcpRSaVUqfxwDpedQy7LOSzKki0rqti0RIoSSYs3JYiEQAIkQeKicB+LxV5zdufHgjCI3QV3yYUDi+raH1sz0zPz9et3fe8NPvP3hy2Hw80xZEaY5XD7pgEMAARusvEZ4M8Afwb4M8C/UYNlOsGFECLjNEQgiKnHBQDn6aeRKxMEABcCRC5iSfuw/AKWCMHk26VBi5bjchTJS+YPCigRTDvFEcmVQIpAOSeEZvmKiBiKW47LEYEQwihKlDCK+QQsBNzfWNbaWJT+DQAtx/3+2xdHpo35D7YdvrbM9zvbV6kKTZ3y4tvdgxNxx7VrgvTpB9bpHjVbwIChuOVwjoBjU/FPRqI9o/G+ybgiXY/gM0q4ulS/dW1wkZm9Q7FdB3uv1gLweaQtDUUk3fLrB2gsEQkb02uKi1o3lFCJXZ+ITNOJJJz27tBrB/uGphOKRPNjtK4Zbz60tbK8UHWv1ljORcJ0014/FZ2Yik/Y3OICM12TzVAUVlSg3n97+d9+rbFlld+wHEQCgDcK+JrD62FP3Vvr2NnG4bZrCRAI+bI+UFHsff7JhlVBEY7NgOCIZGkBA0DrxqLmmgLDduH/aQQLPH/wWw2uOTURGUuYkaTCLyFgRaaPb6tWKXV5Dk4GESVG84W5ZV3F/S01k7FwKDY5OTNqWLEk7EzI2Q0+79Y1wZa64NFz45pCs0MLpu0MjoV1j5yLJ4aArmqalNaI37lx5etHz7sgDCdhxQzJVHTFr0gqJQzEQo9/o4BlmTy+deXZgem47WSXgrPzI1Pf/Ld3CYLIGrEAUVsefHTbuu3NVZQt3JXFPrXUp02atkSJALAcw7QNRVJ1xatKOiWUC543wADQuKZwU13wUOcYZBE9IUDCEVE7IXJ8yrkz/WcHJqqLPl+/asVC4XvUgK6OG9Y8pQHDTpiOobCoJusexUcAk6LOTyz97IOrA5okstVhYIRIOf78mhyJm6OhWOoNp2NGKJog5CosBAkCGnYiHJ+amBmOmZGkj2B5AVxerN3XXLbrl73X2plgOW72shVCzJlDw3TurCurryxMvSycsGYSFk0XgRAkAGA5puWYMTMS9BayfFnLh7eufO/0iJ0ZjhAgEawu8FJKstJeIVRFCvhUIUAIUehVf/vO+tJiX+oqfnhhJOpwv8wW8QvJQGAqNp43wKVB9fG7qk6cHc+UB7mcF2jqn3+ptaTIm525EqoiBbwqCAAEzSOlvejspbHdJy95NSlLj5g3wABwd2PJTNgybe7NIGHGsGZlsLhIz9cTB4bDL/zoyFTC1CSapabkbLSGxyOHP+pPe6qsSNu5tVKV6SK72spfWCYE/Oidjo7+CVki2duFnAGPRxI/eb/LMOy0ZytLPLqWz12zuLX/6s7mr9y9jlucLx1gWaYHOj5pOze8HPiailLfXzx795N3rbNNe6m2NEWS4O7L+zoiETNnmQBQgvnFTCg+99htzTWlCcu+IQJgkaHJ7Oil0X0f9Dxx3y058VIJy9174lJBQMsp2Uju3prKwvJCvawojUH0+ZTHtqw+PzjpCnFNDuQ69U2R6a79Z7a31Kwo1LLdGgSnE+a395wSQuSaFAsBtuPWBv1//Njme7fUsJRka3tL7Q8PdfWNzSjXysOuM7SkiL1T0Zf3tOcqKEWiqsxUKbefJjO/RxmMxv/qlUOjoXiaxLhQqwjo2aQj1x9LE4K723raf43WS2M04jgfnR9Jb8B8Gs2C9Lh+wIyS0Ujif492c/fXVG21OecO92QIIXl24dv1+0wEUGT6zum+Hbevbm1cmc0ULkTMtDnPWYdBgO24KzzqM9vWb2moSHtJ33TMFYItHWAAkAgJGfbL+zoa60t0Tb4GWi58iryzqUbXFc55rspfWRqoKfJlWtnJUHwyamAWNPUNARYAPlU6cmHoYFv/w9vWLH6xy4VXlX5/Z3NFuT8HsmNeprfIyeMdl8emYtmUI/JAAEgye+ntU5FoVnEIEgQEIJjzb5GldPne9oEZ086mEJEHwARxYDr+X7vbs1TjvBuzNw+cO9Z12aNklSHmAXByVd861XOxb+LXH04fbuv/973tnJAsY1ZyDRzp5JlmVzNyORT94f7ObLZDvqBalvv6O2f+5tUjobgh02wll8loCde2QMBC64KYyesqCjvY3n/848utjVVpbNIVnIKLNLfNsORCiLhhz69TI0LMsBOWc/rC6BuHznWNhDiAzGj2esIySBePnhvpnxzn/CrChlEyEUnI6egyiZAZ237xF6ePdQ5xWFhMlymdmkmYtvuDPe1ZuiVEtB13ZCLquO6cvyEIQ5PR4XBsxnEVRikluZYw8MkX3k8tFCJg3DKHQ0O2a1+1twVQgrqSnpFFBNN2zSSngQs9mK5KCBi3sg48BCAipcmiiZhzhIwQSvD6VEOWaIaCOAhdUcsLi0OxibTuN1NOIzMqL5qv6NnZ0qUbZBH/ocm6Jmnz6xSfgrGIcROI6NUCEpFuEsAghJCZ5pF1sQTRwnIEDABCcK8WkJkMIG4KwABAkPrVgk8L3iwACwBF8nhk76fDemUTkQkkRNf8EmGfAmXOKgQVgitM1RU/4G+8hFlaDzwnSIKzUZ3DXVXxRc2Y7ZqAmClYzrQDCMJ8Kpqka9XkYrY5MfWsALBdnnwtgsiu0Plu5myTZojFWKrGMiSUoBCCIBqOKwhSBJkQBCzWg6HYGAhBEBeURQVi2uMIIAAFChSzIWIywIwJ4VGkuXdyhZAEKJQIISwuOM5fCLBMuzKge1QJAMJxczSSkGTGCGoE53oZFgwHIW2teiHguOF8eXvNpvqgEAIRT3aO7f5wmEr0S1ur1lYHOOe7f9lZWaI1ry1foM9tXcOUYsu6hccRIRK1jndc3ryhstCvCgGIGDftA6cH9p7qdQkigCuEDPiHO5s31BQJIfad7t/1fpdPk5MLoQj8xmOb71hbPgs4Znb0je967+xAOPp3T21bWeRLtSyci++8+cGFyQhNEfNCwLbD61f6mtfMdhZsqPG3dQ9PRPj6Kn/T2kIA+PBjT0Nt6eYNlQsmmglXkknqcQAQrhidiN7VXO3x/Iro29pY5VPlVw51MpmZtruhuviJ7eu9XgUAmMTeOnkpwTlBBMf9+iObn/lC0/wbNq0rK/Frf/afB1saKlYV+9Nu6YI9HwsRSTU6LFUVrXndhEyiD91W/vKBQcPmAOC43HbcuRLv2FRsOm4mtfziSIgxEizSEbGuvCB5cGBsJmE5sbjVPRR67d2zlcX+2upCClhd6pckunPL6r2nescTJnKxeW1ZEi0A1FcGG2tLDp0flCipCfrubqwCgKlw4nDHJwU+ZVtTFUF8sLV+y7HuqZlEEvBoKBaKGvRKX4vLecS0MUujtWDs2Fp3smviV+UvnG2ZAAHfee34fxw+J0sEAXwehSLab57UZHb4n59NNrk+/713D3ZcViUmMcqFEFzEbbulbMUrf/14yQqvKjOPzOxIvDSg39e0au6JXq+8qa7k2PlB23HLi/wlQS8A9I+Ed+0/Mzgcfu6RltvWV/hUWVPZ3F7+h9dP/OvuU0HvbEsyY6S4wJO2UnltwKrCntqxbjpqp7IE92yq9QU8jCAXcOjMwEg0ITOizqsM+DzKd7/xoK7K88haXlmgBwMeAOgeCfVOzDBKmqqCDWtKAKDz4lhddVCR2ecaq9841j0wGZmOGpGYqXmklnVlP/jmFy4NhqbCib2Hu09cHL40FXnu0duSt33mgY2tDZVzHY39g9OvHupyuUDMBXA0ZiGC7pEb6osS6Ur+D7SufqB1NQAAh55vTQxFEguIYUbJV+5pSHtz23Y/6Bq2BPcxdn/TqqRLe3XfmS3rKx65d/3a2qK1ZQXD0/Fzg5O/OH7x6Z2NskR9PvXW9eUA0HJLefCw/q03Ts5F+M2rS5pXl8zdvKdv6rVDXTkT8Yfa+zkXD29bCwCamiZJNC3HdXiSGXbScV2cQ/flSd/VRQmKuKJQlxh99oGNp3vHwhHjc7fVAIBhOsWFHsuZtRA7N9Ue7R6mSP57/5nuvvEH76hfV7OiQFc9ulzo1776UHNbz1jMmO13XKDDnQPjIkcSDwBg2rbfOzm08841NAOj/9N9nQfODEiUCCF6piKULMypbMf5+j+9pc5rfhcACPCXT2/b2ly1qrLg1rpSYnOfVwEATWV/9OXWuStvb6qq3+9/aNPq2ooCQshLb53qGQs3VBc/uf2WezbXAMCGyqDnSt/lv/ys7ft7Pi68YvYIIbrC0oYeiwHWJNp2KXSsY2LbrcVpA87JsNE/GiXoIgBFhHnkU5ajWFe23FKZ9lTQpz64cdXWpuq6VUEAkGX2wq7DZ/vHB8fSlJdKveqGYr/Po8zZl6jlRBwXczVahMIr+3ub1wR8upwaTH7t0ebf3bFBAEeAPcd7vv12m0zp1Xw1e/H5h1K3dFFQB4CJ6QQTpKo8AACXBqb+8acnQpZtO+6m2tI/eWKLorFNGyvfa7uUBLx5Q8VLf/qw4/LSFbNdD51Doc1XamvPfr7pi3evxzmzLOB7b7b9rL1PSmm9ZalE3FyjlaYwAjg0bfz8yOBTO2qTRkhhVLtih/1exX9lF5Wv8HEOQAEB5j68YIysqVqRXl9mEm8e7FxVGSgq8ADAiQvDe9r7/B7FdFwjav3e/RvLNH9jXcmP93S8c+zijjvqgUBxcLajLRG39rf1ftA19PyTW5JHAl414L3qM5lCr8qz0WFFIqcuhqaiYZc7H10cUWSKAHtODfu84ILpcnFmcCIOdDg643J3joxFhFPnxxglAOBw8T9HLiT/T4TjP3m/S5UXGrzR8ejxM5cvj8988Z5bfn78om27ez/oCXhVhVFZYqG48ePD52pXBgnANPAXXj3a0TfRUFdc6lUTljMyYxxtHzhyfjDh8nc+7C0p1NMm8edGQmn98EJeGhHjpjsdDbvckSVa5PNTKnEuQtF43IwBgq4qBFjcNFzuztUTuGtbPJbkqwXAdNRIhgR+jxxNWKktO5SiKjNGScywHYcjgq5KikSTswRANGEl30pXJYmRqGGjECW6atjOtOFIMtVkRhDDMSNTd66uSWpKRUKWaHoinsw2S6CA2aQMAefo/5SPU1AIPhUZjTtxXLKMWQC4nCMivYHqVEYiPpXNEXDVt4gpOSB6tQIzariCLxFmBGAkH8XdPC2/kJmiK/7lzwHl7XNagairPoWpy5zry9/3w4JTIvkUH0FycwAGEIKrsleTPGIZs9j5lgaiXwssZyHn/c0EY4pPCYjlqsn5F4UQoKs+manL02Ivxd4ThFCfWpBK2X5aAYMQ4JE9y7POukTWRQgEXQ1IVFpWQhYCmMyWyqJKTOPcP2POLB/ACqP/NwDoKvSxYaDXdQAAAABJRU5ErkJggg==",mgc=new Image,mgc.onload=function(){var t=["font-size: 1px;","line-height: "+this.height+"px;","padding: 0px "+.5*this.width+"px;","background-size: "+this.width+"px "+this.height+"px;","background: url("+lgc+");"].join(" ");console.group("%cWelcome! ","font-size: 20px;"),console.log("%c ",t),console.log("%chttps://netbaseteam.com/","font-size: 40px;"),console.groupEnd()},mgc.src=lgc)},$scope.initDropboxChooser=function(){var t={success:function(t){$scope.getPersonalPhoto("dropbox",t),$scope.updateApp()},linkType:"direct",multiselect:!0,extensions:[".jpg",".jpeg",".png"]};if(MSKHCONFIG.enable_dropbox){var e=Dropbox.createChooseButton(t);document.getElementById("_dropbox").appendChild(e)}},$scope.localStore={db:null,ready:!1,existed:!0,numberOfRecords:0,init:function(){var t=this,e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;if(e){var i=e.open("MSKHDesigner",1);if(null==i)return;i.onsuccess=function(e){t.db=e.target.result,t.ready=!0},i.onupgradeneeded=function(e){e.target.result.createObjectStore("designs",{keyPath:"id"});t.existed=!1},i.onerror=function(t){alert(t)}}},add:function(t,e,i){this.ready&&(this.db.transaction(["designs"],"readwrite").objectStore("designs").add({id:t,data:e}).onsuccess=function(t){"function"==typeof i&&i()})},update:function(t,e,i){if(this.ready){var n=this.db.transaction(["designs"],"readwrite").objectStore("designs"),r=n.get(t);r.onsuccess=function(r){var o=r.target.result;o?o.data=e:o={id:t,data:e},n.put(o).onsuccess=function(t){"function"==typeof i&&i()}},r.onerror=function(t){console.log(t)}}},count:function(){var t=this;if(this.ready){var e=this.db.transaction(["designs"]).objectStore("designs").count();e.onsuccess=function(){t.numberOfRecords=e.result}}},get:function(t,e){if(this.ready){var i=this.db.transaction(["designs"]).objectStore("designs").get(t);i.onsuccess=function(t){"function"==typeof e&&e(t.target.result)},i.onerror=function(t){console.log(t)}}},delete:function(t,e){this.ready&&(this.db.transaction(["designs"],"readwrite").objectStore("designs").delete(t).onsuccess=function(t){e()})}},$scope._localStorage={save:function(t,e){"mskhuploaded"==t&&($scope.resource.upload.data.length>20&&$scope.resource.upload.data.shift(),e=JSON.stringify($scope.resource.upload.data)),localStorage.setItem(t,e)},get:function(t){var e=localStorage.getItem(t);return e?JSON.parse(e):[]},delete:function(t){"mskhuploaded"==t&&($scope.resource.upload.data=[],$scope.updateApp()),localStorage.setItem(t,JSON.stringify([]))}},$scope.generateUniqueId=function(){return"_"+Math.random().toString(36).substr(2,9)},$scope.getResource=function(t,e,i){$scope.resource[t].data.length||angular.isUndefined($scope.resource[t].data.length)||(jQuery(e+" .loading-photo").show(),MSKHDataFactory.get("mskh_get_resource",{type:t,task:$scope.settings.task},function(n){jQuery(e+" .loading-photo").hide();var r=JSON.parse(n);$scope.resource[t].data=r.data,$scope.resource[t].filter.total=$scope.resource[t].data.length,i&&$scope.afterGetResource(t)}))},$scope.onClickTab=function(t,e){switch($scope.resource[e].onclick=!$scope.resource[e].onclick,$scope.resource.photo.onclick||jQuery("#tab-"+e+" .loading-photo").hide(),$scope.disableDrawMode(),t){case"dropbox":case"facebook":case"instagram":case"upload":case"url":"upload"==t&&"yes"==$scope.settings._cache_uploaded_image&&0==$scope.resource.upload.data.length&&($scope.resource.upload.data=$scope._localStorage.get("mskhuploaded")),$timeout(function(){"url"!=t&&$scope.resource[e].onclick&&$scope.renderMasonryList(t,"#mskh-"+t+"-wrap .mansory-wrap",".mansory-item","#mskh-"+t+"-wrap",$scope.resource[t].init)}),$scope.resource.personal={status:!0,type:t};break;case"Pixabay":case"Unsplash":$scope.resource.personal.status=!1,$scope.resource[e].onclick&&$scope.resource[e].type!=t&&$scope.getPhoto(t);break;case"shape":case"icon":case"line":$scope.resource[e].onclick&&$scope.renderMasonryList(t,"#mskh-"+t+"-wrap .mansory-wrap",".mansory-item","#mskh-"+t+"-wrap",$scope.resource[t].init),$scope.resource[e].onclick&&$scope.resource[e].type!=t&&$scope.getMedia(t);break;case"draw":$scope.resource[e].onclick&&$scope.enableDrawMode(),$scope.resource.element.type=t;break;case"qrcode":$scope.resource.element.type=t}},$scope.uploadSvgFile=function(){var t=document.createElement("input");function e(){if(this.files.length>0){var i=this.files[0],n=new FileReader;n.onload=function(i){if(2===i.target.readyState){var r=n.result;$scope.addSvgFromString(r),t.removeEventListener("change",e.bind(t),!1),document.body.removeChild(t)}},n.readAsText(i)}}t.type="file",t.accept="image/svg+xml|application/svg+xml",t.style.display="none",t.addEventListener("change",e.bind(t),!1),document.body.appendChild(t),t.click()},$scope.templateName="",$scope.loadTemplateCat=function(t){MSKHDataFactory.get("mskh_get_resource",{source:"media",type:"get_template_cat"},function(e){1==(e=JSON.parse(e)).flag&&($scope.templateCats=e.data,$scope.templateCat=parseInt($scope.templateCats[0].id)),jQuery(".mskh-popup.popup-template").find(".overlay-main").removeClass("active"),"function"==typeof t&&t()})},$scope._loadTemplateCat=function(){$scope.toggleStageLoading(),$scope.resource.globalTemplate={filter:{perPage:20,currentPage:1,totalPage:0},data:[],init:!1,onload:!1},$scope.loadTemplateCat(function(){$scope.loadGlobalTemplate($scope.templateCat)})},$scope.changeGlobalTemplate=function(){$scope.toggleStageLoading(),$scope.resource.globalTemplate={filter:{perPage:20,currentPage:1,totalPage:0},data:[],init:!1,onload:!1},$scope.loadGlobalTemplate($scope.templateCat)},$scope.templateSize={width:200,height:200},$scope.changeTemplateDimension=function(){var t=200,e=200;$scope.templateSize.width=""!=$scope.templateSize.width?$scope.templateSize.width:200,$scope.templateSize.height=""!=$scope.templateSize.height?$scope.templateSize.height:200,$scope.templateSize.width>$scope.templateSize.height?e=Math.round($scope.templateSize.height/$scope.templateSize.width*200):t=Math.round($scope.templateSize.width/$scope.templateSize.height*200),$scope.templateSize.width=t,$scope.templateSize.height=e,_.each($scope.stages,function(i,n){i.config.width=t,i.config.cwidth=t,i.config.height=e,i.config.cheight=e,$scope.setStageDimension(n)})},$scope.globalTemplateLoaded=!1,$scope.loadGlobalTemplate=function(t,e){$http({method:"GET",url:appConfig.mediaUrl+"/template?limit="+$scope.resource.globalTemplate.filter.perPage+"&category="+t+"&search=&start="+($scope.resource.globalTemplate.filter.currentPage-1)*$scope.resource.globalTemplate.filter.perPage}).then(function(t){var i=t.data.templates;$scope.globalTemplateLoaded=!0,_.each(i.items,function(t,e){$scope.resource.globalTemplate.data.push({thumbnail:t.thumbnail,name:t.name,id:t.id})}),angular.isUndefined(e)&&$scope.toggleStageLoading(),$scope.resource.globalTemplate.filter.totalPage=i.pagesTotal>10?10:i.pagesTotal,$scope.resource.globalTemplate.onload=!1},function(t){console.log("Fail to load: globalTemplate")})},$scope.getGlobalTemplate=function(t,e){var i={source:"media",type:"get_template",id:t};MSKHDataFactory.get("mskh_get_resource",i,function(t){1==(t=JSON.parse(t)).flag&&t.data.design?"function"==typeof e&&e(t.data):($scope.toggleStageLoading(),console.log("Error load global template!"))})},$scope.insertGlobalTemplate=function(t,e){angular.isDefined(e)&&"0"==$scope.settings.valid_license&&e>4?alert($scope.settings.mskhlangs.pro_license_alert):($scope.showDesignTab(),$scope.clearHistory(),$scope.toggleStageLoading(),$scope.getGlobalTemplate(t,function(t){var e=JSON.parse(t.used_font),i=JSON.parse(t.design);angular.isUndefined(i.canvas)&&(i.canvas={width:200,height:200}),e.length&&_.each(e,function(t,e){_.filter($scope.resource.font.data,["alias",t.alias]).length||$scope.resource.font.data.push(t);var i=t.name.replace(/\s/gi,"").toLowerCase();jQuery("#"+i).length||jQuery("head").append('<link id="'+i+'" href="https://fonts.googleapis.com/css?family='+t.name.replace(/\s/gi,"+")+':400,400i,700,700i" rel="stylesheet" type="text/css">')}),$scope.onloadTemplate=!0,$scope.contextAddLayers="template";function n(){$scope.onloadTemplate=!1,$scope.contextAddLayers="normal",$scope.toggleStageLoading()}!function t(e){if(angular.isUndefined($scope.stages[e])||e>=$scope.stages.length)e>=$scope.stages.length&&n();else{var r="frame_"+e,o=$scope.stages[e],s=o.canvas;if(angular.isUndefined(i[r]))t(++e);else{o.states.usedFonts=[],s.clear();var a=i[r].objects;if(0!=a.length){var c=[];!function r(l){function u(){var s,u;++l<a.length?r(l):(s=$scope.fitRectangle(o.config.width,o.config.height,i.canvas.width,i.canvas.height,!0),u=s.width/i.canvas.width,_.each(c,function(t){var e=t.get("scaleX"),i=t.get("scaleY"),n=t.get("top"),r=t.get("left");t.set({scaleX:e*u,scaleY:i*u,left:r*u+s.left,top:n*u+s.top}),t.setCoords()}),$scope.deactiveAllLayer(e),$scope.renderStage(e),++e<$scope.stages.length?t(e):n())}function h(t,e){s.add(t);var i=s.item(s.getObjects().length-1);"function"==typeof e&&e(i),c.push(i),u()}var f=a[l],p=f.type;if("image"===p||"custom-image"===p)fabric.Image.fromObject(f,function(t){h(t)});else{var d=fabric.util.getKlass(p),g=!1;if(["i-text","text","textbox","curvedText"].indexOf(p)>-1){if(!_.filter(o.states.usedFonts,["alias",f.fontFamily]).length){var m=$scope.getFontInfo(f.fontFamily);o.states.usedFonts.push(m)}g=!0}d.fromObject(f,function(t){if(g){var e=t.fontFamily,i=angular.isDefined(t.fontWeight)?t.fontWeight:"",n=angular.isDefined(t.fontStyle)?t.fontStyle:"",r=$scope.getFontInfo(e);t.set({objectCaching:!1}),new FontFaceObserver(e,{weight:i,style:n}).load($scope.settings.subsets[r.subset].preview_text).then(function(){fabric.util.clearFabricFontCache(),h(t,function(t){t.initDimensions(),t.setCoords()})},function(){console.log("Error load font: "+e),h(t)})}else h(t)})}}(0)}else t(++e)}}}(0)}))},$scope.getMedia=function(t,e){jQuery("#tab-element .loading-photo").show(),$scope.resource.element.type=t,$scope.resource.element.type==t&&"search"!=e||($scope.resource[t].data=[],$scope.resource[t].filter.total=0,$scope.resource[t].filter.currentPage=1),$scope.resource.element.type=t;var i="shape"==t?66:"line"==t?78:73,n="icon"==t?$scope.resource.element.contentSearch:"";$http({method:"GET",url:appConfig.mediaUrl+"/clipart?limit=20&category="+i+"&search="+n+"&start="+20*($scope.resource[t].filter.currentPage-1)}).then(function(e){var i=e.data.cliparts;_.each(i.items,function(e,i){$scope.resource[t].data.push({url:e.file,name:e.name})}),$scope.resource[t].filter.totalPage=i.pagesTotal>10?10:i.pagesTotal},function(e){console.log("Fail to load: "+t)})},$scope.getPhoto=function(t,e){if($scope.resource.photo.type==t&&"search"!=e||($scope.resource.photo.data=[],$scope.resource.photo.filter.total=0,$scope.resource.photo.filter.currentPage=1,jQuery("#tab-photo .tab-scroll").stop().animate({scrollTop:jQuery("#tab-photo .main-items").height()},100),jQuery("#mkdesigner-gallery").css("height",0)),$scope.resource.photo.type=t,""!=$scope.resource.photo.type){if(jQuery("#tab-photo .loading-photo").show(),0==$scope.resource.photo.filter.totalPage||$scope.resource.photo.filter.currentPage<=$scope.resource.photo.filter.totalPage)switch(t){case"Pixabay":$http({method:"GET",url:"https://pixabay.com/api/?safesearch=true&key="+MSKHCONFIG._pixabay_api_key+"&response_group=high_resolution&image_type=photo&per_page="+$scope.resource.photo.filter.perPage+"&page="+$scope.resource.photo.filter.currentPage+"&q="+encodeURIComponent($scope.resource.photo.photoSearch)}).then(function(t){var e=t.data,i=Math.ceil(e.totalHits/$scope.resource.photo.filter.perPage);$scope.resource.photo.filter.totalPage=i>10?10:i,_.each(e.hits,function(t,e){$scope.resource.photo.data.push({extenal:1,url:angular.isDefined(t.fullHDURL)?t.fullHDURL:angular.isDefined(t.largeImageURL)?t.largeImageURL:t.imageURL,preview:t.previewURL,des:"@ "+t.user})}),$scope.afterGetResource("photo")},function(t){console.log("Pixabay"),jQuery("#tab-photo .loading-photo").hide()});break;case"Unsplash":var i=""!=$scope.resource.photo.photoSearch?"https://api.unsplash.com/search/photos/?client_id="+MSKHCONFIG._unsplash_api_key+"&per_page="+$scope.resource.photo.filter.perPage+"&page="+$scope.resource.photo.filter.currentPage+"&query="+encodeURIComponent($scope.resource.photo.photoSearch):"https://api.unsplash.com/photos/?client_id="+MSKHCONFIG._unsplash_api_key+"&per_page=20&page="+$scope.resource.photo.filter.currentPage+"&order_by=latest";$http({method:"GET",url:i}).then(function(t){var e=t.data;if(""!=$scope.resource.photo.photoSearch){$scope.resource.photo.filter.totalPage=e.total_pages>10?10:e.total_pages;var i=e.results}else{$scope.resource.photo.filter.totalPage=10;i=e}_.each(i,function(t,e){$scope.resource.photo.data.push({extenal:1,url:t.urls.regular,preview:t.urls.thumb,des:"@ "+t.user.name})}),$scope.afterGetResource("photo")},function(t){console.log("Unsplash"),jQuery("#tab-photo .loading-photo").hide()})}$scope.updateApp()}},$scope.getPersonalPhoto=function(t,e){switch(jQuery("#tab-photo .loading-photo").show(),t){case"dropbox":_.each(e,function(t,e){$scope.resource.dropbox.data.push({extenal:1,id:t.id,preview:t.link,url:t.link,des:t.name})}),$scope.resource.dropbox.data=_.uniqBy($scope.resource.dropbox.data,"id"),$scope.resource.dropbox.filter.total=$scope.resource.dropbox.data.length,jQuery("#tab-photo .loading-photo").hide();break;case"instagram":var i="https://api.instagram.com/v1/users/self/media/recent?access_token="+$scope.resource.instagram.token;$http({method:"GET",url:i}).then(function(t){_.each(t.data.data,function(t,e){$scope.resource.instagram.data.push({extenal:1,id:t.id,preview:t.images.thumbnail.url,url:t.images.standard_resolution.url,des:t.user.full_name})}),$scope.resource.instagram.data=_.uniqBy($scope.resource.instagram.data,"id"),$scope.resource.instagram.filter.total=$scope.resource.instagram.data.length,jQuery("#tab-photo .loading-photo").hide()},function(t){console.log("loadInstagramPhotos"),jQuery("#tab-photo .loading-photo").hide()});break;case"facebook":$scope.resource.facebook.uid=angular.isDefined(e)?e[0]:$scope.resource.facebook.uid,$scope.resource.facebook.accessToken=angular.isDefined(e)?e[1]:$scope.resource.facebook.accessToken,$scope.resource.facebook.nextUrl=""==$scope.resource.facebook.nextUrl?"https://graph.facebook.com/"+$scope.resource.facebook.uid+"/photos/uploaded/?limit="+$scope.resource.facebook.filter.perPage+"&fields=source,images,link&access_token="+$scope.resource.facebook.accessToken:$scope.resource.facebook.nextUrl,$http({method:"GET",url:$scope.resource.facebook.nextUrl}).then(function(t){var e=t.data;_.each(e.data,function(t,e){$scope.resource.facebook.data.push({extenal:1,id:t.id,preview:t.images[t.images.length-1].source,url:t.source,des:"@ Facebook"})}),$scope.resource.facebook.data=_.uniqBy($scope.resource.facebook.data,"id"),$scope.resource.facebook.filter.total=$scope.resource.facebook.data.length,e.paging.next&&($scope.resource.facebook.nextUrl=e.paging.next,$scope.resource.facebook.filter.total+=1),jQuery("#tab-photo .loading-photo").hide()},function(t){console.log("loadFacebookPhotos"),jQuery("#tab-photo .loading-photo").hide()})}},$scope.authenticateInstagram=function(){if($scope.resource.instagram.token=sessionStorage.getItem("mskh_instagram_token"),$scope.resource.instagram.token)$scope.getPersonalPhoto("instagram");else{var t=(window.screen.width-700)/2,e=(window.screen.height-500)/2,i="https://instagram.com/oauth/authorize/?client_id="+MSKHCONFIG._instagram_app_id+"&redirect_uri="+MSKHCONFIG.instagram_redirect_uri+"&response_type=token",n=window.open(i,"_blank","width=700,height=500,left="+t+",top="+e);n.onload=new function(){0==window.location.hash.length&&n.open(i,"_self");var t=setInterval(function(){try{n.location.hash.length&&(clearInterval(t),$scope.resource.instagram.token=n.location.hash.slice(14),sessionStorage.setItem("mskh_instagram_token",$scope.resource.instagram.token),n.close(),$scope.getPersonalPhoto("instagram"))}catch(t){console.log("Instagram")}},100)}}},$scope.logoutInstagram=function(){sessionStorage.removeItem("mskh_instagram_token"),$scope.resource.instagram.token="",$scope.resource.instagram.data=[],$scope.resource.instagram.filter.currentPage=1,$scope.resource.instagram.filter.total=0,jQuery("#tab-photo .tab-scroll").stop().animate({scrollTop:jQuery(".main-items").height()},100)},$scope.afterGetResource=function(t){switch(t){case"clipart":0==$scope.resource.clipart.data.cat.length&&($scope.resource.clipart.data.cat=[{id:"0",name:MSKHCONFIG.mskhlangs.cliparts}]),angular.isDefined(MSKHCONFIG.product_data.option.art_cats)&&($scope.resource.clipart.data.cat=$scope.resource.clipart.data.cat.filter(function(t){var e=t.id;return MSKHCONFIG.product_data.option.art_cats.indexOf(e)>-1})),_.each($scope.resource.clipart.data.cat,function(t,e){t.amount=0,_.each($scope.resource.clipart.data.arts,function(e,i){e.url=e.url.indexOf("http")>-1?e.url:MSKHCONFIG.art_url+e.url,0==e.cat.length&&(e.cat=["0"]),_.includes(e.cat,t.id)&&t.amount++})}),$scope.resource.clipart.data.cat=_.sortBy($scope.resource.clipart.data.cat,"name"),$scope.resource.clipart.data.cat.length?($scope.resource.clipart.filter.currentCat=$scope.resource.clipart.data.cat[0],$scope.resource[t].filter.total=$scope.resource.clipart.filter.currentCat.amount):($scope.resource.clipart.filter.currentCat=-1,$scope.resource.clipart.filter.currentPage=0,$scope.resource[t].filter.total=0),jQuery("#tab-svg").removeClass("mskh-onload");break;case"photo":0==$scope.resource.photo.data.length&&jQuery("#tab-photo .loading-photo").hide(),$scope.resource.photo.filter.total=$scope.resource.photo.filter.totalPage*$scope.resource.photo.filter.perPage}},$scope.changeCat=function(t,e){switch($scope.resource[t].filter.search="",$scope.resource[t].filter.currentPage=1,$scope.resource[t].filter.currentCat=e,$scope.resource[t].filter.total=e.amount,$scope.updateApp(),t){case"clipart":jQuery("#tab-svg .tab-scroll").stop().animate({scrollTop:0},100)}},$scope.onLoadPrintingOptions=!1,$scope.awaitLoadPrintingOptions=!1,$scope.printingOptionsAvailable=!1,$scope.applyOptions=function(){jQuery(".mskh-popup.popup-nbo-options .close-popup").triggerHandler("click"),$scope.changePrintingOptions()},$scope.changePrintingOptions=function(t){if(!$scope.onloadVariation&&angular.isDefined(mskh_window.nbOption)){if(angular.isUndefined(t)){if($scope.onLoadPrintingOptions)return void($scope.awaitLoadPrintingOptions=!0);$scope.awaitLoadPrintingOptions=!1,$scope.onLoadPrintingOptions=!0}var e=mskh_window.nbOption.odOption;if(angular.isDefined(e.dpi)&&($scope.settings.product_data.option.dpi=e.dpi),angular.isDefined(e.page)){$scope.currentStage=0;var i=$scope.settings.product_data.product.length;if(angular.isUndefined($scope.stored_product)&&($scope.stored_product=[],angular.copy($scope.settings.product_data.product,$scope.stored_product)),angular.isDefined(e.page.list_page))$scope.settings.product_data.product=[],angular.forEach(e.page.list_page,function(t,e){if(angular.isDefined($scope.stored_product[t]))$scope.settings.product_data.product.push($scope.stored_product[t]);else if(angular.isDefined($scope.settings.product_data.product[i-1])){var n=angular.copy($scope.settings.product_data.product[i-1],n);$scope.settings.product_data.product.push(n)}}),0==$scope.settings.product_data.product.length&&angular.copy($scope.stored_product,$scope.settings.product_data.product);else if(angular.copy($scope.stored_product,$scope.settings.product_data.product),e.page.number<i)$scope.settings.product_data.product.splice(e.page.number,i-e.page.number);else if(e.page.number>i){var n;for(n=0;n<e.page.number-i;n++){var r=angular.copy($scope.settings.product_data.product[i-1],r);$scope.settings.product_data.product.push(r)}}}angular.isDefined(e.color)&&angular.forEach($scope.settings.product_data.product,function(t,i){if("c"==e.color.bg_type)t.bg_type="color",t.bg_color_value=e.color.bg_color;else if(t.bg_type="image",angular.isDefined(e.page)&&angular.isDefined(e.page.list_page)){if(angular.isDefined(e.page.list_page[i])){var n=e.page.list_page[i];angular.isDefined(e.color.bg_image[n])&&(t.img_src=e.color.bg_image[n])}}else angular.isDefined(e.color.bg_image[i])&&(t.img_src=e.color.bg_image[i])}),angular.isDefined(e.size)&&angular.forEach($scope.settings.product_data.product,function(t,i){t.product_height=e.size.product_height,t.product_width=e.size.product_width,t.real_width=e.size.real_width,t.real_height=e.size.real_height,t.real_left=e.size.real_left,t.real_top=e.size.real_top;var n=t.product_width/t.product_height;t.img_src_top=t.img_src_left=t.area_design_top=t.area_design_left=0,n>1?(t.img_src_width=500,t.area_design_width=500,t.img_src_height=500/n,t.area_design_height=500/n):(t.img_src_height=500,t.area_design_height=500,t.img_src_width=500*n,t.area_design_width=500*n)}),angular.isDefined(e.dimension)&&angular.forEach($scope.settings.product_data.product,function(t,i){t.product_height=e.dimension.height,t.product_width=e.dimension.width,t.real_width=e.dimension.width,t.real_height=e.dimension.height,t.real_left=t.real_top=t.img_src_top=t.img_src_left=t.area_design_left=t.area_design_top=0;var n=t.product_width/t.product_height;n>1?(t.img_src_width=500,t.area_design_width=500,t.img_src_height=500/n,t.area_design_height=500/n):(t.img_src_height=500,t.area_design_height=500,t.img_src_width=500*n,t.area_design_width=500*n)}),angular.isDefined(e.orientation)&&angular.forEach($scope.settings.product_data.product,function(t,i){var n=parseFloat(t.product_width),r=parseFloat(t.product_height);if(1==e.orientation&&n<r||0==e.orientation&&r<n){var o=t.product_width;t.product_width=t.product_height,t.product_height=o,o=t.img_src_width,t.img_src_width=t.img_src_height,t.img_src_height=o,o=t.real_width,t.real_width=t.real_height,t.real_height=o,o=t.img_src_top,t.img_src_top=t.img_src_left,t.img_src_left=o,o=t.area_design_width,t.area_design_width=t.area_design_height,t.area_design_height=o,o=t.bleed_top_bottom,t.bleed_top_bottom=t.bleed_left_right,t.bleed_left_right=o,o=t.margin_top_bottom,t.margin_top_bottom=t.margin_left_right,t.margin_left_right=o,1==e.orientation?(o=t.real_left,t.real_left=t.real_top,t.real_top=t.product_height-t.real_height-o):(o=t.real_top,t.real_top=t.real_left,t.real_left=t.product_width-t.real_width-o),t.area_design_top=t.real_top/t.product_width*t.img_src_width,t.area_design_left=t.real_left/t.product_width*t.img_src_width}}),angular.isDefined(e.area)&&angular.forEach($scope.settings.product_data.product,function(t,i){t.area_design_type=e.area}),angular.isUndefined(t)&&($scope.saveDesign(),appConfig.ready=!1,angular.isDefined(e.color)&&"c"==e.color.bg_type||angular.isDefined(e.area)?$scope.forceInitStage=!0:($scope.settings.product_data.design=$scope.resource.jsonDesign,$scope.settings.product_data.config={},$scope.settings.product_data.config.viewport=$scope.calcViewport(),$scope.settings.product_data.fonts=$scope.resource.usedFonts),$scope.processProductSettings(),$scope.updateApp())}},$scope.onloadVariation=!1,$scope.changeVariation=function(){$scope.onloadVariation||($scope.onloadVariation=!0,$scope.toggleStageLoading(),$scope.saveDesign(),appConfig.ready=!1,MSKHDataFactory.get("_get_product_info",{product_id:MSKHCONFIG.product_id,variation_id:MSKHCONFIG.variation_id,need_templates:1},function(t){$scope.toggleStageLoading(),$scope.onloadVariation=!1,1==MSKHCONFIG.ui_mode&&mskh_window.MSKHPRODUCT._ready(),$scope.settings.product_data=JSON.parse(t),angular.isDefined($scope.settings.product_data.templates)&&($scope.resource.templates=$scope.settings.product_data.templates),$scope.settings.product_data.design=$scope.resource.jsonDesign,$scope.settings.product_data.config={},$scope.settings.product_data.config.viewport=$scope.calcViewport(),$scope.settings.product_data.fonts=$scope.resource.usedFonts,$scope.changePrintingOptions(!0),$scope.processProductSettings()}))},$scope.loadedPrintingOptions=!1,$scope.widthoutPrintingOptions=!1,$scope.getPrintingOptions=function(){jQuery(".mskh-popup.popup-nbo-options").nbShowPopup(),$scope.loadedPrintingOptions||$http({method:"GET",url:$scope.settings.link_get_options}).then(function(t){$scope.loadedPrintingOptions=!0;var e=jQuery("#nbo-options-wrap");e.append(t.data),jQuery(document).trigger("nbo_get_option_success"),jQuery(".variation-selector").removeClass("hidden").show(),jQuery(".nbtcs-swatches").addClass("hidden"),0==jQuery(".nbo-wrapper").length&&($scope.widthoutPrintingOptions=!0,jQuery('input[name="variation_id"]').length>0&&jQuery('input[name="variation_id"]').val()>0&&($scope.printingOptionsAvailable=!0),jQuery(".variations_form").on("woocommerce_variation_has_changed wc_variation_form",function(){jQuery('input[name="variation_id"]').length>0&&jQuery('input[name="variation_id"]').val()>0?(MSKHCONFIG.variation_id=jQuery('input[name="variation_id"]').val(),$scope.printingOptionsAvailable=!0,$scope.changeVariation()):$scope.printingOptionsAvailable=!1}),jQuery(".variations_form").on("found_variation found_variation.wc-variation-form",function(){setTimeout(function(){jQuery('input[name="variation_id"]').length>0&&jQuery('input[name="variation_id"]').val()>0?(MSKHCONFIG.variation_id=jQuery('input[name="variation_id"]').val(),$scope.printingOptionsAvailable=!0,$scope.changeVariation()):$scope.printingOptionsAvailable=!1},100)})),"1"==MSKHCONFIG.show_nbo_option&&"new"==MSKHCONFIG.task&&(e.find("form.variations_form").append('<input name="submit_form_mode2" type="hidden" value="1" />'),e.find("form.cart").append('<input name="submit_form_mode2" type="hidden" value="1" />'),e.find("form.cart").append('<input name="add-to-cart" type="hidden" value="'+MSKHCONFIG.product_id+'" />')),""!=MSKHCONFIG.task2&&(jQuery(".variations_form").addClass("mskh-disabled"),jQuery("form.cart").addClass("mskh-disabled")),jQuery(".mskh-popup.popup-nbo-options .overlay-popup").addClass("nbo-disable"),jQuery(".single_add_to_cart_button").addClass("mskh-disabled"),jQuery(".mskh-popup.popup-nbo-options").find(".overlay-main").removeClass("active"),jQuery(".single_add_to_cart_button").hide();var i=angular.element(e).scope();angular.element(e).injector().get("$compile")(jQuery(e).contents())(i),$timeout(function(){e.perfectScrollbar(),jQuery("#nbo-options-wrap .variations_form").length&&(jQuery("#nbo-options-wrap .variations_form").wc_variation_form(),jQuery("#nbo-options-wrap .variations_form").trigger("wc_variation_form"),jQuery("#nbo-options-wrap .variations_form .variations select").change())})})},$scope.uploadFile=function(t,e){if(e=angular.isDefined(e)?e:0,!(t.length<=0||e>t.length-1||e>parseInt($scope.settings._max_upload_files_at_once)-1)){var i=t[e],n=parseInt($scope.settings._maxsize_upload),r=parseInt($scope.settings._minsize_upload);if(-1!==i.type.indexOf("image"))if(i.size>1024*n*1024)alert("Max file size"+n+" MB");else if(i.size<1024*r*1024)alert("Min file size"+r+" MB");else if(i.type.indexOf("svg")>-1){var o=new FileReader;o.onload=function(i){if(2===i.target.readyState){var n=o.result;$scope.addSvgFromString(n),$scope.uploadFile(t,e+1)}},o.readAsText(i)}else $scope.toggleStageLoading(),MSKHDataFactory.get("_customer_upload",{file:i},function(i){if(1==(i=JSON.parse(i)).flag){if(angular.isDefined(i.ilr)&&($scope.resource.upload.ilr=!0),$scope.resource.upload.ilr&&"no"==MSKHCONFIG._enable_low_resolution_image)return $scope.toggleStageLoading(),alert(i.mes),void $scope.uploadFile(t,e+1);$scope.storeUploadFile(i.src,i.name),$scope.addImage(i.src,!1,!0),jQuery("#tab-photo .tab-scroll").stop().animate({scrollTop:jQuery("#tab-photo .tab-scroll").prop("scrollHeight")},100),localStorage.setItem("uploaded",$scope.resource.upload.data),$scope.onEndRepeat("upload"),$scope.uploadFile(t,e+1)}else $scope.toggleStageLoading(),alert(i.mes)});else alert("Only support image")}},$scope.storeUploadFile=function(t,e){$scope.resource.upload.data.push({url:t,des:e,ilr:$scope.resource.upload.ilr}),"yes"==$scope.settings._cache_uploaded_image&&$scope._localStorage.save("mskhuploaded")},$scope.login=function(t){$scope.settings.is_logged?"function"==typeof t&&t():($scope.toggleStageLoading(),MSKHDataFactory.get("mskh_check_use_logged_in",{type:"check_login"},function(e){if(e=JSON.parse(e),$scope.toggleStageLoading(),1==e.is_login)return MSKHCONFIG.nonce_get=e.nonce_get,MSKHCONFIG.nonce=e.nonce,void("function"==typeof t&&t());var i=(window.screen.width-700)/2,n=(window.screen.height-500)/2,r=window.open(MSKHCONFIG.login_url,"","width=700,height=500,left="+i+",top="+n);r.onload=new function(){0==window.location.hash.length&&r.open(MSKHCONFIG.login_url,"_self");var e=setInterval(function(){try{if(r.location.hash.length){var i=r.location.hash.split("___");i.length&&(MSKHCONFIG.nonce_get=i[0].substr(1),MSKHCONFIG.nonce=i[1]),clearInterval(e),$scope.settings.is_logged=1,r.close(),$scope.updateApp(),"function"==typeof t&&t()}}catch(t){}},100)}}))},$scope.addImageFromUrl=function(t,e,i){if(""!=t)if($scope.toggleStageLoading(),$scope.showDesignTab(),null==t.match(/\.(svg)$/))angular.isUndefined(e)||e?MSKHDataFactory.get("_copy_image_from_url",{url:t,gapi:$scope.resource.gapi},function(t){1==(t=JSON.parse(t)).flag?($scope.addImage(t.src,!1,!0),$scope.storeUploadFile(t.src,"")):alert("Try to download image and then upload to our server!")}):(i&&($scope.resource.upload.ilr=!0),$scope.addImage(t,!1,!0));else{var n={url:t,name:""};$scope.addArt(n,!1,!0)}},$scope.stageOnload=!1,$scope.toggleStageLoading=function(t){jQuery(".loading-workflow").toggleClass("mskh-show");var e=appConfig.isVisual?".mskh-mode-vista":"body";jQuery(e).toggleClass("mskh-onloading");var i=t||2e4;jQuery(".loading-workflow").hasClass("mskh-show")?($scope.stageOnload=!0,promise=$timeout(function(){$scope.stageOnload&&(jQuery(".loading-workflow").toggleClass("mskh-show"),jQuery(e).toggleClass("mskh-onloading"))},i)):($timeout.cancel(promise),$scope.stageOnload=!1)},$scope.initWebcam=function(){$scope.resource.webcam.status=!0,Webcam.set({width:400,height:300,dest_width:1280,dest_height:960,image_format:"jpeg",jpeg_quality:100}),Webcam.set("constraints",{optional:[{minWidth:600}]}),Webcam.attach("#my_camera"),Webcam.setSWFLocation(MSKHCONFIG.assets_url+"webcam.swf")},$scope.pauseWebcam=function(t){1==t&&Webcam.freeze()||Webcam.unfreeze()},$scope.resetWebcam=function(){$scope.resource.webcam.status?(Webcam.reset(),$scope.resource.webcam.status=!1):$scope.initWebcam()},$scope.takeSnapshot=function(){Webcam.snap(function(t){$scope.resetWebcam();var e=t.replace(/^data:image\/\w+;base64,/,"");MSKHDataFactory.get("_save_webcam_image",{image:e},function(t){"success"==(t=JSON.parse(t)).flag?(jQuery(".popup-webcam .close-popup").triggerHandler("click"),$scope.toggleStageLoading(),$scope.addImage(t.url,!1,!0)):(alert("Oops! Try again!"),$scope.initWebcam())})})},$scope.onEndRepeat=function(t){switch(t){case"typography":$scope.renderMasonryList(t,".mskh-sidebar .typography-items",".typography-item","#tab-typography",$scope.resource[t].init);break;case"font":jQuery("#toolbar-font-familly-dropdown").perfectScrollbar("update");break;case"clipart":$scope.renderMasonryList(t,"#tab-svg .clipart-wrap",".clipart-item","#tab-svg",$scope.resource[t].init);break;case"photo":$scope.renderMasonryList(t,"#tab-photo .mkdesigner-gallery",".mkdesigner-item","#tab-photo",$scope.resource[t].init);break;case"dropbox":case"instagram":case"facebook":case"upload":case"shape":case"icon":case"line":$scope.renderMasonryList(t,"#mskh-"+t+"-wrap .mansory-wrap",".mansory-item","#mskh-"+t+"-wrap",$scope.resource[t].init)}},$scope.updateScrollBar=function(t){$timeout(function(){jQuery(t).perfectScrollbar("update")})},$scope.renderMasonryList=function(t,e,i,n,r){imagesLoaded(jQuery(e),function(){r||jQuery(e).masonry("destroy");jQuery(e).masonry({itemSelector:i});jQuery.each(jQuery(e+" "+i),function(t){var e=Math.floor(10*Math.random());e=100*(e+1),checkMobileDevice()?jQuery(this).addClass("in-view"):jQuery(this).addClass("in-view slideInDown animated animate"+e)}),jQuery(n+" .tab-scroll").perfectScrollbar("update"),$timeout(function(){jQuery(n+" .loading-photo").hide(),jQuery(n+" .tab-load-more").show()},100),$scope.resource[t].onload=!1,$scope.resource[t].init=!1})},$scope.scrollLoadMore=function(t,e){if(!$scope.resource[e].onload){if("photo"==e&&$scope.resource.personal.status){var i=$scope.resource.personal.type;if("url"==i||"upload"==i)return;return $scope.resource[i].filter.currentPage*$scope.resource[i].filter.perPage<$scope.resource[i].filter.total?($scope.resource[i].filter.currentPage+=1,jQuery(t+" .loading-photo").show(),$scope.resource[i].onload=!0,"facebook"==i&&$scope.getPersonalPhoto("facebook"),void $scope.updateApp()):void jQuery(t+" .loading-photo").hide()}if("element"!=e){if("globalTemplate"==e)return $scope.resource[e].filter.currentPage<$scope.resource[e].filter.totalPage?($scope.resource[e].filter.currentPage+=1,$scope.toggleStageLoading(),$scope.resource[e].onload=!0,void $scope.loadGlobalTemplate($scope.templateCat)):void jQuery(t+" .loading-photo").hide();if($scope.resource[e].filter.currentPage*$scope.resource[e].filter.perPage>=$scope.resource[e].filter.total)jQuery(t+" .loading-photo").hide();else{switch(jQuery(t+" .loading-photo").show(),$scope.resource[e].filter.currentPage*$scope.resource[e].filter.perPage<$scope.resource[e].filter.total&&($scope.resource[e].filter.currentPage+=1),e){case"typography":case"clipart":$scope.resource[e].onload=!0;break;case"font":break;case"photo":$scope.resource[e].onload=!0,!$scope.resource.personal.status&&$scope.getPhoto($scope.resource.photo.type,"more")}$scope.updateApp()}}else{var n=$scope.resource.element.type;if(["icon","shape","line"].indexOf(n)>-1){if(!($scope.resource[n].filter.currentPage<$scope.resource[n].filter.totalPage))return void jQuery(t+" .loading-photo").hide();$scope.resource[n].filter.currentPage+=1,$scope.getMedia(n,"more")}}}},$scope.generateTypoLink=function(t){return"typography"==$scope.settings.task?MSKHCONFIG.plg_url+"/data/typography/img/"+t.id+".png":"//dpeuzbvf3y4lr.cloudfront.net/typography/"+t.folder+"/preview.png"},$scope.loadFontFailAction=function(t){_.remove($scope.settings.gg_fonts,{id:t.id}),$scope.resource.font.filteredFonts=filterFontFilter($scope.resource.font.data,$scope.resource.font.filter),$scope.updateApp()},$scope.saveForLater=function(){$scope.login(function(){$scope.saveData("saveforlater")})},$scope.startLogo=0,$scope.cuzz=function(){$scope.clearAllStage();var t=filterArtFilter($scope.resource.clipart.data.arts,{currentCat:{id:"10"},currentPage:1,search:"",perPage:1e3});$scope.startLogo<t.length-1&&($scope.addArt(t[$scope.startLogo],!0,!0),$timeout(function(){$scope.saveData()},1e3))},$scope.saveData=function(t){angular.isUndefined(t)&&(t=$scope.settings.task),"share"!=t&&$scope.toggleStageLoading(6e4),"typography"==t&&($scope.resource.usedFonts=[]),"saveforlater"!=t&&"share"!=t&&($scope.maybeZoomStage=!0),$scope.saveDesign(),$scope.resource.config.viewport=$scope.calcViewport(),$scope.resource.config.scale=($window.innerWidth>$window.innerHeight-120?$window.innerHeight-120:$window.innerWidth)/500,$scope.resource.config.product=$scope.settings.product_data.product,$scope.resource.config.dpi=$scope.settings.product_data.option.dpi;var e={};switch(e.used_font=new Blob([JSON.stringify($scope.resource.usedFonts)],{type:"application/json"}),"template"==t&&($scope.resource.jsonDesign.canvas={width:$scope.templateSize.width,height:$scope.templateSize.height}),e.design=new Blob([JSON.stringify($scope.resource.jsonDesign)],{type:"application/json"}),_.each($scope.stages,function(i,n){var r="frame_"+n+"_svg";e["frame_"+n]=$scope.makeblob(i.design),"typography"!=t&&"template"!=t&&(e[r]=new Blob([i.svg],{type:"image/svg"}))}),t){case"typography":e.type="save_typography",e.id=$scope.resource.currentTypo,_.each($scope.stages,function(t,i){e["frame_"+i]=$scope.makeblob(t.design)}),MSKHDataFactory.get("mskh_get_resource",e,function(t){$scope.stages[0].states.usedFonts=[],alert("Success!")});break;case"template":e.type="save_template",e.source="media",e.tem_name=$scope.templateName,e.cid=$scope.templateCat,jQuery(".popup-template .close-popup").triggerHandler("click"),MSKHDataFactory.get("mskh_get_resource",e,function(t){1==(t=JSON.parse(t)).flag?(_.each($scope.stages,function(t,e){t.states.usedFonts=[]}),$scope.resource.usedFonts=[],$scope.listAddedColor=[],$scope.resetStage(),$scope.toggleStageLoading(),alert("Success!")):alert("Try again!")});break;case"saveforlater":default:["product_id","variation_id","task","task2","design_type","mskh_item_key","cart_item_key","order_id","enable_upload_without_design","auto_add_to_cart"].forEach(function(t){e[t]=MSKHCONFIG[t]}),"share"==t&&(e.share=1),e.mskh_file="",e.config=new Blob([JSON.stringify($scope.resource.config)],{type:"application/json"}),"new"==MSKHCONFIG.task&&1==MSKHCONFIG.ui_mode&&(e.auto_add_to_cart=MSKHCONFIG._auto_add_cart_in_detail_page),$timeout(function(){var i="share"!=t&&"saveforlater"!=t&&"new"==MSKHCONFIG.task&&2==MSKHCONFIG.ui_mode?"mskh_save_cart_design":"mskh_save_customer_design";"1"==MSKHCONFIG.show_nbo_option&&"new"==MSKHCONFIG.task&&(i="mskh_save_customer_design"),MSKHDataFactory.get(i,e,function(e){if("success"==(e=JSON.parse(e)).flag){if(3==MSKHCONFIG.ui_mode){if("new"==MSKHCONFIG.task&&""==MSKHCONFIG.task2)return $scope.toggleStageLoading(),console.log(MSKHCONFIG.variation_id),jQuery(".variations_form").submit(),void jQuery("form.cart").submit();if(""!=MSKHCONFIG.redirect_url)return void(window.location=MSKHCONFIG.redirect_url)}if("saveforlater"==t){var i={product_id:MSKHCONFIG.product_id,variation_id:MSKHCONFIG.variation_id,folder:e.folder};return void MSKHDataFactory.get("mskh_save_for_later",i,function(t){t=JSON.parse(t),$scope.toggleStageLoading()})}if("share"==t)return $scope.resource.social.folder=e.sfolder,void jQuery(".mskh-popup.popup-share").find(".overlay-main").removeClass("active");if("1"==MSKHCONFIG.show_nbo_option&&"new"==MSKHCONFIG.task&&""==MSKHCONFIG.task2)return jQuery(".variations_form").submit(),void jQuery("form.cart").submit();if(""!=MSKHCONFIG.redirect_url)return void(window.location=MSKHCONFIG.redirect_url);"yes"==MSKHCONFIG._auto_add_cart_in_detail_page&&1==e.added?mskh_window.location=MSKHCONFIG.cart_url:(mskh_window.MSKHPRODUCT.product_id=MSKHCONFIG.product_id,mskh_window.MSKHPRODUCT.variation_id=MSKHCONFIG.variation_id,mskh_window.MSKHPRODUCT.folder=e.folder,mskh_window.MSKHPRODUCT.show_design_thumbnail(e.image,MSKHCONFIG.task,$scope.resource.config),mskh_window.MSKHPRODUCT.get_sugget_design(MSKHCONFIG.product_id,MSKHCONFIG.variation_id),$scope.toggleStageLoading(),$timeout(function(){_.each($scope.stages,function(t,e){$scope.zoomStage(t.states.fitScaleIndex,e)})}))}else console.log("Oops! Design has not been saved!"),$scope.toggleStageLoading()})})}},$scope.createShareLink=function(t,e){var i=new Date,n=MSKHCONFIG._create_own_page+"?product_id="+MSKHCONFIG.product_id+"&variation_id="+MSKHCONFIG.variation_id+"&reference="+$scope.resource.social.folder+"&mskh_share_id="+$scope.resource.social.folder+"&t="+i.getTime();$scope.resource.social.link=e+encodeURIComponent(n),"twitter"==t&&($scope.resource.social.link+="&text="+$scope.resource.social.comment)},$scope.updateShareLink=function(){var t=$scope.resource.social.link;t.indexOf("&text=")>-1&&(t=t.substr(0,t.indexOf("&text=")+7)+$scope.resource.social.comment,$scope.resource.social.link=t)},$scope.maybeZoomStage=!1,$scope.saveDesign=function(){_.each($scope.stages,function(t,e){$scope.deactiveAllLayer(e);var i=-1!=t.states.fillScaleIndex?t.states.fillScaleIndex:t.states.fitScaleIndex;$scope.maybeZoomStage&&$scope.zoomStage(i,e);var n=t.canvas,r="frame_"+e;$scope.renderStage(e),$scope.resource.jsonDesign[r]=n.toJSON($scope.includeExport),t.svg=n.toSVG(),t.design=n.toDataURL(),$scope.resource.usedFonts=_.concat($scope.resource.usedFonts,t.states.usedFonts)}),$scope.resource.usedFonts=_.uniqBy($scope.resource.usedFonts,"alias"),$scope.maybeZoomStage=!1},$scope.makeblob=function(t){if(-1==t.indexOf(";base64,")){var e=(n=t.split(","))[0].split(":")[1],i=decodeURIComponent(n[1]);return new Blob([i],{type:e})}e=(n=t.split(";base64,"))[0].split(":")[1];for(var n,r=(i=window.atob(n[1])).length,o=new Uint8Array(r),s=0;s<r;++s)o[s]=i.charCodeAt(s);return new Blob([o],{type:e})},$scope.updateApp=function(){"$apply"!==$scope.$root.$$phase&&"$digest"!==$scope.$root.$$phase&&$scope.$apply()},$scope.$on("mskh:keypress",function(t,e){$scope.keypressHandle(e)}),$scope.$on("mskh:keydown",function(t,e){$scope.keydownHandle(e)}),$scope.keydownHandle=function(t){},$scope.wraperClickHandle=function(t){var e=jQuery("#mskh-text-color-picker"),i=jQuery("#mskh-bg-color-picker"),n=jQuery("#mskh-global-color-picker");jQuery(t.target).hasClass("color-palette-add")||!$scope.showTextColorPicker||0!=e.has(t.target).length||e.is(t.target)||($scope.showTextColorPicker=!1),jQuery(t.target).hasClass("color-palette-add")||!$scope.showBgColorPicker||0!=i.has(t.target).length||i.is(t.target)||($scope.showBgColorPicker=!1),jQuery(t.target).hasClass("color-palette-add")||!$scope.globalPicker.active||0!=n.has(t.target).length||n.is(t.target)||($scope.globalPicker.active=!1)},$scope.keypressHandle=function(t){var e=t.target.tagName.toUpperCase();if("INPUT"!=e&&"TEXTAREA"!=e&&!$scope.stages[$scope.currentStage].states.isEditing||t.ctrlKey&&(66==t.which||73==t.which)){var i=$scope.stages[$scope.currentStage].states;if(t.ctrlKey||t.metaKey){if(_.includes([67,116],t.which))return;if(t.preventDefault(),t.shiftKey)switch(t.which){case 221:$scope.setStackPosition("bring-front");break;case 219:$scope.setStackPosition("send-back");break;case 73:$scope.importDesign();break;case 69:$scope.exportDesign();break;case 83:$scope.saveData("saveforlater");break;case 76:$scope.clearAllStage();break;case 79:$scope.loadMyDesign(null,!0);break;case 188:i.isText&&(i.text.ptFontSize-=1,$scope.setTextAttribute("fontSize",i.text.ptFontSize)),$scope.updateApp();break;case 190:i.isText&&(i.text.ptFontSize+=1,$scope.setTextAttribute("fontSize",i.text.ptFontSize)),$scope.updateApp();break;case 71:i.isNativeGroup&&$scope.unGroupLayers(),$scope.updateApp()}else switch(t.which){case 65:$scope.selectAllLayers();break;case 66:i.isText&&i.text.font.file.b&&("italic"!=i.text.fontStyle||"italic"==i.text.fontStyle&&i.text.font.file.bi)&&$scope.setTextAttribute("fontWeight","bold"==i.text.fontWeight?"normal":"bold"),$scope.updateApp();break;case 80:$scope.copyLayers();break;case 73:i.isText&&i.text.font.file.i&&("bold"!=i.text.fontWeight||"bold"==i.text.fontWeight&&i.text.font.file.bi)&&$scope.setTextAttribute("fontStyle","italic"==i.text.fontStyle?"normal":"italic"),$scope.updateApp();break;case 68:$scope.deactiveAllLayer();break;case 69:$scope.clearStage();break;case 90:i.isUndoable&&$scope.undo();break;case 89:i.isRedoable&&$scope.redo();break;case 71:i.isGroup&&$scope.groupLayers(),$scope.updateApp();break;case 76:$scope.settings.bleedLine=!$scope.settings.bleedLine,$scope.updateApp();break;case 82:$scope.toggleRuler(),$scope.updateApp();break;case 72:$scope.translateLayer("horizontal");break;case 86:$scope.translateLayer("vertical");break;case 107:i.currentScaleIndex<i.scaleRange.length-1&&($scope.zoomStage(i.currentScaleIndex+1),$scope.updateApp());break;case 109:i.currentScaleIndex>0&&($scope.zoomStage(i.currentScaleIndex-1),$scope.updateApp());break;case 48:case 96:$scope.zoomStage(i.fitScaleIndex),$scope.updateApp();break;case 49:case 97:-1==i.fillScaleIndex&&$scope.zoomStage(i.fitScaleIndex)||$scope.zoomStage(i.fillScaleIndex),$scope.updateApp();break;case 221:$scope.setStackPosition("bring-forward");break;case 219:$scope.setStackPosition("send-backward");break;case 79:$scope.loadMyDesign(null,!1)}}else if(t.altKey)switch(t.preventDefault(),t.which){case 37:$scope.moveLayer("left","alt");break;case 38:$scope.moveLayer("up","alt");break;case 39:$scope.moveLayer("right","alt");break;case 40:$scope.moveLayer("down","alt");break;case 85:i.isText&&$scope.setTextAttribute("is_uppercase",!0),$scope.updateApp();break;case 76:i.isText&&$scope.setTextAttribute("is_uppercase",!1),$scope.updateApp()}else if(t.shiftKey)switch(t.which){case 107:$scope.scaleLayer("+");break;case 109:$scope.scaleLayer("-");break;case 71:$scope.settings.showGrid=!$scope.settings.showGrid,$scope.updateApp();break;case 76:$scope.clearGuides()}else switch(t.which){case 37:i.isActiveLayer&&$scope.moveLayer("left");break;case 38:i.isActiveLayer&&$scope.moveLayer("up");break;case 39:i.isActiveLayer&&$scope.moveLayer("right");break;case 40:i.isActiveLayer&&$scope.moveLayer("down");break;case 46:$scope.deleteLayers();break;case 86:$scope.resource.drawMode.status&&jQuery('.item[data-type="draw"]').triggerHandler("click");break;case 66:$scope.resource.drawMode.status||jQuery('.item[data-type="draw"]').triggerHandler("click")}}},$scope.onClickStage=function(t){if(angular.element(t.target).hasClass("stage")&&($scope.deactiveAllLayer(),"yes"==$scope.settings._save_latest_design)){$scope.saveDesign();var e={config:{}};e.config.viewport=$scope.calcViewport(),e.fonts=$scope.resource.usedFonts,e.design=$scope.resource.jsonDesign;var i=MSKHCONFIG.product_id+"-"+MSKHCONFIG.variation_id;$scope.localStore.update(i,e,function(){jQuery(".mskh-toasts").nbToasts()})}$scope.ctxMenuStyle.visibility="hidden",$scope.updateApp()},$scope.$on("mskh:contextmenu",function(t,e){$scope.contextMenu(e)}),$scope.ctxMenuStyle={top:"17%",left:"33%",visibility:"hidden"},$scope.contextMenu=function(t){if(!$scope.stages[$scope.currentStage].states.isEditing){if(t.preventDefault(),$scope.stages[$scope.currentStage].states.isActiveLayer){var e=t.pageX,i=t.pageY,n=angular.element(document.getElementById("mskh-context-menu"))[0],r=n.clientHeight,o=n.clientWidth;$scope.workBenchWidth<e+o+15&&(e=$scope.workBenchWidth-o-15),$scope.workBenchHeight<i+r+15&&(i=$scope.workBenchHeight-r-15),$scope.ctxMenuStyle={visibility:"visible",top:i,left:e}}else $scope.ctxMenuStyle={visibility:"hidden","pointer-events":"none"};$scope.updateApp()}},$scope.preventLoadDesign=!1,$scope.globalPicker={color:MSKHCONFIG._default_color,attr:"text.stroke",active:!1},$scope.selectGlobalPicker=function(t){$scope.globalPicker.color=t;var e=$scope.globalPicker.attr.split(".");2==e.length&&"text"==e[0]&&$scope.setTextAttribute(e[1],$scope.globalPicker.color),jQuery("#mskh-global-color-palette").removeClass("show")},$scope.$on("mskh:picker",function(t,e,i){$scope.globalPicker.attr=e,$scope.globalPicker.color=i}),$scope.$on("canvas:created",function(t,e,i){$scope.initStageSetting(e);var n=$scope.stages[e].canvas;if(checkMobileDevice()||(jQuery("#stage-container-"+e).perfectScrollbar(),jQuery("#stage-container-"+e).on("drop",function(t){$scope.onDrop(t)})),n.on("mouse:down",function(t){$scope.onMouseDown(e,t)}),n.on("mouse:over",function(t){$scope.onMouseOverStage(e,t)}),n.on("mouse:out",function(t){$scope.onMouseOutStage(e,t)}),n.on("mouse:move",function(t){$scope.onMouseMoveStage(e,t)}),n.on("mouse:up",function(t){$scope.onMouseUpStage(e,t)}),n.on("path:created",function(t){$scope.onPathCreated(e,t)}),n.on("object:added",function(t){$scope.onObjectAdded(e,t)}),n.on("selection:created",function(t){$scope.onSelectionCreated(e,t)}),n.on("object:scaling",function(t){$scope.onObjectScaling(e,t)}),n.on("object:scaled",function(t){$scope.onObjectScaled(e,t)}),n.on("object:moving",function(t){$scope.onObjectMoving(e,t)}),n.on("object:moved",function(t){$scope.onObjectMoved(e,t)}),n.on("object:rotating",function(t){$scope.onObjectRotating(e,t)}),n.on("object:modified",function(t){$scope.onObjectModified(e,t)}),n.on("before:render",function(t){$scope.onBeforeRender(e,t)}),n.on("after:render",function(t){$scope.onAfterRender(e,t)}),n.on("selection:cleared",function(t){$scope.onSelectionCleared(e,t)}),n.on("text:editing:entered",function(t){$scope.onEditingEntered(e,t)}),n.on("text:editing:exited",function(t){$scope.onEditingExited(e,t)}),n.on("text:changed",function(t){$scope.onTextChanged(e,t)}),n.on("selection:updated",function(t){$scope.onSelectionUpdated(e,t)}),n.on("text:selection:changed",function(t){$scope.onSelectionChanged(e,t)}),n.on("mouse:dblclick",function(t){$scope.onDblclick(t)}),"1"==i){if(appConfig.ready=!0,$scope.preventLoadDesign)return void($scope.preventLoadDesign=!1);$scope.loadTemplateAfterRenderCanvas()}}),$scope.loadTemplateAfterRenderCanvas=function(){if($scope.forceInitStage)return $scope.initStagesSettingWithoutTemplate(),void($scope.forceInitStage=!1);!$scope.isTemplateMode||$scope.isTemplateMode&&"edit"==$scope.settings.task?$timeout(function(){function t(){if(angular.isDefined($scope.settings.product_data.design)){var t=angular.isDefined($scope.settings.product_data.config_ref)?$scope.settings.product_data.config_ref:$scope.settings.product_data.config,e=t.viewport;angular.isUndefined(t.viewport)&&angular.isDefined(t.scale)&&(e={width:500*t.scale,height:500*t.scale}),$scope.insertTemplate(!0,{fonts:$scope.settings.product_data.fonts,design:$scope.settings.product_data.design,viewport:e})}else if("1"==MSKHCONFIG.product_data.option.admindesign&&0==$scope.resource.templates.length&&""!=MSKHCONFIG.product_data.option.global_template_cat)var i=setInterval(function(){$scope.globalTemplateLoaded&&($scope.resource.globalTemplate.data.length>0?$scope.insertGlobalTemplate($scope.resource.globalTemplate.data[0].id):$scope.initStagesSettingWithoutTemplate(),clearInterval(i))},100);else $scope.initStagesSettingWithoutTemplate()}var e;angular.isDefined($scope.settings.product_data.is_reference)?t():angular.isDefined($scope.settings.product_data.is_template)||"create_template"==$scope.settings.task?(e=MSKHCONFIG.product_id+"-"+MSKHCONFIG.variation_id,"yes"==$scope.settings._save_latest_design&&$scope.localStore.ready?$scope.localStore.get(e,function(e){e?$scope.insertTemplate(!0,{fonts:e.data.fonts,design:e.data.design,viewport:e.data.config.viewport}):t()}):t()):t()}):$scope.initStagesSettingWithoutTemplate()},$scope.theFirstCalcViewport=!0,$scope.calcViewport=function(){var t=checkMobileDevice()?20:100,e=checkMobileDevice()?70:100,i=jQuery(".mskh-stages").width()-t,n=jQuery(".mskh-stages").height()-e;return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("CriOS")&&$scope.theFirstCalcViewport&&(e=checkMobileDevice()?60:100),$scope.theFirstCalcViewport=!1,{width:i,height:n}},$scope.reCalcViewPort=function(){},$scope.calcStyle=function(t){return t+"px"},$scope.processProductSettings=function(){var t="mm"==$scope.settings._dimensions_unit?.1:"in"==$scope.settings._dimensions_unit?2.54:1;$scope.rateConvert2Px=$scope.rateConvertCm2Px96dpi*t*parseFloat($scope.settings.product_data.option.dpi)/96;var e=$scope.calcViewport(),i=[.1,.25,.3,.5,.75,1,1.25,1.5,1.75,2,3,4,5],n=checkMobileDevice()?1e3:5e3;$scope.stages=[],_.each($scope.settings.product_data.product,function(r,o){var s=r.product_width*$scope.rateConvert2Px,a=r.product_height*$scope.rateConvert2Px,c=$scope.fitRectangle(e.width,e.height,s,a,!0),l=s/c.width,u=200/Math.max(c.width,c.height),h=n/Math.max(c.width,c.height),f=$scope.fitRectangle(screen.width,screen.height,s,a,!0).width/c.width,p=i.filter(function(t){return t>=u&&t<=h});$scope.stages[o]={config:{_width:s,_height:a,name:r.orientation_name,width:c.width*r.real_width/r.product_width,height:c.width*r.real_height/r.product_width,top:c.width*r.real_top/r.product_width,left:c.width*r.real_left/r.product_width,cwidth:c.width,cheight:c.height,bleed_lr:c.width*r.bleed_left_right/r.product_width,bleed_tb:c.width*r.bleed_top_bottom/r.product_width,margin_lr:c.width*r.margin_left_right/r.product_width,margin_tb:c.width*r.margin_top_bottom/r.product_width,pWidth:r.product_width,pHeight:r.product_height,bgType:r.bg_type,bgColor:r.bg_color_value,bgImage:r.img_src,showBleed:r.show_bleed,showOverlay:r.show_overlay,showSafeZone:r.show_safe_zone,area_design_type:r.area_design_type,show_overlay:r.show_overlay,img_overlay:r.img_overlay},states:{},undos:[],redos:[],layers:[],canvas:{},rulers:[],rulerLines:{vers:[],hors:[]}};var d=$scope.stages[o].states;angular.copy($scope.defaultStageStates,d);var g="mm"==$scope.settings._dimensions_unit?645.16:"in"==$scope.settings._dimensions_unit?1:6.4516;d.ratioConvertFont=c.width/(r.product_width/t*2.54*72)*g,p.forEach(function(t){1!=t&&d.scaleRange.push({ratio:t,value:(100*t).toFixed()+"%",label:(100*t).toFixed()+"%"})}),d.scaleRange.push({ratio:1,value:"100%",label:"Fit"}),d.scaleRange.push({ratio:f,value:(100*f).toFixed()+"%",label:(100*f).toFixed()+"%"}),l>=u&&l<=h&&d.scaleRange.push({ratio:l,value:(100*l).toFixed()+"%",label:"Fill"}),d.scaleRange=_.sortBy(d.scaleRange,[function(t){return t.ratio}]),d.currentScaleIndex=_.findIndex(d.scaleRange,function(t){return 1==t.ratio}),d.fitScaleIndex=_.findIndex(d.scaleRange,function(t){return"Fit"==t.label}),d.fillScaleIndex=_.findIndex(d.scaleRange,function(t){return"Fill"==t.label}),d.fullScreenScaleIndex=_.findIndex(d.scaleRange,function(t){return t.ratio==f})}),"typography"!=$scope.settings.task&&"create_template"!=$scope.settings.task||($scope.stages=[{config:{},states:{scaleRange:[{ratio:1,value:"100%",label:"Fit"},{ratio:2,value:"200%",label:"200%"},{ratio:3,value:"300%",label:"300%"}],currentScaleIndex:0,fitScaleIndex:0,fillScaleIndex:0},undos:[],redos:[],layers:[],canvas:{}}],$scope.stages[0].states.ratioConvertFont=1,"create_template"==$scope.settings.task&&($scope.stages[0].states.scaleRange=[{ratio:1,value:"100%",label:"Fit"},{ratio:2,value:"200%",label:"200%"},{ratio:3,value:"300%",label:"300%"},{ratio:4,value:"400%",label:"400%"},{ratio:5,value:"500%",label:"500%"}]),angular.copy($scope.defaultConfig,$scope.stages[0].config),angular.merge($scope.stages[0].states,$scope.defaultStageStates)),$scope.settings.showRuler&&appConfig.isModern&&$scope.initRuler()},$scope.toggleRuler=function(){$scope.settings.showRuler=!$scope.settings.showRuler,$scope.settings.showRuler&&appConfig.isModern?$scope.initRuler():$scope.clearGuides()},$scope.initRuler=function(){var t=$scope.calcViewport();$timeout(function(){_.each($scope.settings.product_data.product,function(e,i){var n=$scope.stages[i];n.hozRuler=jQuery("#hoz-ruler-"+i).mskhRuler({layout:"horizontal",viewPort:t,config:n.config,zoomRatio:n.states.scaleRange[n.states.currentScaleIndex].ratio,unit:$scope.settings._dimensions_unit}),n.verRuler=jQuery("#ver-ruler-"+i).mskhRuler({layout:"vertical",viewPort:t,config:n.config,zoomRatio:n.states.scaleRange[n.states.currentScaleIndex].ratio,unit:$scope.settings._dimensions_unit}),n.hozRuler.render(),n.verRuler.render()})})},$scope.calcRulerPaddingLeft=function(t){var e=($scope.calcViewport().width-t)/2;return(e=e>0?e+50:50)+"px"},$scope.calcRulerPaddingTop=function(){return"40px"},$scope.addRulerGuideLine=function(t,e){var i=$scope.stages[$scope.currentStage],n=jQuery(t.currentTarget).parent(".stage").offset(),r=t.pageY-n.top,o=t.pageX-n.left;i.rulerLines[e].push({top:r,left:o})},$scope.calcStyleGuideline=function(t,e,i,n){var r={},o=$scope.calcViewport();if("hor"==n)r.top=(t.top>40?40+(t.top-40)*i-3:t.top-3)+"px",r.width=(e.cwidth*i>o.width?e.cwidth*i:o.width)+100+"px";else{var s=(e.cwidth*i-o.width)/2;s<0?t.left<=50?r.left=t.left:r.left=o.width/2-(o.width/2-(t.left-50))*i+50:r.left=o.width/2-(o.width/2-(t.left-50))*i+50+s,r.left=r.left-3+"px",r.height=(e.cheight*i>o.height?e.cheight*i:o.height)+90+"px"}return r},$scope.clearGuides=function(){$scope.stages[$scope.currentStage].rulerLines={vers:[],hors:[]}},$scope.initStageSetting=function(t){$scope.setStageDimension(t),$scope.renderStage(t),$scope.updateApp()},$scope.initStagesSettingWithoutTemplate=function(){(_.each($scope.stages,function(t,e){var i=t.canvas;if("color"==t.config.bgType&&(i.backgroundColor=t.config.bgColor),"2"==t.config.area_design_type){$scope.contextAddLayers="template";var n=i.width,r=i.height,o=new fabric.Path("M0 0 H"+n+" V"+r+" H0z M "+n/2+" 0 A "+n/2+" "+r/2+", 0, 1, 0, "+n/2+" "+r+" A "+n/2+" "+r/2+", 0, 1, 0, "+n/2+" 0z");o.set({strokeWidth:0,isAlwaysOnTop:!0,fill:"#ffffff",selectable:!1,evented:!1}),i.add(o)}i.requestRenderAll()}),$scope.onLoadPrintingOptions=!1,1==$scope.settings.ui_mode||2==$scope.settings.ui_mode)&&(localStorage.getItem("showTourGuide")||$scope.startTourGuide())},$scope.addStage=function(){var t={};angular.copy($scope.stages[$scope.currentStage],t),$scope.stages.splice($scope.currentStage+1,0,t),$scope.preventLoadDesign=!0,$scope.updateApp(),$timeout(function(){$scope.switchStage($scope.currentStage,"next")})},$scope.resetStage=function(){var t={};angular.copy($scope.stages[0],t),$scope.stages=[],$scope.stages.push(t),$scope.currentStage=0,$scope.preventLoadDesign=!0},$scope.setStageDimension=function(t){t=angular.isDefined(t)?t:$scope.currentStage;var e=$scope.stages[t],i=e.config.width*e.states.scaleRange[e.states.currentScaleIndex].ratio,n=e.config.height*e.states.scaleRange[e.states.currentScaleIndex].ratio;$scope.stages[t].canvas.setDimensions({width:i,height:n})},$scope.switchStage=function(t,e){var i="stage-container-"+t,n=parseInt(t)+1;"prev"==e&&(n=parseInt(t)-1),jQuery(".mskh-stages .ps__scrollbar-x-rail, .mskh-stages .ps__scrollbar-y-rail").addClass("mskh-hiden"),$timeout(function(){jQuery(".mskh-stages .ps__scrollbar-x-rail, .mskh-stages .ps__scrollbar-y-rail").removeClass("mskh-hiden")},700);var r="stage-container-"+n,o=angular.element(document.getElementById(i)),s=angular.element(document.getElementById(r));o.addClass("animated"),o.removeClass("fadeInUp"),o.removeClass("fadeInDown"),s.addClass("animated"),s.removeClass("hidden"),s.removeClass("fadeOutDown"),s.removeClass("fadeOutUp"),"prev"==e?(o.removeClass("fadeOutDown"),o.addClass("fadeOutUp"),s.addClass("fadeInDown")):(o.removeClass("fadeOutUp"),o.addClass("fadeOutDown"),s.addClass("fadeInUp")),$scope.currentStage=n,appConfig.isVisual&&$scope.deactiveAllLayer(),$scope.renderStage(),$scope.updateLayersList()},$scope.onDrop=function(t){t.preventDefault();var e=t.originalEvent.dataTransfer.getData("src"),i=t.originalEvent.dataTransfer.getData("extenal");switch(t.originalEvent.dataTransfer.getData("type")){case"image":"true"==i?$scope.addImageFromUrl(e,!0):$scope.addImageFromUrl(e,!1);break;case"svg":$scope.addImageFromUrl(e,!1);break;case"typo":$scope.insertTypography({folder:e})}},$scope.onMouseDown=function(t,e){$scope.stages[$scope.currentStage].states.isShowToolBox=!0,$scope.updateApp()},$scope.onDblclick=function(t){var e=t.target;e&&"activeSelection"===e.type&&$scope.deactiveAllLayer()},$scope.onMouseOverStage=function(t,e){var i=e.target;$scope.updateBoundingRect(i),$scope.updateApp()},$scope.onMouseOutStage=function(t,e){e.target&&angular.merge($scope.stages[$scope.currentStage].states.boundingObject,{visibility:"hidden"}),$scope.updateApp()},$scope.onMouseMoveStage=function(t,e){if($scope.settings.showRuler&&appConfig.isModern){var i=$scope.stages[$scope.currentStage],n=i.canvas.getPointer(e.e),r=(n.x+i.config.top)*i.states.scaleRange[i.states.currentScaleIndex].ratio,o=(n.y+i.config.top)*i.states.scaleRange[i.states.currentScaleIndex].ratio;i.hozRuler.updateCursorIndicator({x:r,y:o}),i.verRuler.updateCursorIndicator({x:r,y:o})}},$scope.onMouseUpStage=function(t,e){var i=$scope.stages[$scope.currentStage];angular.merge(i.states.boundingObject,{visibility:"hidden"}),angular.merge(i.states.coordinates,{style:{visibility:"hidden"}});angular.merge(i.states.snaplines,{ht:{top:-9999},hb:{top:-9999},hc:{top:-9999},vl:{left:-9999},vr:{left:-9999},vc:{left:-9999},hcc:{top:-9999},vcc:{left:-9999},vel:{left:-9999},ver:{left:-9999},het:{top:-9999},heb:{top:-9999}}),angular.merge(i.states.rotate,{style:{visibility:"hidden"}});var n=i.canvas.getActiveObjects();i.tempParameters=null,1==n.length&&(i.tempParameters=JSON.stringify(n[0].toJSON())),e.target&&(e.target.isOnScreen()||$scope.deleteLayers()),$scope.updateApp()},$scope.beforeObjectModify=function(t){$scope.setHistory({element:t,parameters:JSON.stringify(t.toJSON()),interaction:"modify"})},$scope.onPathCreated=function(t,e){},$scope.onObjectAdded=function(t,e){var i=$scope.stages[$scope.currentStage],n=i.canvas,r=e.target,o=(new Date).getTime()+Math.floor(1e3*Math.random());"normal"!=$scope.contextAddLayers&&"copy"!=$scope.contextAddLayers&&"template"!=$scope.contextAddLayers||angular.isUndefined(r.get("itemId"))&&r.set({itemId:o}),"normal"!=$scope.contextAddLayers||$scope.resource.drawMode.status||(i.states.isShowToolBox=!0,n.viewportCenterObject(r),$scope.toggleTip());var s=r.get("type");$scope.resource.upload.ilr&&(r.set({ilr:!0}),$scope.resource.upload.ilr=!1),"i-text"!=s&&"textbox"!=s&&"text"!=s&&"curvedText"!=s||r.initDimensions(),r.setCoords(),["normal","copy","undo","redo"].indexOf($scope.contextAddLayers)>-1&&"2"==i.config.area_design_type&&$scope.setStackLayerAlwaysOnTop();var a=r.get("top"),c=r.get("left");"normal"!=$scope.contextAddLayers||$scope.resource.drawMode.status?"copy"==$scope.contextAddLayers?(r.set({top:a-20,left:c-20}),r.animate({top:a,left:c},{duration:400,onChange:function(){$scope.renderStage()},onComplete:function(){$scope.setHistory({element:r,parameters:JSON.stringify(r.toJSON()),interaction:"add"}),$scope.stages[$scope.currentStage].tempParameters=JSON.stringify(r.toJSON()),$scope.renderStage()},easing:FabricWindow.util.ease.easeInQuad})):$scope.renderStage():(r.set({top:a-50}),r.animate("top",a,{duration:400,onChange:function(){$scope.renderStage()},onComplete:function(){n.setActiveObject(r),$scope.setHistory({element:r,parameters:JSON.stringify(r.toJSON()),interaction:"add"}),$scope.stages[$scope.currentStage].tempParameters=JSON.stringify(r.toJSON()),"i-text"!=s&&"textbox"!=s||(r.selectAll(),r.enterEditing()),$scope.renderStage()},easing:FabricWindow.util.ease.easeInQuad}),$scope.stages[$scope.currentStage].states.isActiveLayer=!0),$scope.onloadTemplate||($scope.onUnloadGroup.status?(angular.isDefined($scope.onUnloadGroup.prevIndex)&&r.moveTo(parseInt($scope.onUnloadGroup.prevIndex)+$scope.onUnloadGroup.length-$scope.onUnloadGroup.remain),$scope.onUnloadGroup.remain>1?$scope.onUnloadGroup.remain-=1:($scope.onUnloadGroup={status:!1,remain:0},$scope.contextAddLayers="normal")):$scope.contextAddLayers="normal"),"normal"!=$scope.contextAddLayers||$scope.resource.drawMode.status||$scope.showDesignTab(),$scope.updateLayersList()},$scope.showDesignTab=function(){checkMobileDevice()&&jQuery("#design-tab").triggerHandler("click")},$scope.onObjectScaling=function(t,e){var i=e.target;$scope.updateAssociateLayer(i),$scope.stages[$scope.currentStage].states.isShowToolBox=!1},$scope.onObjectScaled=function(t,e){$scope.stages[$scope.currentStage].states.isShowToolBox=!0,$scope.setPositionToolbox()},$scope.onObjectMoving=function(t,e){var i=e.target;$scope.updateAssociateLayer(i),$scope.stages[$scope.currentStage].states.isShowToolBox=!1},$scope.onObjectMoved=function(t,e){$scope.stages[$scope.currentStage].states.isShowToolBox=!0,$scope.setPositionToolbox()},$scope.onObjectRotating=function(t,e){var i=e.target;$scope.updateAssociateLayer(i),$scope.updateAngleLabel(i)},$scope.updateAssociateLayer=function(t){t&&(t.setCoords(),$scope.updateCoordenatesLabel(t),$scope.updateBoundingRect(t),$scope.updateSnapLines(),$scope.updateUploadZone(t),$scope.updateApp())},$scope.updateUploadZone=function(t){var e=t.get("type"),i=t.get("elementUpload");"image"!=e&&"custom-image"!=e||!i?angular.merge($scope.stages[$scope.currentStage].states.uploadZone,{visibility:"hidden"}):angular.merge($scope.stages[$scope.currentStage].states.uploadZone,{visibility:"visible",top:t.oCoords.tl.y-1,left:t.oCoords.tl.x-1,width:Math.sqrt(Math.pow(t.oCoords.tl.x-t.oCoords.tr.x,2)+Math.pow(t.oCoords.tl.y-t.oCoords.tr.y,2))+2,height:Math.sqrt(Math.pow(t.oCoords.tl.x-t.oCoords.bl.x,2)+Math.pow(t.oCoords.tl.y-t.oCoords.bl.y,2))+2,transform:"rotate("+t.angle+"deg)"})},$scope.updateAngleLabel=function(t){t?angular.merge($scope.stages[$scope.currentStage].states.rotate,{style:{transform:"rotate("+t.angle+"deg)",top:t.oCoords.mtr.y,left:t.oCoords.mtr.x,visibility:"visible"},angle:fabric.util.toFixed(t.angle,0)}):angular.merge($scope.stages[$scope.currentStage].states.rotate,{style:{visibility:"hidden"}})},$scope.updateCoordenatesLabel=function(t){if(t){t.getBoundingRect();var e=t.oCoords.tl.y,i=t.oCoords.tl.x;t.angle>315&&t.angle<360||t.angle>45&&t.angle<90||t.angle>135&&t.angle<180||t.angle>225&&t.angle<270?(t.oCoords.tr.x<i&&(e=t.oCoords.tr.y,i=t.oCoords.tr.x),t.oCoords.br.x<i&&(e=t.oCoords.br.y,i=t.oCoords.br.x),t.oCoords.bl.x<i&&(e=t.oCoords.bl.y,i=t.oCoords.bl.x)):(t.oCoords.tr.y<e&&(e=t.oCoords.tr.y,i=t.oCoords.tr.x),t.oCoords.br.y<e&&(e=t.oCoords.br.y,i=t.oCoords.br.x),t.oCoords.bl.y<e&&(e=t.oCoords.bl.y,i=t.oCoords.bl.x)),angular.merge($scope.stages[$scope.currentStage].states.coordinates,{style:{visibility:"visible",top:e,left:i},top:parseInt(e),left:parseInt(i)})}},$scope.updateBoundingRect=function(t){var e=$scope.stages[$scope.currentStage];if(t){t.getBoundingRect();angular.merge(e.states.boundingObject,{visibility:"visible",top:t.oCoords.tl.y-1,left:t.oCoords.tl.x-1,width:Math.sqrt(Math.pow(t.oCoords.tl.x-t.oCoords.tr.x,2)+Math.pow(t.oCoords.tl.y-t.oCoords.tr.y,2))+2,height:Math.sqrt(Math.pow(t.oCoords.tl.x-t.oCoords.bl.x,2)+Math.pow(t.oCoords.tl.y-t.oCoords.bl.y,2))+2,transform:"rotate("+t.angle+"deg)"}),e.states.boundingRealSize={size:(t.width*t.scaleX/e.config.cwidth*e.config.pWidth).toFixed(2)+"x"+(t.height*t.scaleY/e.config.cheight*e.config.pHeight).toFixed(2)+$scope.settings._dimensions_unit,transform:t.angle>270||t.angle<90?"rotate(0deg)":"rotate(180deg)"},$scope.updateApp()}else angular.merge(e.states.boundingObject,{visibility:"hidden"}),angular.merge(e.states.coordinates,{visibility:"hidden"})},$scope.updateSnapLines=function(){var t=this.stages[$scope.currentStage].canvas,e=t.getActiveObject(),i={ht:{top:-9999},hb:{top:-9999},hc:{top:-9999},vl:{left:-9999},vr:{left:-9999},vc:{left:-9999},hcc:{top:-9999},vcc:{left:-9999},vel:{left:-9999},ver:{left:-9999},het:{top:-9999},heb:{top:-9999}};if(e){var n=e.getBoundingRect();t.forEachObject(function(t){if(t!==e){var r=t.getBoundingRect();Math.abs(n.left-r.left)<1&&(i.vl.left=r.left),Math.abs(n.left+n.width-r.left)<1&&(i.vr.left=r.left),Math.abs(n.left-r.left-r.width)<1&&(i.vl.left=r.left+r.width),Math.abs(n.top-r.top)<1&&(i.ht.top=r.top),Math.abs(n.top+n.height-r.top)<1&&(i.ht.top=r.top),Math.abs(n.top-r.top-r.height)<1&&(i.hb.top=r.top+r.height),Math.abs(n.left+n.width-r.left-r.width)<1&&(i.vr.left=r.left+r.width),Math.abs(n.top+n.height-r.top-r.height)<1&&(i.hb.top=r.top+r.height),Math.abs(n.left+n.width/2-r.left-r.width/2)<1&&(i.vc.left=r.left+r.width/2),Math.abs(n.top+n.height/2-r.top-r.height/2)<1&&(i.hc.top=r.top+r.height/2)}}),Math.abs(n.left+n.width/2-t.width/2)<1&&(i.vcc.left=t.width/2),Math.abs(n.top+n.height/2-t.height/2)<1&&(i.hcc.top=t.height/2),Math.abs(n.left)<1&&(i.vel.left=0),Math.abs(n.top)<1&&(i.het.top=0),Math.abs(n.left+n.width-t.width)<1&&(i.ver.left=t.width),Math.abs(n.top+n.height-t.height)<1&&(i.heb.top=t.height),angular.merge($scope.stages[$scope.currentStage].states.snaplines,i)}},$scope.updateWarning=function(t){if($scope.settings.showWarning.oos){var e=$scope.stages[$scope.currentStage],i=e.canvas,n=t.getBoundingRect();n.left<0||n.top<0||n.left+n.width>i.width||n.top+n.height>i.height?e.states.oos=!0:e.states.oos=!1,$scope.updateApp()}},$scope.onObjectModified=function(t,e){var i=e.target,n=i.angle;if(n=Math.abs(i.angle-0)<=1||Math.abs(i.angle-360)<=1?0:Math.abs(i.angle-180)<=1?180:n,i.set({angle:n,dirty:!0}),$scope.stages[$scope.currentStage].tempParameters&&($scope.setHistory({element:i,parameters:$scope.stages[$scope.currentStage].tempParameters,interaction:"modify"}),$scope.stages[$scope.currentStage].tempParameters=null),$scope.stages[$scope.currentStage].states.isText&&"curvedText"!=$scope.stages[$scope.currentStage].states.type&&"no"==MSKHCONFIG._enable_text_free_transform){var r=i.fontSize*i.scaleX,o=r/$scope.stages[$scope.currentStage].states.ratioConvertFont;o=o.toFixed(2),i.set({dirty:!0,scaleX:1,scaleY:1,fontSize:r,ptFontSize:o}),$scope.stages[$scope.currentStage].states.text.fontSize=r,$scope.stages[$scope.currentStage].states.text.ptFontSize=o}$scope.updateWarning(i)},$scope.onBeforeRender=function(t,e){},$scope.onAfterRender=function(t,e){},$scope.onSelectionCleared=function(t,e){$scope.stages[$scope.currentStage].states.isActiveLayer=!1,$scope.stages[$scope.currentStage].states.itemId=null,$scope.stages[$scope.currentStage].states.isEditing=!1,angular.merge($scope.stages[$scope.currentStage].states.uploadZone,{visibility:"hidden"}),$scope.stages[$scope.currentStage].states.elementUpload=!1,$scope.stages[$scope.currentStage].states.oos=!1,$scope.stages[$scope.currentStage].states.ilr=!1},$scope.onEditingEntered=function(t,e){$scope.stages[$scope.currentStage].states.isEditing=!0,$scope.updateApp()},$scope.onEditingExited=function(t,e){$scope.stages[$scope.currentStage].states.isEditing=!1,e.target&&$scope.updateLayersList(),$scope.updateApp()},$scope.onSelectionChanged=function(t,e){$scope.getCurrentLayerInfo(),$scope.updateUploadZone(e.target),$scope.updateWarning(e.target),$scope.stages[$scope.currentStage].states.isGroup&&($scope.stages[$scope.currentStage].states.ilr=!1),$scope.scrollToSelectedLayer()},$scope.onSelectionUpdated=function(t,e){$scope.getCurrentLayerInfo(),$scope.updateUploadZone(e.target),$scope.updateWarning(e.target),$scope.stages[$scope.currentStage].states.isGroup&&($scope.stages[$scope.currentStage].states.ilr=!1),$scope.scrollToSelectedLayer()},$scope.onSelectionCreated=function(t,e){$scope.getCurrentLayerInfo(),$scope.updateUploadZone(e.target),$scope.updateWarning(e.target),$scope.toggleTip(),$scope.scrollToSelectedLayer()},$scope.scrollToSelectedLayer=function(){},$scope.onTextChanged=function(t,e){e.target&&$scope.updateLayersList(),angular.merge($scope.stages[$scope.currentStage].states.boundingObject,{visibility:"hidden"}),$scope.updateApp()},$scope.onClickDone=function(){$scope.stages[$scope.currentStage].states.isShowToolBox=!1,$scope.updateApp(),$scope.renderStage(),jQuery("html,body").animate({scrollTop:jQuery("#mskh-vista-app").offset().top},"slow")},$scope.setPositionToolbox=function(){appConfig.isModern||$timeout(function(){var t=$scope.stages[$scope.currentStage].canvas,e=t.getActiveObject(),i=(t.getActiveObjects(),jQuery(".mskh-vista"),jQuery(".mskh-vista .stage.mskh-active")),n=jQuery(".mskh-vista .stage.mskh-active .stage-main"),r=(jQuery(".mskh-vista .mskh-layout"),jQuery('.mskh-vista .v-toolbox .mskh-nav-tab[data-tab="tab-main-box"]')),o=e.getBoundingRect(),s=$scope.stages[$scope.currentStage],a=s.states.scaleRange[s.states.currentScaleIndex].ratio,c=parseInt(i.css("padding-left").slice(0,-2)),l=parseInt(i.css("padding-top").slice(0,-2)),u=(parseInt(i.css("padding-bottom").slice(0,-2)),parseInt(i.css("padding-right").slice(0,-2)),0),h=0,f="translateX(-50%)",p=(t.width,t.height,s.config.top*a),d=(s.config.cheight-s.config.top-s.config.height)*a,g=(s.config.cwidth,s.config.left,s.config.width,s.config.left*a),m=o.top+o.height,v=(o.left,o.width,o.left+o.width/2),_=i.scrollTop(),b=i.scrollLeft();r.each(function(t,e){jQuery(this).triggerHandler("click")}),h=n.height()>i.height()-5?n.height()-d>i.outerHeight()+_-l?m+p>i.outerHeight()+_?i.outerHeight():m+p-_+l:m>t.height?n.height()-d-_+l:m+p-_+l:o.top+o.height>t.height?t.height+l+p:m+l+p,h+=7,s.states.toolboxTriangle="center",n.width()>i.width()-5?v+g-b+c<0?(u=0,f="translateX(0)"):v+g-b+c-i.outerWidth()>0?(u=i.outerWidth(),f="translateX(-100%)"):u=v+g-b+c:v<0?(u=(i.outerWidth()-n.width())/2+g,f="translateX(0)"):v>t.width?(u=(i.outerWidth()-n.width())/2+g+t.width,f="translateX(-100%)"):u=(i.outerWidth()-n.width())/2+g+v,(u-=7)+160>i.outerWidth()&&(u=i.outerWidth(),f="translateX(-100%)"),u<160&&(f="translateX(0)",u=0),s.states.toolboxStyle={top:h,left:u,transform:f}})},$scope.getCurrentLayerInfo=function(){var t=$scope.stages[$scope.currentStage].canvas,e=t.getActiveObject(),i=t.getActiveObjects();if($scope.stages[$scope.currentStage].states.isActiveLayer=!0,$scope.stages[$scope.currentStage].states.isGroup=!1,$scope.stages[$scope.currentStage].states.isNativeGroup=!1,$scope.stages[$scope.currentStage].states.isLayer=!1,$scope.stages[$scope.currentStage].states.isText=!1,$scope.stages[$scope.currentStage].states.isImage=!1,$scope.stages[$scope.currentStage].states.isPath=!1,$scope.stages[$scope.currentStage].states.isShape=!1,$scope.stages[$scope.currentStage].states.isEditing=!1,$scope.stages[$scope.currentStage].states.elementUpload=!1,$scope.stages[$scope.currentStage].states.isGroupText=!1,appConfig.isVisual&&$scope.setPositionToolbox(),i.length>1){if($scope.stages[$scope.currentStage].states.isGroup=!0,appConfig.isVisual){var n=["i-text","text","textbox","curvedText"];_.each(i,function(t,e){if(!_.includes(n,t.get("type")))return $scope.stages[$scope.currentStage].states.isGroupText=!1,!1})}}else if($scope.stages[$scope.currentStage].states.isLayer=!0,e){if(!e.get("itemId")){var r=(new Date).getTime()+Math.floor(1e3*Math.random());e.set({itemId:r})}switch($scope.stages[$scope.currentStage].states.ilr=!!angular.isDefined(e.get("ilr"))&&e.get("ilr"),$scope.stages[$scope.currentStage].states.forceLock=!!angular.isDefined(e.get("forceLock"))&&e.get("forceLock"),$scope.stages[$scope.currentStage].states.opacity=fabric.util.toFixed(100*e.get("opacity")),["type","itemId","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockRotation","lockUniScaling","selectable","visible","angle","excludeFromExport"].forEach(function(t){$scope.stages[$scope.currentStage].states[t]=e.get(t)}),e.type){case"i-text":case"text":case"textbox":case"curvedText":angular.copy($scope.defaultStageStates.text,$scope.stages[$scope.currentStage].states.text),$scope.addColor(tinycolor(e.get("fill")).toHexString()),$scope.stages[$scope.currentStage].states.isText=!0,$scope.stages[$scope.currentStage].states.isEditing=!!e.isEditing&&e.isEditing,$scope.stages[$scope.currentStage].states.fixedWidth=!!angular.isDefined(e.fixedWidth)&&e.fixedWidth,$scope.stages[$scope.currentStage].states.text={font:$scope.getFontInfo(e.get("fontFamily")),is_uppercase:$scope.isUpperCase(e)},["fontFamily","ptFontSize","fontSize","editable","textAlign","fontWeight","textDecoration","fontStyle","spacing","lineHeight","fill","charSpacing","textBackgroundColor","stroke","strokeWidth","text"].forEach(function(t){$scope.stages[$scope.currentStage].states.text[t]=e.get(t)}),angular.isUndefined($scope.stages[$scope.currentStage].states.text.ptFontSize)&&($scope.stages[$scope.currentStage].states.text.ptFontSize=$scope.stages[$scope.currentStage].states.text.fontSize/$scope.stages[$scope.currentStage].states.ratioConvertFont),""==$scope.stages[$scope.currentStage].states.text.textBackgroundColor&&($scope.stages[$scope.currentStage].states.text.textBackgroundColor="#ffffff"),$scope.stages[$scope.currentStage].states.text.stroke||($scope.stages[$scope.currentStage].states.text.stroke="#ffffff"),"curvedText"==e.type&&(["reverse","spacing","radius"].forEach(function(t){$scope.stages[$scope.currentStage].states.text[t]=e.get(t)}),$scope.stages[$scope.currentStage].states.text.rtl=!!angular.isDefined(e.rtl)&&e.rtl,$scope.stages[$scope.currentStage].states.text.rtl&&($scope.stages[$scope.currentStage].states.text.text=$scope.stages[$scope.currentStage].states.text.text.split("").reverse().join("")));break;case"image":case"custom-image":$scope.stages[$scope.currentStage].states.elementUpload=!!angular.isDefined(e.get("elementUpload"))&&e.get("elementUpload"),$scope.stages[$scope.currentStage].states.ilr=!!angular.isDefined(e.get("ilr"))&&e.get("ilr"),$scope.stages[$scope.currentStage].states.isImage=!0,$scope.stages[$scope.currentStage].states.src=e.getSvgSrc(),$scope.stages[$scope.currentStage].states.origin_src=angular.isDefined(e.origin_src)?e.origin_src:e.getSvgSrc(),["crop_left","crop_top","crop_width","crop_height","crop_scaleX","crop_scaleY"].forEach(function(t){angular.isDefined(e[t])&&($scope.stages[$scope.currentStage].states[t]=e[t])});break;case"rect":case"triangle":case"line":case"polygon":case"circle":case"ellipse":$scope.stages[$scope.currentStage].states.isShape=!0,$scope.stages[$scope.currentStage].states.svg.groupPath=$scope.getPathOfSvg(e);break;case"path-group":case"path":case"group":$scope.stages[$scope.currentStage].states.isPath=!0,$scope.stages[$scope.currentStage].states.svg.groupPath=$scope.getPathOfSvg(e),"group"==e.type&&($scope.stages[$scope.currentStage].states.isNativeGroup=!0)}}$scope.updateApp()},$scope.toggleTip=function(t){var e=getCookie("_user");angular.isDefined(t)?1==t?jQuery(".mskh-tip").removeClass("mskh-show"):jQuery(".mskh-tip").addClass("mskh-show"):""==e&&(setCookie("_user","Hello World",.5),jQuery(".mskh-tip").addClass("mskh-show"))},$scope.startCountTime=function(){$scope.startTime=new Date},$scope.endCountTime=function(){var t=new Date;console.log(t-$scope.startTime+" ms")},$scope.getFontInfo=function(t){var e=_.filter($scope.resource.font.data,{alias:t})[0],i=angular.copy(e,i);return i?(i.file={r:1},i.file.i=angular.isDefined(e.file.i)?1:0,i.file.b=angular.isDefined(e.file.b)?1:0,i.file.bi=angular.isDefined(e.file.bi)?1:0):i={name:"Roboto",alias:"Roboto",file:{r:1,b:1,i:1,bi:1},cat:["99"],type:"google",subset:"latin"},i},$scope.getPathOfSvg=function(t){var e=[];return _.each(t._objects,function(t,i){if(""!=t.get("fill")){var n=tinycolor(t.get("fill")).toHexString();$scope.addColor(n),(findex=_.findIndex(e,["color",n]))>-1?e[findex].index.push(i):e.push({color:n,index:[i]})}}),0==e.length&&($scope.addColor(tinycolor(t.get("fill")).toHexString()),e.push({color:tinycolor(t.get("fill")).toHexString(),index:[-1]})),e},$scope.isUpperCase=function(t){return!!angular.isDefined(t.is_uppercase)&&t.is_uppercase},$scope.fitRectangle=function(t,e,i,n,r){var o={};return i<t&&n<e?r?t/e>i/n?(o.width=i*e/n,o.height=e,o.top=0,o.left=(t*n-i*e)/n/2):(o.width=t,o.height=t*n/i,o.top=(i*e-t*n)/i/2,o.left=0):(o.top=(t-i)/2,o.left=(e-n)/2,o.width=i,o.height=n):t/e>i/n?(o.width=i*e/n,o.height=e,o.top=0,o.left=(t*n-i*e)/n/2):(o.width=t,o.height=t*n/i,o.top=(i*e-t*n)/i/2,o.left=0),o},$scope.insertTemplateFont=function(t,e){if(_.filter($scope.resource.font.data,["alias",t]).length){var i=$scope.getFontInfo(t),n=t,r=n.replace(/\s/gi,"").toLowerCase();if(!jQuery("#"+r).length)if("google"==i.type)jQuery("head").append('<link id="'+r+'" href="https://fonts.googleapis.com/css?family='+n.replace(/\s/gi,"+")+':400,400i,700,700i" rel="stylesheet" type="text/css">');else{var o=i.url;o.indexOf("http")>-1||(o=MSKHCONFIG.font_url+o);var s="";s="<style type='text/css' id='"+r+"' >",s+="@font-face {font-family: '"+n+"';",s+="src: local(''),",s+="url('"+o+"') format('truetype')",s+="}",s+="</style>",jQuery("head").append(s)}new FontFaceObserver(n).load($scope.settings.subsets[i.subset].preview_text).then(function(){angular.isDefined(e)&&e(n)},function(){console.log("Fail to load: "+n),angular.isDefined(e)&&e(n)})}else MSKHDataFactory.get("mskh_get_resource",{type:"google_font",font_name:t},function(i){if(1==(i=JSON.parse(i)).flag){_.filter($scope.resource.font.data,["alias",t]).length||$scope.resource.font.data.push(i.data);var n=i.data.alias,r=n.replace(/\s/gi,"").toLowerCase();jQuery("#"+r).length||jQuery("head").append('<link id="'+r+'" href="https://fonts.googleapis.com/css?family='+n.replace(/\s/gi,"+")+':400,400i,700,700i" rel="stylesheet" type="text/css">'),new FontFaceObserver(n).load($scope.settings.subsets[i.data.subset].preview_text).then(function(){angular.isDefined(e)&&e(n)},function(){console.log("Fail to load: "+n),angular.isDefined(e)&&e("Roboto")})}else angular.isDefined(e)&&e("Roboto")})},$scope.onloadTemplate=!1,$scope.currentLocalTempId=0,$scope.insertTemplate=function(t,e){function i(t,e,i,n){function r(t){var o="frame_"+t,s=$scope.stages[t],a=s.canvas;a.clear(),angular.isUndefined(e[o])&&(e[o]={version:"2.3.3",objects:[]}),angular.isDefined(e[o].background)&&(a.backgroundColor=e[o].background);var c=e[o].objects;!function e(o){function l(){o++,0!=c.length&&o<c.length?e(o):++t<$scope.stages.length?r(t):_.each($scope.stages,function(t,e){$scope.renderStage(e);var r=t.canvas.getObjects();$scope.renderTextAfterLoadFont(r,function(){$scope.deactiveAllLayer(),$scope.renderStage(e),$timeout(function(){$scope.deactiveAllLayer(),$scope.renderStage(e),e==$scope.stages.length-1&&($scope.onloadTemplate=!1,$scope.contextAddLayers="normal",angular.isDefined(i)?$scope.resizeStages(i):angular.isDefined(n)&&angular.isDefined(n.scale)?(i={width:500*n.scale,height:500*n.scale},$scope.resizeStages(i)):$scope.toggleStageLoading(),$scope.onLoadPrintingOptions=!1,(1==$scope.settings.ui_mode||2==$scope.settings.ui_mode)&&(localStorage.getItem("showTourGuide")||$scope.startTourGuide()))},500)})})}if(c.length>0){var u=c[o],h=u.type,f=!0;if("image"==h||"custom-image"==h){if(appConfig.domainChanged){var p=u.src.split("mskhdesigner");u.src=MSKHCONFIG.mskh_content_url+p[1]}angular.isDefined(u.avatar)&&angular.isDefined($scope.settings.contact_sheets)&&(u.src=$scope.settings.contact_sheets.avatar),angular.isDefined(u.c_avatar)&&angular.isDefined($scope.settings.contact_sheet)&&(angular.isDefined($scope.settings.contact_sheet[u.c_avatar])?u.src=$scope.settings.contact_sheet[u.c_avatar].c_avatar:f=!1),f?fabric.Image.fromObject(u,function(t){a.add(t),l()}):l()}else{var d=fabric.util.getKlass(h);if(["i-text","text","textbox","curvedText"].indexOf(h)>-1&&(_.filter(s.states.usedFonts,["alias",u.fontFamily]).length||s.states.usedFonts.push($scope.getFontInfo(u.fontFamily))),["first_name","last_name","full_name","company","address","postcode","city","phone","email","mobile","website","title"].forEach(function(t){angular.isDefined(u[t])&&angular.isDefined($scope.settings.user_infos)&&(u.text=$scope.settings.user_infos[t].value)}),["date","c_full_name","c_title","c_mobile","c_phone","c_email"].forEach(function(t){angular.isDefined(u[t])&&angular.isDefined($scope.settings.contact_sheets)&&("date"==t?u.text=$scope.settings.contact_sheets[t]:angular.isDefined($scope.settings.contact_sheet[u[t]])?u.text=$scope.settings.contact_sheet[u[t]][t]:f=!1)}),angular.isDefined(u.vcard)){var g={left:u.left,top:u.top,vcard:1};if($scope.strVcard="",angular.isDefined($scope.settings.user_infos)){var m=$scope.settings.user_infos;$scope.strVcard+="BEGIN:VCARD\nVERSION:3.0\n",$scope.strVcard+="N:"+m.last_name.value+";"+m.first_name.value+"\nFN:"+m.full_name.value,$scope.strVcard+="\nADR;TYPE=home:;;"+m.address.value+";"+m.city.value+";;"+m.postcode.value+";"+m.country.value,$scope.strVcard+="\nTEL;TYPE=home:"+m.phone.value,$scope.strVcard+="\nTEL;TYPE=work:"+m.mobile.value,$scope.strVcard+="\nEMAIL;TYPE=internet,work:"+m.email.value,$scope.strVcard+="\nURL;TYPE=work:"+m.website.value,$scope.strVcard+="\nEND:VCARD";var v=qrcode("0","M");v.addData($scope.strVcard),v.make();var b=v.createSvgTag();fabric.loadSVGFromString(b,function(t,e){var i=fabric.util.groupSVGElements(t,e);i.set(g),i.scaleToWidth(u.width*u.scaleX),i.scaleToHeight(u.height*u.scaleY),i.vcard=1,a.add(i),l()})}else d.fromObject(u,function(t){a.add(t),l()})}else if(f)if("text"==h){var y=u.text,w={};angular.copy(u,w),delete w.text,delete w.type;var x=new fabric.IText(y,w);a.add(x),l()}else d.fromObject(u,function(t){a.add(t),l()});else l()}}else l()}(0)}t.length?_.each(t,function(e,i){_.filter($scope.resource.font.data,["alias",e.alias]).length||angular.isDefined(e.file)&&angular.isDefined(e.file.r)&&$scope.resource.font.data.push(e),i==t.length-1?$scope.insertTemplateFont(e.alias,function(){r(0),_.filter($scope.resource.usedFonts,["alias",e.alias]).length||$scope.resource.usedFonts.push($scope.getFontInfo(e.alias))}):$scope.insertTemplateFont(e.alias,function(){_.filter($scope.resource.usedFonts,["alias",e.alias]).length||$scope.resource.usedFonts.push($scope.getFontInfo(e.alias))})}):r(0)}$scope.currentLocalTempId=e.id,angular.isUndefined(e.doNotShowLoading)&&($scope.toggleStageLoading(6e4),$scope.showDesignTab()),$scope.onloadTemplate=!0,$scope.contextAddLayers="template",t?i(e.fonts,e.design,e.viewport):MSKHDataFactory.get("_get_product_info",{product_id:MSKHCONFIG.product_id,variation_id:MSKHCONFIG.variation_id,template_id:e.id},function(t){i((t=JSON.parse(t)).fonts,t.design,t.config.viewport,t.config)})},$scope.resizeStages=function(t){_.each($scope.stages,function(e,i){var n=$scope.calcViewport(),r=$scope.fitRectangle(t.width,t.height,e.config._width,e.config._height,!0),o=$scope.fitRectangle(n.width,n.height,e.config._width,e.config._height,!0).width/r.width;1!=o&&(e.canvas.forEachObject(function(t){var e=t.scaleX,i=t.scaleY,n=t.left,r=t.top,s=e*o,a=i*o,c=n*o,l=r*o;t.scaleX=s,t.scaleY=a,t.left=c,t.top=l,t.setCoords()}),e.canvas.calcOffset(),$scope.renderStage(i)),i==$scope.stages.length-1&&$scope.toggleStageLoading()})},$scope.insertTypography=function(t){var e=$scope.stages[$scope.currentStage],i=e.canvas;$scope.toggleStageLoading(),$scope.showDesignTab(),MSKHDataFactory.get("mskh_get_resource",{type:"get_typo",folder:t.folder},function(t){var n=(t=JSON.parse(t)).data.font,r=t.data.design.frame_0.objects;function o(){_.each(r,function(t,n){n==r.length-1?$scope.loadTemplateLayer(t,function(){$scope.renderTextAfterLoadFont($scope.resource.tempData.template,function(){var t=new fabric.ActiveSelection($scope.resource.tempData.template,{canvas:i});i.setActiveObject(t),t.addWithUpdate(),i.viewportCenterObjectH(t),i.viewportCenterObjectV(t),$scope.renderStage(),$timeout(function(){$scope.deactiveAllLayer(),i.setActiveObject(t),t.addWithUpdate(),i.viewportCenterObjectH(t),i.viewportCenterObjectV(t),"2"==e.config.area_design_type&&$scope.setStackLayerAlwaysOnTop(),$scope.renderStage(),$scope.toggleStageLoading()},500)})}):$scope.loadTemplateLayer(t)})}$scope.resource.tempData.template=[],n.length?_.each(n,function(t,i){_.filter($scope.resource.font.data,["alias",t.alias]).length||$scope.resource.font.data.push(t),i==n.length-1?$scope.insertTemplateFont(t.alias,function(){o(),_.filter(e.states.usedFonts,["alias",t.alias]).length||e.states.usedFonts.push($scope.getFontInfo(t.alias))}):$scope.insertTemplateFont(t.alias,function(){_.filter(e.states.usedFonts,["alias",t.alias]).length||e.states.usedFonts.push($scope.getFontInfo(t.alias))})}):o()})},$scope.renderTextAfterLoadFont=function(t,e){0!=t.length?_.each(t,function(i,n){if(["text","i-text","curvedText","textbox"].indexOf(i.type)>-1){var r=i.get("fontFamily"),o=i.get("fontWeight"),s=i.get("fontStyle"),a=$scope.getFontInfo(r),c={};""!=o&&(c.weight=o),""!=s&&(c.style=s),i.set({objectCaching:!1}),fabric.util.clearFabricFontCache(),new FontFaceObserver(r,{weight:o,style:s}).load($scope.settings.subsets[a.subset].preview_text).then(function(){fabric.util.clearFabricFontCache(),i.initDimensions(),i.setCoords()},function(){})}n==t.length-1&&"function"==typeof e&&e()}):e()},$scope.loadTemplateLayer=function(t,e,i){i=angular.isDefined(i)?i:$scope.currentStage;var n=$scope.stages[i].canvas;fabric.util.getKlass(t.type).fromObject(t,function(t){$scope.contextAddLayers="template",n.add(t);var i=n.item(n.getObjects().length-1);$scope.resource.tempData.template.push(i),"function"==typeof e&&e()})},$scope.insertCanvaTypo=function(t){if("typography"==$scope.settings.task){$scope.stages[0].states.usedFonts=[],$scope.zoomStage(0);var e=$scope.generateTypoLink(t);$scope.resource.currentTypo=t.id;var i=(i=e.replace("png","svg")).replace("/img/","/svg/"),n=$scope.stages[0],r=n.canvas;r.clear(),$scope.toggleStageLoading(),fabric.Image.fromURL(e,function(t){n.config.width=t.width,n.config.height=t.height,r.setDimensions({width:t.width,height:t.height}),fabric.loadSVGFromURL(i,function(t,e){r.add(fabric.util.groupSVGElements(t,e).set({scaleX:n.config.width/e.width,scaleY:n.config.height/e.height})),$scope.renderStage(0),$timeout(function(){var t=r.getActiveObject(),e=[],i=0;_.each(t._objects,function(t,i){if(angular.isDefined(t.text)){var n=tinycolor(t.get("fill")).toHexString();n="#ffffff"==n.toLowerCase()?"#404762":n,e.push({index:i,type:"text",text:t.text,font:(r=t.fontFamily,r=(r=(r=r.replace(/'/g,"")).split("-")[0]).replace(/([A-Z])/g," $1").trim()),fill:n})}var r;""==t.get("fill")&&e.push({index:i,type:"empty_rect"})}),t.set({dirty:!0}),_.each(e,function(o,s){var a=o.index-i;if(t._objects.splice(a,1),i++,"text"==o.type){var c=new FabricWindow.IText(o.text,{radius:50,fontSize:20,noScaleCache:!1,fill:o.fill,lockUniScaling:!0,lockRotation:!0,spacing:0});c.setControlVisible("mtr",!1),s<_.findLastIndex(e,function(t){return"text"==t.type})?$scope.insertTemplateFont(o.font,function(t){c.set({fontFamily:t}),r.add(c),_.filter(n.states.usedFonts,["alias",t]).length||n.states.usedFonts.push($scope.getFontInfo(t))}):$scope.insertTemplateFont(o.font,function(t){c.set({fontFamily:t}),r.add(c),_.filter(n.states.usedFonts,["alias",t]).length||n.states.usedFonts.push($scope.getFontInfo(t)),$scope.renderStage(0),$scope.toggleStageLoading(),$scope.updateLayersList()})}})},1e3)})})}else $scope.insertTypography(t)},$scope.itemToJson=function(t,e){return e?JSON.stringify(e):JSON.stringify(t)},$scope.setItemParameters=function(t,e){var i=JSON.parse(t),n=this.stages[this.currentStage].canvas.item(this.getLayerById(e));void 0!==i.src&&fabric.Image.fromURL(i.src,function(t){n.getElement().setAttribute("src",i.src)}),n.set(i),n.setCoords(),angular.isDefined(i.filters)&&_.each(i.filters,function(t,e){})},$scope.undo=function(){var t=this.stages[this.currentStage],e=t.canvas;if(t.undos.length>0){var i=t.undos.pop(),n=i.parameters;if("remove"===i.interaction)$scope.contextAddLayers="undo",e.add(i.element),i.interaction="add";else if("add"===i.interaction){var r=e.item($scope.getLayerById(i.element.itemId));e.remove(r),i.interaction="remove"}else{r=e.item($scope.getLayerById(i.element.itemId));var o=JSON.parse(n);_.each(o,function(t,e){o[e]=r.get(e)}),n=JSON.stringify(o),this.setItemParameters(i.parameters,i.element.itemId)}this.setHistory(!1,{element:i.element,parameters:n,interaction:i.interaction}),$scope.deactiveAllLayer(),this.renderStage()}$scope.updateApp()},$scope.redo=function(){var t=this.stages[this.currentStage],e=t.canvas;if(t.redos.length>0){var i=t.redos.pop(),n=i.parameters;if("remove"===i.interaction)$scope.contextAddLayers="redo",e.add(i.element),i.interaction="add";else if("add"===i.interaction){var r=e.item($scope.getLayerById(i.element.itemId));e.remove(r),i.interaction="remove"}else{r=e.item($scope.getLayerById(i.element.itemId));var o=JSON.parse(n);_.each(o,function(t,e){o[e]=r.get(e)}),n=JSON.stringify(o),this.setItemParameters(i.parameters,i.element.itemId)}this.setHistory({element:i.element,parameters:n,interaction:i.interaction}),$scope.deactiveAllLayer(),this.renderStage()}$scope.updateApp()},$scope.setHistory=function(t,e){var i=this.stages[this.currentStage];t?(angular.isUndefined(i.undos)&&(i.undos=[]),i.undos.push(t),i.undos.length>50&&i.undos.shift(),i.states.isUndoable=!0):(angular.isUndefined(i.redos)&&(i.redos=[]),i.states.isRedoable=!0,i.redos.push(e)),$scope.updateApp(),$scope.updateStatusHistory()},$scope.updateStatusHistory=function(){var t=this.stages[this.currentStage];t.states.isUndoable=t.undos.length>0,t.states.isRedoable=t.redos.length>0,$scope.updateApp()},$scope.clearHistory=function(){var t=this.stages[this.currentStage];t.undos=[],t.redos=[],t.states.isRedoable=!1,t.states.isUndoable=!1,$scope.updateApp()},$scope.enableFullScreenMode=function(){requestFullScreen(document.getElementById("mskh-stages"))},$scope.exitFullscreenMode=function(){exitFullscreen()},$scope.toggleStageFullScreenMode=function(){_.each($scope.stages,function(t,e){var i=$scope.fullScreenMode?t.states.fullScreenScaleIndex:t.states.fitScaleIndex;$scope.zoomStage(i,e),$scope.deactiveAllLayer(e),$scope.renderStage(e)})},$scope.debug=function(){var t=$scope.stages[$scope.currentStage].canvas,e=new fabric.CurvedText("Text",{top:100,left:100,fontSize:20});t.add(e)},$scope.lineConfig={dash1:5,dash2:5,width:100,color:"#ff0000"},$scope.addLine=function(){$scope.stages[$scope.currentStage].canvas.add(new fabric.Line([0,20,$scope.lineConfig.width,20],{strokeDashArray:[$scope.lineConfig.dash1,$scope.lineConfig.dash2],stroke:$scope.lineConfig.color}))},$scope.addShape=function(t){var e=$scope.stages[$scope.currentStage].canvas,i=null;switch(t){case"rect":i=new fabric.Rect({width:50,height:50});break;case"circle":i=new fabric.Circle({radius:50});break;case"triangle":i=new fabric.Triangle({width:50,height:50})}e.add(i)},$scope.tempLayer={},$scope.renderStage=function(t){t=t||$scope.currentStage,$scope.stages[t].canvas.calcOffset(),$scope.stages[t].canvas.requestRenderAll()},$scope.deactiveAllLayer=function(t){t=t||$scope.currentStage,$scope.stages[t].canvas.discardActiveObject(),angular.merge($scope.stages[$scope.currentStage].states.uploadZone,{visibility:"hidden"}),$scope.renderStage(),$scope.updateApp()},$scope.groupLayers=function(){var t=$scope.stages[$scope.currentStage].canvas.getActiveObject();"activeSelection"===t.type&&($scope.contextAddLayers="template",t.toGroup(),$scope.renderStage(),$scope.getCurrentLayerInfo())},$scope.onUnloadGroup={status:!1,remain:0,length:0},$scope.unGroupLayers=function(){var t=$scope.stages[$scope.currentStage].canvas.getActiveObject();"group"===t.type&&($scope.onUnloadGroup={status:!0,remain:t._objects.length,length:t._objects.length},angular.isDefined(t.itemId)&&($scope.onUnloadGroup.prevIndex=$scope.getLayerById(t.itemId)),$scope.contextAddLayers="template",t.toActiveSelection(),$scope.renderStage(),$scope.getCurrentLayerInfo())},$scope.applyFilters=function(t,e,i,n){},$scope.clearAllStage=function(){_.each($scope.stages,function(t,e){t.canvas.clear()}),$scope.initStagesSettingWithoutTemplate()},$scope.disableDrawMode=function(){$scope.resource.drawMode.status=!1,_.each($scope.stages,function(t,e){t.canvas.isDrawingMode=!1}),$scope.changeBush(),$scope.updateApp()},$scope.enableDrawMode=function(){$scope.resource.drawMode.status=!0,_.each($scope.stages,function(t,e){t.canvas.isDrawingMode=!0}),$scope.updateApp()},$scope.changeBush=function(){_.each($scope.stages,function(t,e){t.canvas.freeDrawingBrush=new fabric[$scope.resource.drawMode.brushType+"Brush"](t.canvas),t.canvas.freeDrawingBrush.color=$scope.resource.drawMode.brushColor,t.canvas.freeDrawingBrush.width=$scope.resource.drawMode.brushWidth})},$scope.importDesign=function(){var t=document.createElement("input");function e(){if(this.files.length>0){var i=this.files[0],n=new FileReader;n.onload=function(i){if(2===i.target.readyState){var r=JSON.parse(n.result);$scope.insertTemplate(!0,{fonts:r.fonts,design:r.design}),t.removeEventListener("change",e.bind(t),!1),document.body.removeChild(t)}},n.readAsText(i)}}t.type="file",t.accept="text/json|application/json",t.style.display="none",t.addEventListener("change",e.bind(t),!1),document.body.appendChild(t),t.click()},$scope.exportDesign=function(){$scope.saveDesign();var t={config:{}};t.config.viewport=$scope.calcViewport(),t.fonts=$scope.resource.usedFonts,t.design=$scope.resource.jsonDesign;var e=JSON.stringify(t),i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-u,"+e),i.setAttribute("download","design.json"),i.click()},$scope.loadMyDesign=function(t,e){$scope.login(function(){var i={},n=!0;$scope.toggleStageLoading(),null!=t?(i={did:t},n=!1):i={product_id:MSKHCONFIG.product_id,variation_id:MSKHCONFIG.variation_id};var r=e?"mskh_get_designs_in_cart":"mskh_get_user_designs";MSKHDataFactory.get(r,i,function(t){1==(t=JSON.parse(t)).flag&&(n?($scope.resource.myTemplates=t.designs,$scope.toggleStageLoading()):$scope.insertTemplate(!0,{fonts:t.fonts,design:t.design,doNotShowLoading:!0}))})})},$scope.deleteLayers=function(t){var e=this.stages[$scope.currentStage].canvas,i=angular.isDefined(t)?e.item(t):e.getActiveObjects();i&&(angular.isDefined(t)?($scope.setHistory({element:i,parameters:JSON.stringify(i.toJSON()),interaction:"remove"}),e.remove(i)):e.getActiveObjects().forEach(function(t){$scope.setHistory({element:t,parameters:JSON.stringify(t.toJSON()),interaction:"remove"}),e.remove(t)}),e.discardActiveObject().requestRenderAll()),$scope.updateLayersList()},$scope.resetLayer=function(){var t=$scope.stages[$scope.currentStage].canvas,e="frame_"+$scope.currentStage,i=null,n=t.getActiveObject();if(angular.isDefined($scope.settings.product_data.design)){i=$scope.settings.product_data.design[e].objects;var r=_.find(i,{itemId:n.get("itemId")});angular.isDefined(r)&&(n.set(r),n.setCoords(),$scope.deactiveAllLayer(),$scope.renderStage())}},$scope.activeLayer=function(t,e){var i=$scope.stages[$scope.currentStage],n=i.canvas;!$scope.isTemplateMode&&angular.isDefined(n.item(t).forceLock)&&n.item(t).forceLock||(n.setActiveObject(n.item(t)),angular.isDefined(e)&&(i.layers[e].active=!0),$scope.renderStage())},$scope.copyLayers=function(){var t=this.stages[$scope.currentStage].canvas;t.getActiveObject()&&(t.getActiveObject().clone(function(t){_clipboard=t}),$timeout(function(){_clipboard.clone(function(e){t.discardActiveObject(),e.set({left:e.left+10,top:e.top+10,evented:!0}),"activeSelection"===e.type?(e.canvas=t,e.forEachObject(function(e){$scope.contextAddLayers="copy",t.add(e)}),e.setCoords()):($scope.contextAddLayers="copy",t.add(e)),t.setActiveObject(e),t.requestRenderAll()})}))},$scope.alignLayer=function(t){var e=this.stages[this.currentStage].canvas,i=e.getActiveObject(),n=e.getActiveObjects(),r=n[0].getBoundingRect(),o={left:r.left,top:r.top,right:r.left+r.width,bottom:r.top+r.height},s=[],a=[],c=0,l=0;switch(n.forEach(function(t,e){var i=t.getBoundingRect();i.left<o.left&&(o.left=i.left),i.top<o.top&&(o.top=i.top),i.left+i.width>o.right&&(o.right=i.left+i.width),i.top+i.height>o.bottom&&(o.bottom=i.top+i.height),s.push({index:e,value:i.left}),a.push({index:e,value:i.top}),c+=i.width,l+=i.height}),t){case"horizontal":n.forEach(function(t){var e=t.getBoundingRect();t.set({top:t.get("top")+(o.top+o.bottom)/2-e.top-e.height/2}),t.setCoords()});break;case"vertical":n.forEach(function(t){var e=t.getBoundingRect();t.set({left:t.get("left")+(o.left+o.right)/2-e.left-e.width/2}),t.setCoords()});break;case"top":n.forEach(function(t){var e=t.getBoundingRect();t.set({top:t.get("top")+o.top-e.top}),t.setCoords()});break;case"bottom":n.forEach(function(t){var e=t.getBoundingRect();t.set({top:t.get("top")+o.bottom-e.top-e.height}),t.setCoords()});break;case"left":n.forEach(function(t){var e=t.getBoundingRect();t.set({left:t.get("left")-e.left+o.left}),t.setCoords()});break;case"right":n.forEach(function(t){var e=t.getBoundingRect();t.set({left:t.get("left")-e.left+o.right-e.width}),t.setCoords()});break;case"dis-horizontal":leftPosition=_.sortBy(s,[function(t){return t.value}]);var u=(o.right-o.left-c)/(n.length-1);leftPosition.forEach(function(t,e){var i=t.index;if(e>0&&e<n.length-1){var r=n[i],o=n[leftPosition[e-1].index],s=r.getBoundingRect(),a=o.getBoundingRect();r.set({left:r.get("left")-s.left+a.left+a.width+u}),r.setCoords()}});break;case"dis-vertical":topPosition=_.sortBy(a,[function(t){return t.value}]);u=(o.bottom-o.top-l)/(n.length-1);topPosition.forEach(function(t,e){var i=t.index;if(e>0&&e<n.length-1){var r=n[i],o=n[topPosition[e-1].index],s=r.getBoundingRect(),a=o.getBoundingRect();r.set({top:r.get("top")-s.top+a.top+a.height+u}),r.setCoords()}})}i.addWithUpdate(),this.renderStage()},$scope.translateLayer=function(t){var e=$scope.stages[$scope.currentStage],i=e.canvas,n=i.getActiveObject();if(n){var r=n.getBoundingRect(),o=e.states.scaleRange[e.states.currentScaleIndex].ratio,s=n.get("left"),a=n.get("top");switch($scope.beforeObjectModify(n),e.states.isShowToolBox=!1,t){case"horizontal":i.viewportCenterObjectH(n);break;case"vertical":i.viewportCenterObjectV(n);break;case"center":i.viewportCenterObjectH(n),i.viewportCenterObjectV(n);break;case"top":n.set({top:0});break;case"top-left":n.set({top:0,left:0});break;case"top-center":i.viewportCenterObjectH(n),n.set({top:0});break;case"top-right":n.set({top:0,left:s+(i.width-r.width-r.left)/o});break;case"bottom":n.set({top:a+(i.height-r.height-r.top)/o});break;case"bottom-left":n.set({left:0,top:a+(i.height-r.height-r.top)/o});break;case"bottom-center":i.viewportCenterObjectH(n),n.set({top:a+(i.height-r.height-r.top)/o});break;case"bottom-right":n.set({left:s+(i.width-r.width-r.left)/o,top:a+(i.height-r.height-r.top)/o});break;case"left":n.set({left:0});break;case"middle-left":i.viewportCenterObjectV(n),n.set({left:0});break;case"right":n.set({left:s+(i.width-r.width-r.left)/o});break;case"middle-right":i.viewportCenterObjectV(n),n.set({left:s+(i.width-r.width-r.left)/o})}n.setCoords(),$scope.renderStage()}},$scope.getLayerById=function(t){var e;return this.stages[this.currentStage].canvas.forEachObject(function(i,n){i.get("itemId")==t&&(e=n)}),e},$scope.closePopupClearStage=function(){jQuery(".clear-stage-alert .close-popup").triggerHandler("click")},$scope.zoomStage=function(t,e){e=angular.isDefined(e)?e:$scope.currentStage;var i=$scope.stages[e],n=i.canvas;i.states.isShowToolBox=!0,i.states.currentScaleIndex=t,$scope.setStageDimension(e),n.setZoom(i.states.scaleRange[i.states.currentScaleIndex].ratio),jQuery("#stage-container-"+$scope.currentStage).stop().animate({scrollTop:0,scrollLeft:0},100),jQuery("#stage-container-"+$scope.currentStage).perfectScrollbar("update"),appConfig.isVisual&&$scope.deactiveAllLayer(),this.renderStage(),$scope.settings.showRuler&&appConfig.isModern&&(i.hozRuler.update({config:i.config,zoomRatio:i.states.scaleRange[i.states.currentScaleIndex].ratio}),i.verRuler.update({config:i.config,zoomRatio:i.states.scaleRange[i.states.currentScaleIndex].ratio}))},$scope.clearStage=function(){var t=$scope.stages[$scope.currentStage],e=t.canvas;if(e.clear(),jQuery(".clear-stage-alert .close-popup").triggerHandler("click"),"color"==t.config.bgType&&(e.backgroundColor=t.config.bgColor),"2"==t.config.area_design_type){$scope.contextAddLayers="template";var i=e.width,n=e.height,r=new fabric.Path("M0 0 H"+i+" V"+n+" H0z M "+i/2+" 0 A "+i/2+" "+n/2+", 0, 1, 0, "+i/2+" "+n+" A "+i/2+" "+n/2+", 0, 1, 0, "+i/2+" 0z");r.set({strokeWidth:0,isAlwaysOnTop:!0,fill:"#ffffff",selectable:!1,evented:!1}),e.add(r)}$scope.updateLayersList(),e.requestRenderAll()},$scope.selectAllLayers=function(){var t=this.stages[this.currentStage].canvas;$scope.deactiveAllLayer();var e=[];t.forEachObject(function(t,i){t.get("selectable")&&e.push(t)});var i=new fabric.ActiveSelection(e,{canvas:t});i.addWithUpdate(),t.setActiveObject(i),$scope.renderStage()},$scope.stageToJson=function(t){return t=t||$scope.currentStage,$scope.renderStage(t),this.stages[t].canvas.toJSON($scope.includeExport)},$scope.loadStageFromJson=function(t,e){this.stages[t].canvas.loadFromJSON(e,function(){$scope.renderStage(t)})},$scope.copyStage=function(t){t=t||$scope.currentStage,$scope.tempStageDesign={id:t,design:$scope.stageToJson()}},$scope.pasteStage=function(t){t=t||$scope.currentStage,$scope.loadStageFromJson(t,$scope.tempStageDesign.design),$scope.tempStageDesign=null},$scope.clearClipboardDesign=function(){$scope.tempStageDesign=null},$scope.rotateLayer=function(t){var e=this.stages[this.currentStage].canvas.getActiveObject();switch($scope.beforeObjectModify(e),t){case"reflect-hoz":e.toggle("flipY");break;case"reflect-ver":e.toggle("flipX");break;case"90cw":(i=e.get("angle")+90)>360&&(i-=360),i<0&&(i+=360),e.set({angle:i});break;case"90ccw":(i=e.get("angle")-90)>360&&(i-=360),i<0&&(i+=360),e.set({angle:i});break;case"180":(i=e.get("angle")+180)>360&&(i-=360),i<0&&(i+=360),e.set({angle:i});break;default:var i=parseInt(t);e.set({angle:i})}e.setCoords(),this.renderStage()},$scope.scaleLayer=function(t){var e=this.stages[this.currentStage],i=e.canvas.getActiveObject();if(i&&($scope.beforeObjectModify(i),!e.lockMovementY&&!e.lockMovementX)){var n=i.scaleX,r=i.scaleY,o=i.left,s=i.top,a=i.width*n,c=i.height*r,l="+"===t?1.1:.9,u=n*l,h=r*l,f=o+a/2-a*l/2,p=s+c/2-c*l/2;i.scaleX=u,i.scaleY=h,i.left=f,i.top=p,i.setCoords(),$scope.renderStage()}},$scope.moveLayer=function(t,e){var i=this.stages[this.currentStage].canvas,n=i.getActiveObjects(),r=i.getActiveObject(),o=e?1:10;0!=n.length&&(angular.merge($scope.stages[$scope.currentStage].states.boundingObject,{visibility:"hidden"}),n.forEach(function(e){switch($scope.beforeObjectModify(e),t){case"up":e.get("lockMovementY")||e.set("top",e.get("top")-o);break;case"down":e.get("lockMovementY")||e.set("top",e.get("top")+o);break;case"left":e.get("lockMovementX")||e.set("left",e.get("left")-o);break;case"right":e.get("lockMovementX")||e.set("left",e.get("left")+o)}e.setCoords()}),"activeSelection"===r.type&&r.addWithUpdate(),this.updateApp(),this.renderStage())},$scope.sortLayer=function(t,e){this.stages[this.currentStage].canvas.item(t).moveTo(e),$scope.renderStage(),$scope.updateLayersList(),$scope.updateApp()},$scope.updateLayersList=function(){var t=$scope.stages[$scope.currentStage],e=t.canvas;t.layers=[],e.forEachObject(function(e,i){var n={index:i,visible:e.get("visible"),selectable:e.get("selectable"),forceLock:e.get("forceLock"),itemId:e.get("itemId")};if(!e.isAlwaysOnTop){switch(e.type){case"i-text":case"text":case"textbox":case"curvedText":n.type="text",n.icon_class="text-fields",n.text=e.get("text"),n.editable=e.get("editable");break;case"image":case"custom-image":n.type="image",n.src=e.getSvgSrc();break;case"rect":case"triangle":case"line":case"polygon":case"circle":case"ellipse":var r="rect"==e.type?"rectangle":e.type;n.icon_class="layer-"+r,n.type=e.type;break;case"path-group":case"path":n.icon_class="vector",n.type="path";break;case"group":n.icon_class="layer-group",n.type="group";break;default:n.type=e.type}t.layers.push(n)}}),$timeout(function(){jQuery("#tab-layer .tab-scroll").perfectScrollbar("update")})},$scope.setStackLayerAlwaysOnTop=function(t){$scope.stages[$scope.currentStage].canvas.forEachObject(function(t){t.isAlwaysOnTop&&t.bringToFront()}),t&&$scope.renderStage()},$scope.setStackPosition=function(t,e,i){var n=i||$scope.stages[$scope.currentStage].canvas.getActiveObject();switch($scope.beforeObjectModify(n),t){case"bring-front":n.bringToFront(),$scope.setStackLayerAlwaysOnTop();break;case"bring-forward":n.bringForward();break;case"send-backward":n.sendBackwards();break;case"send-back":n.sendToBack();break;default:var r=parseInt(t);n.moveTo(r)}$scope.renderStage(),e||$scope.updateLayersList()},$scope.changeBackground=function(t){$scope.stages[$scope.currentStage].config.bgColor=t},$scope.changeBackgroundCanvas=function(t){var e=$scope.stages[$scope.currentStage].canvas;$scope.showDesignTab(),e.backgroundColor=t,e.renderAll()},$scope.changeFill=function(t){var e=$scope.stages[$scope.currentStage],i=e.canvas;if(!angular.equals({},i)){var n=i.getActiveObject();$scope.beforeObjectModify(n),e.states.isPath?(n.set({dirty:!0}),_.each(e.states.svg.groupPath[e.states.svg.currentPath].index,function(e){e>-1?n._objects[e].set({fill:t}):n.set({fill:t})}),e.states.svg.groupPath[e.states.svg.currentPath].color=t):(n.set({fill:t}),e.states.text.fill=t),$scope.renderStage()}},$scope.addText=function(t,e,i){t=angular.isDefined(t)?t:$scope.settings._default_text,e=angular.isUndefined(e)?"bodytext":e;var n="IText",r=16,o=MSKHCONFIG.default_font.alias,s=$scope.stages[$scope.currentStage].states;switch(e){case"heading":n="Textbox",r=42;break;case"subheading":n="Textbox",r=36}var a={fontFamily:o,radius:50,objectCaching:!1,fontSize:r,ptFontSize:r/s.ratioConvertFont};function c(){$scope.stages[$scope.currentStage].canvas.add(new FabricWindow[n](t,a))}i&&angular.extend(a,i),new FontFaceObserver(o).load($scope.settings.subsets[MSKHCONFIG.default_font.subset].preview_text).then(function(){fabric.util.clearFabricFontCache(o),c()},function(){console.log("Fail to load font: "+o),c()})},$scope.addCurvedText=function(t){var e=$scope.stages[$scope.currentStage].states;function i(){var i=!1;"rtl"==MSKHCONFIG.lang_rtl&&(i=!0,t=t.split("").reverse().join("")),$scope.stages[$scope.currentStage].canvas.add(new fabric.CurvedText(t,{radius:100,rtl:i,top:100,left:100,fontFamily:n,fontSize:20,ptFontSize:20/e.ratioConvertFont}))}var n=MSKHCONFIG.default_font.alias;new FontFaceObserver(n).load($scope.settings.subsets[MSKHCONFIG.default_font.subset].preview_text).then(function(){fabric.util.clearFabricFontCache(n),i()},function(){console.log("Fail to load font: "+n),i()})},$scope.setLayerAttribute=function(t,e,i,n){var r=$scope.stages[$scope.currentStage].canvas;if(appConfig.ready){var o=angular.isDefined(i)?r.item(i):r.getActiveObject();if("selectable"!=t||$scope.isTemplateMode||!angular.isDefined(o.forceLock)||!o.forceLock){$scope.beforeObjectModify(o);var s=o.get("type");"i-text"!=s&&"textbox"!=s||"forceLock"!=t||(1==e?o.set({editable:!1}):o.set({editable:!0})),"forceLock"==t&&o.set({selectable:!1});var a={};switch(a[t]=e,o.set(a),t){case"visible":case"selectable":$scope.deactiveAllLayer();break;case"lockScalingX":("textbox"==s?[]:["tl","tr","bl","br"]).forEach(function(t){o.setControlVisible(t,!e)});break;case"lockScalingY":("textbox"==s?[]:["tl","tr","bl","br"]).forEach(function(t){o.setControlVisible(t,!e)});break;case"lockRotation":o.setControlVisible("mtr",!e)}$scope.renderStage(),angular.isDefined(i)?$scope.stages[$scope.currentStage].layers[n][t]=e:$scope.stages[$scope.currentStage].states[t]=e,"text"!=t&&$scope.updateLayersList(),$scope.updateApp()}}},$scope.setTextAttribute=function(t,e,i){var n=$scope.stages[$scope.currentStage],r=n.states,o=n.canvas;if(appConfig.ready){var s=o.getActiveObject(),a=o.getActiveObjects();if(s&&a){$scope.beforeObjectModify(s);var c={};if(c[t]=e,s.set(c),"fontSize"==t){var l=arrayMin($scope.listFontSizeInPt);$scope.forceMinSize&&l>e&&(e=l),s.set({ptFontSize:e,fontSize:e*r.ratioConvertFont}),r.text.ptFontSize=e}switch(t){case"is_uppercase":e?s.set({text:s.get("text").toUpperCase()}):s.set({text:s.get("text").toLowerCase()});break;case"fontFamily":_.filter(r.usedFonts,["alias",e]).length||r.usedFonts.push($scope.getFontInfo(e)),r.text.font=$scope.getFontInfo(e),r.text.font.file.b||(s.set({fontWeight:"normal"}),r.text.fontWeight="normal"),r.text.font.file.i||(s.set({fontStyle:"normal"}),r.text.fontStyle="normal"),r.text.font.file.bi||"bold"!=s.get("fontWeight")||"italic"!=s.get("fontStyle")||(s.set({fontWeight:"normal",fontStyle:"normal"}),r.text.fontWeight="normal",r.text.fontStyle="normal")}if(r.text[t]=e,"rtl"==t&&s.set({text:s.text.split("").reverse().join("")}),t.indexOf("font")>-1)new FontFaceObserver(r.text.fontFamily,{weight:r.text.fontWeight,style:r.text.fontStyle}).load($scope.settings.subsets[r.text.font.subset].preview_text).then(function(){fabric.util.clearFabricFontCache(r.text.fontFamily),s.initDimensions(),s.setCoords(),$scope.renderStage()},function(){s.setCoords(),$scope.renderStage()});else s.setCoords(),$scope.renderStage();$scope.updateLayersList()}}},$scope.addImage=function(t,e,i,n,r){var o=$scope.stages[$scope.currentStage],s=o.canvas,a=o.states.scaleRange[o.states.currentScaleIndex].ratio;e&&$scope.toggleStageLoading(),fabric.Image.fromURL(t,function(e){if($scope.stages[$scope.currentStage].states.elementUpload){var o=s.getActiveObject(),c=o.getElement();$scope.beforeObjectModify(o),c.setAttribute("src",t),s.getActiveObject().set({dirty:!0,width:e.width,height:e.height,scaleX:o.width*o.scaleX/e.width,scaleY:o.width*o.scaleX/e.width}),o.setCoords(),$scope.deactiveAllLayer(),$scope.renderStage()}else{var l=s.width/a*.9,u=s.height/a*.9,h=l;e.width<l&&(h=e.width);var f=h/e.width,p=e.height*f;if(p>u){var d=(p=u)/e.height;h=e.width*d}e.set({fill:"#ff0000",scaleX:h/e.width,scaleY:p/e.height}),n&&(e[n]=r),$scope.stages[$scope.currentStage].canvas.add(e)}i&&$scope.toggleStageLoading()})},$scope.applyFilter=function(t,e,i){var n=$scope.stages[$scope.currentStage].canvas;(t=t||n.getActiveObject()).filters[e]=i,t.applyFilters(),$scope.renderStage()},$scope.filterImage=function(){var t=fabric.Image.filters;$scope.applyFilter(null,0,new t.Grayscale)},$scope.cropObj={status:!1},$scope.initCrop=function(){$scope.cropObj.status=!0,jQuery(".mskh-popup.popup-mskh-crop").nbShowPopup(),$scope.cropObj.src=$scope.stages[$scope.currentStage].states.origin_src,jQuery(".mskh-popup.popup-mskh-crop .overlay-popup").addClass("nbo-disable"),jQuery(".mskh-popup.popup-mskh-crop").find(".overlay-main").removeClass("active");var t=new Image;t.src=$scope.cropObj.src,t.onload=function(){$scope.cropObj.width=this.width,$scope.cropObj.height=this.height,$timeout(function(){$scope.cropObj.canvas=$scope.cropObj.canvas?$scope.cropObj.canvas:new FabricWindow.Canvas("crop-handle-wrap");var t=jQuery("#crop-source").width(),e=jQuery("#crop-source").height();$scope.cropObj.canvas.setDimensions({width:t,height:e}),$scope.cropObj.canvas.clear(),$scope.cropObj.canvas.on("mouse:down",function(t){$scope.cropObj.canvas.item(0)}),$scope.cropObj.canvas.on("object:modified",function(t){var e=t.target,i=e.getBoundingRect(!0);i.left<0&&(e.left=0),i.top<0&&(e.top=0),e.setCoords();var n=(i=e.getBoundingRect(!0)).left>0?i.left:0,r=i.top>0?i.top:0;i.left+i.width>$scope.cropObj.canvas.getWidth()&&(e.scaleX=e.scaleX*(($scope.cropObj.canvas.getWidth()-n)/i.width)),i.top+i.height>$scope.cropObj.canvas.getHeight()&&(e.scaleY=e.scaleY*(($scope.cropObj.canvas.getHeight()-r)/i.height)),e.setCoords()});var i=new fabric.Rect({left:0,top:0,fill:"rgba(255,255,255,0.15)",width:200,height:200,strokeWidth:1,stroke:"#ffffff",strokeDashArray:[5,5]});angular.isDefined($scope.stages[$scope.currentStage].states.crop_left)&&i.set({left:$scope.stages[$scope.currentStage].states.crop_left,top:$scope.stages[$scope.currentStage].states.crop_top,width:$scope.stages[$scope.currentStage].states.crop_width,height:$scope.stages[$scope.currentStage].states.crop_height,scaleX:$scope.stages[$scope.currentStage].states.crop_scaleX,scaleY:$scope.stages[$scope.currentStage].states.crop_scaleY}),$scope.cropObj.canvas.add(i);var n=$scope.cropObj.canvas.item(0);n.setControlVisible("mtr",!1),$scope.cropObj.canvas.setActiveObject(n),angular.isUndefined($scope.stages[$scope.currentStage].states.crop_left)&&$scope.cropObj.canvas.viewportCenterObject(n)},100)}},$scope.cancelCrop=function(){jQuery(".mskh-popup.popup-mskh-crop").find(".overlay-main").removeClass("active"),jQuery(".mskh-popup.popup-mskh-crop .close-popup").triggerHandler("click")},$scope.cropImage=function(){var t=$scope.cropObj.canvas.item(0).getBoundingRect(!0),e=$scope.cropObj.width/$scope.cropObj.canvas.width;$scope.cropObj.bound={left:$scope.cropObj.canvas.item(0).get("left"),top:$scope.cropObj.canvas.item(0).get("top"),width:$scope.cropObj.canvas.item(0).get("width"),height:$scope.cropObj.canvas.item(0).get("height"),scaleX:$scope.cropObj.canvas.item(0).get("scaleX"),scaleY:$scope.cropObj.canvas.item(0).get("scaleY")};var i=new FormData;i.append("nonce",MSKHCONFIG.nonce),i.append("action","mskh_crop_image"),i.append("url",$scope.cropObj.src),i.append("startX",t.left*e),i.append("startY",t.top*e),i.append("width",t.width*e),i.append("height",t.height*e),jQuery(".mskh-popup.popup-mskh-crop").find(".overlay-main").addClass("active"),jQuery.ajax({url:MSKHCONFIG.ajax_url,method:"POST",processData:!1,contentType:!1,data:i}).done(function(t){var e;1==t.flag?(e=t.url,fabric.Image.fromURL(e,function(t){var i=$scope.stages[$scope.currentStage].canvas,n=i.getActiveObject(),r=n.getElement();$scope.beforeObjectModify(n),r.setAttribute("src",e),n.set({origin_src:$scope.cropObj.src,crop_left:$scope.cropObj.bound.left,crop_top:$scope.cropObj.bound.top,crop_width:$scope.cropObj.bound.width,crop_height:$scope.cropObj.bound.height,crop_scaleX:$scope.cropObj.bound.scaleX,crop_scaleY:$scope.cropObj.bound.scaleY}),$scope.cropObj.bound={},i.getActiveObject().set({dirty:!0,width:t.width,height:t.height,scaleX:n.width*n.scaleX/t.width,scaleY:n.width*n.scaleX/t.width}),n.setCoords(),$scope.renderStage(),$scope.getCurrentLayerInfo(),jQuery(".mskh-popup.popup-mskh-crop").find(".overlay-main").removeClass("active"),jQuery(".mskh-popup.popup-mskh-crop .close-popup").triggerHandler("click")})):jQuery(".mskh-popup.popup-mskh-crop").find(".overlay-main").removeClass("active")})},$scope.addSvgFromString=function(t,e){angular.isUndefined(e)&&$scope.toggleStageLoading(),fabric.loadSVGFromString(t,function(t,e){$scope._addSvg(t,e,{name:""},!0)})},$scope.addSvgFromMedia=function(t,e){angular.isDefined(e)&&"0"==$scope.settings.valid_license&&e>19?alert($scope.settings.mskhlangs.pro_license_alert):($scope.showDesignTab(),$scope.toggleStageLoading(),$http({method:"GET",url:appConfig.mediaUrl+"/clipart?get_svg="+t.url.replace("//dpeuzbvf3y4lr.cloudfront.net/","")}).then(function(t){var e=t.data.data;$scope.addSvgFromString(e,!1)},function(t){console.log("Fail to load: svg")}))},$scope.addArt=function(t,e,i){e&&$scope.toggleStageLoading(),null!=t.url.match(/\.(jpeg|jpg|gif|png)$/)?$scope.addImage(t.url,!1,i):fabric.loadSVGFromURL(t.url,function(e,n){e?$scope._addSvg(e,n,t,i):(alert("Try again!"),$scope.toggleStageLoading())})},$scope._addSvg=function(t,e,i,n){var r=$scope.stages[$scope.currentStage],o=r.canvas,s=r.states.scaleRange[r.states.currentScaleIndex].ratio,a=o.width/s*.9,c=o.height/s*.9,l=a;e.width<a&&(l=e.width);var u=l/e.width,h=e.height*u;if(h>c){var f=(h=c)/e.height;l=e.width*f}var p=fabric.util.groupSVGElements(t,e);p.scaleToWidth(l),p.scaleToHeight(h),o.add(p),n&&$scope.toggleStageLoading()},$scope.addQrCode=function(){var t=qrcode(4,"L");t.addData($scope.resource.qrText),t.make();var e=t.createSvgTag();fabric.loadSVGFromString(e,function(t,e){$scope._addSvg(t,e,{name:""},!1)}),jQuery("#barcode").html(""),jQuery(".main-qrcode").html("").append(e)},$scope.addBarCode=function(){jQuery(".main-qrcode").html(""),JsBarcode("#barcode",$scope.resource.qrText,{font:MSKHCONFIG.default_font.alias,lineColor:MSKHCONFIG._default_color}),$timeout(function(){fabric.loadSVGFromString(jQuery("#barcode").wrap("<div/>").parent().html(),function(t,e){$scope._addSvg(t,e,{name:""},!1),jQuery("#barcode").unwrap()})})},$scope.strVcard="",$scope.buildVcart=function(t){var e=$scope.settings.user_infos;$scope.strVcard+="BEGIN:VCARD\nVERSION:3.0\n",$scope.strVcard+="N:"+e.last_name.value+";"+e.first_name.value+"\nFN:"+e.full_name.value,$scope.strVcard+="\nADR;TYPE=home:;;"+e.address.value+";"+e.city.value+";;"+e.postcode.value+";"+e.country.value,$scope.strVcard+="\nTEL;TYPE=home:"+e.phone.value,$scope.strVcard+="\nTEL;TYPE=work:"+e.mobile.value,$scope.strVcard+="\nEMAIL;TYPE=internet,work:"+e.email.value,$scope.strVcard+="\nURL;TYPE=work:"+e.website.value,$scope.strVcard+="\nEND:VCARD";var i=qrcode("0","M");i.addData($scope.strVcard),i.make();var n=i.createSvgTag();fabric.loadSVGFromString(n,function(e,i){var n=$scope.stages[$scope.currentStage],r=n.canvas,o=n.states.scaleRange[n.states.currentScaleIndex].ratio,s=r.width/o*.9,a=r.height/o*.9,c=s;i.width<s&&(c=i.width);var l=c/i.width,u=i.height*l;if(u>a){var h=(u=a)/i.height;c=i.width*h}var f=fabric.util.groupSVGElements(e,i);t?f.set(t):(f.scaleToWidth(c),f.scaleToHeight(u)),f.vcard=1,r.add(f)})},$scope.addUserInfo=function(t){var e=$scope.stages[$scope.currentStage].states,i=["first_name","last_name","full_name"].indexOf(t)>-1?9:7,n=["first_name","last_name","full_name"].indexOf(t)>-1?"nbfontf7afb53fe3":"nbfont92f8d8c63d",r={fontFamily:n,radius:50,objectCaching:!1,fontSize:i*e.ratioConvertFont,ptFontSize:i};r[t]=1;var o="title"==t?"Textbox":"IText";function s(){$scope.stages[$scope.currentStage].canvas.add(new FabricWindow[o]($scope.settings.user_infos[t].value,r))}e.text.font=$scope.getFontInfo(n),_.filter(e.usedFonts,["alias",n]).length||e.usedFonts.push(e.text.font);var a=n.replace(/\s/gi,"").toLowerCase();if(!jQuery("#"+a).length){var c=e.text.font.url;e.text.font.url.indexOf("http")>-1||(c=MSKHCONFIG.font_url+e.text.font.url);var l="";l="<style type='text/css' id='"+a+"' >",l+="@font-face {font-family: '"+n+"';",l+="src: local(''),",l+="url('"+c+"') format('truetype')",l+="}",l+="</style>",jQuery("head").append(l)}new FontFaceObserver(n).load($scope.settings.subsets[e.text.font.subset].preview_text).then(function(){fabric.util.clearFabricFontCache(n),s()},function(){console.log("Fail to load font: "+n),s()})},$scope.initContact=function(){$scope.settings.contact_sheet=[],$scope.settings.contact_sheets.currentContactIndex=0,angular.copy($scope.settings.contact_sheets.contact[$scope.settings.contact_sheets.first_con],$scope.settings.contact_sheet)},$scope.changeContact=function(){angular.copy($scope.settings.contact_sheets.contact[$scope.settings.contact_sheets.first_con],$scope.settings.contact_sheet)},$scope.addContactSheet=function(t,e){var i=$scope.stages[$scope.currentStage].states;if("contact"!=t)if("avatar"!=t){(n={textAlign:"left",ptFontSize:9,fontSize:9*i.ratioConvertFont})[t]=1,$scope.addText($scope.settings.contact_sheets[t],"heading",n)}else $scope.addImage($scope.settings.contact_sheets[t],!0,!0,t,1);else if(angular.isDefined($scope.settings.contact_sheet[$scope.settings.contact_sheets.currentContactIndex])){var n,r=$scope.settings.contact_sheet[$scope.settings.contact_sheets.currentContactIndex];if("c_avatar"!=e)(n={textAlign:"left",ptFontSize:9,fontSize:9*i.ratioConvertFont})[t]=$scope.settings.contact_sheets.currentContactIndex,$scope.addText(r[e],"heading",n);else $scope.addImage(r[e],!0,!0,e,$scope.settings.contact_sheets.currentContactIndex)}},$scope.currentCountryCode="",$scope.contacts=[],$scope._contacts=["","","","","","","",""],$scope.getUsersByCountryCode=function(){""!=$scope.currentCountryCode&&($scope.toggleStageLoading(),$scope.settings.contact_sheet=[],$http({method:"GET",url:MSKHCONFIG.ajax_url+"?action=mskh_get_users_by_country_code&country_code="+$scope.currentCountryCode}).then(function(t){$scope.contacts=t.data,$scope.toggleStageLoading()},function(t){console.log("Fail to load: contacts"),$scope.toggleStageLoading()}))},$scope._changeContact=function(t){$scope.settings.contact_sheet[t]={},angular.copy($scope.contacts[t],$scope.settings.contact_sheet[t])},$scope.updateTemplate=function(){$scope.clearAllStage(),$scope.insertTemplate(!1,{id:$scope.currentLocalTempId})},$scope.tourGuide={firstTime:!0,currentStep:-1,steps:[]},$scope.startTourGuide=function(){if(!$scope.settings.is_mobile){if(-1==$scope.tourGuide.currentStep){var t=[];jQuery.each(jQuery("[data-tour]"),function(){var e=jQuery(this),i=e.attr("data-tour"),n=e.attr("data-tour-priority");t.push({priority:n,template:"tour_guide."+i,element:e})}),$scope.tourGuide.steps=_.sortBy(t,[function(t){return t.priority}])}localStorage.setItem("showTourGuide",1),$scope.tourGuide.currentStep=-1,$timeout(function(){$scope.nextTour()},300)}},$scope.processTourComponents=function(t){var e=$scope.tourGuide.steps[$scope.tourGuide.currentStep].element;if(t)jQuery(".tour-guide").removeClass("active");else{var i=jQuery(".mskh-tourStep"),n=jQuery(".bgTour-top"),r=jQuery(".bgTour-right"),o=jQuery(".bgTour-bottom"),s=jQuery(".bgTour-left"),a=e.outerHeight(),c=e.outerWidth();$scope.tourGuide.firstTime&&(c=75,$scope.tourGuide.firstTime=!1);var l=e.offset(),u=l.top,h=l.left,f=$(window).height()-a-u;$(window).width();n.css({height:u+"px"}),o.css({height:f+"px"}),r.css({top:u+"px",left:h+c+"px",height:a+"px"}),s.css({top:u+"px",width:h+"px",height:a+"px"}),$(window).width()>2*h?(i.attr("data-pos","left"),i.css({top:u+"px",left:h+c+7+"px"})):(i.attr("data-pos","right"),i.css({top:u+"px",left:h-7+"px"})),jQuery(".tour-guide").addClass("active")}},$scope.nextTour=function(){$scope.tourGuide.currentStep<$scope.tourGuide.steps.length-1&&($scope.tourGuide.currentStep++,$scope.processTourComponents())},$scope.prevTour=function(){$scope.tourGuide.currentStep>0&&($scope.tourGuide.currentStep--,$scope.processTourComponents())},jQuery(document).ready(function(){$scope.init()})}]),mskhApp.factory("FabricWindow",["$window",function(t){return t.fabric.Object.prototype.set({transparentCorners:!1,borderColor:"rgba(79, 84, 103,0.7)",cornerStyle:"circle",cornerColor:"rgba(255,255,255,1)",borderDashArray:[2,2],cornerStrokeColor:"rgba(63, 70, 82,1)",fill:MSKHCONFIG._default_color,hoverCursor:"pointer",borderOpacityWhenMoving:0}),checkMobileDevice()&&t.fabric.Object.prototype.set({cornerSize:17}),t.fabric.IText.prototype.set({cursorWidth:1,cursorColor:"#000",selectionColor:"rgba(1, 196, 204, 0.3)",cursorDuration:500}),"no"==MSKHCONFIG._enable_text_free_transform&&t.fabric.IText.prototype.set({_controlsVisibility:{tl:!0,tr:!0,br:!0,bl:!0,ml:!1,mt:!1,mr:!1,mb:!1,mtr:!0}}),t.fabric.Canvas.prototype.set({preserveObjectStacking:!0,controlsAboveOverlay:!0,selectionColor:"rgba(1, 196, 204, 0.3)",selectionBorderColor:"#01c4cc",selectionLineWidth:.5,centeredKey:"shiftKey",uniScaleKey:"altKey"}),t.fabric.Textbox.prototype.set({_controlsVisibility:{tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}),t.fabric.Image.prototype.set({originX:"center",originY:"center"}),fabric.enableGLFiltering=!1,fabric.PathGroup={},fabric.PathGroup.fromObject=function(t,e){var i=t.paths;delete t.paths,"string"==typeof i?fabric.loadSVGFromURL(i,function(n){var r=i,o=fabric.util.groupSVGElements(n,t,r);o.type="group",t.paths=i,e(o)}):fabric.util.enlivenObjects(i,function(n){n.forEach(function(t){t._removeTransformMatrix()});var r=new fabric.Group(n,t);r.type="group",t.paths=i,e(r)})},fabric.LimitedTextbox=fabric.util.createClass(fabric.Textbox,{updateFromTextArea:function(){this.callSuper("updateFromTextArea")}}),t.fabric}]),mskhApp.directive("mskhCanvas",["FabricWindow","$timeout","$rootScope",function(t,e,i){return{restrict:"AE",scope:{stage:"=stage",index:"@",last:"@"},link:function(i,n,r){e(function(){i.stage.canvas=new t.Canvas("mskh-stage-"+i.index),i.$emit("canvas:created",i.index,i.last),n.parent().children().on("contextmenu",function(t){t.preventDefault(),i.$emit("mskh:contextmenu",t)})})}}}]),mskhApp.directive("keypress",["$window",function(t){return{restrict:"AE",link:function(e,i,n){t.document.addEventListener("keydown",function(t){e.$emit("mskh:keypress",t)},!1)}}}]),mskhApp.directive("mskhScroll",["$timeout",function(t){return{restrict:"AE",scope:{container:"@",type:"@",offset:"@",action:"&mskhScroll"},link:function(e,i,n){t(function(){var t="font"!=e.type?jQuery(e.container+" .tab-scroll"):jQuery(e.container),i=parseInt(e.offset),n=jQuery(e.container+" .info-support");t.on("ps-scroll-y",function(){t.prop("clientHeight")!=t.prop("scrollHeight")&&t.prop("scrollTop")+t.prop("clientHeight")-t.prop("scrollHeight")+i>0&&e.action({container:e.container,type:e.type}),n.length&&(t.prop("scrollTop")>1500&&n.addClass("slideInDown animated show")||n.removeClass("slideInDown animated show"))})})}}}]),mskhApp.directive("mskhLayer",["$timeout",function(t){return{restrict:"AE",scope:{action:"&mskhLayer"},link:function(e,i,n){t(function(){checkMobileDevice()||jQuery(i).sortable({placeholder:"sortable-placeholder",containment:"#tab-layer",stop:function(t,i){var n=jQuery(this).attr("data-prev-index"),r=0;r=jQuery(this).attr("data-previndex")>i.item.index()?jQuery(i.item).next().attr("data-index"):jQuery(i.item).prev().attr("data-index"),jQuery(this).removeAttr("data-previndex"),jQuery(this).removeAttr("data-prev-index"),e.action({srcIndex:n,dstIndex:r})},start:function(t,e){jQuery(this).attr("data-prev-index",jQuery(e.item).attr("data-index")),jQuery(this).attr("data-previndex",e.item.index())}})})}}}]),mskhApp.directive("endRepeatColorPicker",["$timeout",function(t){return{restrict:"A",link:function(e,i,n){t(function(){jQuery(i).mskhColorPalette()})}}}]),mskhApp.directive("repeatEnd",[function(){return{restrict:"AE",link:function(t,e,i){t.$last&&t.$eval(i.repeatEnd)}}}]),mskhApp.directive("keyup",["$window",function(t){return{restrict:"AE",link:function(e,i,n){t.document.addEventListener("keyup",function(t){e.$emit("mskh:keyup",t)},!1)}}}]),mskhApp.filter("keyboardShortcut",function(t){return function(e){if(e){var i=e.split("-"),n=/Mac OS X/.test(t.navigator.userAgent),r=!n||i.length>2?"+":"",o={M:n?"":"Ctrl",A:n?"Option":"Alt",S:"Shift"};return i.map(function(t,e){return e==i.length-1?t:o[t]}).join(r)}}}),mskhApp.filter("filterFont",function(){return function(t,e){var i=[];return angular.forEach(t,function(t,n){var r=[];r.limit=!(i.length>e.perPage*e.currentPage-1),e.search?r.name=t.name.toLowerCase().indexOf(e.search.toLowerCase())>=0:r.name=!0,r.limit&&r.name&&i.push(t)}),i=_.sortBy(i,[function(t){return t.name}])}}),mskhApp.filter("filterArt",function(){return function(t,e){var i=[];return t=_.sortBy(t,[function(t){return t.name}]),angular.forEach(t,function(t,n){var r=[];r.limit=!(i.length>e.perPage*e.currentPage-1),e.search?r.name=t.name.toLowerCase().indexOf(e.search.toLowerCase())>=0:r.name=!0,e.currentCat.id?r.cat=!!_.includes(t.cat,e.currentCat.id):r.cat=!0,r.limit&&r.name&&r.cat&&i.push(t)}),i}}),mskhApp.filter("reverse",function(){return function(t){return t.slice().reverse()}}),mskhApp.directive("imageOnLoad",[function(){return{restrict:"A",scope:{src:"=imageOnLoad"},link:function(t,e){var i=new Image;i.onload=function(){e.removeClass("image-onload")},i.src=t.src,e.addClass("image-onload")}}}]),mskhApp.directive("fontOnLoad",[function(){return{restrict:"A",scope:{font:"=",preview:"=",loadFontFailAction:"&"},link:function(t,e){var i=t.font.alias,n=t.font.type;if(""!=i){var r=i.replace(/\s/gi,"").toLowerCase();if(!jQuery("#"+r).length)if("google"==n)jQuery("head").append('<link id="'+r+'" href="https://fonts.googleapis.com/css?family='+i.replace(/\s/gi,"+")+':400,400i,700,700i" rel="stylesheet" type="text/css">');else{var o=t.font.url;t.font.url.indexOf("http")>-1||(o=MSKHCONFIG.font_url+t.font.url);var s="";s="<style type='text/css' id='"+r+"' >",s+="@font-face {font-family: '"+i+"';",s+="src: local(''),",s+="url('"+o+"') format('"+("ttf"==n.toLowerCase()?"truetype":"woff")+"')",s+="}",s+="</style>",jQuery("head").append(s)}new FontFaceObserver(i).load(t.preview).then(function(){e.removeClass("font-loading")},function(){t.loadFontFailAction({font:t.font})}),e.addClass("font-loading")}}}}]),mskhApp.directive("mskhDndFile",["$timeout",function(t){return{restrict:"A",scope:{uploadFile:"&mskhDndFile"},link:function(e,i){t(function(){var t=jQuery(i),n=t.find('input[type="file"]');function r(e){e.preventDefault(),e.stopPropagation(),t.addClass("highlight")}function o(e){e.preventDefault(),e.stopPropagation(),t.removeClass("highlight")}function s(t){t.length>0&&e.uploadFile({files:t})}_.each(["dragenter","dragover"],function(e,i){t.on(e,r)}),_.each(["dragleave","drop"],function(e,i){t.on(e,o)}),t.on("drop",function(t){{if(jQuery("#accept-term").length&&!jQuery("#accept-term").is(":checked"))return void alert(MSKHCONFIG.mskhlangs.alert_upload_term);t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.files.length&&(t.preventDefault(),t.stopPropagation(),s(t.originalEvent.dataTransfer.files))}}),t.on("click",function(t){n.click()}),n.on("click",function(t){if(t.stopPropagation(),jQuery("#accept-term").length&&!jQuery("#accept-term").is(":checked"))return alert(MSKHCONFIG.mskhlangs.alert_upload_term),void t.preventDefault()}),n.on("change",function(){s(this.files)})})}}}]),mskhApp.directive("mskhDrag",[function(){return{restrict:"AE",scope:{url:"=mskhDrag",extenal:"@extenal",type:"@type"},link:function(t,e,i){e.attr("draggable","true"),e.on("dragstart",function(e){e.originalEvent.dataTransfer.setData("src",t.url),e.originalEvent.dataTransfer.setData("extenal",t.extenal),e.originalEvent.dataTransfer.setData("type",t.type)})}}}]),mskhApp.directive("rulerGuideline",["$timeout",function(t){return{restrict:"AE",scope:{direction:"@rulerGuideline",preventClick:"=preventClick",offset:"=offset",ratio:"@ratio",cwidth:"@cwidth"},link:function(e,i,n){t(function(){var t=jQuery(i),n=t.parents(".stage");t.on("mousedown",function(t){n.find(".guide-backdrop").removeClass("mskh-prevent-event"),n.on("mousemove.mskh-move-guideline",function(t){var i=parseFloat(e.ratio),r=parseFloat(e.cwidth),o=n.offset(),s=t.pageY-o.top+n.scrollTop(),a=t.pageX-o.left+n.scrollLeft();s=s<=40?s:40+(s-40)/i;var c=n.width(),l=(r*i-c)/2;a=l<0?a>50?c/2-(c/2+50-a)/i+50:a:c/2-(c/2+50+l-a)/i+50,e.offset="hor"==e.direction?s:a}),t.preventDefault()}).on("mouseup",function(t){n.off("mousemove.mskh-move-guideline"),n.find(".guide-backdrop").addClass("mskh-prevent-event")}),n.on("mouseup",function(){n.off("mousemove.mskh-move-guideline"),n.find(".guide-backdrop").addClass("mskh-prevent-event")}),t.trigger("mousedown")})}}}]),mskhApp.directive("mskhColorPicker",["$timeout",function(t){return{restrict:"C",scope:{cattr:"@",color:"@"},link:function(e,i){jQuery(i).on("click",function(){t(function(){jQuery("#mskh-global-color-palette").addClass("show")}),e.$emit("mskh:picker",e.cattr,e.color)})}}}]),mskhApp.directive("mskhClearStage",function(){return{restrict:"A",link:function(t,e){jQuery(e).on("click",function(){jQuery(".mskh-popup.popup-select, .v-popup.v-popup-select").nbShowPopup()})}}}),mskhApp.directive("convertToNumber",function(){return{require:"ngModel",link:function(t,e,i,n){n.$parsers.push(function(t){return null!=t?parseInt(t,10):null}),n.$formatters.push(function(t){return null!=t?""+t:null})}}}),mskhApp.factory("MSKHDataFactory",function(t){return{get:function(e,i,n){var r=new FormData;r.append("action",e);var o="mskh_get_resource"==e?MSKHCONFIG.nonce_get:MSKHCONFIG.nonce;r.append("nonce",o),angular.forEach(i,function(t,e){var i;if("object"!=typeof t||_.includes(["file","design","config","product","upload","used_font","option"],e)||e.indexOf("frame")>-1)r.append(e,t);else for(var n in t)t.hasOwnProperty(n)&&(i=[e,"[",n,"]"].join(""),r.append(i,t[n]))});var s={transformRequest:angular.identity,transformResponse:angular.identity,headers:{"Content-Type":void 0}},a=MSKHCONFIG.ajax_url;"typography"!=i.type&&"get_typo"!=i.type||(a=appConfig.mediaUrl+"/typo"),"media"==i.source&&(a=appConfig.mediaUrl+"/template"),t.post(a,r,s).then(function(t){n(t.data)},function(t){console.log(t)})}}}),"yes"==MSKHCONFIG._enable_facebook_photo&&""!=MSKHCONFIG.fbID){window.fbAsyncInit=function(){FB.init({appId:MSKHCONFIG.fbID,status:!0,cookie:!0,xfbml:!0,autoLogAppEvents:!0,version:"v3.0"})},function(t,e,i){var n,r=t.getElementsByTagName("script")[0];t.getElementById(i)||((n=t.createElement("script")).id=i,n.src="https://connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(n,r))}(document,0,"facebook-jssdk");var mskhOnFBLogin=function(){FB.getLoginStatus(function(t){if("connected"===t.status){var e=t.authResponse.userID,i=t.authResponse.accessToken,n=angular.element(document.getElementById("designer-controller")).scope();n.getPersonalPhoto("facebook",[e,i]),n.updateApp()}})}}function requestFullScreen(t){var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(e)e.call(t);else if(void 0!==window.ActiveXObject){var i=new ActiveXObject("WScript.Shell");null!==i&&i.SendKeys("{Esc}")}}function exitFullscreen(){var t=document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.exitFullscreen;t&&t.call(document)}function setCookie(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var r="expires="+n.toUTCString();document.cookie=t+"="+e+"; "+r}function getCookie(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var r=i[n];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(e))return r.substring(e.length,r.length)}return""}function receiveMessage(t){t.origin==window.location.origin&&"change_nbo_options"==t.data&&angular.element(document.getElementById("designer-controller")).scope().changePrintingOptions()}function mskhPostMessage(){mskh_window.postMessage("received",window.location.origin)}if(window.addEventListener("message",receiveMessage,!1),mskh_window.jQuery('input[name="variation_id"]').on("change",function(){if((1==MSKHCONFIG.ui_mode||3==MSKHCONFIG.ui_mode&&angular.isUndefined(window.nbOption))&&appConfig.ready){var t=mskh_window.jQuery('input[name="variation_id"]').val();if(MSKHCONFIG.variation_id==t)return;var e=angular.element(document.getElementById("designer-controller")).scope();""!=t&&(mskh_window.MSKHPRODUCT._unready(),"yes"==MSKHCONFIG._hide_button_cart_in_detail_page&&mskh_window.jQuery('button[type="submit"].single_add_to_cart_button').hide()),MSKHCONFIG.variation_id=t,""!=t&&e.changeVariation()}}),jQuery(document).on("change_nbo_options_without_od_option",function(){if(appConfig.ready&&3==MSKHCONFIG.ui_mode&&mskh_window.jQuery('input[name="variation_id"]').length){var t=mskh_window.jQuery('input[name="variation_id"]').val();if(MSKHCONFIG.variation_id==t)return;if(MSKHCONFIG.variation_id=t,""!=t)angular.element(document.getElementById("designer-controller")).scope().changeVariation()}}),jQuery(document).on("change_nbo_options_with_od_option",function(){if(appConfig.ready&&3==MSKHCONFIG.ui_mode){var t=angular.element(document.getElementById("designer-controller")).scope();if(mskh_window.jQuery('input[name="variation_id"]').length){var e=mskh_window.jQuery('input[name="variation_id"]').val();MSKHCONFIG.variation_id=e}t.changePrintingOptions()}}),jQuery(document).on("change_nbo_options",function(){if(appConfig.ready){var t=angular.element(document.getElementById("designer-controller")).scope();jQuery('input[name="variation_id"]').length?(t.printingOptionsAvailable=jQuery('input[name="variation_id"]').val()>0,MSKHCONFIG.variation_id=jQuery('input[name="variation_id"]').val()):t.printingOptionsAvailable=!0,t.updateApp()}}),jQuery(document).on("invalid_nbo_options",function(){if(appConfig.ready){var t=angular.element(document.getElementById("designer-controller")).scope();t.printingOptionsAvailable=!1,t.updateApp()}}),3==MSKHCONFIG.ui_mode){var bootstrapmskhApp=function(){var t=document.getElementById("mskh-vista-app");angular.element(function(){angular.bootstrap(t,["mskhApp"])})};window.nbOption?jQuery(document).on("initialed_nbo_options",function(){bootstrapmskhApp()}):bootstrapmskhApp()}